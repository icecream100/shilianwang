# 需求文档 - 系统设置

## 1. 概述
### 1.1 背景
随着运营门户功能的日益复杂和用户规模的增长，需要一个强大且灵活的后台管理系统来支撑日常运营和维护工作。系统设置模块作为运营门户的核心组成部分，旨在为管理员提供用户账户管理、角色权限配置等关键功能，确保系统的安全、稳定、高效运行。

## 2.  目标

- 提供精细化的用户管理功能，支持用户信息的增删改查及状态控制。
- 实现灵活的角色管理和权限分配机制，满足不同岗位用户的操作需求。
- 保障系统操作的安全性与合规性，所有关键操作均有日志记录。
- 提升管理效率，简化管理员的日常维护工作。

## 3. 用户与场景

### 3.1 目标用户

- 系统管理员：负责整个运营门户的系统配置、用户账户管理、权限分配、安全监控等。
- 运营主管/经理：可能需要管理特定范围内的用户或查看特定模块的数据，权限由系统管理员授予。
- 作为一个系统管理员，我想要方便地新增和调整部门信息，以便于公司的组织架构在系统中能够得到准确体现。

### 3.2 用户场景/故事

- 场景一：系统管理员需要为新入职的运营人员创建一个门户访问账号，并根据其岗位职责分配相应的操作权限。
    - 作为一个系统管理员，我想要快速创建一个新的用户账号并为其分配合适的角色，以便于新员工能够立即开始工作。
- 场景二：系统管理员发现某个用户账号存在异常操作风险，需要立即禁用该账号。
    - 作为一个系统管理员，我想要能够立即禁用某个用户的账号，以便于阻止潜在的安全风险。
- 场景三：系统管理员需要根据公司组织架构调整，修改现有用户的角色或权限。
    - 作为一个系统管理员，我想要方便地修改用户的角色和权限配置，以便于适应组织结构或职责的变化。
- 场景四：系统管理员需要创建一个新的运营角色，并为该角色配置特定的功能模块访问权限。
    - 作为一个系统管理员，我想要灵活地定义新的角色并精确控制其权限范围，以便于满足不同业务场景的需求。
- 场景五: 公司新增了一个业务团队，系统管理员需要在运营门户中建立对应的部门结构。
        - 作为一个系统管理员，我想要方便地新增和调整部门信息，以便于公司的组织架构在系统中能够得到准确体现。

## 4. 功能范围/列表

- 4.1 用户管理
- 4.2 角色管理
- 4.3 部门管理

## 5. 功能模块详情

---

### 5.1 功能模块：用户管理

#### 5.1.1 功能描述与目标

- 解决问题: 提供对运营门户用户账户的全面管理能力，包括用户的创建、信息维护、状态控制、角色分配等，确保用户信息的准确性和账户的安全性。
- 用户价值/目标: 管理员能够高效、准确地管理所有用户账户，控制用户对系统资源的访问，保障系统运营的有序进行。
- 核心能力概述: 支持用户列表展示与筛选、新增用户、编辑用户信息、删除用户、启用/禁用用户状态、为用户分配角色。

#### 5.1.2 原型参考

- 主要原型页面: [系统设置原型.html - 用户管理页面](file:///Users/wangjingang/Library/Mobile%20Documents/iCloud~md~obsidian/Documents/alex/02工作/视联网适配中心/html_prototypes/系统设置原型.html)

#### 5.1.3 详细需求

##### 5.1.3.1 功能入口与触发条件

- 入口: 左侧导航栏 -> 系统配置 -> 用户管理 [参考原型 系统设置原型.html]
- 触发条件: 用户已登录，并拥有"用户管理"或"系统管理员"等具备相应操作权限的角色。

##### 5.1.3.2 交互流程与界面详述

- 主界面/列表描述: [参考原型 系统设置原型.html - 用户管理页面]
    - 布局: 顶部为筛选区域，下方为用户数据列表，列表上方包含"新增用户"等操作按钮。
    - 包含元素:
        - 筛选区: 用户名输入框、姓名输入框、手机号输入框、状态选择器（全部、启用、禁用）、"查询"按钮、"重置"按钮。
        - 操作按钮区: "新增用户"按钮（蓝色主要按钮）。
        - 用户列表: 显示列包括：序号、用户名、姓名、手机号、邮箱、所属部门、角色、状态（启用/禁用标签）、创建时间、操作（编辑、分配角色、启用/禁用、删除）。
    - 默认交互/排序: 列表默认按创建时间降序排列。支持分页功能，每页10条记录。
- 核心操作流程细化:
    - A. 新增用户 流程:
        - 触发: 点击列表上方的"新增用户"按钮。
        - 交互步骤:
            - Step 1: 系统弹出"新增用户"对话框（600px宽度）[参考原型 系统设置原型.html - 新增用户对话框]。
            - Step 2: 用户填写表单字段：
                - 用户名（必填）: 文本输入框，支持字母、数字、下划线
                - 姓名（必填）: 文本输入框
                - 手机号（必填）: 文本输入框，格式验证
                - 邮箱（必填）: 文本输入框，格式验证
                - 所属部门（必填）: 下拉选择器，级联选择部门
                - 密码（必填）: 密码输入框，强度验证
                - 确认密码（必填）: 密码输入框，一致性验证
            - Step 3: 用户点击"确定"按钮。
            - Step 4: 前端校验: 必填项校验、手机号格式校验（^1[3-9]\d{9}$）、邮箱格式校验、密码复杂度校验。
            - Step 5: 后端校验: 用户名唯一性校验。
            - Step 6: 结果处理:
                - 成功: 关闭弹窗，列表刷新显示新增用户，并给出成功提示"新增用户成功"。
                - 失败 (业务校验): 在弹窗内提示具体错误信息，如"用户名已存在"。
            - Step 7: 用户点击"取消"按钮，弹窗关闭，无数据变更。
    - B. 查询用户 流程:
        - 触发: 用户在筛选区输入条件后，点击"查询"按钮。
        - 交互步骤:
            - Step 1: 用户输入一个或多个筛选条件（用户名、姓名、手机号、状态）。
            - Step 2: 用户点击"查询"按钮，显示加载状态。
            - Step 3: 系统根据筛选条件从后端获取匹配的用户数据，并刷新用户列表。
            - Step 4: 若无匹配数据，列表显示"暂无数据"提示。
            - Step 5: 用户点击"重置"按钮，清除所有筛选条件，列表恢复显示所有用户。
    - C. 修改用户信息 流程:
        - 触发: 点击用户列表中对应行操作列的"编辑"按钮。
        - 交互步骤:
            - Step 1: 系统弹出"编辑用户"对话框，并回填该用户的现有信息 [参考原型 系统设置原型.html - 编辑用户对话框]。用户名字段置为只读状态。
            - Step 2: 用户修改姓名、手机号、邮箱、部门、状态等信息。密码字段不显示，可提供"重置密码"选项。
            - Step 3: 用户点击"确定"按钮。
            - Step 4: 前端校验: 必填项校验、格式校验。
            - Step 5: 后端校验: （若修改了唯一性相关的字段，如手机号，需校验）。
            - Step 6: 结果处理:
                - 成功: 关闭弹窗，列表刷新显示更新后的用户信息，并给出成功提示"用户信息修改成功"。
                - 失败: 在弹窗内提示具体错误信息。
            - Step 7: 用户点击"取消"按钮，弹窗关闭，无数据变更。
    - D. 删除用户 流程:
        - 触发: 点击用户列表中对应行操作列的"删除"按钮。
        - 交互步骤:
            - Step 1: 系统弹出二次确认对话框，提示"确定要删除用户 [用户名] 吗？此操作不可恢复。"
            - Step 2: 用户点击"确定"按钮。
            - Step 3: 后端执行删除前校验：检查是否为超级管理员账户（如admin），若是则禁止删除并提示"超级管理员账户不允许删除"。
            - Step 4: 后端执行删除操作（逻辑删除）。
            - Step 5: 结果处理:
                - 成功: 关闭确认对话框，列表刷新移除被删除用户，并给出成功提示"用户删除成功"。
                - 失败: 提示具体错误信息。
            - Step 6: 用户点击"取消"按钮，确认对话框关闭，无操作。
    - E. 修改用户状态 (启用/禁用) 流程:
        - 触发: 点击用户列表中对应行操作列的"启用"或"禁用"按钮（按钮文本根据当前状态动态显示）。
        - 交互步骤:
            - Step 1: 系统弹出二次确认对话框，提示"确定要[启用/禁用]用户 [用户名] 吗？"
            - Step 2: 用户点击"确定"按钮。
            - Step 3: 后端更新用户状态。
            - Step 4: 结果处理:
                - 成功: 关闭确认对话框，列表中该用户的状态标签更新（绿色"启用"或灰色"禁用"），操作按钮相应变化，并给出成功提示"用户状态修改成功"。
                - 失败: 提示具体错误信息。
            - Step 5: 用户点击"取消"按钮，确认对话框关闭，无操作。
    - F. 分配角色 流程:
        - 触发: 点击用户列表中对应行操作列的"分配角色"按钮。
        - 交互步骤:
            - Step 1: 系统弹出"分配角色"对话框（400px宽度）[参考原型 系统设置原型.html - 分配角色对话框]，显示当前用户信息（姓名和用户名，只读）。
            - Step 2: 界面显示角色选择区域，包含说明文字"请选择要分配的角色："。
            - Step 3: 以复选框组形式展示所有可用角色，每个角色项包含：
                - 角色复选框: 用于选择/取消选择该角色
                - 角色名称: 如"系统管理员"、"运营人员"、"查看员"
                - 角色状态标签: 显示"启用"或"禁用"状态
                - 禁用状态的角色不可选择
            - Step 4: 系统根据用户当前角色，预选中对应的复选框。
            - Step 5: 用户通过复选框选择或取消选择角色。
            - Step 6: 用户点击"确定"按钮。
            - Step 7: 后端保存用户与角色的关联关系。
            - Step 8: 结果处理:
                - 成功: 关闭弹窗，用户列表中该用户的角色信息更新，并给出成功提示"角色分配成功"。
                - 失败: 在弹窗内提示具体错误信息。
            - Step 9: 用户点击"取消"按钮，弹窗关闭，无数据变更。

##### 5.1.3.3 字段定义与数据规则

| 字段名称 | 字段标识 (Eng) | 数据类型 & 长度 | 界面显隐/读写 | 约束/规则 (强调唯一性、格式、范围、必填、默认值、选项来源) | 数据来源/去向 | 备注/说明 |
|--------------|------------------|-------------------|---------------|--------------------------------------------------------------------|-----------------|----------------------|
| 用户ID | userId | Long | 后端生成/不直接显示 | 主键，自增 | 系统生成 | 内部唯一标识 |
| 用户名 | username | String(50) | 显示/新增时写，编辑时只读 | 必填，唯一，4-20位字母数字下划线 | 用户输入 | 登录凭证 |
| 姓名 | realName | String(50) | 显示/读写 | 必填 | 用户输入 | |
| 密码 | password | String(255) | 新增时写/不显示 | 必填（新增时），符合密码复杂度策略，加密存储 | 用户输入 | 编辑时不显示 |
| 手机号 | phoneNumber | String(20) | 显示/读写 | 可选，格式校验^1[3-9]\d{9}$ | 用户输入 | |
| 邮箱 | email | String(100) | 显示/读写 | 可选，邮箱格式校验 | 用户输入 | |
| 所属部门ID | deptId | Long | 显示/读写（通过下拉选择器） | 可选，引用部门表ID | 用户选择 | 关联部门 |
| 状态 | status | Integer | 显示/可操作修改 | 必填，0:禁用, 1:启用。默认1 | 系统/管理员操作 | 显示为标签形式 |
| 角色ID列表 | roleIds | List\<Long\> | 分配角色时选择/不直接显示 | 多选 | 用户选择（复选框） | 关联角色 |
| 创建时间 | createTime | DateTime | 列表显示/只读 | 自动生成 | 系统自动生成 | 格式：YYYY-MM-DD HH:mm:ss |
| 更新时间 | updateTime | DateTime | 不显示/只读 | 自动更新 | 系统自动生成 | |
| 创建者 | creator | String(50) | 可选显示/只读 | 记录操作人 | 系统记录 | |
| 更新者 | updater | String(50) | 可选显示/只读 | 记录操作人 | 系统记录 | |

##### 5.1.3.4 权限控制

- 功能访问权限: 拥有"用户管理查看"或更高权限（如"用户管理完全控制"、"系统管理员"）的角色可以访问用户管理界面。
- 操作权限:
    - 新增用户: 需要"用户新增"权限。
    - 修改用户信息: 需要"用户修改"权限。
    - 删除用户: 需要"用户删除"权限。
    - 修改用户状态: 需要"用户状态修改"权限。
    - 分配角色: 需要"用户角色分配"权限。
    - 查询用户: 基础访问权限即可。
- 数据权限 (如适用): 默认情况下，拥有用户管理权限的管理员可以管理所有用户。可根据需求扩展，如部门管理员只能管理其本部门及下级部门的用户（需结合组织架构）。

#### 5.1.4 业务规则

- 用户名唯一性: 系统中用户名必须唯一，不允许重复。
- 密码安全策略: 新增用户或重置密码时，密码必须符合预设的复杂度要求（如长度、字符类型组合、与历史密码不同等）。密码需加密存储。
- 默认状态: 新增用户默认为"启用"状态。
- 删除用户: 删除用户时，采用逻辑删除（标记为已删除，数据保留）。超级管理员账户（如admin）不允许被删除。
- 超级管理员保护: 系统应内置一个或多个超级管理员账户，该账户不允许被删除或禁用，其核心权限不可被剥夺。
- 角色关联: 用户可以被分配一个或多个角色。
- 部门关联: 用户可以选择所属部门，部门数据来源于预设的部门列表（技术部、运营部、业务部、市场部等）。

#### 5.1.5 异常处理方案

- 用户名已存在: 新增用户时，如用户名与现有用户重复，应提示"用户名已存在，请使用其他用户名"。
- 手机号/邮箱格式错误: 提示"请输入正确的手机号"或"请输入正确的邮箱地址"。
- 密码不符合策略: 提示具体的密码策略要求。
- 删除超级管理员: 尝试删除超级管理员账户时，提示"超级管理员账户不允许删除"。
- 无权限操作: 提示"您没有执行此操作的权限"。
- 网络异常/服务器错误: 通用错误提示"操作失败，请稍后重试或联系管理员"。
- 查询超时: 查询操作超过30秒未响应时，提示"查询超时，请重试"。

#### 5.1.6 与其他功能的关联和依赖

- 依赖项 (Dependencies):
    - 角色管理模块: 需要获取角色列表供用户分配。
    - 部门管理模块: 需要获取部门列表供用户选择所属部门。
    - 系统日志模块: 所有用户管理相关的操作（增删改、状态变更、角色分配）均需记录详细日志。
- 被依赖项 (Generated Dependencies):
    - 登录模块: 验证用户身份时需要查询用户信息及状态。
    - 各业务模块: 需要根据当前登录用户的权限（通过其角色获取）来控制功能可见性和可操作性。

---

### 5.2 功能模块：角色管理

#### 5.2.1 功能描述与目标

- 解决问题: 提供对运营门户内用户角色的定义和权限配置能力，实现基于角色的访问控制 (RBAC)。
- 用户价值/目标: 管理员能够创建和管理不同的角色，并为每个角色精确分配其所需的操作权限，从而实现权限的集中管理和灵活分配，保障系统安全，简化权限维护。
- 核心能力概述: 支持角色列表展示与筛选、新增角色、编辑角色信息、删除角色、启用/禁用角色状态、为角色分配权限（菜单权限）。

#### 5.2.2 原型参考

- 主要原型页面: [系统设置原型.html - 角色管理页面](file:///Users/wangjingang/Library/Mobile%20Documents/iCloud~md~obsidian/Documents/alex/02工作/视联网适配中心/html_prototypes/系统设置原型.html)

#### 5.2.3 详细需求

##### 5.2.3.1 功能入口与触发条件

- 入口: 左侧导航栏 -> 系统配置 -> 角色管理 [参考原型 系统设置原型.html]
- 触发条件: 用户已登录，并拥有"角色管理"或"系统管理员"等具备相应操作权限的角色。

##### 5.2.3.2 交互流程与界面详述

- 主界面/列表描述: [参考原型 系统设置原型.html - 角色管理页面]
    - 布局: 顶部为筛选区域，下方为角色数据列表，列表上方包含"新增角色"等操作按钮。
    - 包含元素:
        - 筛选区: 角色名称输入框、"查询"按钮、"重置"按钮。
        - 操作按钮区: "新增角色"按钮（蓝色主要按钮）。
        - 角色列表: 显示列包括：序号、角色名称、角色标识、角色描述、状态（启用/禁用标签）、创建时间、操作（编辑、授权、启用/禁用、删除）。
    - 默认交互/排序: 列表默认按创建时间降序排列。支持分页功能，每页10条记录。
- 核心操作流程细化:
    - A. 新增角色 流程:
        - 触发: 点击列表上方的"新增角色"按钮。
        - 交互步骤:
            - Step 1: 系统弹出"新增角色"对话框（600px宽度）[参考原型 系统设置原型.html - 新增角色对话框]。
            - Step 2: 用户填写表单字段：
                - 角色名称（必填）: 文本输入框，中文名称
                - 角色标识（必填）: 文本输入框，英文标识，系统唯一
                - 角色描述（可选）: 多行文本输入框
                - 状态（必填）: 单选按钮，默认启用
            - Step 3: 用户点击"确定"按钮。
            - Step 4: 前端校验: 必填项校验（角色名称、角色标识）、角色标识格式校验（仅限字母数字下划线）。
            - Step 5: 后端校验: 角色名称唯一性校验、角色标识唯一性校验。
            - Step 6: 结果处理:
                - 成功: 关闭弹窗，列表刷新显示新增角色，并给出成功提示"新增角色成功"。
                - 失败 (业务校验): 在弹窗内提示具体错误信息，如"角色名称已存在"。
            - Step 7: 用户点击"取消"按钮，弹窗关闭，无数据变更。
    - B. 查询角色 流程:
        - 触发: 用户在筛选区输入条件后，点击"查询"按钮。
        - 交互步骤:
            - Step 1: 用户输入角色名称进行筛选。
            - Step 2: 用户点击"查询"按钮，显示加载状态。
            - Step 3: 系统根据筛选条件从后端获取匹配的角色数据，并刷新角色列表。
            - Step 4: 若无匹配数据，列表显示"暂无数据"提示。
            - Step 5: 用户点击"重置"按钮，清除筛选条件，列表恢复显示所有角色。
    - C. 修改角色信息 流程:
        - 触发: 点击角色列表中对应行操作列的"编辑"按钮。
        - 交互步骤:
            - Step 1: 系统弹出"编辑角色"对话框，并回填该角色的现有信息 [参考原型 系统设置原型.html - 编辑角色对话框]。角色标识字段置为只读状态。
            - Step 2: 用户修改角色名称、角色描述、状态。
            - Step 3: 用户点击"确定"按钮。
            - Step 4: 前端校验: 必填项校验。
            - Step 5: 后端校验: 角色名称唯一性校验（排除自身）。
            - Step 6: 结果处理:
                - 成功: 关闭弹窗，列表刷新显示更新后的角色信息，并给出成功提示"角色信息修改成功"。
                - 失败: 在弹窗内提示具体错误信息。
            - Step 7: 用户点击"取消"按钮，弹窗关闭，无数据变更。
    - D. 删除角色 流程:
        - 触发: 点击角色列表中对应行操作列的"删除"按钮。
        - 交互步骤:
            - Step 1: 系统弹出二次确认对话框，提示"确定要删除角色 [角色名称] 吗？删除后，拥有此角色的用户将失去相应权限。"
            - Step 2: 用户点击"确定"按钮。
            - Step 3: 后端校验: 检查该角色是否为内置保护角色（如admin角色），若是则禁止删除并提示"内置保护角色，不允许删除"。
            - Step 4: 后端执行删除操作（同时删除角色与权限的关联）。
            - Step 5: 结果处理:
                - 成功: 关闭确认对话框，列表刷新移除被删除角色，并给出成功提示"角色删除成功"。
                - 失败: 提示具体错误信息。
            - Step 6: 用户点击"取消"按钮，确认对话框关闭，无操作。
    - E. 角色授权 (分配权限) 流程:
        - 触发: 点击角色列表中对应行操作列的"授权"按钮。
        - 交互步骤:
            - Step 1: 系统弹出"角色授权"对话框（600px宽度）[参考原型 系统设置原型.html - 角色授权对话框]。显示当前角色信息（角色名称和角色标识，只读）。
            - Step 2: 界面以树状结构展示所有可分配的菜单权限项，权限树包含三个主要模块：运营门户（驾驶舱、客户管理、运营分析、运行监控、系统配置、日志管理）、接口适配（接入平台管理、设备管理、通道管理）、业务数据采集（业务采集设置、客户同步设置、任务状态）。
            - Step 3: 该角色已拥有的权限项默认勾选。支持父子节点联动选择。
            - Step 4: 用户通过勾选/取消勾选来为角色增删权限。
            - Step 5: 用户点击"确定"按钮。
            - Step 6: 后端保存角色与权限的关联关系（包括选中的节点和半选中的父节点）。
            - Step 7: 结果处理:
                - 成功: 关闭弹窗，并给出成功提示"角色授权成功"。
                - 失败: 在弹窗内提示具体错误信息。
            - Step 8: 用户点击"取消"按钮，弹窗关闭，无数据变更。
    - F. 修改角色状态 (启用/禁用) 流程:
        - 触发: 点击角色列表中对应行操作列的"启用"或"禁用"按钮。
        - 交互步骤:
            - Step 1: 系统弹出二次确认对话框，提示"确定要[启用/禁用]角色 [角色名称] 吗？禁用后，拥有此角色的用户将临时失去相应权限。"
            - Step 2: 用户点击"确定"按钮。
            - Step 3: 后端更新角色状态。
            - Step 4: 结果处理:
                - 成功: 关闭确认对话框，列表中该角色的状态标签更新（绿色"启用"或灰色"禁用"），操作按钮相应变化，并给出成功提示"角色状态修改成功"。
                - 失败: 提示具体错误信息。
            - Step 5: 用户点击"取消"按钮，确认对话框关闭，无操作。

##### 5.2.3.3 字段定义与数据规则

| 字段名称 | 字段标识 (Eng) | 数据类型 & 长度 | 界面显隐/读写 | 约束/规则 (强调唯一性、格式、范围、必填、默认值、选项来源) | 数据来源/去向 | 备注/说明 |
|--------------|------------------|-------------------|---------------|--------------------------------------------------------------------|-----------------|----------------------|
| 角色ID | roleId | Long | 后端生成/不直接显示 | 主键，自增 | 系统生成 | 内部唯一标识 |
| 角色名称 | roleName | String(50) | 显示/读写 | 必填，唯一 | 用户输入 | |
| 角色标识 | roleKey | String(50) | 显示/新增时写，编辑时只读 | 必填，唯一，^[a-zA-Z0-9_]+$ | 用户输入 | 程序中判断权限用 |
| 角色描述 | description | String(200) | 显示/读写 | 可选，最大200字符 | 用户输入 | 多行文本输入 |
| 状态 | status | Integer | 显示/可操作修改 | 必填，0:禁用, 1:启用。默认1 | 系统/管理员操作 | 显示为标签形式 |
| 权限ID列表 | permissionIds | List\<Long\> | 授权时选择/不直接显示 | 多选 | 用户选择（权限树） | 关联权限项 |
| 创建时间 | createTime | DateTime | 列表显示/只读 | 自动生成 | 系统自动生成 | 格式：YYYY-MM-DD HH:mm:ss |
| 更新时间 | updateTime | DateTime | 不显示/只读 | 自动更新 | 系统自动生成 | |
| 创建者 | creator | String(50) | 可选显示/只读 | 记录操作人 | 系统记录 | |
| 更新者 | updater | String(50) | 可选显示/只读 | 记录操作人 | 系统记录 | |

##### 5.2.3.4 权限控制

- 功能访问权限: 拥有"角色管理查看"或更高权限（如"角色管理完全控制"、"系统管理员"）的角色可以访问角色管理界面。
- 操作权限:
    - 新增角色: 需要"角色新增"权限。
    - 修改角色信息: 需要"角色修改"权限。
    - 删除角色: 需要"角色删除"权限。
    - 角色授权: 需要"角色授权"权限。
    - 修改角色状态: 需要"角色状态修改"权限。
    - 查询角色: 基础访问权限即可。
- 数据权限: 默认情况下，拥有角色管理权限的管理员可以管理所有角色。内置的超级管理员角色通常不可被修改或删除其核心权限。

#### 5.2.4 业务规则

- 角色名称/标识唯一性: 系统中角色名称和角色标识必须唯一。
- 权限项定义: 系统预定义权限树结构，包含三个主要模块：
    - 运营门户：驾驶舱、客户管理、运营分析（客户分析、设备分析、业务分析）、运行监控（告警规则管理、告警事件管理）、系统配置（用户管理、角色管理）、日志管理（登录日志、操作日志）
    - 接口适配：接入平台管理、设备管理、通道管理
    - 业务数据采集：业务采集设置、客户同步设置、任务状态
- 默认角色: 系统预设常用角色：系统管理员（拥有所有权限）、运营人员（运营相关权限）、查看员（只读权限）。
- 超级管理员角色保护: 系统内置的超级管理员角色（admin）不允许被删除，其核心权限不可被移除。
- 角色禁用影响: 若一个角色被禁用，则所有拥有该角色的用户将临时失去通过该角色获得的权限。重新启用后，权限恢复。
- 角色删除影响: 若一个角色被删除，则所有拥有该角色的用户将永久失去通过该角色获得的权限。用户与该角色的关联关系也应被清除。
- 权限树联动: 支持父子节点联动选择，勾选父菜单自动勾选其下所有子菜单，取消父菜单自动取消其下所有子菜单。

#### 5.2.5 异常处理方案

- 角色名称/标识已存在: 新增或修改时，如与现有角色冲突，应提示"角色名称/角色标识已存在"。
- 删除内置保护角色: 尝试删除受保护的内置角色（如admin）时，应明确禁止并提示"内置保护角色，不允许删除"。
- 角色标识格式错误: 提示"角色标识只能包含字母、数字和下划线"。
- 无权限操作: 提示"您没有执行此操作的权限"。
- 网络异常/服务器错误: 通用错误提示"操作失败，请稍后重试或联系管理员"。
- 查询超时: 查询操作超过30秒未响应时，提示"查询超时，请重试"。
- 权限树加载失败: 权限分配对话框中权限树加载失败时，提示"权限数据加载失败，请刷新重试"。

#### 5.2.6 与其他功能的关联和依赖

- 依赖项 (Dependencies):
    - 权限资源定义模块: 需要一个地方统一定义系统中所有的权限点（菜单、按钮、API等），形成权限树结构。
    - 系统日志模块: 所有角色管理相关的操作（增删改、授权、状态变更）均需记录详细日志。
- 被依赖项 (Generated Dependencies):
    - 用户管理模块: 在为用户分配角色时，需要获取角色列表。
    - 各业务模块的访问控制: 业务模块需要根据用户拥有的角色及其权限来判断用户是否有权访问特定功能或执行特定操作。

---

### 5.3 功能模块：部门管理

#### 5.3.1 功能描述与目标

- 解决的问题: 提供对公司组织架构的集中管理能力，支持多层级的部门创建、信息维护和结构调整，解决组织架构不清晰、变更维护困难的问题。
    
- 用户价值/目标: 管理员能够方便、直观地维护系统的部门树形结构，为用户管理、权限分配和数据隔离提供准确的组织架构基础。
    
- 核心能力概述: 支持以树形结构展示部门列表、新增部门、编辑部门信息、删除部门。
    

#### 5.3.2 原型参考

- 主要原型页面: 系统设置原型.html - 部门管理页面
    

#### 5.3.3 详细需求

##### 5.3.3.1 功能入口与触发条件

- 入口: 左侧导航栏 -> 系统配置 -> 部门管理
    
- 触发条件: 用户已登录，并拥有"部门管理"或"系统管理员"等具备相应操作权限的角色。
    

##### 5.3.3.2 交互流程与界面详述

- 主界面/列表描述: [参考原型 系统设置原型.html - 部门管理页面]
    
    - 布局: 顶部为筛选区域，下方为部门数据列表（树形表格），列表上方包含操作按钮。
        
    - 包含元素:
        
        - 筛选区: 部门名称输入框、状态选择器（全部、启用、禁用）、"查询"按钮、"重置"按钮。
            
        - 操作按钮区: "新增部门"按钮（蓝色主要按钮）、"展开全部"按钮、"折叠全部"按钮。
            
        - 部门列表: 以树形表格展示，显示列包括：部门名称、排序、负责人、联系电话、邮箱、状态（启用/禁用标签）、创建时间、操作（编辑、新增下级、启用/禁用、删除）。
            
    - 默认交互/排序: 部门树默认按排序号升序排列。支持展开/折叠操作。分页显示，每页10条记录。
    
    - 预设部门数据: 系统预设完整的公司组织架构：
        - 视联网科技有限公司（根部门）
            - 技术部（前端开发组、后端开发组）
            - 运营部（市场推广组、客户服务组）
            - 业务部（销售一组、销售二组、商务支持组）
            - 人力资源部（招聘培训组、薪酬绩效组）
            - 财务部
            - 行政部
        - 北京分公司（北京技术部、北京销售部）
        - 上海分公司（上海运营部、上海客服部）
        - 深圳分公司（深圳研发部）
        
- 核心操作流程细化:
    
    - A. 新增部门 流程:
        
        - 触发: 点击列表上方的“新增一级部门”按钮，或点击部门树节点上的“新增子部门”按钮。
            
        - 交互步骤:
            
            - Step 1: 系统弹出“新增部门”对话框。若为新增子部门，上级部门字段自动填充且只读。
                
            - Step 2: 用户填写表单字段：
                - 部门名称（必填）: 文本输入框
                - 上级部门（可选）: 下拉选择器，树形选择上级部门（若为新增子部门则自动填充且只读）
                - 负责人（可选）: 文本输入框
                - 联系电话（可选）: 文本输入框，格式验证
                - 邮箱（可选）: 文本输入框，格式验证
                - 排序（可选）: 数字输入框，默认为0
                - 部门状态（必填）: 单选按钮，默认启用
                
            - Step 3: 用户点击“确定”按钮。
                
            - Step 4: 前端校验: 必填项校验（部门名称）。
                
            - Step 5: 后端校验: 同级部门下的部门名称唯一性校验。
                
            - Step 6: 结果处理:
                
                - 成功: 关闭弹窗，部门树刷新显示新增的部门节点，并给出成功提示“新增部门成功”。
                    
                - 失败 (业务校验): 在弹窗内提示具体错误信息，如“同级部门下该名称已存在”。
                    
            - Step 7: 用户点击“取消”按钮，弹窗关闭，无数据变更。
                
    - B. 修改部门信息 流程:
        
        - 触发: 点击部门树节点上的“编辑”按钮。
            
        - 交互步骤:
            
            - Step 1: 系统弹出“编辑部门”对话框，并回填该部门的现有信息。
                
            - Step 2: 用户修改部门名称、负责人、排序号、状态等信息。上级部门字段不可修改。
                
            - Step 3: 用户点击“确定”按钮。
                
            - Step 4: 前端校验: 必填项校验。
                
            - Step 5: 后端校验: 同级部门下的部门名称唯一性校验（排除自身）。
                
            - Step 6: 结果处理:
                
                - 成功: 关闭弹窗，部门树对应节点信息更新，并给出成功提示“部门信息修改成功”。
                    
                - 失败: 在弹窗内提示具体错误信息。
                    
            - Step 7: 用户点击“取消”按钮，弹窗关闭，无数据变更。
                
    - C. 删除部门 流程:
        
        - 触发: 点击部门树节点上的“删除”按钮。
            
        - 交互步骤:
            
            - Step 1: 系统弹出二次确认对话框，提示“确定要删除部门[部门名称]吗? 此操作不可恢复。”
                
            - Step 2: 用户点击“确定”按钮。
                
            - Step 3: 后端执行删除前校验: 检查该部门下是否存在子部门，或是否有关联的用户。若存在，则禁止删除并给出相应提示。
                
            - Step 4: 后端执行删除操作（逻辑删除）。
                
            - Step 5: 结果处理:
                
                - 成功: 关闭确认对话框，部门树刷新移除被删除的节点，并给出成功提示“部门删除成功”。
                    
                - 失败: 提示具体错误信息，如“该部门下存在子部门，不允许删除”或“该部门下存在用户，不允许删除”。
                    
            - Step 6: 用户点击“取消”按钮，确认对话框关闭，无操作。
                

##### 5.3.3.3 字段定义与数据规则

|字段名称|字段标识 (Eng)|数据类型 & 长度|界面显隐/读写|约束/规则 (强调唯一性、格式、范围、必填、默认值、选项来源)|数据来源/去向|备注/说明|
|---|---|---|---|---|---|---|
|部门ID|deptId|Long|后端生成/不显示|主键, 自增|系统生成|内部唯一标识|
|上级部门ID|parentId|Long|表单中显示/选择|引用部门表ID，一级部门的parentId为0|用户选择/系统指定||
|部门名称|deptName|String(50)|显示/读写|必填, 同级下唯一|用户输入||
|排序号|orderNum|Integer|显示/读写|数字，用于同级部门排序，默认0|用户输入||
|负责人|leaderId|Long|显示/读写|可选，引用用户表ID|用户选择||
|状态|status|Integer|显示/可修改|必填, 0:禁用, 1:启用。默认1|系统/管理员操作|禁用后，该部门在选择器中不可见|
|创建时间|createTime|DateTime|列表显示/只读|自动生成|系统自动生成||
|更新时间|updateTime|DateTime|不显示/只读|自动更新|系统自动生成||

##### 5.3.3.4 权限控制

- 功能访问权限: 拥有"部门管理查看"或更高权限（如"部门管理完全控制"、"系统管理员"）的角色可以访问部门管理界面。
    
- 操作权限:
    
    - 新增部门: 需要"部门新增"权限。
        
    - 修改部门信息: 需要"部门修改"权限。
        
    - 删除部门: 需要"部门删除"权限。
        
- 数据权限 (如适用): 可扩展为部门管理员只能管理其本部门及下级部门。
    

#### 5.3.4 业务规则

- 部门名称唯一性: 在同一个父部门下，子部门的名称必须是唯一的。
    
- 删除约束: 当一个部门包含子部门时，不允许删除。当一个部门下已关联用户时，不允许删除。
    
- 状态影响: 部门被禁用后，在其他功能（如用户管理中选择所属部门）的下拉列表或选择器中将不可见、不可选。
    
- 根节点保护: 系统应存在一个不可删除、不可编辑的根节点，如“公司总部”。
    

#### 5.3.5 异常处理方案

- 部门名称已存在: 新增或修改时，如与同级部门名称冲突，应提示“同级部门下该名称已存在”。
    
- 删除含子部门的部门: 尝试删除含有子部门的部门时，提示“该部门下存在子部门，不允许删除”。
    
- 删除含用户的部门: 尝试删除已关联用户的部门时，提示“该部门下存在用户，不允许删除”。
    
- 无权限操作: 提示“您没有执行此操作的权限”。
    
- 网络异常/服务器错误: 通用错误提示“操作失败，请稍后重试或联系管理员”。
    

#### 5.3.6 与其他功能的关联和依赖

- 依赖项 (Dependencies):
    
    - 用户管理模块: 需要获取用户列表供选择部门负责人。
        
- 被依赖项 (Generated Dependencies):
    
    - 用户管理模块: 在为用户指定所属部门时，需要获取已启用的部门列表。
        
    - 数据权限体系: 系统的部分数据权限可能需要依据部门树结构来进行范围限定。
