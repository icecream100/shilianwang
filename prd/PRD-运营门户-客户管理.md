# 需求文档 - 客户管理

## 1. 功能概述

  - 1.1 功能名称：客户管理
  - 1.2 功能概述：提供对省级适配中心所服务的省内客户信息进行全面管理，包括客户基本信息的录入、修改、查询、删除，支持与省侧CRM系统的数据同步及映射配置，并能对客户可访问的省级视频资源进行精细化授权管理。

## 2. 用户与场景

  - 2.1 目标用户: 省级适配中心运营人员、系统管理员。
  - 2.2 用户场景/故事:
      - 场景一：作为一个省级适配中心运营人员，我想要快速查询某个省内客户的详细信息（如联系方式、所属行业）及其已授权的视频资源，以便于提供支持或进行业务沟通。
      - 场景二：作为一个省级适配中心运营人员，当有新的省内客户接入服务，但CRM系统尚未同步或客户信息不完整时，我想要在适配中心门户上手动新增或修改客户信息，以便于保证客户信息的及时性和完整性，应对各种业务场景。
      - 场景三：作为一个省级适配中心系统管理员，我想要配置适配中心与省侧CRM系统的对接参数，包括接口信息、同步频率、以及客户数据字段的自定义映射和转换规则，并能查看同步日志，以便于实现客户信息的自动化同步与管理，减少人工操作，保证数据一致性。
      - 场景四：作为一个省级适配中心运营人员，我想要为特定的省内客户授权其可访问的视频资源范围（如某些区域的设备、特定业务分组），并设定授权期限和允许的业务类型（如实时预览、录像回放），以便于满足客户的业务需求并保障资源安全。
      - 场景五：作为一个省级适配中心运营人员，我想要查看和管理客户的授权记录，包括修改授权范围、延长授权期限或撤销授权，以便于灵活管理客户授权，适应业务动态调整。

## 3. 功能范围/列表

  - 3.1 功能模块一: 客户信息管理 (含CRM同步配置与日志)
  - 3.2 功能模块二: 客户授权资源管理

## 4. 功能模块详情

-----

### 4.1 功能模块：客户信息管理

#### 4.1.1 功能描述与目标

  - 解决问题: 需要一个集中的地方管理省内客户的基础信息，确保信息的准确性和时效性，同时减轻手动录入负担，并能追溯信息来源和变更。
  - 用户价值/目标: 提高客户信息管理效率，保证数据质量，为客户服务和运营分析提供准确的数据基础。
  - 核心能力概述: 支持手动新增、查询、修改、删除客户基本信息。支持从省侧CRM系统定期同步客户信息，并提供字段自定义映射、转换规则配置及同步日志查看功能。

#### 4.1.2 原型参考

  - 主要原型页面: 客户管理原型.html - 包含客户列表页面、新增/编辑客户对话框、客户详情对话框、CRM同步配置对话框（含同步配置、字段映射、同步日志三个标签页）、资源授权管理对话框

#### 4.1.3 详细需求

##### 4.1.3.1 功能入口与触发条件

  - 客户列表入口: 左侧导航栏 -> 运营门户 -> 客户管理 [参考原型 客户管理原型.html]
  - CRM同步配置入口: 客户管理页面 -> "CRM同步配置"按钮 [参考原型 客户管理原型.html]
  - 手动同步CRM入口: 客户管理页面 -> "手动同步CRM"按钮 [参考原型 客户管理原型.html]
  - 触发条件: 用户已登录，并拥有相应客户管理或CRM配置权限。

##### 4.1.3.2 交互流程与界面详述

  - **A. 客户列表与查询 (手动管理)**: [参考原型 客户管理原型.html]
      - 布局: 页面主要分为顶部标题栏、搜索筛选区、操作按钮区和下方客户列表区。
      - 包含元素:
          - 页面标题: "客户管理"标题显示在页面顶部。
          - 搜索筛选区: 包含关键词搜索框、客户状态下拉选择（全部/正常/暂停）、行业下拉选择（全部/金融/制造业/教育/医疗/政府/其他）。
          - 操作按钮: "搜索"和"重置"按钮用于执行搜索和清空筛选条件。
          - 功能按钮区: 包含"新增客户"、"CRM同步配置"、"手动同步CRM"三个主要操作按钮。
          - 客户列表: 表格形式展示客户信息。关键列包括：客户编号、客户名称、联系人、联系电话、行业、客户级别、数据来源、状态、创建时间。操作列包含：查看、编辑、授权管理、删除等按钮。
          - 分页组件: 页面底部提供分页导航。
      - 默认交互/排序: 列表默认按客户创建时间降序排列。支持点击列表头对相应列进行排序。

  - **B. 新增客户 (手动)**: [参考原型 客户管理原型.html - 新增/编辑客户对话框]
      - 触发: 在客户列表页面点击"新增客户"按钮。
      - 交互步骤:
          - Step 1: 系统弹出"新增客户"模态对话框，标题显示为"新增客户"。
          - Step 2: 用户在表单中输入客户基础信息，包括：
              - 客户ID: 文本输入框，必填
              - 客户名称: 文本输入框，必填
              - 联系人: 文本输入框，必填
              - 联系电话: 文本输入框，必填，支持手机号格式校验
              - 邮箱: 文本输入框，可选
              - 所属省份: 下拉选择框，可选
              - 行业: 下拉选择框，可选
              - 客户级别: 下拉选择框，可选
              - 详细地址: 文本输入框，可选
              - 状态: 下拉选择框，默认为"正常"
              - 备注: 多行文本输入框，可选
          - Step 3: 用户点击"保存"或"确定"按钮。
          - Step 4: 前端对必填项（如客户名称、客户ID）和数据格式（如电话号码、邮箱格式）进行校验。
          - Step 5: 后端对客户ID或客户名称的唯一性进行校验。
          - Step 6: 结果处理:
              - 成功: 保存客户信息至数据库，关闭对话框/返回列表页，显示全局成功提示"新增客户 [客户名称] 成功"，客户列表刷新显示新客户。
              - 失败 (业务校验): 在对话框内或页面顶部显示具体的错误提示信息，如"客户ID已存在，请修改"。表单不清空，允许用户修改后重新提交。
          - Step 7: 用户点击"取消"按钮或关闭对话框，则不保存任何信息，返回客户列表页。

  - **C. 修改客户 (手动)**: [参考原型 客户管理原型.html - 新增/编辑客户对话框]
      - 触发: 在客户列表的操作列中点击对应客户的"编辑"按钮。
      - 交互步骤:
          - Step 1: 系统弹出"编辑客户"模态对话框，标题显示为"编辑客户"，并回填该客户的现有信息到对应表单字段中。
          - Step 2: 用户在表单中修改允许编辑的客户信息。对于从CRM同步的客户，部分核心字段（如CRM系统中的客户ID）可能设为只读或在修改时给出明确提示："此字段由CRM系统同步，手动修改可能在下次同步时被覆盖。"
          - Step 3: 用户点击"保存"或"确定"按钮。
          - Step 4: 前端和后端进行与新增客户时类似的校验（如数据格式、部分字段唯一性）。
          - Step 5: 结果处理:
              - 成功: 更新数据库中的客户信息，关闭对话框/返回列表页，显示全局成功提示"客户 [客户名称] 信息修改成功"，客户列表相应行数据刷新。
              - 失败: 在对话框内或页面顶部显示具体的错误提示信息。
          - Step 6: 用户点击"取消"按钮或关闭对话框，则不保存修改，返回客户列表页。

  - **D. 删除客户 (手动)**:
      - 触发: 在客户列表的操作列中点击对应客户的“删除”按钮。
      - 交互步骤:
          - Step 1: 系统弹出二次确认对话框，提示“确定删除客户 [客户名称] 吗？此操作可能无法撤销。”
          - Step 2: 用户点击“确定删除”按钮。
          - Step 3: 后端校验该客户是否有关联的有效资源授权或其他关键业务数据。若存在，则系统应提示“无法删除：客户 [客户名称] 尚有关联的有效资源授权（或具体业务数据），请先处理或解除这些关联。”并终止删除操作。或提供选项，允许在解除关联后删除（需谨慎设计，明确告知用户影响）。
          - Step 4: 若校验通过允许删除，后端执行逻辑删除操作（将客户标记为已删除状态，而非物理删除），并记录操作日志。
          - Step 5: 结果处理:
              - 成功: 关闭确认对话框，显示全局成功提示“客户 [客户名称] 已被删除”，客户列表刷新，该客户不再显示（或根据筛选条件可查看已删除客户）。
              - 失败 (业务校验): 提示具体的错误信息。
          - Step 6: 用户点击“取消”按钮，则不执行删除操作。
  - **E. 查看客户详情**: [参考原型 客户管理原型.html - 客户详情对话框]
      - 触发: 在客户列表的操作列中点击对应客户的"查看详情"按钮，或点击客户名称的链接。
      - 交互步骤:
          - Step 1: 系统弹出"客户详情"模态对话框，以描述列表形式展示客户详情。
          - Step 2: 详情对话框使用Element Plus的el-descriptions组件，分两列展示客户的全部基础信息（只读形式），包括：客户编号、客户名称、联系人、联系电话、邮箱、所属省份、状态、创建时间、最后同步时间、备注等信息。
          - Step 3: 对话框底部提供"关闭"和"编辑"按钮，点击"编辑"可直接跳转到编辑客户对话框。

  - **F. CRM同步配置**: [参考原型 客户管理原型.html - CRM同步配置对话框]
      - 触发: 拥有特定权限的用户在客户管理相关页面点击"CRM同步配置"入口。
      - 交互步骤 (配置接口与同步任务):
          - Step 1: 系统弹出"CRM同步配置"模态对话框，包含三个标签页："同步配置"、"字段映射"、"同步日志"。
          - Step 2: 在"同步配置"标签页中，展示CRM系统的接口配置信息：
              - API地址: 文本输入框，用于输入CRM系统的API服务地址
              - 认证方式: 下拉选择框，支持选择认证类型（如API Key、OAuth2等）
              - API密钥: 文本输入框，用于输入认证密钥
              - 同步频率: 下拉选择框，支持选择同步频率（如每日、每周等）
              - 启用同步: 开关组件，用于启用或禁用同步功能
          - Step 3: 管理员可以输入或修改接口服务地址、选择认证方式并填写相应的认证参数（如Client ID, Client Secret, Token URL, API Key等）。
          - Step 4: 管理员可以配置同步频率，例如选择"每日"并指定执行时间（如凌晨2点）。
          - Step 5: 管理员可以启用或禁用整个CRM同步任务。
          - Step 6: 提供"测试连接"功能，验证输入的接口地址和认证信息是否能成功连接到CRM系统。测试结果应明确提示成功或失败原因。
          - Step 7: 管理员点击"保存配置"按钮，系统保存并应用这些配置。
      - 交互步骤 (字段映射与转换规则配置):
          - Step 1: 在CRM同步配置对话框中，点击"字段映射"标签页。
          - Step 2: 字段映射标签页以表格形式展示字段映射配置，包含"添加映射"按钮。
          - Step 3: 表格列包括：本地字段（下拉选择，包含客户编号、客户名称、联系人、联系电话、邮箱等选项）、CRM字段（文本输入框）、转换规则（文本输入框，可选）、操作（删除按钮）。
          - Step 4: 管理员可以通过"添加映射"按钮新增字段映射行。
          - Step 5: 对于每个映射行，管理员可以：
              - 从本地字段下拉列表中选择目标字段
              - 在CRM字段输入框中输入对应的CRM系统字段名
              - 在转换规则输入框中输入可选的数据转换规则
              - 通过删除按钮移除不需要的映射行
          - Step 6: 配置完成后，通过对话框底部的"保存配置"按钮保存映射规则。

  - **G. CRM同步日志查看**: [参考原型 客户管理原型.html - CRM同步配置对话框的同步日志标签页]
      - 触发: 在CRM同步配置对话框中，点击"同步日志"标签页。
      - 交互步骤:
          - Step 1: 进入"同步日志"标签页。
          - Step 2: 标签页顶部提供"刷新日志"按钮，用于手动刷新日志列表。
          - Step 3: 以表格形式展示历次CRM同步任务的执行记录，关键列包括：同步时间、状态（成功/失败，用不同颜色的标签显示）、处理记录数、详细信息。
          - Step 4: 列表以时间倒序排列，显示最近的同步记录。
          - Step 5: 状态列使用Element Plus的el-tag组件，成功显示为绿色标签，失败显示为红色标签。

##### 4.1.3.4 权限控制

  - 查看客户列表/客户详情: 需要具备“客户信息管理-查看”权限。
  - 手动新增客户: 需要具备“客户信息管理-新增”权限。
  - 手动修改客户信息: 需要具备“客户信息管理-修改”权限。
  - 手动删除客户: 需要具备“客户信息管理-删除”权限。
  - 配置CRM同步参数/字段映射与转换规则: 通常需要较高级别权限，如“客户信息管理-CRM配置”或“系统管理员”角色。
  - 查看CRM同步日志: 需要具备“客户信息管理-查看同步日志”或等同于CRM配置的权限。
  - 手动触发CRM同步任务: 需要具备“客户信息管理-手动同步”或等同于CRM配置的权限。

#### 4.1.4 业务规则

  - 客户ID（业务层面）或客户名称在适配中心系统中应保持唯一性，以避免混淆。
  - **CRM同步核心逻辑**:
      - [cite\_start]系统应支持按照管理员配置的频率（通过CRON表达式或预设选项）自动从省侧CRM系统拉取客户数据 [cite: 1]。
      - [cite\_start]在数据同步过程中，严格按照管理员配置的字段映射规则，将CRM源系统中的字段数据填充到适配中心客户信息表的目标字段中 [cite: 1]。
      - [cite\_start]对映射的字段，应支持预设的数据转换规则（如代码值到显示名的转换、日期格式统一、特定字符串处理等）的应用 [cite: 1]。
      - 同步策略：应明确定义新增、更新的逻辑。例如，以CRM系统中的客户唯一标识（如CRM客户ID）为基准，判断适配中心中是否存在对应客户：
          - 若不存在，则在适配中心新增该客户记录。
          - 若已存在，则根据配置的更新策略（如“CRM数据覆盖本地”、“仅更新空值字段”、“标记冲突待人工审核”，默认建议“CRM数据覆盖本地指定字段”）更新适配中心的客户信息。
      - [cite\_start]每次同步任务（无论是自动还是手动触发）均需生成详细的执行日志，清晰记录任务的起止时间、处理状态、成功同步的记录数、新增数、更新数、以及失败的记录详情和具体失败原因 [cite: 1]。
  - **手动管理与CRM同步的协调**:
      - [cite\_start]用户在适配中心门户上手动新增、查询、修改、删除客户信息，应视为对CRM同步数据的有效补充或在特定场景（如CRM故障、数据延迟）下的应急处理手段 [cite: 1]。
      - 对于手动创建的客户，若后续CRM同步数据中出现了可唯一识别为同一客户的记录（例如基于某个共通的业务ID），系统应有机制处理此种“冲突”或“合并”场景，例如提示管理员手动确认合并，或根据预设规则自动处理（如优先保留CRM信息并关联手动补充的数据）。
      - 对于手动修改的已由CRM同步来的客户信息，应明确告知用户，在下一次CRM同步时，这些手动修改可能会被来自CRM的数据所覆盖（除非特定字段被配置为“本地优先”或“不参与CRM更新”）。
  - **数据删除规则**:
      - 删除客户信息时，优先采用逻辑删除（即标记客户状态为“已删除”），而非物理删除，以便于数据审计、历史追溯或未来可能的恢复。
      - 在执行删除操作前，必须检查该客户是否存在有效的、未到期的资源授权记录。若存在，应阻止删除，并提示用户先处理这些授权关系。

#### 4.1.5 异常处理方案

  - 客户ID/名称重复: 在用户尝试保存手动新增或修改的客户信息时，若后端校验发现客户ID或客户名称与现有记录冲突，应在界面清晰提示“客户ID/名称 [具体值] 已存在，请修改后重试”。
  - **CRM同步过程中的异常**:
      - CRM接口连接失败: 若无法连接到配置的CRM系统API（如网络问题、URL错误、认证失败），应在同步日志中详细记录错误信息（如HTTP状态码、错误响应体），并将该次同步任务标记为“失败”。系统可配置在连接失败时通过邮件或系统内消息通知管理员。CRM同步配置界面也应能反映当前的连接状态。
      - 字段映射或数据转换错误: 若在同步过程中，因字段映射配置不完整、数据转换规则无法应用于某些源数据（如日期格式不匹配导致转换失败、值映射未找到对应项），应将包含问题的具体客户记录标记为同步失败，并在日志中记录详细的字段名、源数据值及失败原因。整个同步任务可根据失败记录的比例标记为“部分成功”或“失败”，不应因单条或少量记录的转换问题而完全中断整个同步批次（可配置）。
      - 数据写入适配中心数据库失败: 如因数据库约束（不太可能发生若前面校验完整）或数据库服务本身问题导致数据无法写入，也需详细记录日志并标记失败。
  - 保存CRM配置时校验失败: 例如，管理员输入的API地址格式不规范、CRON表达式语法错误等，应在保存前进行前端和后端校验，并即时在界面上给出明确的错误提示。
  - 删除客户时存在有效关联数据: 当尝试删除一个仍拥有有效资源授权的客户时，系统应阻止操作并明确提示用户：“无法删除客户 [客户名称]，因为该客户尚拥有有效的资源授权。请先撤销或处理相关授权记录。”

#### 4.1.6 与其他功能的关联和依赖

  - **依赖项 (Dependencies)**:
      - 省侧CRM系统接口: 是实现客户信息自动同步功能的前提和数据来源。
      - (本PRD后续定义的) 客户授权资源管理模块: 客户信息是进行资源授权的主体，授权管理需要引用有效的客户数据。
      - 系统预设字典/可配置选项: 用于如“所属行业”、“客户级别”等字段的规范化输入和展示。
  - **被依赖项 (Generated Dependencies)**:
      - [cite\_start]省侧客户分析模块 (运营分析模块的一部分): 需要客户信息（如客户的行业归属、级别、区域等）作为多维度分析的基础数据来进行客户数量统计、分布分析、活跃度分析等 [cite: 1, 3]。
      - [cite\_start]驾驶舱 (省侧运营与监控概览) 模块: 可能会调用客户数据以展示如“当前服务的省内客户总数”等核心运营指标 [cite: 1]。
      - 系统审计日志模块: 所有对客户信息的手动增、删、改操作，以及CRM同步配置的变更和同步任务的执行情况，都需要被审计日志模块详细记录。

-----

### 4.2 功能模块：客户授权资源管理

#### 4.2.1 功能描述与目标

  - 解决问题: 需要对省内客户可访问的视频资源进行精细化管控，确保客户只能访问被授权的设备资源，同时支持灵活的授权管理和权限调整。
  - 用户价值/目标: 提供安全可控的资源访问机制，满足客户差异化的业务需求，同时保障省级视频资源的安全性和合规性。
  - 核心能力概述: 支持为客户授权特定的设备资源，设定授权期限和业务类型权限，提供授权记录的查看、修改和撤销功能。

#### 4.2.2 原型参考

  - 主要原型页面: 客户管理原型.html - 授权资源管理对话框、新增资源授权对话框

#### 4.2.3 详细需求

##### 4.2.3.1 功能入口与触发条件

  - 入口: 客户列表页面 -> 操作列 -> "授权管理"按钮 [参考原型 客户管理原型.html - 授权资源管理对话框]
  - 触发条件: 用户已登录，具备"客户授权管理"相关权限，且选择了有效的客户记录。

##### 4.2.3.2 交互流程与界面详述

  - **A. 授权资源管理弹窗**: [参考原型 客户管理原型.html - 授权资源管理对话框]
      - 布局: 弹窗分为客户信息展示区、搜索操作区和资源列表区。
      - 包含元素:
          - 客户信息展示: 在灰色背景区域显示当前客户的基本信息（客户名称和客户编号）。
          - 搜索框: 支持按资源名称进行搜索筛选，带搜索图标。
          - "添加授权"按钮: 用于为客户新增资源授权，带加号图标。
          - 资源列表: 以表格形式展示该客户已授权的资源列表，包含复选框、资源名称、资源类型、业务类型（用不同颜色标签显示：核心业务-红色、扩展业务-橙色、基础业务-蓝色）、描述、授权时间、操作列（取消授权按钮）。
      - 默认交互: 弹窗打开时显示已授权的资源列表，列表按授权时间降序排列。支持多选资源进行批量操作。

  - **B. 新增资源授权**: [参考原型 客户管理原型.html - 新增资源授权对话框]
      - 触发: 在授权资源管理弹窗中点击"增加授权"按钮。
      - 交互步骤:
          - Step 1: 系统弹出"新增资源授权"子对话框。
          - Step 2: 对话框顶部提供搜索框，支持按资源名称进行搜索筛选。
          - Step 3: 以表格形式展示可授权的资源列表，包含复选框、资源名称、资源类型、业务类型（用标签显示）、描述、最大用户数等列。
          - Step 4: 用户通过复选框选择需要授权的资源，支持多选。
          - Step 5: 用户点击"确认"按钮。
          - Step 6: 前端校验是否选择了资源。
          - Step 7: 后端校验资源的有效性和是否已授权。
          - Step 8: 结果处理:
              - 成功: 保存授权记录，关闭子对话框，刷新资源列表，显示成功提示"资源授权成功"。
              - 失败: 显示具体错误信息，如"部分资源已授权，请重新选择"。
          - Step 9: 用户点击"取消"按钮，关闭子对话框，不保存任何授权。

  - **C. 取消资源授权**:
      - 触发: 在资源列表中点击某个资源的"取消授权"按钮。
      - 交互步骤:
          - Step 1: 系统弹出确认对话框："确定要取消对资源 [资源名称] 的授权吗？"。
          - Step 2: 用户点击"确定"按钮。
          - Step 3: 后端执行取消授权操作，更新授权状态。
          - Step 4: 结果处理:
              - 成功: 关闭确认对话框，刷新资源列表，显示成功提示"已取消对 [资源名称] 的授权"。
              - 失败: 显示错误信息。
          - Step 5: 用户点击"取消"按钮，不执行取消授权操作。
  - **D. 资源搜索与筛选**:
      - 在授权资源管理弹窗的搜索框中输入关键词，系统实时筛选显示匹配的资源记录。
      - 支持按资源名称、资源类型等字段进行模糊搜索。

##### 4.2.3.3 字段定义与数据规则

| 字段名称 | 字段标识 (Eng) | 数据类型 & 长度 | 界面显隐/读写 | 约束/规则 (强调唯一性、格式、范围、必填、默认值、选项来源) | 数据来源/去向 | 备注/说明 |
|--------------|------------------|-------------------|---------------|--------------------------------------------------------------------|-----------------|----------------------|
| 客户内码 | customerInternalId | Long | 隐藏/只读 | 系统自动生成，唯一，自增 | 系统生成 | 适配中心内部主键 |
| 客户编号 | customerCode | String(50) | 显示/新增时可写，编辑时条件性读写 | 必填。对于手动新增客户，此编号在适配中心内必须唯一。对于CRM同步客户，此编号通常来自CRM系统，作为业务唯一标识。 | 用户输入/CRM同步 | 核心业务编号，用于对外交互或关联。在原型中显示为"客户编号" |
| 客户名称 | customerName | String(100) | 显示/读写 | 必填 | 用户输入/CRM同步 |  |
| 联系人 | contactPerson | String(50) | 显示/读写 | 必填 | 用户输入/CRM同步 |  |
| 联系电话 | contactPhone | String(30) | 显示/读写 | 必填，需为有效手机号码格式（支持1[3-9]\d{9}格式校验） | 用户输入/CRM同步 |  |
| 邮箱 | email | String(100) | 显示/读写 | 可选，若填写需为有效邮箱格式 | 用户输入/CRM同步 |  |
| 所属省份 | province | String(50) | 显示/读写（下拉选择） | 可选。选项来源为系统预设的省份字典。 | 用户输入/CRM同步 |  |
| 所属行业 | industry | String(50) | 显示/读写（下拉选择） | 可选。选项包括：金融、制造业、教育、医疗、政府、其他。 | 用户输入/CRM同步（可能需值转换） |  |
| 客户级别 | customerLevel | String(30) | 显示/读写（下拉选择） | 可选。选项包括：重要客户、普通客户、潜在客户等。 | 用户输入/CRM同步（可能需值转换） |  |
| 详细地址 | address | String(200) | 显示/读写 | 可选 | 用户输入/CRM同步 |  |
| 状态 | status | Enum(ACTIVE, INACTIVE) | 显示/读写（下拉选择） | 必填，默认为ACTIVE。ACTIVE:正常，INACTIVE:暂停 | 用户输入/CRM同步 | 在界面上显示为"正常"或"暂停" |
| 备注信息 | remarks | String(500) | 显示/读写 | 可选 | 用户输入 |  |
| 信息来源 | dataSource | Enum(MANUAL, CRM_SYNC) | 显示/只读 | 系统自动记录。MANUAL:手动创建, CRM_SYNC:CRM同步 | 系统记录 |  |
| CRM源系统ID | crmOriginalId | String(50) | 隐藏/只读（或详情中显示） |  | CRM同步时记录 | 用于与CRM系统数据核对或追溯 |
| 创建时间 | creationTime | DateTime | 列表显示/只读 | 系统自动生成 | 系统生成 |  |
| 最后修改时间 | lastUpdateTime | DateTime | 列表显示/只读 | 系统自动更新 | 系统更新 |  |
| CRM同步配置:API地址 | crmApiUrl | String(255) | CRM配置页/管理员读写 | 必填（若启用同步），有效的URL格式 | 管理员输入 |  |
| CRM同步配置:认证方式 | crmAuthType | Enum(NONE, BASIC_AUTH, TOKEN_AUTH, OAUTH2) | CRM配置页/管理员读写 |  | 管理员选择 |  |
| CRM同步配置:认证详情 | crmAuthDetails | JSON/String(1000) | CRM配置页/管理员读写 | 根据认证方式条件性必填 | 管理员输入 | 存储如用户名/密码、Token、OAuth2参数等 |
| CRM同步配置:同步频率 | crmSyncFrequencyCron | String(50) | CRM配置页/管理员读写 | CRON表达式格式，或选择预设频率（如每日HH:mm） | 管理员配置 |  |
| CRM同步配置:启用状态 | crmSyncEnabled | Boolean | CRM配置页/管理员读写 | 默认为禁用 | 管理员配置 |  |
| CRM同步配置:字段映射规则 | crmFieldMappingConfig | JSON/Text | CRM配置页（内部存储）/管理员通过专用界面配置 |  | 管理员配置 |  |
| CRM同步日志:执行ID | syncLogId | Long | 同步日志列表/只读 | 系统生成，唯一 | 系统生成 |  |
| CRM同步日志:开始时间 | syncStartTime | DateTime | 同步日志列表/只读 |  | 系统记录 |  |
| CRM同步日志:结束时间 | syncEndTime | DateTime | 同步日志列表/只读 |  | 系统记录 |  |
| CRM同步日志:执行状态 | syncStatus | Enum(SUCCESS, FAIL, PARTIAL_SUCCESS, IN_PROGRESS) | 同步日志列表/只读 |  | 系统记录 |  |
| CRM同步日志:同步客户数 | syncTotalCount | Integer | 同步日志列表/只读 |  | 系统记录 |  |
| CRM同步日志:新增数 | syncAddedCount | Integer | 同步日志列表/只读 |  | 系统记录 |  |
| CRM同步日志:更新数 | syncUpdatedCount | Integer | 同步日志列表/只读 |  | 系统记录 |  |
| CRM同步日志:失败数 | syncFailedCount | Integer | 同步日志列表/只读 |  | 系统记录 |  |
| CRM同步日志:详情/错误信息 | syncDetailsMessage | Text | 同步日志详情/只读 |  | 系统记录 |  |

##### 4.2.3.4 权限控制

  - 查看客户授权列表: 需要具备"客户授权管理-查看"权限。
  - 新增客户资源授权: 需要具备"客户授权管理-新增"权限。
  - 取消客户资源授权: 需要具备"客户授权管理-撤销"权限。
  - 修改授权配置: 需要具备"客户授权管理-修改"权限。

#### 4.2.4 业务规则

  - 授权唯一性: 同一客户对同一资源在同一时间只能有一条有效的授权记录。
  - 授权状态自动更新: 系统应定期检查授权记录的到期时间，自动将过期的授权状态更新为"EXPIRED"。
  - 资源有效性校验: 新增授权时，必须校验目标资源在资源管理系统中的有效性和可用性。
  - 授权级联影响: 当客户被删除时，应同时处理该客户的所有授权记录（设为已撤销状态）。
  - 业务类型权限控制: 不同的业务类型权限应与实际的视频业务系统对接，确保权限控制的有效性。
  - 限制条件与边界情况:
      - 授权数量限制: 可配置单个客户的最大授权资源数量。
      - 资源授权范围: 只能授权属于本省级适配中心管辖范围内的资源。
      - 并发授权控制: 防止同时对同一资源进行重复授权操作。

#### 4.2.5 异常处理方案

  - 资源不存在或已失效: 当尝试授权一个不存在或已失效的资源时，应提示"选择的资源不存在或已失效，请重新选择"。
  - 重复授权: 当尝试对已授权的资源再次授权时，应提示"该资源已授权给此客户，无需重复授权"。
  - 网络异常: 授权操作提交时若网络中断，应提示"网络连接失败，请检查网络后重试"，并保持当前选择状态。
  - 权限不足: 用户尝试执行无权限的授权操作时，应提示"您没有执行此操作的权限"。
  - 系统异常: 服务器内部错误时，应提示"操作失败，请稍后重试或联系管理员"。

#### 4.2.6 与其他功能的关联和依赖

  - **依赖项 (Dependencies)**:
      - 客户信息管理模块: 需要有效的客户数据作为授权主体。
      - 资源管理系统: 需要获取可授权的设备资源列表和资源状态信息。
      - 权限管理模块: 依赖角色和权限配置来控制授权操作的访问权限。
  - **被依赖项 (Generated Dependencies)**:
      - 视频业务系统: 实际的视频预览、回放等业务功能需要根据授权记录进行权限验证。
      - 运营分析模块: 可能需要授权数据进行客户资源使用情况分析。
      - 审计日志模块: 所有授权相关操作都需要被详细记录。

-----
