# 需求文档 - 运营门户 - 个人中心

## 1. 概述
### 1.1 功能简介
- 个人中心模块是运营门户的核心功能之一，提供了用户个人信息管理、密码修改、登录功能等核心功能。
- 该模块旨在提升用户体验，增强账户安全性，并提供个性化的系统偏好设置。
### 1.2 主要功能
- 个人信息管理：查看和修改用户的基本信息，如姓名、联系方式等。
- 修改密码：允许用户修改登录密码，保障账户安全。
- 登录功能：提供用户登录入口，验证用户身份并允许访问系统。
## 2. 背景与目标

运营门户的每个用户都需要一个专属空间来管理其个人信息、账户安全设置以及个性化偏好。个人中心模块旨在提供这样一个集中的管理界面，提升用户体验和账户安全性。

### 2.2 目标

- 用户能够方便地查看和修改其个人基本信息（在允许范围内）。
- 用户能够安全地修改其登录密码。
- 用户能够进行个性化的系统偏好设置（如界面主题、消息通知等）。
- 提供清晰的登录功能，保障用户安全访问系统。

## 3. 用户与场景

### 3.1 目标用户

- 所有运营门户的注册用户。

### 3.2 用户场景/故事

- 场景一：用户希望修改自己的联系方式或更新个人资料。
  - 作为一个运营门户用户，我想要方便地修改我的个人资料，以便于保持信息的最新状态。
- 场景二：用户出于安全考虑，希望定期修改自己的登录密码。
  - 作为一个运营门户用户，我想要安全地修改我的登录密码，以便于保护我的账户安全。
- 场景三：用户希望根据自己的喜好调整门户的界面主题。
  - 作为一个运营门户用户，我想要个性化设置门户的界面主题，以便于获得更舒适的视觉体验。
- 场景四：用户需要登录系统以访问其功能。
  - 作为一个用户，我想要通过输入用户名和密码来登录运营门户，以便于访问我被授权的功能。

## 4. 功能范围/列表

- 4.1 个人信息管理
- 4.2 修改密码
- 4.3 登录功能

## 5. 功能模块详情

---

### 5.1 功能模块：个人信息管理

#### 5.1.1 功能描述与目标

- 解决的问题: 用户需要一个地方查看自己的账户信息，并修改部分允许调整的个人资料。
- 用户价值/目标: 用户可以方便地管理自己的个人信息，确保信息的准确性，并进行一些个性化配置。
- 核心能力概述: 展示用户基本信息、允许修改部分可编辑信息（如联系方式、头像、个性化设置等）。

#### 5.1.2 原型参考

- 主要原型页面: P_Profile_View (个人信息查看页), P_Profile_Edit (个人信息编辑页)

#### 5.1.3 详细需求

##### 5.1.3.1 功能入口与触发条件

- 入口: 用户登录后，通常在页面右上角的用户头像/名称下拉菜单中点击“个人中心”链接 [参考原型 P_Profile_View]。
- 触发条件: 用户已成功登录运营门户。

##### 5.1.3.2 交互流程与界面详述

- 主界面/查看个人信息: [参考原型 P_Profile_View]
  - 布局: 页面主要展示一个包含用户头像和基本信息的卡片区域。
  - 包含元素: 显示用户头像、用户名、姓名、所属部门、角色、手机号、邮箱。可编辑信息（姓名、手机号、邮箱）支持行内编辑，头像支持点击上传更新。
  - 默认交互: 信息默认为只读展示，可编辑字段旁有“修改”图标/按钮触发编辑状态。
- 核心操作流程细化:
  - A. 查看个人信息 流程:
    - 触发: 用户通过入口访问个人中心页面。
    - 交互步骤:
      - Step 1: 系统加载并显示当前登录用户的个人信息，包括头像。
      - Step 2: 对于不可修改的信息（如用户名、所属部门、角色），仅做展示。
      - Step 3: 对于可修改的信息（姓名、手机号、邮箱），旁边显示“修改”图标/按钮。头像区域悬停或点击可触发上传操作。
  - B. 修改个人信息 (姓名、手机号、邮箱) 流程:
    - 触发: 用户点击相应信息旁的“修改”图标/按钮。
    - 交互步骤:
      - Step 1: 对应字段进入行内编辑状态，显示输入框和“保存”、“取消”按钮。
      - Step 2: 用户修改字段信息。
      - Step 3: 用户点击“保存”按钮。
      - Step 4: 前端校验: 对修改的字段进行格式校验（如手机号格式、邮箱格式）。
      - Step 5: 后端校验: （若有必要，如手机号/邮箱唯一性校验，排除自身）。
      - Step 6: 结果处理:
        - 成功: 更新信息，并给出成功提示“个人信息修改成功”。页面对应字段刷新显示新信息，恢复到只读状态。
        - 失败: 提示具体错误信息，编辑状态可能保留以便用户修正。
      - Step 7: 用户点击“取消”按钮，放弃修改，信息恢复原状，字段恢复到只读状态。
  - C. 修改头像 流程:
    - 触发: 用户点击头像区域的上传触发元素（如相机图标或整个头像区域）。
    - 交互步骤:
      - Step 1: 系统弹出“更换头像”对话框。
      - Step 2: 用户在对话框中选择本地图片文件（如JPG, PNG格式，大小限制如2MB）。
      - Step 3: 系统显示预览头像。
      - Step 4: 用户点击“确定”按钮。
      - Step 5: 前端校验: （如文件格式、大小）。
      - Step 6: 后端处理: 上传图片并保存，更新用户头像URL。
      - Step 7: 结果处理:
        - 成功: 关闭对话框，个人信息页面的头像更新为新头像，给出成功提示“头像更换成功”。
        - 失败: 在对话框内提示具体错误信息（如“文件过大”或“上传失败”）。
      - Step 8: 用户点击“取消”按钮或关闭对话框，放弃修改。

##### 5.1.3.3 字段定义与数据规则

| 字段名称 | 字段标识 (Eng) | 数据类型 & 长度 | 界面显隐/读写   | 约束/规则 (强调唯一性、格式、范围、必填、默认值、选项来源) | 数据来源/去向         | 备注/说明      |
| -------- | -------------- | --------------- | --------------- | ---------------------------------------------------------- | --------------------- | -------------- |
| 用户名   | username       | String(50)      | 显示/只读       |                                                            | 当前登录用户          |                |
| 姓名     | realName       | String(50)      | 显示/读写       |                                                            | 当前登录用户/用户输入 | 支持行内编辑   |
| 所属部门 | department     | String(100)     | 显示/只读       |                                                            | 当前登录用户          |                |
| 角色     | roles          | List\<String\>  | 显示/只读       |                                                            | 当前登录用户          | 显示为多个标签 |
| 手机号   | phoneNumber    | String(20)      | 显示/读写       | 有效手机号格式                                             | 当前登录用户/用户输入 | 支持行内编辑   |
| 邮箱     | email          | String(100)     | 显示/读写       | 有效邮箱格式                                               | 当前登录用户/用户输入 | 支持行内编辑   |
| 头像     | avatarUrl      | String(255)     | 显示/可上传修改 | 图片URL。上传时支持JPG/PNG格式，文件大小建议不超过2MB      | 用户上传/系统默认     | 通过对话框上传 |

##### 5.1.3.4 权限控制

- 功能访问权限: 所有成功登录的用户均可访问自己的个人信息管理页面。
- 操作权限: 用户只能修改自己账户下允许修改的个人信息。

#### 5.1.4 业务规则

- 信息同步策略: 若部分用户信息（如姓名、部门）从外部系统（如HR系统、统一认证平台）同步，则这部分信息在个人中心通常为只读，或提供链接指引到源头系统修改。
- 可修改范围: 明确哪些个人信息允许用户在运营门户内直接修改，哪些是只读的。

#### 5.1.5 异常处理方案

- 保存失败: 修改个人信息保存时，若发生网络或服务器错误，提示“信息保存失败，请稍后重试”。
- 无效输入: 用户输入不符合格式要求（如邮箱格式错误），应即时给出提示。

#### 5.1.6 与其他功能的关联和依赖

- 依赖项 (Dependencies):
  - 用户管理模块: 获取当前用户的基本信息。
  - 外部用户源: 同步核心用户信息。
- 被依赖项 (Generated Dependencies):
  - 系统界面框架: 根据用户设置的界面主题调整显示。
  - 消息通知模块: 根据用户设置的通知偏好发送消息。

---

### 5.2 功能模块：修改密码

#### 5.2.1 功能描述与目标

- 解决的问题: 用户需要一个安全的方式来修改自己的登录密码。
- 用户价值/目标: 增强账户安全性，允许用户在怀疑密码泄露或按计划更新密码时进行操作。
- 核心能力概述: 用户输入旧密码、新密码、确认新密码，系统校验通过后更新密码。

#### 5.2.2 原型参考

- 主要原型页面: P_ChangePassword (修改密码页/弹窗)

#### 5.2.3 详细需求

##### 5.2.3.1 功能入口与触发条件

- 入口: 通常在个人中心页面，有明确的“修改密码”链接或按钮 [参考原型 P_ChangePassword]。
- 触发条件: 用户已成功登录运营门户。

##### 5.2.3.2 交互流程与界面详述

- 修改密码界面: [参考原型 P_ChangePassword]
  - 布局: 通常为个人中心内的一个专属区域或卡片式表单，非独立页面或弹窗。
  - 包含元素: “旧密码”输入框、“新密码”输入框、“确认新密码”输入框、“修改密码”按钮、“重置”按钮。
  - 交互提示: 新密码输入框下方有明确的密码复杂度要求提示：“密码长度至少8位，包含大小写字母和数字”。
- 核心操作流程细化:
  - A. 修改密码 流程:
    - 触发: 用户在个人中心导航至“修改密码”视图。
    - 交互步骤:
      - Step 1: 系统显示修改密码表单。
      - Step 2: 用户输入旧密码、新密码、确认新密码。
      - Step 3: 用户点击“修改密码”按钮。
      - Step 4: 前端校验: 所有字段必填；新密码与确认新密码一致；新密码符合预设的复杂度策略（长度至少8位，包含大小写字母和数字）。
      - Step 5: 后端校验: 验证旧密码的正确性；新密码不能与旧密码（或近期历史密码）相同。
      - Step 6: 结果处理:
        - 成功: 提示“密码修改成功。为保障账户安全，部分系统可能要求您重新登录。”（根据实际策略，可能强制用户下线并跳转到登录页）。表单可清空或保留重置状态。
        - 失败 (如旧密码错误、新密码不符合策略等): 在表单内或上方清晰提示具体错误原因。输入框内容可不清空（或仅清空密码字段），允许用户修正后再次提交。
      - Step 7: 用户点击“重置”按钮，清空所有输入框内容。

##### 5.2.3.3 字段定义与数据规则

| 字段名称   | 字段标识 (Eng)     | 数据类型 & 长度 | 界面显隐/读写 | 约束/规则 (强调唯一性、格式、范围、必填、默认值、选项来源) | 数据来源/去向 | 备注/说明 |
| ---------- | ------------------ | --------------- | ------------- | ---------------------------------------------------------- | ------------- | --------- |
| 旧密码     | oldPassword        | String(255)     | 输入/写       | 必填                                                       | 用户输入      |           |
| 新密码     | newPassword        | String(255)     | 输入/写       | 必填，符合密码复杂度策略                                   | 用户输入      |           |
| 确认新密码 | confirmNewPassword | String(255)     | 输入/写       | 必填，需与新密码一致                                       | 用户输入      |           |

##### 5.2.3.4 权限控制

- 功能访问权限: 所有成功登录的用户均可访问修改自己密码的功能。

#### 5.2.4 业务规则

- 旧密码验证: 必须正确输入当前使用的密码才能进行后续操作。
- 密码复杂度策略: 新密码必须满足系统设定的复杂度要求：长度至少8位，且必须同时包含大写字母、小写字母和数字。
- 新旧密码校验: 新密码不能与当前密码（以及最近N次历史密码，若系统支持）相同。
- 密码修改后处理: 密码修改成功后，为安全起见，可以考虑强制用户重新登录，使旧会话失效。
- SSO场景: 如果系统接入了单点登录（SSO），密码修改操作可能需要跳转到统一的身份认证平台进行，此时运营门户内仅提供指引或链接。

#### 5.2.5 异常处理方案

- 旧密码错误: 提示“旧密码不正确，请重新输入”。不应提示密码错误的具体次数，以防暴力破解。
- 新密码与确认新密码不一致: 提示“两次输入的新密码不一致，请检查”。
- 新密码不符合安全策略: 提示具体的密码策略要求。
- 新密码与旧密码（或历史密码）相同: 提示“新密码不能与当前密码（或近期使用过的密码）相同”。
- 保存失败: 若因网络或服务器错误导致密码修改失败，提示“密码修改失败，请稍后重试”。

#### 5.2.6 与其他功能的关联和依赖

- 依赖项 (Dependencies):
  - 登录模块: 验证旧密码时需要与存储的密码进行比对。
  - (若有)SSO服务: 若密码管理由外部统一认证平台处理。
- 被依赖项 (Generated Dependencies):
  - 系统日志模块: 用户修改密码的操作（无论成功与否）均需记录日志。
  - 登录模块: 用户下次登录时需使用新密码。

---

### 5.3 功能模块：登录功能

#### 5.3.1 功能描述与目标

- 解决的问题: 为授权用户提供安全访问运营门户的入口。
- 用户价值/目标: 用户能够通过身份验证成功进入系统，并访问其被授予权限的功能模块。
- 核心能力概述: 用户输入凭证（用户名、密码），系统校验凭证有效性，成功则允许访问，失败则拒绝。

#### 5.3.2 原型参考

- 主要原型页面: P_Login (登录页)

#### 5.3.3 详细需求

##### 5.3.3.1 功能入口与触发条件

- 入口: 运营门户的访问地址，用户未登录时自动跳转到登录页 [参考原型 P_Login]。或用户主动点击“退出登录”后跳转到登录页。
- 触发条件: 用户访问需要登录才能访问的系统资源。

##### 5.3.3.2 交互流程与界面详述

- 登录界面: [参考原型 P_Login]
  - 布局: 简洁明了，居中卡片式设计，突出输入区域和操作按钮。
  - 包含元素: “用户名”输入框、“密码”输入框、“登录”按钮、系统名称/Logo。包含“记住我”复选框、“忘记密码？”链接。验证码输入框和验证码图片区域为条件显示（例如，在首次登录失败后）。
  - 交互提示: 输入框的占位提示。
- 核心操作流程细化:
  - A. 用户登录 流程:
    - 触发: 用户在登录页输入凭证并点击“登录”按钮。
    - 交互步骤:
      - Step 1: 用户输入用户名和密码。
      - Step 2: (若验证码区域已显示) 用户输入验证码。
      - Step 3: 用户可选择勾选“记住我”复选框。
      - Step 4: 用户点击“登录”按钮。
      - Step 5: 前端校验: 用户名、密码（及验证码，若显示时）是否为空。
      - Step 6: 后端校验: 验证用户名是否存在、密码是否正确、用户状态是否为“启用”、（若启用了验证码）验证码是否正确。
      - Step 7: 结果处理:
        - 成功: 创建用户会话（Session/Token），记录登录日志，页面跳转到用户默认首页或上次访问页面。
        - 失败 (如用户名或密码错误、账户被禁用、验证码错误等): 在登录页面清晰提示具体错误原因，如“用户名或密码错误”、“账户已被禁用，请联系管理员”、“验证码错误”。密码字段通常清空。首次登录失败后，验证码输入框和图片可能会显示出来，并需要用户在下次尝试时填写。
  - B. 忘记密码 流程:
    - 触发: 用户点击“忘记密码？”链接。
    - 交互步骤:
      - Step 1: 系统弹出“找回密码”对话框。
      - Step 2: 用户在对话框中输入其“用户名”和注册时使用的“邮箱”。
      - Step 3: 用户点击“发送重置链接”按钮。
      - Step 4: 前端校验: 用户名和邮箱字段是否为空，邮箱格式是否正确。
      - Step 5: 后端处理: （模拟）校验用户信息，并发送密码重置链接到用户邮箱。
      - Step 6: 结果处理:
        - 成功: 提示“重置链接已发送到您的邮箱，请查收”，并关闭“找回密码”对话框。
        - 失败: 在对话框内提示错误信息，如“用户信息不匹配”或“发送失败”。
      - Step 7: 用户点击“取消”按钮或关闭图标，关闭对话框。
  - C. 刷新验证码 流程 (当验证码显示时):
    - 触发: 用户点击验证码图片区域。
    - 交互步骤:
      - Step 1: 系统请求新的验证码。
      - Step 2: 验证码图片区域更新显示新的验证码字符。

##### 5.3.3.3 字段定义与数据规则

| 字段名称 | 字段标识 (Eng) | 数据类型 & 长度 | 界面显隐/读写    | 约束/规则 (强调唯一性、格式、范围、必填、默认值、选项来源) | 数据来源/去向 | 备注/说明              |
| -------- | -------------- | --------------- | ---------------- | ---------------------------------------------------------- | ------------- | ---------------------- |
| 用户名   | username       | String(50)      | 输入/写          | 必填                                                       | 用户输入      | 登录表单、忘记密码表单 |
| 密码     | password       | String(255)     | 输入/写          | 必填                                                       | 用户输入      | 登录表单               |
| 验证码   | captcha        | String(10)      | 条件显示/输入/写 | 条件必填 (如登录失败后显示)                                | 用户输入      | 防机器人，4位字符组合  |
| 记住我   | rememberMe     | Boolean         | 可选勾选/写      |                                                            | 用户选择      | 延长登录有效期         |
| 邮箱     | email          | String(100)     | 输入/写          | 必填 (忘记密码时)，有效邮箱格式                            | 用户输入      | 忘记密码表单           |

##### 5.3.3.4 权限控制

- 功能访问权限: 所有未登录用户或会话过期的用户均会导向登录功能。

#### 5.3.4 业务规则

- 凭证校验: 用户名和密码必须与系统中存储的记录匹配。
- 账户状态检查: 只有状态为“启用”的用户才能成功登录。
- 登录尝试限制: 为防止暴力破解，可设置登录失败次数限制。例如，首次登录失败后，可能会要求输入验证码。
- 会话管理: 登录成功后，系统为用户创建会话（Session）或颁发令牌（Token），用于后续请求的身份认证。会话/令牌有有效期。
- “记住我”功能: 若用户勾选“记住我”，则会话/令牌的有效期会适当延长。
- 验证码机制: 在用户首次登录失败后，系统将显示图片验证码，用户在后续登录尝试中必须正确输入验证码。验证码图片支持点击刷新。
- 忘记密码流程: 用户通过输入用户名和注册邮箱来请求密码重置。系统（模拟）向该邮箱发送重置链接。实际实现中需确保邮箱的有效性和安全性。
- SSO集成: 若系统与单点登录（SSO）集成，登录流程将由SSO服务处理，运营门户仅作为服务提供方（SP）接收认证结果。

#### 5.3.5 异常处理方案

- 用户名或密码错误: 提示“用户名或密码不正确，请重试”。
- 账户不存在: 提示“用户不存在”或统一为“用户名或密码不正确”。
- 账户被禁用/锁定: 提示“您的账户已被禁用/锁定，请联系管理员”。
- 验证码错误: 提示“验证码输入错误”。
- 登录服务不可用: 若后端认证服务出现问题，提示“登录服务暂不可用，请稍后重试”。

#### 5.3.6 与其他功能的关联和依赖

- 依赖项 (Dependencies):

  - 用户管理模块: 需要查询用户信息（用户名、密码、状态）进行验证。
  - (若有)验证码服务: 生成和校验验证码。
  - (若有)SSO服务: 委托认证。
- 被依赖项 (Generated Dependencies):

  - 系统所有需要登录才能访问的功能模块: 登录是访问这些模块的前提。
  - 系统日志模块: 记录用户登录尝试（成功与失败）的日志。
  - 会话管理机制: 管理用户登录后的会话状态。
-
