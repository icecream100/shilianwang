<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视联网适配中心 - 业务数据采集</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        .sidebar {
            width: 250px;
            background: #001529;
            color: white;
            height: 100vh;
            overflow-y: auto;
        }
        .main-content {
            flex: 1;
            background: #f5f5f5;
            overflow-y: auto;
        }
        .el-menu {
            border-right: none;
        }
        .el-menu--dark {
            background-color: #001529;
        }
        .el-menu-item.is-active {
            background-color: #1890ff !important;
        }
        .el-submenu__title:hover {
            background-color: #1890ff !important;
        }
        .el-menu-item:hover {
            background-color: #1890ff !important;
        }
        .content-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status-success {
            color: #52c41a;
        }
        .status-error {
            color: #ff4d4f;
        }
        .status-warning {
            color: #faad14;
        }
        .status-info {
            color: #1890ff;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .health-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .health-good {
            background-color: #52c41a;
        }
        .health-warning {
            background-color: #faad14;
        }
        .health-error {
            background-color: #ff4d4f;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="flex h-screen">
            <!-- 左侧导航 -->
            <div class="sidebar">
                <div class="p-4 border-b border-gray-600">
                    <h2 class="text-lg font-bold text-white">视联网适配中心</h2>
                </div>
                <el-menu
                    v-model:default-active="activeMenuItem"
                    class="el-menu-vertical-demo"
                    background-color="#001529"
                    text-color="#fff"
                    active-text-color="#fff"
                    :collapse="false"
                    @select="handleMenuSelect">
                    
                    <el-sub-menu index="1">
                        <template #title>
                            <el-icon><Monitor /></el-icon>
                            <span>运营门户</span>
                        </template>
                        <el-menu-item index="1-1">驾驶舱</el-menu-item>
                        <el-sub-menu index="1-2">
                            <template #title>客户管理</template>
                        </el-sub-menu>
                        <el-sub-menu index="1-3">
                            <template #title>运营分析</template>
                            <el-menu-item index="1-3-1">客户分析</el-menu-item>
                            <el-menu-item index="1-3-2">设备分析</el-menu-item>
                            <el-menu-item index="1-3-3">业务分析</el-menu-item>
                        </el-sub-menu>
                        <el-sub-menu index="1-4">
                            <template #title>运行监控</template>
                            <el-menu-item index="1-4-1">告警规则管理</el-menu-item>
                            <el-menu-item index="1-4-3">告警事件管理</el-menu-item>
                        </el-sub-menu>
                        <el-sub-menu index="1-5">
                            <template #title>系统配置</template>
                            <el-menu-item index="1-5-1">用户管理</el-menu-item>
                            <el-menu-item index="1-5-2">角色管理</el-menu-item>
                        </el-sub-menu>
                        <el-sub-menu index="1-6">
                            <template #title>日志管理</template>
                            <el-menu-item index="1-6-1">登录日志</el-menu-item>
                            <el-menu-item index="1-6-2">操作日志</el-menu-item>
                        </el-sub-menu>
                    </el-sub-menu>
                    
                    <el-sub-menu index="2">
                        <template #title>
                            <el-icon><Connection /></el-icon>
                            <span>接口适配</span>
                        </template>
                        <el-menu-item index="2-1">接入平台管理</el-menu-item>
                        <el-menu-item index="2-2">设备管理</el-menu-item>
                        <el-menu-item index="2-3">通道管理</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="3">
                        <template #title>
                            <el-icon><DataAnalysis /></el-icon>
                            <span>业务数据采集</span>
                        </template>
                        <el-menu-item index="3-1">业务采集设置</el-menu-item>
                        <el-menu-item index="3-2">客户同步设置</el-menu-item>
                        <el-menu-item index="3-3">任务状态</el-menu-item>
                    </el-sub-menu>
                </el-menu>
            </div>

            <!-- 主内容区域 -->
            <div class="main-content">
                <!-- 顶部导航栏 -->
                <div class="bg-white border-b border-gray-200 px-6 py-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-xl font-semibold text-gray-800">{{currentPageTitle}}</h1>
                            <p class="text-sm text-gray-500 mt-1">{{currentPageDescription}}</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <!-- 用户信息 -->
                            <el-dropdown trigger="click">
                                <div class="flex items-center cursor-pointer px-3 py-2 rounded-lg hover:bg-gray-100">
                                    <el-avatar size="small" class="mr-2">
                                        <i class="el-icon-user"></i>
                                    </el-avatar>
                                    <span class="text-gray-700 font-medium">{{ currentUser.name }}</span>
                                    <i class="el-icon-arrow-down ml-1 text-gray-500"></i>
                                </div>
                                <template #dropdown>
                                    <el-dropdown-menu>
                                        <el-dropdown-item @click="showProfile">
                                            <i class="el-icon-user mr-2"></i>个人中心
                                        </el-dropdown-item>
                                        <el-dropdown-item @click="changePassword">
                                            <i class="el-icon-key mr-2"></i>修改密码
                                        </el-dropdown-item>
                                        <el-dropdown-item divided @click="logout">
                                            <i class="el-icon-switch-button mr-2"></i>退出登录
                                        </el-dropdown-item>
                                    </el-dropdown-menu>
                                </template>
                            </el-dropdown>
                        </div>
                    </div>
                </div>

                <!-- 内容区域 -->
                <div class="p-6">
                    <!-- 业务采集设置页面 -->
                    <div v-if="currentPage === 'business'">

                            <div class="content-card p-6">
                                <!-- 操作栏 -->
                                <div class="flex justify-between items-center mb-6">
                                    <div class="flex items-center space-x-4">
                                        <el-input
                                            v-model="businessSearch"
                                            placeholder="搜索配置名称、平台名称"
                                            style="width: 300px"
                                            clearable>
                                            <template #prefix>
                                                <el-icon><Search /></el-icon>
                                            </template>
                                        </el-input>
                                        <el-select v-model="businessPlatformFilter" placeholder="源平台" clearable style="width: 150px">
                                            <el-option label="全部" value=""></el-option>
                                            <el-option label="千里眼" value="qianliyan"></el-option>
                                            <el-option label="移动看家" value="kanjia"></el-option>
                                            <el-option label="GB/T 28181" value="gb28181"></el-option>
                                        </el-select>
                                        <el-select v-model="businessDataTypeFilter" placeholder="数据类型" clearable style="width: 150px">
                                            <el-option label="全部" value=""></el-option>
                                            <el-option label="设备元数据" value="device_metadata"></el-option>
                                            <el-option label="用户行为数据" value="user_behavior"></el-option>
                                            <el-option label="视频业务数据" value="video_business"></el-option>
                                            <el-option label="套餐订购信息" value="package_info"></el-option>
                                        </el-select>
                                        <el-select v-model="businessStatusFilter" placeholder="状态" clearable style="width: 120px">
                                            <el-option label="全部" value=""></el-option>
                                            <el-option label="启用" value="enabled"></el-option>
                                            <el-option label="停用" value="disabled"></el-option>
                                        </el-select>
                                    </div>
                                    <el-button type="primary" @click="showAddBusinessConfigDialog">
                                        <el-icon><Plus /></el-icon>
                                        新增采集配置
                                    </el-button>
                                </div>

                                <!-- 配置列表 -->
                                <el-table :data="filteredBusinessConfigs" stripe>
                                    <el-table-column type="selection" width="55"></el-table-column>
                                    <el-table-column prop="configName" label="配置名称" width="180"></el-table-column>
                                    <el-table-column prop="sourcePlatformName" label="源平台" width="120"></el-table-column>
                                    <el-table-column prop="dataTypes" label="采集数据类型" width="200">
                                        <template #default="scope">
                                            <el-tag v-for="type in scope.row.dataTypes" :key="type" size="small" class="mr-1">
                                                {{getDataTypeName(type)}}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="collectionMode" label="采集方式" width="120">
                                        <template #default="scope">
                                            <el-tag :type="scope.row.collectionMode === 'PERIODIC_PULL' ? 'primary' : 'success'">
                                                {{scope.row.collectionMode === 'PERIODIC_PULL' ? '周期拉取' : '实时订阅'}}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="frequency" label="采集频率" width="120"></el-table-column>
                                    <el-table-column prop="enabledStatus" label="启用状态" width="100">
                                        <template #default="scope">
                                            <el-switch v-model="scope.row.enabledStatus" @change="toggleBusinessConfig(scope.row)"></el-switch>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="lastExecuteTime" label="上次执行" width="150"></el-table-column>
                                    <el-table-column prop="lastExecuteStatus" label="执行状态" width="100">
                                        <template #default="scope">
                                            <span :class="getExecuteStatusClass(scope.row.lastExecuteStatus)">
                                                <el-icon><CircleFilled /></el-icon>
                                                {{getExecuteStatusText(scope.row.lastExecuteStatus)}}
                                            </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="操作" width="280">
                                        <template #default="scope">
                                            <el-button size="small" @click="viewBusinessConfig(scope.row)">详情</el-button>
                                            <el-button size="small" type="primary" @click="editBusinessConfig(scope.row)">编辑</el-button>
                                            <el-button size="small" type="warning" @click="triggerBusinessCollection(scope.row)">手动触发</el-button>
                                            <el-button size="small" type="danger" @click="deleteBusinessConfig(scope.row)">删除</el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>

                                <!-- 分页 -->
                                <div class="flex justify-center mt-6">
                                    <el-pagination
                                        v-model:current-page="businessCurrentPage"
                                        :page-size="10"
                                        :total="businessConfigs.length"
                                        layout="total, prev, pager, next">
                                    </el-pagination>
                                </div>
                            </div>
                    </div>

                    <!-- 客户同步设置页面 -->
                    <div v-if="currentPage === 'crm'">
                        <div class="content-card">
                            <el-tabs v-model="crmActiveTab" class="px-6 pt-4">
                                <el-tab-pane label="同步配置" name="config">
                                    <div class="pb-6">
                                        <el-form :model="crmConfig" label-width="100px" class="max-w-2xl">
                                            <el-form-item label="CRM系统地址">
                                                <el-input v-model="crmConfig.apiUrl" placeholder="https://api.crm.example.com"></el-input>
                                            </el-form-item>
                                            <el-form-item label="认证方式">
                                                <el-input v-model="crmConfig.authType" placeholder="API Key"></el-input>
                                            </el-form-item>
                                            <el-form-item label="API密钥">
                                                <el-input v-model="crmConfig.authParams" placeholder="请输入API密钥" show-password></el-input>
                                            </el-form-item>
                                            <el-form-item label="同步频率">
                                                <el-select v-model="crmConfig.syncFrequency" placeholder="每天" style="width: 100%">
                                                    <el-option label="每天" value="daily"></el-option>
                                                    <el-option label="每周" value="weekly"></el-option>
                                                    <el-option label="每月" value="monthly"></el-option>
                                                </el-select>
                                            </el-form-item>
                                            <el-form-item label="启用同步">
                                                <el-switch v-model="crmConfig.enabled"></el-switch>
                                            </el-form-item>
                                            <el-form-item>
                                                <el-button type="primary" @click="saveCrmConfig">保存配置</el-button>
                                                <el-button @click="testCrmConnection">测试连接</el-button>
                                            </el-form-item>
                                        </el-form>
                                    </div>
                                </el-tab-pane>
                                
                                <el-tab-pane label="字段映射" name="mapping">
                                    <div class="pb-6">
                                        <div class="mb-4">
                                            <el-button type="primary" @click="addFieldMapping">添加映射</el-button>
                                        </div>
                                        <el-table :data="fieldMappings" border>
                                            <el-table-column prop="localField" label="本地字段" width="200">
                                                <template #default="scope">
                                                    <span class="text-gray-600">{{scope.row.localField}}</span>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="crmField" label="CRM字段" width="200">
                                                <template #default="scope">
                                                    <el-input v-model="scope.row.crmField" placeholder="输入对应的CRM字段" size="small"></el-input>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="fieldType" label="字段类型" width="150">
                                                <template #default="scope">
                                                    <el-select v-model="scope.row.fieldType" placeholder="选择类型" size="small" style="width: 100%">
                                                        <el-option label="文本" value="text"></el-option>
                                                        <el-option label="数字" value="number"></el-option>
                                                        <el-option label="日期" value="date"></el-option>
                                                    </el-select>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="required" label="必填" width="80">
                                                <template #default="scope">
                                                    <el-switch v-model="scope.row.required" size="small"></el-switch>
                                                </template>
                                            </el-table-column>
                                            <el-table-column label="操作" width="100">
                                                <template #default="scope">
                                                    <el-button size="small" type="danger" @click="removeFieldMapping(scope.$index)">删除</el-button>
                                                </template>
                                            </el-table-column>
                                        </el-table>
                                        <div class="mt-4">
                                            <el-button type="primary" @click="saveFieldMappings">保存配置</el-button>
                                        </div>
                                    </div>
                                </el-tab-pane>
                                
                                <el-tab-pane label="同步日志" name="logs">
                                    <div class="pb-6">
                                        <div class="mb-4 flex justify-between items-center">
                                            <div class="flex space-x-2">
                                                <el-button type="primary" @click="refreshSyncLogs">刷新日志</el-button>
                                            </div>
                                            <div class="text-sm text-gray-500">
                                                最后同步时间：{{crmSyncStatus.lastSyncTime}}
                                            </div>
                                        </div>
                                        
                                        <el-table :data="crmSyncLogs" border>
                                            <el-table-column prop="syncTime" label="同步时间" width="150"></el-table-column>
                                            <el-table-column prop="status" label="状态" width="100">
                                                <template #default="scope">
                                                    <el-tag :type="scope.row.status === 'success' ? 'success' : 'danger'" size="small">
                                                        {{scope.row.status === 'success' ? '成功' : '失败'}}
                                                    </el-tag>
                                                </template>
                                            </el-table-column>
                                            <el-table-column prop="processedCount" label="处理记录" width="100"></el-table-column>
                                            <el-table-column prop="successCount" label="成功记录" width="100"></el-table-column>
                                            <el-table-column prop="errorMessage" label="错误信息" show-overflow-tooltip></el-table-column>
                                            <el-table-column label="操作" width="100">
                                                <template #default="scope">
                                                    <el-button size="small" @click="viewSyncLogDetail(scope.row)">详情</el-button>
                                                </template>
                                            </el-table-column>
                                        </el-table>
                                    </div>
                                </el-tab-pane>
                            </el-tabs>
                        </div>
                    </div>

                    <!-- 任务状态页面 -->
                    <div v-if="currentPage === 'status'">
                            <div class="space-y-6">
                                 
                                <!-- 数据采集任务概览 -->
                                <div class="content-card p-6">
                                    <h3 class="text-lg font-semibold mb-4">数据采集任务概览</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                                            <div class="text-2xl font-bold text-blue-600">{{taskOverview.totalTasks}}</div>
                                            <div class="text-sm text-gray-600">总任务数</div>
                                        </div>
                                        <div class="bg-green-50 p-4 rounded-lg text-center">
                                            <div class="text-2xl font-bold text-green-600">{{taskOverview.runningTasks}}</div>
                                            <div class="text-sm text-gray-600">运行中</div>
                                        </div>
                                        <div class="bg-yellow-50 p-4 rounded-lg text-center">
                                            <div class="text-2xl font-bold text-yellow-600">{{taskOverview.todaySuccess}}</div>
                                            <div class="text-sm text-gray-600">今日成功</div>
                                        </div>
                                        <div class="bg-red-50 p-4 rounded-lg text-center">
                                            <div class="text-2xl font-bold text-red-600">{{taskOverview.todayFailed}}</div>
                                            <div class="text-sm text-gray-600">今日失败</div>
                                        </div>
                                    </div>
                                    
                     
                            
                            <!-- 全部任务记录 -->
                            <div class="content-card p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold">全部任务记录</h3>
                                    <div class="flex space-x-2">
                                        <el-select v-model="taskRecordStatusFilter" placeholder="状态筛选" clearable style="width: 120px">
                                            <el-option label="全部" value=""></el-option>
                                            <el-option label="成功" value="success"></el-option>
                                            <el-option label="失败" value="error"></el-option>
                                            <el-option label="运行中" value="running"></el-option>
                                        </el-select>
                                        <el-date-picker
                                            v-model="taskRecordDateRange"
                                            type="daterange"
                                            range-separator="至"
                                            start-placeholder="开始日期"
                                            end-placeholder="结束日期"
                                            size="default"
                                            style="width: 240px">
                                        </el-date-picker>
                                        <el-button type="primary" @click="queryTaskRecords">查询</el-button>
                                        <el-button @click="refreshTaskRecords">刷新</el-button>
                                    </div>
                                </div>
                                
                                <el-table :data="getCurrentPageTaskRecords()" stripe>
                                    <el-table-column prop="taskName" label="任务名称" width="200"></el-table-column>
                                    <el-table-column prop="taskType" label="任务类型" width="120"></el-table-column>
                                    <el-table-column prop="startTime" label="开始时间" width="150"></el-table-column>
                                    <el-table-column prop="endTime" label="结束时间" width="150"></el-table-column>
                                    <el-table-column prop="duration" label="执行时长" width="100"></el-table-column>
                                    <el-table-column prop="status" label="状态" width="100">
                                        <template #default="scope">
                                            <el-tag :type="getTaskRecordStatusType(scope.row.status)" size="small">
                                                {{getTaskRecordStatusText(scope.row.status)}}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="processedCount" label="处理记录数" width="120"></el-table-column>
                                    <el-table-column prop="errorMessage" label="错误信息" show-overflow-tooltip></el-table-column>
                                    <el-table-column label="操作" width="120">
                                        <template #default="scope">
                                            <el-button size="small" @click="viewTaskRecordDetail(scope.row)">详情</el-button>
                                            <el-button size="small" type="primary" @click="retryTask(scope.row)" v-if="scope.row.status === 'error'">重试</el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>
                                
                                <div class="flex justify-between items-center mt-4">
                                    <div class="text-sm text-gray-500">
                                        共 {{getTaskRecordTotal()}} 条记录
                                    </div>
                                    <el-pagination
                                        v-model:current-page="taskRecordCurrentPage"
                                        v-model:page-size="taskRecordPageSize"
                                        :page-sizes="[10, 20, 50, 100]"
                                        :total="getTaskRecordTotal()"
                                        layout="total, sizes, prev, pager, next, jumper">
                                    </el-pagination>
                                </div>
                            </div>
                    </div>
                    </div>
                </div>
                    </div>

                    <!-- 同步日志详情弹窗 -->
                    <el-dialog v-model="syncLogDetailDialogVisible" title="同步日志详情" width="800px">
                        <div class="space-y-6">
                            <!-- 基本信息 -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-medium mb-3 text-gray-800">基本信息</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <span class="text-gray-600">同步时间：</span>
                                        <span class="font-medium">{{ syncLogDetailData.syncTime }}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">同步状态：</span>
                                        <el-tag :type="syncLogDetailData.status === 'success' ? 'success' : 'danger'" size="small">
                                            {{ syncLogDetailData.status === 'success' ? '成功' : '失败' }}
                                        </el-tag>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">执行时长：</span>
                                        <span class="font-medium">{{ syncLogDetailData.duration }}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">同步类型：</span>
                                        <span class="font-medium">{{ syncLogDetailData.syncType }}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">数据源：</span>
                                        <span class="font-medium">{{ syncLogDetailData.dataSource }}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">目标系统：</span>
                                        <span class="font-medium">{{ syncLogDetailData.targetSystem }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 同步统计 -->
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-lg font-medium mb-3 text-gray-800">同步统计</h4>
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-blue-600">{{ syncLogDetailData.processedCount }}</div>
                                        <div class="text-sm text-gray-600">处理记录数</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-green-600">{{ syncLogDetailData.successCount }}</div>
                                        <div class="text-sm text-gray-600">成功记录数</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-red-600">{{ (syncLogDetailData.processedCount || 0) - (syncLogDetailData.successCount || 0) }}</div>
                                        <div class="text-sm text-gray-600">失败记录数</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 字段同步详情 -->
                            <div>
                                <h4 class="text-lg font-medium mb-3 text-gray-800">字段同步详情</h4>
                                <el-table :data="syncLogDetailData.details" border>
                                    <el-table-column prop="field" label="字段名称" width="200"></el-table-column>
                                    <el-table-column prop="count" label="同步数量" width="120"></el-table-column>
                                    <el-table-column prop="status" label="状态" width="100">
                                        <template #default="scope">
                                            <el-tag :type="scope.row.status === 'success' ? 'success' : 'danger'" size="small">
                                                {{ scope.row.status === 'success' ? '成功' : '失败' }}
                                            </el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="备注">
                                        <template #default="scope">
                                            <span class="text-gray-600">{{ scope.row.status === 'success' ? '同步完成' : '同步失败' }}</span>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </div>
                            
                            <!-- 错误信息 -->
                            <div v-if="syncLogDetailData.errorMessage" class="bg-red-50 p-4 rounded-lg">
                                <h4 class="text-lg font-medium mb-3 text-red-800">错误信息</h4>
                                <div class="text-red-700 bg-white p-3 rounded border border-red-200">
                                    {{ syncLogDetailData.errorMessage }}
                                </div>
                            </div>
                        </div>
                        
                        <template #footer>
                            <div class="flex justify-end space-x-2">
                                <el-button @click="syncLogDetailDialogVisible = false">关闭</el-button>
                                <el-button type="primary" @click="syncLogDetailDialogVisible = false">确定</el-button>
                            </div>
                        </template>
                    </el-dialog>

                    <!-- 配置详情弹窗 -->
        <el-dialog v-model="configDetailDialogVisible" title="配置详情" width="800px">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">配置名称</label>
                        <div class="text-sm text-gray-900">{{configDetailData.configName}}</div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">数据源类型</label>
                        <div class="text-sm text-gray-900">{{configDetailData.dataSourceType}}</div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">采集频率</label>
                        <div class="text-sm text-gray-900">{{configDetailData.frequency}}</div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">状态</label>
                        <el-tag :type="configDetailData.enabledStatus ? 'success' : 'danger'" size="small">
                            {{configDetailData.enabledStatus ? '启用' : '停用'}}
                        </el-tag>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">最后执行时间</label>
                        <div class="text-sm text-gray-900">{{configDetailData.lastExecuteTime}}</div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">下次执行时间</label>
                        <div class="text-sm text-gray-900">{{configDetailData.nextExecuteTime}}</div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">API地址</label>
                    <div class="text-sm text-gray-900 bg-gray-50 p-2 rounded">{{configDetailData.apiUrl}}</div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">采集参数</label>
                    <div class="text-sm text-gray-900 bg-gray-50 p-2 rounded" style="white-space: pre-wrap;">{{configDetailData.collectionParams}}</div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">描述</label>
                    <div class="text-sm text-gray-900">{{configDetailData.description}}</div>
                </div>
            </div>
            <template #footer>
                <div class="dialog-footer">
                    <el-button @click="configDetailDialogVisible = false">关闭</el-button>
                    <el-button type="primary" @click="editBusinessConfig(configDetailData)">编辑配置</el-button>
                </div>
            </template>
        </el-dialog>

        <!-- 新增/编辑业务数据采集配置对话框 -->
        <el-dialog v-model="businessConfigDialogVisible" :title="businessConfigDialogTitle" width="700px">
            <el-form :model="businessConfigForm" :rules="businessConfigRules" ref="businessConfigFormRef" label-width="120px">
                <el-form-item label="配置名称" prop="configName">
                    <el-input v-model="businessConfigForm.configName" placeholder="请输入配置名称"></el-input>
                </el-form-item>
                <el-form-item label="源平台" prop="sourcePlatform">
                    <el-select v-model="businessConfigForm.sourcePlatform" placeholder="请选择源平台" style="width: 100%">
                        <el-option label="千里眼平台" value="qianliyan"></el-option>
                        <el-option label="移动看家" value="kanjia"></el-option>
                        <el-option label="GB/T 28181" value="gb28181"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="采集数据类型" prop="dataTypes">
                    <el-checkbox-group v-model="businessConfigForm.dataTypes">
                        <el-checkbox label="device_metadata">设备元数据</el-checkbox>
                        <el-checkbox label="channel_metadata">通道元数据</el-checkbox>
                        <el-checkbox label="user_behavior">用户行为数据</el-checkbox>
                        <el-checkbox label="video_business">视频业务数据</el-checkbox>
                        <el-checkbox label="package_info">套餐订购信息</el-checkbox>
                    </el-checkbox-group>
                </el-form-item>
                <el-form-item label="采集方式" prop="collectionMode">
                    <el-radio-group v-model="businessConfigForm.collectionMode">
                        <el-radio label="PERIODIC_PULL">周期性拉取</el-radio>
                        <el-radio label="REALTIME_SUBSCRIBE">实时订阅</el-radio>
                    </el-radio-group>
                </el-form-item>
                <el-form-item label="采集频率" v-if="businessConfigForm.collectionMode === 'PERIODIC_PULL'">
                    <el-select v-model="businessConfigForm.frequency" placeholder="请选择采集频率" style="width: 100%">
                        <el-option label="每小时" value="0 0 * * * ?"></el-option>
                        <el-option label="每日凌晨2点" value="0 0 2 * * ?"></el-option>
                        <el-option label="每6小时" value="0 0 */6 * * ?"></el-option>
                        <el-option label="自定义" value="custom"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="自定义CRON" v-if="businessConfigForm.frequency === 'custom'">
                    <el-input v-model="businessConfigForm.customCron" placeholder="请输入CRON表达式"></el-input>
                </el-form-item>
                <el-form-item label="采集参数">
                    <el-input v-model="businessConfigForm.collectionParams" type="textarea" :rows="3" placeholder="可选，JSON格式的采集参数"></el-input>
                </el-form-item>
                <el-form-item label="启用状态">
                    <el-switch v-model="businessConfigForm.enabledStatus"></el-switch>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="businessConfigDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveBusinessConfig">保存</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 字段映射配置对话框 -->
        <el-dialog v-model="fieldMappingDialogVisible" title="CRM字段映射配置" width="800px">
            <div class="grid grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium mb-3">CRM源字段</h4>
                    <el-table :data="crmSourceFields" size="small" height="400">
                        <el-table-column prop="fieldName" label="字段名" width="120"></el-table-column>
                        <el-table-column prop="fieldType" label="类型" width="80"></el-table-column>
                        <el-table-column prop="description" label="描述"></el-table-column>
                    </el-table>
                </div>
                <div>
                    <h4 class="font-medium mb-3">目标字段映射</h4>
                    <el-form :model="fieldMappingForm" size="small">
                        <el-form-item v-for="(mapping, index) in fieldMappingForm.mappings" :key="index" :label="mapping.sourceField">
                            <el-select v-model="mapping.targetField" placeholder="选择目标字段" style="width: 100%">
                                <el-option v-for="field in targetFields" :key="field.value" :label="field.label" :value="field.value"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-form>
                </div>
            </div>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="fieldMappingDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveFieldMapping">保存映射</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- CRM同步日志对话框 -->
        <el-dialog v-model="crmSyncLogDialogVisible" title="CRM同步日志" width="900px">
            <div class="mb-4">
                <el-date-picker
                    v-model="logDateRange"
                    type="daterange"
                    range-separator="至"
                    start-placeholder="开始日期"
                    end-placeholder="结束日期"
                    style="margin-right: 10px">
                </el-date-picker>
                <el-select v-model="logStatusFilter" placeholder="状态" clearable style="width: 120px; margin-right: 10px">
                    <el-option label="全部" value=""></el-option>
                    <el-option label="成功" value="success"></el-option>
                    <el-option label="失败" value="failed"></el-option>
                    <el-option label="部分成功" value="partial"></el-option>
                </el-select>
                <el-button type="primary" @click="querySyncLogs">查询</el-button>
            </div>
            <el-table :data="crmSyncLogs" stripe>
                <el-table-column prop="syncTime" label="同步时间" width="150"></el-table-column>
                <el-table-column prop="status" label="状态" width="100">
                    <template #default="scope">
                        <el-tag :type="getSyncLogStatusType(scope.row.status)">{{getSyncLogStatusText(scope.row.status)}}</el-tag>
                    </template>
                </el-table-column>
                <el-table-column prop="totalCount" label="总数量" width="80"></el-table-column>
                <el-table-column prop="successCount" label="成功" width="80"></el-table-column>
                <el-table-column prop="failedCount" label="失败" width="80"></el-table-column>
                <el-table-column prop="duration" label="耗时" width="100"></el-table-column>
                <el-table-column prop="errorMessage" label="错误信息" show-overflow-tooltip></el-table-column>
                <el-table-column label="操作" width="100">
                    <template #default="scope">
                        <el-button size="small" @click="viewSyncLogDetail(scope.row)">详情</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;
        
        createApp({
            data() {
                return {
                    activeMenuItem: '3-1',
                    currentPage: 'business',
                    
                    // 用户信息
                    currentUser: {
                        name: '李管理员',
                        role: '系统管理员',
                        avatar: ''
                    },
                    
                    // 业务采集设置
                    businessConfigs: [
                        {
                            id: 1,
                            configName: '千里眼设备元数据采集',
                            sourcePlatformName: '千里眼平台',
                            dataTypes: ['device_metadata', 'channel_metadata'],
                            collectionMode: 'PERIODIC_PULL',
                            frequency: '每日凌晨2点',
                            enabledStatus: true,
                            lastExecuteTime: '2024-01-20 02:00:00',
                            lastExecuteStatus: 'success'
                        },
                        {
                            id: 2,
                            configName: '移动看家用户行为采集',
                            sourcePlatformName: '移动看家',
                            dataTypes: ['user_behavior', 'video_business'],
                            collectionMode: 'PERIODIC_PULL',
                            frequency: '每6小时',
                            enabledStatus: true,
                            lastExecuteTime: '2024-01-20 14:00:00',
                            lastExecuteStatus: 'failed'
                        }
                    ],
                    businessSearch: '',
                    businessPlatformFilter: '',
                    businessDataTypeFilter: '',
                    businessStatusFilter: '',
                    businessCurrentPage: 1,
                    businessConfigDialogVisible: false,
                    businessConfigDialogTitle: '新增采集配置',
                    businessConfigForm: {
                        configName: '',
                        sourcePlatform: '',
                        dataTypes: [],
                        collectionMode: 'PERIODIC_PULL',
                        frequency: '',
                        customCron: '',
                        collectionParams: '',
                        enabledStatus: true
                    },
                    businessConfigRules: {
                        configName: [{ required: true, message: '请输入配置名称', trigger: 'blur' }],
                        sourcePlatform: [{ required: true, message: '请选择源平台', trigger: 'change' }],
                        dataTypes: [{ required: true, message: '请选择采集数据类型', trigger: 'change' }],
                        collectionMode: [{ required: true, message: '请选择采集方式', trigger: 'change' }]
                    },
                    
                    // CRM配置
                    crmActiveTab: 'config',
                    crmConfig: {
                        apiUrl: 'https://api.crm.example.com',
                        authType: 'API Key',
                        authParams: '',
                        queryFilter: '',
                        syncFrequency: 'daily',
                        customCron: '',
                        enabled: true
                    },
                    crmSyncStatus: {
                        status: 'success',
                        lastSyncTime: '2024-01-20 02:00:00',
                        syncCount: 1250,
                        newCount: 45,
                        updateCount: 123
                    },
                    crmSyncLoading: false,
                    fieldMappingDialogVisible: false,
                    crmSyncLogDialogVisible: false,
                    
                    // 字段映射
                    fieldMappings: [
                        { localField: '客户编号', crmField: 'customer_id', fieldType: 'text', required: true },
                        { localField: '客户名称', crmField: 'company_name', fieldType: 'text', required: true },
                        { localField: '联系人', crmField: 'contact_name', fieldType: 'text', required: true },
                        { localField: '联系电话', crmField: 'phone', fieldType: 'text', required: false },
                        { localField: '邮箱', crmField: 'email', fieldType: 'text', required: false }
                    ],
                    crmSourceFields: [
                        { fieldName: 'customer_id', fieldType: 'String', description: '客户ID' },
                        { fieldName: 'customer_name', fieldType: 'String', description: '客户名称' },
                        { fieldName: 'contact_phone', fieldType: 'String', description: '联系电话' },
                        { fieldName: 'contact_email', fieldType: 'String', description: '邮箱地址' },
                        { fieldName: 'company_name', fieldType: 'String', description: '公司名称' }
                    ],
                    targetFields: [
                        { label: '客户ID', value: 'customerId' },
                        { label: '客户名称', value: 'customerName' },
                        { label: '联系人', value: 'contactPerson' },
                        { label: '联系电话', value: 'contactPhone' },
                        { label: '邮箱', value: 'email' },
                        { label: '公司名称', value: 'companyName' }
                    ],
                    fieldMappingForm: {
                        mappings: [
                            { sourceField: 'customer_id', targetField: 'customerId' },
                            { sourceField: 'customer_name', targetField: 'customerName' },
                            { sourceField: 'contact_phone', targetField: 'contactPhone' },
                            { sourceField: 'contact_email', targetField: 'email' },
                            { sourceField: 'company_name', targetField: 'companyName' }
                        ]
                    },
                    
                    // CRM同步日志
                    crmSyncLogs: [
                        {
                            syncTime: '2024-01-20 02:00:00',
                            status: 'success',
                            totalCount: 1250,
                            successCount: 1250,
                            failedCount: 0,
                            duration: '2分35秒',
                            errorMessage: ''
                        },
                        {
                            syncTime: '2024-01-19 02:00:00',
                            status: 'partial',
                            totalCount: 1180,
                            successCount: 1165,
                            failedCount: 15,
                            duration: '3分12秒',
                            errorMessage: '部分客户数据格式错误'
                        }
                    ],
                    logDateRange: [],
                    logStatusFilter: '',
                    
                    // 任务记录相关数据
                    taskRecords: [
                        {
                            taskName: '客户基础信息采集',
                            taskType: '数据采集',
                            startTime: '2024-01-20 14:30:00',
                            endTime: '2024-01-20 14:32:15',
                            duration: '2分15秒',
                            status: 'success',
                            processedCount: 156,
                            errorMessage: ''
                        },
                        {
                            taskName: '设备状态数据采集',
                            taskType: '状态监控',
                            startTime: '2024-01-20 15:00:00',
                            endTime: '',
                            duration: '',
                            status: 'running',
                            processedCount: 0,
                            errorMessage: ''
                        },
                        {
                            taskName: '业务日志采集',
                            taskType: '日志采集',
                            startTime: '2024-01-20 13:45:00',
                            endTime: '2024-01-20 13:45:30',
                            duration: '30秒',
                            status: 'error',
                            processedCount: 0,
                            errorMessage: 'API认证失败，请检查密钥配置'
                        },
                        {
                            taskName: 'CRM客户同步',
                            taskType: '数据同步',
                            startTime: '2024-01-20 12:00:00',
                            endTime: '2024-01-20 12:05:22',
                            duration: '5分22秒',
                            status: 'success',
                            processedCount: 89,
                            errorMessage: ''
                        },
                        {
                            taskName: '系统健康检查',
                            taskType: '健康检查',
                            startTime: '2024-01-20 11:30:00',
                            endTime: '2024-01-20 11:30:45',
                            duration: '45秒',
                            status: 'success',
                            processedCount: 4,
                            errorMessage: ''
                        }
                    ],
                    taskRecordStatusFilter: '',
                    taskRecordDateRange: [],
                    taskRecordCurrentPage: 1,
                    taskRecordPageSize: 10,
                    
                    // 配置详情弹窗
                    configDetailDialogVisible: false,
                    configDetailData: {},
                    
                    // 同步日志详情弹窗
                    syncLogDetailDialogVisible: false,
                    syncLogDetailData: {},
                    
                    // 系统状态
                    systemHealth: {
                        cpuUsage: 45,
                        memoryUsage: 68,
                        diskIO: 125,
                        networkThroughput: 89
                    },
                    microServices: [
                        { name: '接口适配服务', status: 'healthy', cpu: 35, memory: 45 },
                        { name: '流媒体服务', status: 'healthy', cpu: 52, memory: 67 },
                        { name: '数据处理服务', status: 'warning', cpu: 78, memory: 82 },
                        { name: '认证服务', status: 'healthy', cpu: 25, memory: 38 },
                        { name: '消息队列服务', status: 'healthy', cpu: 42, memory: 55 },
                        { name: '数据库服务', status: 'healthy', cpu: 38, memory: 62 }
                    ],
                    platformConnections: [
                        {
                            platformName: '千里眼平台',
                            connectionStatus: 'connected',
                            pingLatency: 15,
                            packetLoss: 0,
                            heartbeatStatus: 'normal',
                            authStatus: 'valid',
                            apiSuccessRate: 99.5,
                            avgResponseTime: 120,
                            lastSyncTime: '2024-01-20 15:30:00'
                        },
                        {
                            platformName: '移动看家',
                            connectionStatus: 'disconnected',
                            pingLatency: 0,
                            packetLoss: 100,
                            heartbeatStatus: 'abnormal',
                            authStatus: 'invalid',
                            apiSuccessRate: 0,
                            avgResponseTime: 0,
                            lastSyncTime: '2024-01-19 18:45:00'
                        }
                    ],
                    taskOverview: {
                        totalTasks: 5,
                        runningTasks: 1,
                        todaySuccess: 3,
                        todayFailed: 1
                    },
                    recentErrors: [
                        {
                            taskName: '移动看家用户行为采集',
                            errorTime: '2024-01-20 14:00:00',
                            errorMessage: '连接超时：无法访问目标API'
                        },
                        {
                            taskName: 'CRM客户数据同步',
                            errorTime: '2024-01-20 08:30:00',
                            errorMessage: '认证失败：Token已过期'
                        }
                    ]
                }
            },
            
            computed: {
                currentPageTitle() {
                    const titleMap = {
                        'business': '业务采集设置',
                        'crm': '客户同步设置',
                        'status': '任务状态'
                    };
                    return titleMap[this.currentPage] || '业务数据采集';
                },
                currentPageDescription() {
                    const descMap = {
                        'business': '配置和管理从各省级视频平台采集业务数据的任务，支持设备元数据、用户行为、视频业务等数据类型的采集',
                        'crm': '配置与省侧CRM系统的数据对接参数，实现客户信息的自动同步和字段映射',
                        'status': '监控数据采集任务的执行状态、系统健康度和平台连接状况'
                    };
                    return descMap[this.currentPage] || '配置和管理各类数据源的采集任务，监控系统运行状态';
                },
                filteredBusinessConfigs() {
                    return this.businessConfigs.filter(config => {
                        const matchSearch = !this.businessSearch || 
                            config.configName.toLowerCase().includes(this.businessSearch.toLowerCase()) ||
                            config.sourcePlatformName.toLowerCase().includes(this.businessSearch.toLowerCase());
                        const matchPlatform = !this.businessPlatformFilter || config.sourcePlatformName.includes(this.businessPlatformFilter);
                        const matchDataType = !this.businessDataTypeFilter || config.dataTypes.includes(this.businessDataTypeFilter);
                        const matchStatus = !this.businessStatusFilter || 
                            (this.businessStatusFilter === 'enabled' && config.enabledStatus) ||
                            (this.businessStatusFilter === 'disabled' && !config.enabledStatus);
                        return matchSearch && matchPlatform && matchDataType && matchStatus;
                    });
                }
            },
            
            methods: {
                handleMenuSelect(index) {
                    this.activeMenuItem = index;
                    // 根据菜单项设置当前页面
                    if (index === '3-1') {
                        this.currentPage = 'business';
                    } else if (index === '3-2') {
                        this.currentPage = 'crm';
                    } else if (index === '3-3') {
                        this.currentPage = 'status';
                    }
                },
                
                refreshAllData() {
                    ElMessage.success('数据已刷新');
                },
                
                // 业务数据采集配置方法
                showAddBusinessConfigDialog() {
                    this.businessConfigDialogTitle = '新增采集配置';
                    this.businessConfigForm = {
                        configName: '',
                        sourcePlatform: '',
                        dataTypes: [],
                        collectionMode: 'PERIODIC_PULL',
                        frequency: '',
                        customCron: '',
                        collectionParams: '',
                        enabledStatus: true
                    };
                    this.businessConfigDialogVisible = true;
                },
                
                editBusinessConfig(config) {
                    this.businessConfigDialogTitle = '编辑采集配置';
                    this.businessConfigForm = { ...config };
                    this.businessConfigDialogVisible = true;
                },
                
                saveBusinessConfig() {
                    this.$refs.businessConfigFormRef.validate((valid) => {
                        if (valid) {
                            ElMessage.success('采集配置保存成功');
                            this.businessConfigDialogVisible = false;
                        }
                    });
                },
                
                viewBusinessConfig(config) {
                    this.configDetailData = { ...config };
                    this.configDetailDialogVisible = true;
                },
                
                toggleBusinessConfig(config) {
                    const action = config.enabledStatus ? '启用' : '停用';
                    ElMessage.success(`采集配置 ${config.configName} 已${action}`);
                },
                
                triggerBusinessCollection(config) {
                    ElMessageBox.confirm(
                        `确定手动触发采集任务 ${config.configName} 吗？`,
                        '确认触发',
                        {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning',
                        }
                    ).then(() => {
                        ElMessage.success('采集任务已触发，请稍后查看执行结果');
                    }).catch(() => {
                        ElMessage.info('已取消触发');
                    });
                },
                
                deleteBusinessConfig(config) {
                    ElMessageBox.confirm(
                        `确定删除采集配置 ${config.configName} 吗？删除后无法恢复。`,
                        '确认删除',
                        {
                            confirmButtonText: '确定删除',
                            cancelButtonText: '取消',
                            type: 'warning',
                        }
                    ).then(() => {
                        ElMessage.success('删除成功');
                    }).catch(() => {
                        ElMessage.info('已取消删除');
                    });
                },
                
                // CRM配置方法
                saveCrmConfig() {
                    ElMessage.success('CRM配置保存成功');
                },
                
                testCrmConnection() {
                    ElMessage.info('正在测试CRM连接...');
                    setTimeout(() => {
                        ElMessage.success('CRM连接测试成功');
                    }, 2000);
                },
                
                triggerCrmSync() {
                    this.crmSyncLoading = true;
                    ElMessage.info('正在执行CRM数据同步...');
                    setTimeout(() => {
                        this.crmSyncLoading = false;
                        ElMessage.success('CRM数据同步完成');
                        this.crmSyncStatus.lastSyncTime = new Date().toLocaleString();
                    }, 3000);
                },
                
                showFieldMappingDialog() {
                    this.fieldMappingDialogVisible = true;
                },
                
                saveFieldMapping() {
                    ElMessage.success('字段映射配置保存成功');
                    this.fieldMappingDialogVisible = false;
                },
                
                showCrmSyncLogDialog() {
                    this.crmSyncLogDialogVisible = true;
                },
                
                querySyncLogs() {
                    ElMessage.success('同步日志查询完成');
                },
                
                viewSyncLogDetail(log) {
                    this.syncLogDetailData = {
                        syncTime: log.syncTime,
                        status: log.status,
                        processedCount: log.processedCount,
                        successCount: log.successCount,
                        errorMessage: log.errorMessage,
                        duration: '2分30秒',
                        syncType: '增量同步',
                        dataSource: 'CRM系统',
                        targetSystem: '视联网适配中心',
                        details: [
                            { field: '客户姓名', count: log.successCount || 0, status: 'success' },
                            { field: '联系电话', count: log.successCount || 0, status: 'success' },
                            { field: '客户地址', count: log.successCount || 0, status: 'success' },
                            { field: '业务类型', count: log.successCount || 0, status: 'success' }
                        ]
                    };
                    this.syncLogDetailDialogVisible = true;
                },
                
                // 状态展示方法
                viewPlatformDetails(platform) {
                    ElMessage.info(`查看平台详情：${platform.platformName}`);
                },
                
                testPlatformConnection(platform) {
                    ElMessage.info(`正在测试 ${platform.platformName} 连接...`);
                    setTimeout(() => {
                        ElMessage.success('连接测试完成');
                    }, 2000);
                },
                
                viewErrorDetails(error) {
                    ElMessage.info(`查看错误详情：${error.taskName}`);
                },
                
                // 辅助方法
                getDataTypeName(type) {
                    const nameMap = {
                        'device_metadata': '设备元数据',
                        'channel_metadata': '通道元数据',
                        'user_behavior': '用户行为',
                        'video_business': '视频业务',
                        'package_info': '套餐信息'
                    };
                    return nameMap[type] || type;
                },
                
                getExecuteStatusClass(status) {
                    const classMap = {
                        'success': 'status-success',
                        'failed': 'status-error',
                        'running': 'status-info'
                    };
                    return classMap[status] || 'status-info';
                },
                
                getExecuteStatusText(status) {
                    const textMap = {
                        'success': '成功',
                        'failed': '失败',
                        'running': '运行中'
                    };
                    return textMap[status] || '未知';
                },
                
                getConnectionStatusClass(status) {
                    const classMap = {
                        'connected': 'status-success',
                        'disconnected': 'status-error',
                        'connecting': 'status-warning'
                    };
                    return classMap[status] || 'status-info';
                },
                
                getConnectionStatusText(status) {
                    const textMap = {
                        'connected': '已连接',
                        'disconnected': '连接失败',
                        'connecting': '连接中'
                    };
                    return textMap[status] || '未知';
                },
                
                // 用户相关方法
                showProfile() {
                    this.$message.info('跳转到个人中心页面');
                },
                
                changePassword() {
                    this.$message.info('打开修改密码对话框');
                },
                
                logout() {
                    this.$confirm('确定要退出登录吗？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        this.$message.success('已退出登录');
                        // 这里可以添加实际的退出登录逻辑
                    }).catch(() => {});
                },
                
                getHealthClass(status) {
                    const classMap = {
                        'healthy': 'health-good',
                        'warning': 'health-warning',
                        'error': 'health-error'
                    };
                    return classMap[status] || 'health-good';
                },
                
                getServiceStatusText(status) {
                    const textMap = {
                        'healthy': '正常',
                        'warning': '警告',
                        'error': '错误'
                    };
                    return textMap[status] || '未知';
                },
                
                getSyncLogStatusType(status) {
                    const typeMap = {
                        'success': 'success',
                        'failed': 'danger',
                        'partial': 'warning'
                    };
                    return typeMap[status] || 'info';
                },
                
                getSyncLogStatusText(status) {
                    const textMap = {
                        'success': '成功',
                        'failed': '失败',
                        'partial': '部分成功'
                    };
                    return textMap[status] || status;
                },
                
                // 任务记录相关方法
                getTaskStatusType(status) {
                    const statusMap = {
                        'success': 'success',
                        'running': 'warning',
                        'error': 'danger',
                        'pending': 'info'
                    };
                    return statusMap[status] || 'info';
                },
                
                getTaskStatusText(status) {
                    const statusMap = {
                        'success': '成功',
                        'running': '运行中',
                        'error': '失败',
                        'pending': '等待中'
                    };
                    return statusMap[status] || '未知';
                },
                
                // 筛选任务记录
                getFilteredTaskRecords() {
                    let filtered = this.taskRecords;
                    
                    // 状态筛选
                    if (this.taskRecordStatusFilter) {
                        filtered = filtered.filter(record => record.status === this.taskRecordStatusFilter);
                    }
                    
                    // 日期范围筛选
                    if (this.taskRecordDateRange && this.taskRecordDateRange.length === 2) {
                        const startDate = this.taskRecordDateRange[0];
                        const endDate = this.taskRecordDateRange[1];
                        filtered = filtered.filter(record => {
                            const recordDate = new Date(record.startTime);
                            return recordDate >= startDate && recordDate <= endDate;
                        });
                    }
                    
                    return filtered;
                },
                
                // 获取当前页任务记录
                getCurrentPageTaskRecords() {
                    const filtered = this.getFilteredTaskRecords();
                    const start = (this.taskRecordCurrentPage - 1) * this.taskRecordPageSize;
                    const end = start + this.taskRecordPageSize;
                    return filtered.slice(start, end);
                },
                
                // 获取任务记录总数
                getTaskRecordTotal() {
                    return this.getFilteredTaskRecords().length;
                },
                
                // 任务记录页码变化
                handleTaskRecordPageChange(page) {
                    this.taskRecordCurrentPage = page;
                },
                
                // 查看任务详情
                viewTaskDetail(record) {
                    ElMessage.info('查看任务详情：' + record.taskName);
                },
                
                // 重新执行任务
                retryTask(record) {
                    ElMessageBox.confirm('确认重新执行该任务？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        ElMessage.success('任务已重新启动');
                    }).catch(() => {
                        ElMessage.info('已取消操作');
                    });
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>