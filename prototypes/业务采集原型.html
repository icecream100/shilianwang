<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视联网适配中心 - 业务采集模块</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sidebar {
            width: 250px;
            background: #001529;
            color: white;
            height: 100vh;
            overflow-y: auto;
        }
        .main-content {
            flex: 1;
            background: #f5f5f5;
            overflow-y: auto;
        }
        .el-menu {
            border-right: none;
        }
        .el-menu--dark {
            background-color: #001529;
        }
        .el-menu-item.is-active {
            background-color: #1890ff !important;
        }
        .el-submenu__title:hover {
            background-color: #1890ff !important;
        }
        .el-menu-item:hover {
            background-color: #1890ff !important;
        }
        .content-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status-success {
            color: #52c41a;
        }
        .status-error {
            color: #ff4d4f;
        }
        .status-warning {
            color: #faad14;
        }
        .status-info {
            color: #1890ff;
        }
        .field-tree {
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            padding: 16px;
            background: #fafafa;
            min-height: 300px;
        }
        .mapping-line {
            position: absolute;
            border-top: 2px solid #1890ff;
            z-index: 10;
        }
        .field-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: white;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .field-item:hover {
            border-color: #1890ff;
            box-shadow: 0 2px 4px rgba(24, 144, 255, 0.2);
        }
        .field-item.selected {
            border-color: #1890ff;
            background: #e6f7ff;
        }
        .wizard-steps {
            margin-bottom: 24px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="flex h-screen">
            <!-- 左侧导航 -->
            <div class="sidebar">
                <div class="p-4 border-b border-gray-600">
                    <h2 class="text-lg font-bold text-white">视联网适配中心</h2>
                </div>
                <el-menu
                    :default-active="activeMenu"
                    class="el-menu-vertical-demo"
                    background-color="#001529"
                    text-color="#fff"
                    active-text-color="#fff"
                    :collapse="false"
                    @select="handleMenuSelect">
                    
                    <el-sub-menu index="1">
                        <template #title>
                            <el-icon><Monitor /></el-icon>
                            <span>运营门户</span>
                        </template>
                        <el-menu-item index="1-1">运营门户</el-menu-item>
                        <el-sub-menu index="1-2">
                            <template #title>客户管理</template>
                        </el-sub-menu>
                        <el-sub-menu index="1-3">
                            <template #title>运营分析</template>
                            <el-menu-item index="1-3-1">客户分析</el-menu-item>
                            <el-menu-item index="1-3-2">设备分析</el-menu-item>
                            <el-menu-item index="1-3-3">业务分析</el-menu-item>
                        </el-sub-menu>
                        <el-sub-menu index="1-5">
                            <template #title>系统配置</template>
                            <el-menu-item index="1-5-1">用户管理</el-menu-item>
                            <el-menu-item index="1-5-2">角色管理</el-menu-item>
                        </el-sub-menu>
                        <el-sub-menu index="1-6">
                            <template #title>日志管理</template>
                            <el-menu-item index="1-6-1">登录日志</el-menu-item>
                            <el-menu-item index="1-6-2">操作日志</el-menu-item>
                        </el-sub-menu>
                    </el-sub-menu>
                    
                    <el-sub-menu index="2">
                        <template #title>
                            <el-icon><Connection /></el-icon>
                            <span>接口适配</span>
                        </template>
                        <el-menu-item index="2-1">业务平台管理</el-menu-item>
                        <el-menu-item index="2-2">设备管理</el-menu-item>
                        <el-menu-item index="2-3">通道管理</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="3">
                        <template #title>
                            <el-icon><DataAnalysis /></el-icon>
                            <span>业务数据采集</span>
                        </template>
                        <el-menu-item index="platform">业务平台管理</el-menu-item>
                        <el-menu-item index="interface">接口管理</el-menu-item>
                        <el-menu-item index="task">任务管理</el-menu-item>
                        <el-menu-item index="log">同步记录</el-menu-item>
                    </el-sub-menu>
                </el-menu>
            </div>

            <!-- 主内容区域 -->
            <div class="main-content">
                <!-- 顶部导航栏 -->
                <div class="bg-white border-b border-gray-200 px-6 py-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-xl font-semibold text-gray-800">{{ currentPageTitle }}</h1>
                        </div>
                        <div class="flex items-center space-x-4">
                            <!-- 用户信息 -->
                            <el-dropdown trigger="click">
                                <div class="flex items-center cursor-pointer px-3 py-2 rounded-lg hover:bg-gray-100">
                                    <el-avatar size="small" class="mr-2" :src="userInfo.avatarUrl">
                                        <i class="el-icon-user"></i>
                                    </el-avatar>
                                    <span class="text-gray-700 font-medium">{{ userInfo.realName }}</span>
                                    <i class="el-icon-arrow-down ml-1 text-gray-500"></i>
                                </div>
                                <template #dropdown>
                                    <el-dropdown-menu>
                                        <el-dropdown-item @click="navigateToProfile">
                                            <i class="el-icon-user mr-2"></i>个人中心
                                        </el-dropdown-item>
                                        <el-dropdown-item @click="navigateToPassword">
                                            <i class="el-icon-key mr-2"></i>修改密码
                                        </el-dropdown-item>
                                        <el-dropdown-item divided @click="logout">
                                            <i class="el-icon-switch-button mr-2"></i>退出登录
                                        </el-dropdown-item>
                                    </el-dropdown-menu>
                                </template>
                            </el-dropdown>
                        </div>
                    </div>
                </div>

                <!-- 内容区域 -->
                <div class="p-6">
                    <!-- 业务平台管理 -->
                    <div v-show="activeTab === 'platform'">
                        <div class="content-card p-6">
                            <!-- 筛选查询区域 -->
                            <div class="mb-6">
                                <div class="flex justify-between items-start">
                                    <div class="flex flex-wrap gap-4">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">平台名称:</span>
                                            <el-input
                                                v-model="platformSearch"
                                                placeholder="搜索平台名称"
                                                style="width: 200px"
                                                clearable>
                                                <template #prefix>
                                                    <el-icon><Search /></el-icon>
                                                </template>
                                            </el-input>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">连接类型:</span>
                                            <el-select v-model="platformTypeFilter" placeholder="请选择" clearable style="width: 150px">
                                                <el-option label="全部" value=""></el-option>
                                                <el-option label="HTTP" value="http"></el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <el-button type="primary" @click="showAddPlatformDialog">
                                        <el-icon><Plus /></el-icon>
                                        新增平台
                                    </el-button>
                                </div>
                            </div>

                            <!-- 平台列表 -->
                            <el-table :data="filteredPlatforms" stripe>
                                <el-table-column prop="name" label="平台名称" width="150"></el-table-column>
                                <el-table-column prop="type" label="连接类型" width="120">
                                    <template #default="scope">
                                        <el-tag :type="getPlatformTypeTagType(scope.row.type)">{{getPlatformTypeName(scope.row.type)}}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="baseUrl" label="连接地址" width="200"></el-table-column>
                                <el-table-column prop="description" label="描述" width="200"></el-table-column>
                                <el-table-column prop="status" label="连接状态" width="120">
                                    <template #default="scope">
                                        <span :class="getConnectionStatusClass(scope.row.status)">
                                            <el-icon><CircleFilled /></el-icon>
                                            {{getConnectionStatusText(scope.row.status)}}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="createTime" label="新增时间" width="180"></el-table-column>
                                <el-table-column label="操作" width="280">
                                    <template #default="scope">
                                        <div class="flex items-center gap-1">
                                            <el-button size="small" @click="viewPlatform(scope.row)">详情</el-button>
                                            <el-button size="small" type="primary" @click="editPlatform(scope.row)">编辑</el-button>
                                            <el-button size="small" type="warning" @click="testConnection(scope.row)">测试连接</el-button>
                                            <el-button size="small" type="danger" @click="deletePlatform(scope.row)">删除</el-button>
                                        </div>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="platformCurrentPage"
                                    :page-size="10"
                                    :total="platforms.length"
                                    layout="total, prev, pager, next">
                                </el-pagination>
                            </div>
                        </div>
                    </div>

                    <!-- 接口管理 -->
                    <div v-show="activeTab === 'interface'">
                        <div class="content-card p-6">
                            <!-- 筛选查询区域 -->
                            <div class="mb-6">
                                <div class="flex justify-between items-start">
                                    <div class="flex flex-wrap gap-4">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">接口名称:</span>
                                            <el-input
                                                v-model="interfaceSearch"
                                                placeholder="搜索接口名称"
                                                style="width: 200px"
                                                clearable>
                                                <template #prefix>
                                                    <el-icon><Search /></el-icon>
                                                </template>
                                            </el-input>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">所属平台:</span>
                                            <el-select v-model="interfacePlatformFilter" placeholder="请选择" clearable style="width: 150px">
                                                <el-option label="全部" value=""></el-option>
                                                <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <el-button type="primary" @click="showAddInterfaceDialog">
                                        <el-icon><Plus /></el-icon>
                                        新增接口
                                    </el-button>
                                </div>
                            </div>

                            <!-- 接口列表 -->
                            <el-table :data="filteredInterfaces" stripe>
                                <el-table-column prop="name" label="接口名称" width="150"></el-table-column>
                                <el-table-column prop="platformName" label="所属平台" width="120"></el-table-column>
                                <el-table-column prop="path" label="接口路径" width="200"></el-table-column>
                                <el-table-column prop="method" label="请求方法" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getMethodTagType(scope.row.method)">{{scope.row.method}}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="fieldCount" label="字段数量" width="100"></el-table-column>
                                <el-table-column prop="description" label="描述" width="200"></el-table-column>
                                <el-table-column prop="createTime" label="新增时间" width="180"></el-table-column>
                                <el-table-column label="操作" width="200">
                                    <template #default="scope">
                                        <div class="flex gap-1">
                                            <el-button size="small" @click="viewInterfaceDetail(scope.row)">详情</el-button>
                                            <el-button size="small" type="primary" @click="editInterface(scope.row)">编辑</el-button>
                                            <el-button size="small" type="danger" @click="deleteInterface(scope.row)">删除</el-button>
                                        </div>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="interfaceCurrentPage"
                                    :page-size="10"
                                    :total="interfaces.length"
                                    layout="total, prev, pager, next">
                                </el-pagination>
                            </div>
                        </div>
                    </div>

                    <!-- 任务管理 -->
                    <div v-show="activeTab === 'task'">
                        <div class="content-card p-6">
                            <!-- 操作栏 -->
                            <!-- 筛选查询区域 -->
                            <div class="mb-6">
                                <div class="flex justify-between items-start">
                                    <div class="flex flex-wrap gap-4">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">任务名称:</span>
                                            <el-input
                                                v-model="taskSearch"
                                                placeholder="搜索任务名称"
                                                style="width: 200px"
                                                clearable>
                                                <template #prefix>
                                                    <el-icon><Search /></el-icon>
                                                </template>
                                            </el-input>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">任务状态:</span>
                                            <el-select v-model="taskStatusFilter" placeholder="请选择" clearable style="width: 150px">
                                                <el-option label="全部" value=""></el-option>
                                                <el-option label="启用" value="enabled"></el-option>
                                                <el-option label="停用" value="disabled"></el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <el-button type="primary" @click="showTaskWizard">
                                        <el-icon><Plus /></el-icon>
                                        新建任务
                                    </el-button>
                                </div>
                            </div>

                            <!-- 任务列表 -->
                            <el-table :data="filteredTasks" stripe>
                                <el-table-column prop="name" label="任务名称" width="150"></el-table-column>
                                <el-table-column prop="sourceInfo" label="源平台/接口" width="200">
                                    <template #default="scope">
                                        <div>
                                            <div class="font-medium">{{scope.row.sourceInfo.platformName}}</div>
                                            <div class="text-sm text-gray-500">{{scope.row.sourceInfo.interfaceName}}</div>
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="targetInfo" label="目标平台/接口" width="200">
                                    <template #default="scope">
                                        <div>
                                            <div class="font-medium">{{scope.row.targetInfo.platformName}}</div>
                                            <div class="text-sm text-gray-500">{{scope.row.targetInfo.interfaceName}}</div>
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="runMode" label="运行模式" width="100">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.runMode === 'once' ? 'info' : 'primary'">
                                            {{ scope.row.runMode === 'once' ? '单次' : '循环' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="status" label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getTaskStatusTagType(scope.row.status)">{{getTaskStatusText(scope.row.status)}}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="lastRunTime" label="最近运行" width="180"></el-table-column>
                                <el-table-column prop="nextRunTime" label="下次运行" width="180">
                                    <template #default="scope">
                                        <span v-if="scope.row.runMode === 'cycle' && scope.row.status === 'enabled'">
                                            {{ scope.row.nextRunTime || '-' }}
                                        </span>
                                        <span v-else>-</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="createTime" label="新增时间" width="180"></el-table-column>
                                <el-table-column label="操作" width="280">
                                    <template #default="scope">
                                        <div class="flex flex-wrap gap-1">
                                            <el-button size="small" @click="viewTaskDetail(scope.row)">详情</el-button>
                                            <el-button size="small" type="primary" @click="editTaskDetail(scope.row)">编辑</el-button>
                                            <el-button size="small" :type="scope.row.status === 'enabled' ? 'warning' : 'success'" @click="toggleTaskStatus(scope.row)">
                                                {{scope.row.status === 'enabled' ? '停用' : '启用'}}
                                            </el-button>
                                            <el-button size="small" type="danger" @click="deleteTask(scope.row)">删除</el-button>
                                        </div>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="taskCurrentPage"
                                    :page-size="10"
                                    :total="tasks.length"
                                    layout="total, prev, pager, next">
                                </el-pagination>
                            </div>
                        </div>
                    </div>

                    <!-- 同步记录 -->
                    <div v-show="activeTab === 'log'">
                        <div class="content-card p-6">
                            <!-- 筛选查询区域 -->
                            <div class="mb-6">
                                <div class="flex flex-col gap-4">
                                    <!-- 第一行 -->
                                    <div class="flex flex-wrap gap-4">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">任务名称:</span>
                                            <el-select v-model="logTaskFilter" placeholder="请选择" clearable style="width: 150px">
                                                <el-option label="全部任务" value=""></el-option>
                                                <el-option v-for="task in tasks" :key="task.id" :label="task.name" :value="task.id"></el-option>
                                            </el-select>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">时间范围:</span>
                                            <el-date-picker
                                                v-model="logDateRange"
                                                type="datetimerange"
                                                range-separator="至"
                                                start-placeholder="开始时间"
                                                end-placeholder="结束时间"
                                                format="YYYY-MM-DD HH:mm:ss"
                                                value-format="YYYY-MM-DD HH:mm:ss"
                                                style="width: 350px">
                                            </el-date-picker>
                                        </div>
                                    </div>
                                    <!-- 第二行 -->
                                    <div class="flex flex-wrap gap-4 items-center">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">源平台:</span>
                                            <el-select v-model="logSourcePlatformFilter" placeholder="请选择" clearable style="width: 120px">
                                                <el-option label="全部" value=""></el-option>
                                                <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.name"></el-option>
                                            </el-select>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">目标平台:</span>
                                            <el-select v-model="logTargetPlatformFilter" placeholder="请选择" clearable style="width: 120px">
                                                <el-option label="全部" value=""></el-option>
                                                <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.name"></el-option>
                                            </el-select>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">调用状态:</span>
                                            <el-select v-model="logStatusFilter" placeholder="请选择" clearable style="width: 120px">
                                                <el-option label="全部" value=""></el-option>
                                                <el-option label="成功" value="success"></el-option>
                                                <el-option label="失败" value="failure"></el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <!-- 第三行 -->
                                    <div class="flex flex-wrap gap-4 items-center">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700 w-16">关键词:</span>
                                            <el-input v-model="logKeywordSearch" placeholder="搜索任务名称、接口名称、错误信息" clearable style="width: 300px"></el-input>
                                        </div>
                                        <el-button type="primary" @click="searchLogs">
                                            <el-icon><Search /></el-icon>
                                            查询
                                        </el-button>
                                        <el-button @click="resetLogFilters">
                                            <el-icon><Refresh /></el-icon>
                                            重置
                                        </el-button>
                                    </div>
                                </div>
                            </div>

                            <!-- 日志列表 -->
                            <el-table :data="filteredLogs" stripe>
                                <el-table-column prop="callTime" label="调用时间" width="160"></el-table-column>
                                <el-table-column prop="taskName" label="任务名称" width="140"></el-table-column>
                                <el-table-column prop="sourcePlatform" label="源平台" width="100"></el-table-column>
                                <el-table-column prop="sourceInterface" label="源接口" width="100"></el-table-column>
                                <el-table-column prop="targetPlatform" label="目标平台" width="100"></el-table-column>
                                <el-table-column prop="targetInterface" label="目标接口" width="100"></el-table-column>
                                <el-table-column prop="status" label="状态" width="80">
                                    <template #default="scope">
                                        <el-tag :type="getLogStatusType(scope.row.status)">
                                            {{getLogStatusText(scope.row.status)}}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="dataCount" label="数据量" width="80"></el-table-column>
                                <el-table-column label="成功/失败" width="100">
                                    <template #default="scope">
                                        <span style="color: #67C23A;">{{scope.row.successCount}}</span> / 
                                        <span style="color: #F56C6C;">{{scope.row.failureCount}}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="duration" label="耗时(ms)" width="90"></el-table-column>
                                <el-table-column label="操作" width="100">
                                    <template #default="scope">
                                        <el-button size="small" type="primary" @click="viewLogDetail(scope.row)">详情</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="logCurrentPage"
                                    :page-size="10"
                                    :total="logs.length"
                                    layout="total, prev, pager, next">
                                </el-pagination>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 业务平台管理对话框 -->
        <el-dialog v-model="platformDialogVisible" :title="platformDialogTitle" width="600px">
            <el-form :model="platformForm" label-width="100px">
                <el-form-item label="平台名称" required>
                    <el-input v-model="platformForm.name" placeholder="请输入平台名称"></el-input>
                </el-form-item>
                <el-form-item label="平台描述">
                    <el-input v-model="platformForm.description" type="textarea" placeholder="请输入平台描述"></el-input>
                </el-form-item>
                <el-form-item label="连接类型" required>
                    <el-select v-model="platformForm.type" placeholder="请选择连接类型" @change="onConnectionTypeChange">
                        <el-option label="HTTP" value="http"></el-option>
                    </el-select>
                </el-form-item>
                <div v-if="platformForm.type === 'http'">
                    <el-form-item label="Base URL" required>
                        <el-input v-model="platformForm.baseUrl" placeholder="http://api.example.com"></el-input>
                    </el-form-item>
                    <el-form-item label="认证方式">
                        <el-select v-model="platformForm.authType" placeholder="请选择认证方式">
                            <el-option label="无认证" value="none"></el-option>
                            <el-option label="API Key" value="apikey"></el-option>
                            <el-option label="Bearer Token" value="bearer"></el-option>
                        </el-select>
                    </el-form-item>
                </div>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="platformDialogVisible = false">取消</el-button>
                    <el-button type="warning" @click="testPlatformConnection">测试连接</el-button>
                    <el-button type="primary" @click="savePlatform">保存</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 平台详情查看对话框 -->
        <el-dialog v-model="platformDetailVisible" title="平台详情" width="700px">
            <el-descriptions :column="2" border>
                <el-descriptions-item label="平台名称">{{platformDetail.name}}</el-descriptions-item>
                <el-descriptions-item label="连接类型">
                    <el-tag :type="getPlatformTypeTagType(platformDetail.type)">{{getPlatformTypeName(platformDetail.type)}}</el-tag>
                </el-descriptions-item>
                <el-descriptions-item label="平台描述" :span="2">{{platformDetail.description || '暂无描述'}}</el-descriptions-item>
                <template v-if="platformDetail.type === 'http'">
                    <el-descriptions-item label="连接地址">{{platformDetail.baseUrl}}</el-descriptions-item>
                    <el-descriptions-item label="认证方式">{{getAuthTypeName(platformDetail.authType)}}</el-descriptions-item>
                </template>
                <el-descriptions-item label="连接状态">
                    <span :class="getConnectionStatusClass(platformDetail.status)">
                        <el-icon><CircleFilled /></el-icon>
                        {{getConnectionStatusText(platformDetail.status)}}
                    </span>
                </el-descriptions-item>
                <el-descriptions-item label="新增时间">{{platformDetail.createTime}}</el-descriptions-item>
            </el-descriptions>
        </el-dialog>

        <!-- 接口管理对话框 -->
        <el-dialog v-model="interfaceDialogVisible" :title="interfaceDialogTitle" width="800px">
            <el-form :model="interfaceForm" label-width="100px">
                <el-form-item label="所属平台" required>
                    <el-select v-model="interfaceForm.platformId" placeholder="请选择平台">
                        <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="接口名称" required>
                    <el-input v-model="interfaceForm.name" placeholder="请输入接口名称"></el-input>
                </el-form-item>
                <el-form-item label="接口路径" required>
                    <el-input v-model="interfaceForm.path" placeholder="/api/order/create"></el-input>
                </el-form-item>
                <el-form-item label="请求方法" required>
                    <el-select v-model="interfaceForm.method" placeholder="请选择请求方法">
                        <el-option label="GET" value="GET"></el-option>
                        <el-option label="POST" value="POST"></el-option>
                        <el-option label="PUT" value="PUT"></el-option>
                        <el-option label="DELETE" value="DELETE"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="接口描述">
                    <el-input v-model="interfaceForm.description" type="textarea" placeholder="请输入接口描述"></el-input>
                </el-form-item>
                <el-form-item label="字段定义">
                    <div class="field-tree">
                        <div class="flex justify-between items-center mb-4">
                            <span class="font-medium">字段结构编辑器</span>
                            <el-button size="small" type="primary" @click="addRootField">添加根字段</el-button>
                        </div>
                        <div class="field-tree-container">
                            <div v-for="(field, index) in interfaceForm.fields" :key="index" class="field-node">
                                <div class="field-item" :style="{paddingLeft: field.level * 20 + 'px'}">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span v-if="field.level > 0" class="text-gray-400">└─</span>
                                            <el-input v-model="field.name" placeholder="字段名" size="small" style="width: 120px"></el-input>
                                            <el-select v-model="field.type" placeholder="类型" size="small" style="width: 100px" @change="onFieldTypeChange(field, index)">
                                                <el-option label="String" value="string"></el-option>
                                                <el-option label="Number" value="number"></el-option>
                                                <el-option label="Boolean" value="boolean"></el-option>
                                                <el-option label="Object" value="object"></el-option>
                                                <el-option label="Array" value="array"></el-option>
                                            </el-select>
                                            <el-checkbox v-model="field.required">必填</el-checkbox>
                                            <el-input v-model="field.description" placeholder="描述" size="small" style="width: 150px"></el-input>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                            <el-button v-if="field.type === 'object' || field.type === 'array'" size="small" type="success" @click="addChildField(index)">添加子字段</el-button>
                                            <el-button size="small" type="danger" @click="removeField(index)">删除</el-button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="interfaceDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveInterface">保存</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 任务向导对话框 -->
        <el-dialog v-model="taskWizardVisible" title="创建同步任务" width="1000px">
            <div class="wizard-steps">
                <el-steps :active="taskWizardStep" finish-status="success">
                    <el-step title="基本信息"></el-step>
                    <el-step title="字段映射"></el-step>
                    <el-step title="运行配置"></el-step>
                    <el-step title="配置确认"></el-step>
                </el-steps>
            </div>
            
            <!-- 步骤1：基本信息 -->
            <div v-show="taskWizardStep === 0">
                <el-form :model="taskForm" label-width="120px">
                    <el-form-item label="任务名称" required>
                        <el-input v-model="taskForm.name" placeholder="请输入任务名称"></el-input>
                    </el-form-item>
                    <el-form-item label="任务描述">
                        <el-input v-model="taskForm.description" type="textarea" placeholder="请输入任务描述"></el-input>
                    </el-form-item>
                    <el-form-item label="源平台" required>
                        <el-select v-model="taskForm.sourcePlatformId" placeholder="请选择源平台" @change="onSourcePlatformChange">
                            <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="源接口" required>
                        <el-select v-model="taskForm.sourceInterfaceId" placeholder="请选择源接口" @change="onSourceInterfaceChange">
                            <el-option v-for="interface in sourceInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="目标平台" required>
                        <el-select v-model="taskForm.targetPlatformId" placeholder="请选择目标平台" @change="onTargetPlatformChange">
                            <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="目标接口" required>
                        <el-select v-model="taskForm.targetInterfaceId" placeholder="请选择目标接口" @change="onTargetInterfaceChange">
                            <el-option v-for="interface in targetInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                        </el-select>
                    </el-form-item>
                </el-form>
            </div>
            
            <!-- 步骤2：字段映射 -->
            <div v-show="taskWizardStep === 1">
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-medium">字段映射配置</h4>
                        <div class="space-x-2">
                            <el-button size="small" type="warning" @click="clearAllMappings">清空映射</el-button>
                        </div>
                    </div>
                    
                    <!-- Tab标签页 -->
                    <el-tabs v-model="activeFieldMappingTab" class="mb-4">
                        <el-tab-pane label="Body" name="body">
                            <!-- Body字段映射内容 -->
                            <div class="space-y-4">
                                <!-- 映射行 -->
                                <div class="space-y-3 max-h-96 overflow-y-auto">
                                    <div v-for="(sourceField, index) in sourceFields" :key="index" class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                        <!-- 源字段展示 -->
                                        <div class="flex-1">
                                            <el-input v-model="sourceField.name" readonly size="small" class="mb-1">
                                                <template #prepend>源字段</template>
                                            </el-input>
                                        </div>
                                        
                                        <!-- 箭头 -->
                                        <div class="flex items-center">
                                            <el-icon class="text-blue-500 text-lg"><Right /></el-icon>
                                        </div>
                                        
                                        <!-- 目标字段选择 -->
                                        <div class="flex-1">
                                            <el-select v-model="fieldMappings[sourceField.name]" placeholder="选择目标字段" size="small" class="w-full" clearable>
                                                <template #prefix>目标字段</template>
                                                <el-option v-for="targetField in availableTargetFields(sourceField.name)" :key="targetField.name" :label="targetField.name" :value="targetField.name" :disabled="isTargetFieldUsed(targetField.name, sourceField.name)">
                                                    <div class="flex justify-between items-center">
                                                        <span>{{targetField.name}}</span>
                                                        <div class="flex items-center space-x-1">
                                                            <el-tag size="small" :type="getFieldTypeColor(targetField.type)">{{targetField.type}}</el-tag>
                                                            <el-tag v-if="targetField.required" size="small" type="danger">必填</el-tag>
                                                        </div>
                                                    </div>
                                                </el-option>
                                            </el-select>
                                        </div>
                                        
                                        <!-- 操作按钮 -->
                                        <div class="flex items-center">
                                            <el-button v-if="fieldMappings[sourceField.name]" size="small" type="danger" text @click="clearMapping(sourceField.name)">
                                                <el-icon><Delete /></el-icon>
                                            </el-button>
                                        </div>
                                    </div>
                                    
                                    <!-- 空状态 -->
                                    <div v-if="sourceFields.length === 0" class="text-center py-8 text-gray-500">
                                        <el-icon class="text-4xl mb-2"><MessageBox /></el-icon>
                                        <p>请先在上方选择源接口</p>
                                    </div>
                                </div>
                            </div>
                        </el-tab-pane>
                        
                        <el-tab-pane label="Query" name="query">
                            <!-- Query参数映射内容 -->
                            <div class="space-y-4">
                                <!-- 操作按钮 -->
                                <div class="flex justify-between items-center">
                                    <div class="flex gap-2">
                                        <el-button size="small" @click="loadQuerySourceFields">加载源Query参数</el-button>
                                        <el-button size="small" @click="loadQueryTargetFields">加载目标Query参数</el-button>
                                        <el-button size="small" type="primary" @click="autoMatchQueryFields">智能匹配</el-button>
                                    </div>
                                    <el-button size="small" type="danger" @click="clearAllQueryMappings">清空映射</el-button>
                                </div>
                                
                                <!-- 字段映射列表 -->
                                <div class="space-y-3">
                                    <div v-for="(sourceField, index) in querySourceFields" :key="index" class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                        <!-- 源字段 -->
                                        <div class="flex-1">
                                            <el-input v-model="sourceField.name" readonly size="small">
                                                <template #prefix>
                                                    <span class="text-xs text-gray-500">源参数</span>
                                                </template>
                                            </el-input>
                                            <div class="text-xs text-gray-500 mt-1">{{sourceField.type}} {{sourceField.required ? '(必填)' : '(可选)'}}</div>
                                        </div>
                                        
                                        <!-- 箭头 -->
                                        <el-icon class="text-gray-400 text-lg"><Right /></el-icon>
                                        
                                        <!-- 目标字段选择 -->
                                        <div class="flex-1">
                                            <el-select v-model="queryFieldMappings[sourceField.name]" placeholder="选择目标参数" size="small" class="w-full" clearable>
                                                <template #prefix>
                                                    <span class="text-xs text-gray-500">目标参数</span>
                                                </template>
                                                <el-option v-for="targetField in availableQueryTargetFields(sourceField.name)" :key="targetField.name" :label="targetField.name" :value="targetField.name" :disabled="isQueryTargetFieldUsed(targetField.name, sourceField.name)">
                                                    <div class="flex justify-between items-center">
                                                        <span>{{targetField.name}}</span>
                                                        <span class="text-xs text-gray-400">{{targetField.type}}</span>
                                                    </div>
                                                </el-option>
                                            </el-select>
                                        </div>
                                        
                                        <!-- 操作按钮 -->
                                        <div class="flex gap-1">
                                            <el-button v-if="queryFieldMappings[sourceField.name]" size="small" type="danger" text @click="clearQueryMapping(sourceField.name)">
                                                <el-icon><Delete /></el-icon>
                                            </el-button>
                                        </div>
                                    </div>
                                    
                                    <div v-if="querySourceFields.length === 0" class="text-center py-8 text-gray-500">
                                        <el-icon class="text-4xl mb-2"><Search /></el-icon>
                                        <p>暂无Query参数</p>
                                        <p class="text-sm">请先加载源Query参数</p>
                                    </div>
                                </div>
                            </div>
                        </el-tab-pane>
                        
                        <el-tab-pane label="Headers" name="headers">
                            <!-- Headers映射内容 -->
                            <div class="space-y-4">
                                <!-- 操作按钮 -->
                                <div class="flex justify-between items-center">
                                    <div class="flex gap-2">
                                        <el-button size="small" @click="loadHeadersSourceFields">加载源Headers</el-button>
                                        <el-button size="small" @click="loadHeadersTargetFields">加载目标Headers</el-button>
                                        <el-button size="small" type="primary" @click="autoMatchHeadersFields">智能匹配</el-button>
                                    </div>
                                    <el-button size="small" type="danger" @click="clearAllHeadersMappings">清空映射</el-button>
                                </div>
                                
                                <!-- 字段映射列表 -->
                                <div class="space-y-3">
                                    <div v-for="(sourceField, index) in headersSourceFields" :key="index" class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                        <!-- 源字段 -->
                                        <div class="flex-1">
                                            <el-input v-model="sourceField.name" readonly size="small">
                                                <template #prefix>
                                                    <span class="text-xs text-gray-500">源Header</span>
                                                </template>
                                            </el-input>
                                            <div class="text-xs text-gray-500 mt-1">{{sourceField.type}} {{sourceField.required ? '(必填)' : '(可选)'}}</div>
                                        </div>
                                        
                                        <!-- 箭头 -->
                                        <el-icon class="text-gray-400 text-lg"><Right /></el-icon>
                                        
                                        <!-- 目标字段选择 -->
                                        <div class="flex-1">
                                            <el-select v-model="headersFieldMappings[sourceField.name]" placeholder="选择目标Header" size="small" class="w-full" clearable>
                                                <template #prefix>
                                                    <span class="text-xs text-gray-500">目标Header</span>
                                                </template>
                                                <el-option v-for="targetField in availableHeadersTargetFields(sourceField.name)" :key="targetField.name" :label="targetField.name" :value="targetField.name" :disabled="isHeadersTargetFieldUsed(targetField.name, sourceField.name)">
                                                    <div class="flex justify-between items-center">
                                                        <span>{{targetField.name}}</span>
                                                        <span class="text-xs text-gray-400">{{targetField.type}}</span>
                                                    </div>
                                                </el-option>
                                            </el-select>
                                        </div>
                                        
                                        <!-- 操作按钮 -->
                                        <div class="flex gap-1">
                                            <el-button v-if="headersFieldMappings[sourceField.name]" size="small" type="danger" text @click="clearHeadersMapping(sourceField.name)">
                                                <el-icon><Delete /></el-icon>
                                            </el-button>
                                        </div>
                                    </div>
                                    
                                    <div v-if="headersSourceFields.length === 0" class="text-center py-8 text-gray-500">
                                        <el-icon class="text-4xl mb-2"><Document /></el-icon>
                                        <p>暂无Headers</p>
                                        <p class="text-sm">请先加载源Headers</p>
                                    </div>
                                </div>
                            </div>
                        </el-tab-pane>
                        
                        <el-tab-pane label="Path" name="path">
                            <!-- Path参数映射内容 -->
                            <div class="space-y-4">
                                <!-- 操作按钮 -->
                                <div class="flex justify-between items-center">
                                    <div class="flex gap-2">
                                        <el-button size="small" @click="loadPathSourceFields">加载源Path参数</el-button>
                                        <el-button size="small" @click="loadPathTargetFields">加载目标Path参数</el-button>
                                        <el-button size="small" type="primary" @click="autoMatchPathFields">智能匹配</el-button>
                                    </div>
                                    <el-button size="small" type="danger" @click="clearAllPathMappings">清空映射</el-button>
                                </div>
                                
                                <!-- 字段映射列表 -->
                                <div class="space-y-3">
                                    <div v-for="(sourceField, index) in pathSourceFields" :key="index" class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                        <!-- 源字段 -->
                                        <div class="flex-1">
                                            <el-input v-model="sourceField.name" readonly size="small">
                                                <template #prefix>
                                                    <span class="text-xs text-gray-500">源路径参数</span>
                                                </template>
                                            </el-input>
                                            <div class="text-xs text-gray-500 mt-1">{{sourceField.type}} {{sourceField.required ? '(必填)' : '(可选)'}}</div>
                                        </div>
                                        
                                        <!-- 箭头 -->
                                        <el-icon class="text-gray-400 text-lg"><Right /></el-icon>
                                        
                                        <!-- 目标字段选择 -->
                                        <div class="flex-1">
                                            <el-select v-model="pathFieldMappings[sourceField.name]" placeholder="选择目标路径参数" size="small" class="w-full" clearable>
                                                <template #prefix>
                                                    <span class="text-xs text-gray-500">目标路径参数</span>
                                                </template>
                                                <el-option v-for="targetField in availablePathTargetFields(sourceField.name)" :key="targetField.name" :label="targetField.name" :value="targetField.name" :disabled="isPathTargetFieldUsed(targetField.name, sourceField.name)">
                                                    <div class="flex justify-between items-center">
                                                        <span>{{targetField.name}}</span>
                                                        <span class="text-xs text-gray-400">{{targetField.type}}</span>
                                                    </div>
                                                </el-option>
                                            </el-select>
                                        </div>
                                        
                                        <!-- 操作按钮 -->
                                        <div class="flex gap-1">
                                            <el-button v-if="pathFieldMappings[sourceField.name]" size="small" type="danger" text @click="clearPathMapping(sourceField.name)">
                                                <el-icon><Delete /></el-icon>
                                            </el-button>
                                        </div>
                                    </div>
                                    
                                    <div v-if="pathSourceFields.length === 0" class="text-center py-8 text-gray-500">
                                        <el-icon class="text-4xl mb-2"><Link /></el-icon>
                                        <p>暂无Path参数</p>
                                        <p class="text-sm">请先加载源Path参数</p>
                                    </div>
                                </div>
                            </div>
                        </el-tab-pane>
                    </el-tabs>
                    
                    <!-- 映射统计 -->
                    <div class="mt-4 p-3 bg-blue-50 rounded">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-blue-700">映射统计：已配置 {{validMappingsCount}} 个有效映射</span>
                            <span class="text-gray-600">源字段：{{sourceFields.length}} 个 | 目标字段：{{targetFields.length}} 个</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 步骤3：运行模式配置 -->
            <div v-show="taskWizardStep === 2">
                <div class="space-y-6">
                    <div>
                        <h4 class="font-medium mb-4">运行模式</h4>
                        <el-radio-group v-model="taskForm.runMode" class="mb-4">
                            <el-radio label="once">单次执行</el-radio>
                            <el-radio label="cycle">循环执行</el-radio>
                        </el-radio-group>
                    </div>
                    
                    <!-- 循环配置 -->
                    <div v-if="taskForm.runMode === 'cycle'" class="space-y-4">
                        <div>
                            <h5 class="font-medium mb-2">循环类型</h5>
                            <el-radio-group v-model="taskForm.cycleType">
                                <el-radio label="monthly">每月</el-radio>
                                <el-radio label="weekly">每周</el-radio>
                                <el-radio label="daily">每日</el-radio>
                            </el-radio-group>
                        </div>
                        
                        <!-- 每月配置 -->
                        <div v-if="taskForm.cycleType === 'monthly'" class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">执行日期</label>
                                <el-select v-model="taskForm.monthlyDay" placeholder="选择日期">
                                    <el-option v-for="day in 31" :key="day" :label="`${day}日`" :value="day"></el-option>
                                </el-select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">执行时间</label>
                                <el-time-picker v-model="taskForm.executeTime" format="HH:mm" placeholder="选择时间"></el-time-picker>
                            </div>
                        </div>
                        
                        <!-- 每周配置 -->
                        <div v-if="taskForm.cycleType === 'weekly'" class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">执行星期</label>
                                <el-select v-model="taskForm.weeklyDay" placeholder="选择星期">
                                    <el-option label="星期一" value="1"></el-option>
                                    <el-option label="星期二" value="2"></el-option>
                                    <el-option label="星期三" value="3"></el-option>
                                    <el-option label="星期四" value="4"></el-option>
                                    <el-option label="星期五" value="5"></el-option>
                                    <el-option label="星期六" value="6"></el-option>
                                    <el-option label="星期日" value="0"></el-option>
                                </el-select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">执行时间</label>
                                <el-time-picker v-model="taskForm.executeTime" format="HH:mm" placeholder="选择时间"></el-time-picker>
                            </div>
                        </div>
                        
                        <!-- 每日配置 -->
                        <div v-if="taskForm.cycleType === 'daily'">
                            <label class="block text-sm font-medium mb-1">执行时间</label>
                            <el-time-picker v-model="taskForm.executeTime" format="HH:mm" placeholder="选择时间"></el-time-picker>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 步骤4：配置确认 -->
            <div v-show="taskWizardStep === 3">
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium mb-2">基本信息</h4>
                        <div class="bg-gray-50 p-4 rounded">
                            <p><strong>任务名称：</strong>{{taskForm.name}}</p>
                            <p><strong>任务描述：</strong>{{taskForm.description}}</p>
                            <p><strong>源平台/接口：</strong>{{getSelectedPlatformName(taskForm.sourcePlatformId)}} / {{getSelectedInterfaceName(taskForm.sourceInterfaceId)}}</p>
                            <p><strong>目标平台/接口：</strong>{{getSelectedPlatformName(taskForm.targetPlatformId)}} / {{getSelectedInterfaceName(taskForm.targetInterfaceId)}}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">运行配置</h4>
                        <div class="bg-gray-50 p-4 rounded">
                            <p><strong>运行模式：</strong>{{taskForm.runMode === 'once' ? '单次执行' : '循环执行'}}</p>
                            <div v-if="taskForm.runMode === 'cycle'">
                                <p><strong>循环类型：</strong>{{getCycleTypeText(taskForm.cycleType)}}</p>
                                <p v-if="taskForm.cycleType === 'monthly'"><strong>执行时间：</strong>每月{{taskForm.monthlyDay}}日 {{formatTime(taskForm.executeTime)}}</p>
                                <p v-if="taskForm.cycleType === 'weekly'"><strong>执行时间：</strong>每周{{getWeekDayText(taskForm.weeklyDay)}} {{formatTime(taskForm.executeTime)}}</p>
                                <p v-if="taskForm.cycleType === 'daily'"><strong>执行时间：</strong>每日 {{formatTime(taskForm.executeTime)}}</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">字段映射概览</h4>
                        <div class="bg-gray-50 p-4 rounded">
                            <p><strong>映射数量：</strong>{{ validMappingCount }} 个</p>
                            <div v-for="(sourceField, targetField) in fieldMappings" :key="targetField" class="text-sm">
                                <p v-if="sourceField">{{ sourceField }} → {{ targetField }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="taskWizardVisible = false">取消</el-button>
                    <el-button v-if="taskWizardStep > 0" @click="taskWizardStep--">上一步</el-button>
                    <el-button v-if="taskWizardStep < 3" type="primary" @click="taskWizardStep++">下一步</el-button>
                    <el-button v-if="taskWizardStep === 3" type="success" @click="saveTask">保存并激活</el-button>
                    <el-button v-if="taskWizardStep === 3" @click="saveDraftTask">存为草稿</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 接口详情弹窗 -->
        <el-dialog v-model="interfaceDetailVisible" title="接口详情" width="800px">
            <el-descriptions :column="2" border>
                <el-descriptions-item label="接口名称">{{ interfaceDetail.name }}</el-descriptions-item>
                <el-descriptions-item label="所属平台">{{ interfaceDetail.platformName }}</el-descriptions-item>
                <el-descriptions-item label="接口路径">{{ interfaceDetail.path }}</el-descriptions-item>
                <el-descriptions-item label="请求方法">
                    <el-tag :type="interfaceDetail.method === 'POST' ? 'primary' : 'success'">{{ interfaceDetail.method }}</el-tag>
                </el-descriptions-item>
                <el-descriptions-item label="接口描述" :span="2">{{ interfaceDetail.description }}</el-descriptions-item>
            </el-descriptions>
            <div class="mt-6">
                <h4 class="text-lg font-medium mb-4">字段结构</h4>
                <div class="border rounded-lg p-4 bg-gray-50">
                    <div v-for="field in interfaceDetail.fields" :key="field.id" class="field-display" :style="{paddingLeft: field.level * 20 + 'px', marginBottom: '8px'}">
                        <div class="flex items-center space-x-2">
                            <span v-if="field.level > 0" class="text-gray-400">└─</span>
                            <span class="font-medium">{{ field.name }}</span>
                            <el-tag size="small" :type="getFieldTypeColor(field.type)">{{ field.type }}</el-tag>
                            <el-tag v-if="field.required" size="small" type="danger">必填</el-tag>
                            <span class="text-gray-600">{{ field.description }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </el-dialog>

        <!-- 日志详情对话框 -->
        <el-dialog v-model="logDetailVisible" title="调用详情" width="1400px" class="log-detail-dialog">
            <!-- 基本信息 -->
            <div class="mb-6">
                <el-descriptions :column="4" border>
                    <el-descriptions-item v-for="(value, key) in logDetail.basicInfo" :key="key" :label="key">
                        <div class="flex items-center space-x-2">
                            <span class="font-medium">{{ value }}</span>
                        </div>
                    </el-descriptions-item>
                </el-descriptions>
            </div>

            <!-- 成功状态：显示同步成果 -->
            <div v-if="logDetail.status === 'success' || logDetail.status === 'partial'">
                <div class="bg-white border border-gray-200 rounded-lg shadow-sm">
                    <div class="bg-gray-50 px-4 py-3 flex items-center justify-between border-b">
                        <div class="flex items-center space-x-2 text-gray-700">
                            <el-icon><DataAnalysis /></el-icon>
                            <h4 class="font-medium">同步成果数据</h4>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="text-sm text-gray-600">
                                <span class="font-bold text-green-600">{{ logDetail.data.length }}</span> 条数据同步成功
                            </div>
                            <el-button type="success" size="small">
                                <el-icon class="mr-1"><Download /></el-icon>
                                导出数据
                            </el-button>
                        </div>
                    </div>
                    <div class="p-4">
                        <el-table :data="logDetail.data" stripe height="400" style="width: 100%">
                            <el-table-column prop="orderNo" label="订单号" width="180"></el-table-column>
                            <el-table-column prop="customerName" label="客户姓名" width="120"></el-table-column>
                            <el-table-column prop="phone" label="联系电话" width="150"></el-table-column>
                            <el-table-column prop="businessType" label="业务类型"></el-table-column>
                            <el-table-column prop="bandwidth" label="带宽"></el-table-column>
                            <el-table-column prop="installAddress" label="安装地址" min-width="250"></el-table-column>
                            <el-table-column prop="orderTime" label="订购时间" width="180"></el-table-column>
                            <el-table-column prop="syncStatus" label="同步状态" width="100">
                                <template #default="scope">
                                    <el-tag type="success" size="small">{{ scope.row.syncStatus }}</el-tag>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                </div>
            </div>

            <!-- 失败状态：不显示内容 -->
            <div v-else-if="logDetail.status === 'failure'">
                <!-- 失败状态下不显示任何内容 -->
            </div>

            <!-- 报文内容区域 -->
            <div class="grid grid-cols-3 gap-6" style="display: none;">
                <!-- 原始请求 -->
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center space-x-2 text-white">
                            <el-icon><Upload /></el-icon>
                            <h4 class="font-medium">原始请求</h4>
                        </div>
                        <el-button size="small" type="primary" plain @click="copyToClipboard(logDetail.originalRequest)">
                            <el-icon><CopyDocument /></el-icon>
                            复制
                        </el-button>
                    </div>
                    <div class="p-4">
                        <div class="bg-gray-50 rounded-lg border" style="height: 420px; overflow-y: auto;">
                            <pre class="text-sm p-4 leading-relaxed font-mono">{{logDetail.originalRequest}}</pre>
                        </div>
                    </div>
                </div>
                
                <!-- 转换后请求 -->
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                    <div class="bg-gradient-to-r from-green-500 to-green-600 px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center space-x-2 text-white">
                            <el-icon><Refresh /></el-icon>
                            <h4 class="font-medium">转换后请求</h4>
                        </div>
                        <el-button size="small" type="success" plain @click="copyToClipboard(logDetail.transformedRequest)">
                            <el-icon><CopyDocument /></el-icon>
                            复制
                        </el-button>
                    </div>
                    <div class="p-4">
                        <div class="bg-gray-50 rounded-lg border" style="height: 420px; overflow-y: auto;">
                            <pre class="text-sm p-4 leading-relaxed font-mono">{{logDetail.transformedRequest}}</pre>
                        </div>
                    </div>
                </div>
                
                <!-- 目标响应 -->
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center space-x-2 text-white">
                            <el-icon><Download /></el-icon>
                            <h4 class="font-medium">目标响应</h4>
                        </div>
                        <el-button size="small" type="warning" plain @click="copyToClipboard(logDetail.targetResponse)">
                            <el-icon><CopyDocument /></el-icon>
                            复制
                        </el-button>
                    </div>
                    <div class="p-4">
                        <div class="bg-gray-50 rounded-lg border" style="height: 420px; overflow-y: auto;">
                            <pre class="text-sm p-4 leading-relaxed font-mono">{{logDetail.targetResponse}}</pre>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 错误信息区域 -->
            <div v-if="logDetail.errorMessage" class="mt-6">
                <div class="bg-red-50 border border-red-200 rounded-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-red-500 to-red-600 px-4 py-3">
                        <div class="flex items-center space-x-2 text-white">
                            <el-icon><Warning /></el-icon>
                            <h4 class="font-medium">错误信息</h4>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="bg-red-25 p-4 rounded border border-red-100">
                            <p class="text-red-800 font-mono text-sm leading-relaxed">{{logDetail.errorMessage}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </el-dialog>

        <!-- 任务详情弹窗 -->
        <el-dialog v-model="taskDetailDialogVisible" title="任务详情" width="800px">
            <el-descriptions :column="2" border>
                <el-descriptions-item label="任务名称">{{ taskDetailForm.name }}</el-descriptions-item>

                <el-descriptions-item label="任务描述" :span="2">{{ taskDetailForm.description || '暂无描述' }}</el-descriptions-item>
                <el-descriptions-item label="源平台">{{ taskDetailForm.sourcePlatformName }}</el-descriptions-item>
                <el-descriptions-item label="源接口">{{ taskDetailForm.sourceInterfaceName }}</el-descriptions-item>
                <el-descriptions-item label="目标平台">{{ taskDetailForm.targetPlatformName }}</el-descriptions-item>
                <el-descriptions-item label="目标接口">{{ taskDetailForm.targetInterfaceName }}</el-descriptions-item>
                <el-descriptions-item label="最近运行时间">{{ taskDetailForm.lastRunTime || '暂未运行' }}</el-descriptions-item>
                <el-descriptions-item label="新增时间">{{ taskDetailForm.createTime }}</el-descriptions-item>
            </el-descriptions>
        </el-dialog>

        <!-- 任务编辑向导弹窗 -->
        <el-dialog v-model="taskEditDialogVisible" title="编辑任务" width="1000px">
            <div class="wizard-steps">
                <el-steps :active="taskEditWizardStep" finish-status="success">
                    <el-step title="基本信息"></el-step>
                    <el-step title="字段映射"></el-step>
                    <el-step title="运行配置"></el-step>
                    <el-step title="配置确认"></el-step>
                </el-steps>
            </div>
            
            <!-- 步骤1：基本信息 -->
            <div v-show="taskEditWizardStep === 0">
                <el-form :model="taskDetailForm" label-width="120px">
                    <el-form-item label="任务名称" required>
                        <el-input v-model="taskDetailForm.name" placeholder="请输入任务名称"></el-input>
                    </el-form-item>
                    <el-form-item label="任务描述">
                        <el-input v-model="taskDetailForm.description" type="textarea" placeholder="请输入任务描述"></el-input>
                    </el-form-item>

                    <el-form-item label="源平台" required>
                        <el-select v-model="taskDetailForm.sourcePlatformId" placeholder="请选择源平台" @change="onEditSourcePlatformChange">
                            <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="源接口" required>
                        <el-select v-model="taskDetailForm.sourceInterfaceId" placeholder="请选择源接口" @change="onEditSourceInterfaceChange">
                            <el-option v-for="interface in editSourceInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="目标平台" required>
                        <el-select v-model="taskDetailForm.targetPlatformId" placeholder="请选择目标平台" @change="onEditTargetPlatformChange">
                            <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="目标接口" required>
                        <el-select v-model="taskDetailForm.targetInterfaceId" placeholder="请选择目标接口" @change="onEditTargetInterfaceChange">
                            <el-option v-for="interface in editTargetInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                        </el-select>
                    </el-form-item>
                </el-form>
            </div>
            
            <!-- 步骤2：字段映射 -->
            <div v-show="taskEditWizardStep === 1">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-medium">字段映射配置</h4>
                    <div class="space-x-2">
                        <el-button size="small" type="warning" @click="clearAllEditMappings">清空映射</el-button>
                    </div>
                </div>
                
                <!-- 字段映射Tab标签页 -->
                <el-tabs v-model="activeEditFieldMappingTab" class="mb-4">
                    <el-tab-pane label="Body" name="body">
                        <!-- Body字段映射内容 -->
                        <div class="space-y-4">
                            <!-- 映射行 -->
                            <div class="space-y-3 max-h-96 overflow-y-auto">
                                <div v-for="(sourceField, index) in editSourceFields" :key="index" class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                    <!-- 源字段展示 -->
                                    <div class="flex-1">
                                        <el-input v-model="sourceField.name" readonly size="small" class="mb-1">
                                            <template #prepend>源字段</template>
                                        </el-input>
                                    </div>
                                    
                                    <!-- 箭头 -->
                                    <div class="flex items-center">
                                        <el-icon class="text-blue-500 text-lg"><Right /></el-icon>
                                    </div>
                                    
                                    <!-- 目标字段选择 -->
                                    <div class="flex-1">
                                        <el-select v-model="editFieldMappings[sourceField.name]" placeholder="选择目标字段" size="small" class="w-full" clearable>
                                            <template #prefix>目标字段</template>
                                            <el-option v-for="targetField in availableEditTargetFields(sourceField.name)" :key="targetField.name" :label="targetField.name" :value="targetField.name" :disabled="isEditTargetFieldUsed(targetField.name, sourceField.name)">
                                                <div class="flex justify-between items-center">
                                                    <span>{{targetField.name}}</span>
                                                    <div class="flex items-center space-x-1">
                                                        <el-tag size="small" :type="getFieldTypeColor(targetField.type)">{{targetField.type}}</el-tag>
                                                        <el-tag v-if="targetField.required" size="small" type="danger">必填</el-tag>
                                                    </div>
                                                </div>
                                            </el-option>
                                        </el-select>
                                    </div>
                                    
                                    <!-- 操作按钮 -->
                                    <div class="flex items-center">
                                        <el-button v-if="editFieldMappings[sourceField.name]" size="small" type="danger" text @click="clearEditMapping(sourceField.name)">
                                            <el-icon><Delete /></el-icon>
                                        </el-button>
                                    </div>
                                </div>
                                
                                <!-- 空状态 -->
                                <div v-if="editSourceFields.length === 0" class="text-center py-8 text-gray-500">
                                    <el-icon class="text-4xl mb-2"><MessageBox /></el-icon>
                                    <p>请先在上方选择源接口</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 映射统计 -->
                        <div class="mt-4 p-3 bg-blue-50 rounded">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-blue-700">映射统计：已配置 {{validEditMappingsCount}} 个有效映射</span>
                                <span class="text-gray-600">源字段：{{editSourceFields.length}} 个 | 目标字段：{{editTargetFields.length}} 个</span>
                            </div>
                        </div>
                    </el-tab-pane>
                    
                    <el-tab-pane label="Query" name="query">
                        <!-- Query参数映射内容 -->
                        <div class="space-y-4">
                            <!-- 操作按钮 -->
                            <div class="flex justify-between items-center">
                                <div class="flex gap-2">
                                    <el-button size="small" @click="loadEditQuerySourceFields">加载源Query参数</el-button>
                                    <el-button size="small" @click="loadEditQueryTargetFields">加载目标Query参数</el-button>
                                    <el-button size="small" type="primary" @click="autoMatchEditQueryFields">智能匹配</el-button>
                                </div>
                                <el-button size="small" type="danger" @click="clearAllEditQueryMappings">清空映射</el-button>
                            </div>
                            
                            <!-- 字段映射列表 -->
                            <div class="space-y-3">
                                <div v-for="(sourceField, index) in editQuerySourceFields" :key="index" class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                    <!-- 源字段 -->
                                    <div class="flex-1">
                                        <el-input v-model="sourceField.name" readonly size="small">
                                            <template #prefix>
                                                <span class="text-xs text-gray-500">源参数</span>
                                            </template>
                                        </el-input>
                                        <div class="text-xs text-gray-500 mt-1">{{sourceField.type}} {{sourceField.required ? '(必填)' : '(可选)'}}</div>
                                    </div>
                                    
                                    <!-- 箭头 -->
                                    <el-icon class="text-gray-400 text-lg"><Right /></el-icon>
                                    
                                    <!-- 目标字段选择 -->
                                    <div class="flex-1">
                                        <el-select v-model="editQueryFieldMappings[sourceField.name]" placeholder="选择目标参数" size="small" class="w-full" clearable>
                                            <template #prefix>
                                                <span class="text-xs text-gray-500">目标参数</span>
                                            </template>
                                            <el-option v-for="targetField in availableEditQueryTargetFields(sourceField.name)" :key="targetField.name" :label="targetField.name" :value="targetField.name" :disabled="isEditQueryTargetFieldUsed(targetField.name, sourceField.name)">
                                                <div class="flex justify-between items-center">
                                                    <span>{{targetField.name}}</span>
                                                    <span class="text-xs text-gray-400">{{targetField.type}}</span>
                                                </div>
                                            </el-option>
                                        </el-select>
                                    </div>
                                    
                                    <!-- 操作按钮 -->
                                    <div class="flex gap-1">
                                        <el-button v-if="editQueryFieldMappings[sourceField.name]" size="small" type="danger" text @click="clearEditQueryMapping(sourceField.name)">
                                            <el-icon><Delete /></el-icon>
                                        </el-button>
                                    </div>
                                </div>
                                
                                <div v-if="editQuerySourceFields.length === 0" class="text-center py-8 text-gray-500">
                                    <el-icon class="text-4xl mb-2"><Search /></el-icon>
                                    <p>暂无Query参数</p>
                                    <p class="text-sm">请先加载源Query参数</p>
                                </div>
                            </div>
                        </div>
                    </el-tab-pane>
                    
                    <el-tab-pane label="Headers" name="headers">
                        <!-- Headers映射内容 -->
                        <div class="space-y-4">
                            <!-- 操作按钮 -->
                            <div class="flex justify-between items-center">
                                <div class="flex gap-2">
                                    <el-button size="small" @click="loadEditHeadersSourceFields">加载源Headers</el-button>
                                    <el-button size="small" @click="loadEditHeadersTargetFields">加载目标Headers</el-button>
                                    <el-button size="small" type="primary" @click="autoMatchEditHeadersFields">智能匹配</el-button>
                                </div>
                                <el-button size="small" type="danger" @click="clearAllEditHeadersMappings">清空映射</el-button>
                            </div>
                            
                            <!-- 字段映射列表 -->
                            <div class="space-y-3">
                                <div v-for="(sourceField, index) in editHeadersSourceFields" :key="index" class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                    <!-- 源字段 -->
                                    <div class="flex-1">
                                        <el-input v-model="sourceField.name" readonly size="small">
                                            <template #prefix>
                                                <span class="text-xs text-gray-500">源Header</span>
                                            </template>
                                        </el-input>
                                        <div class="text-xs text-gray-500 mt-1">{{sourceField.type}} {{sourceField.required ? '(必填)' : '(可选)'}}</div>
                                    </div>
                                    
                                    <!-- 箭头 -->
                                    <el-icon class="text-gray-400 text-lg"><Right /></el-icon>
                                    
                                    <!-- 目标字段选择 -->
                                    <div class="flex-1">
                                        <el-select v-model="editHeadersFieldMappings[sourceField.name]" placeholder="选择目标Header" size="small" class="w-full" clearable>
                                            <template #prefix>
                                                <span class="text-xs text-gray-500">目标Header</span>
                                            </template>
                                            <el-option v-for="targetField in availableEditHeadersTargetFields(sourceField.name)" :key="targetField.name" :label="targetField.name" :value="targetField.name" :disabled="isEditHeadersTargetFieldUsed(targetField.name, sourceField.name)">
                                                <div class="flex justify-between items-center">
                                                    <span>{{targetField.name}}</span>
                                                    <span class="text-xs text-gray-400">{{targetField.type}}</span>
                                                </div>
                                            </el-option>
                                        </el-select>
                                    </div>
                                    
                                    <!-- 操作按钮 -->
                                    <div class="flex gap-1">
                                        <el-button v-if="editHeadersFieldMappings[sourceField.name]" size="small" type="danger" text @click="clearEditHeadersMapping(sourceField.name)">
                                            <el-icon><Delete /></el-icon>
                                        </el-button>
                                    </div>
                                </div>
                                
                                <div v-if="editHeadersSourceFields.length === 0" class="text-center py-8 text-gray-500">
                                    <el-icon class="text-4xl mb-2"><Document /></el-icon>
                                    <p>暂无Headers</p>
                                    <p class="text-sm">请先加载源Headers</p>
                                </div>
                            </div>
                        </div>
                    </el-tab-pane>
                    
                    <el-tab-pane label="Path" name="path">
                        <!-- Path参数映射内容 -->
                        <div class="space-y-4">
                            <!-- 操作按钮 -->
                            <div class="flex justify-between items-center">
                                <div class="flex gap-2">
                                    <el-button size="small" @click="loadEditPathSourceFields">加载源Path参数</el-button>
                                    <el-button size="small" @click="loadEditPathTargetFields">加载目标Path参数</el-button>
                                    <el-button size="small" type="primary" @click="autoMatchEditPathFields">智能匹配</el-button>
                                </div>
                                <el-button size="small" type="danger" @click="clearAllEditPathMappings">清空映射</el-button>
                            </div>
                            
                            <!-- 字段映射列表 -->
                            <div class="space-y-3">
                                <div v-for="(sourceField, index) in editPathSourceFields" :key="index" class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                    <!-- 源字段 -->
                                    <div class="flex-1">
                                        <el-input v-model="sourceField.name" readonly size="small">
                                            <template #prefix>
                                                <span class="text-xs text-gray-500">源路径参数</span>
                                            </template>
                                        </el-input>
                                        <div class="text-xs text-gray-500 mt-1">{{sourceField.type}} {{sourceField.required ? '(必填)' : '(可选)'}}</div>
                                    </div>
                                    
                                    <!-- 箭头 -->
                                    <el-icon class="text-gray-400 text-lg"><Right /></el-icon>
                                    
                                    <!-- 目标字段选择 -->
                                    <div class="flex-1">
                                        <el-select v-model="editPathFieldMappings[sourceField.name]" placeholder="选择目标路径参数" size="small" class="w-full" clearable>
                                            <template #prefix>
                                                <span class="text-xs text-gray-500">目标路径参数</span>
                                            </template>
                                            <el-option v-for="targetField in availableEditPathTargetFields(sourceField.name)" :key="targetField.name" :label="targetField.name" :value="targetField.name" :disabled="isEditPathTargetFieldUsed(targetField.name, sourceField.name)">
                                                <div class="flex justify-between items-center">
                                                    <span>{{targetField.name}}</span>
                                                    <span class="text-xs text-gray-400">{{targetField.type}}</span>
                                                </div>
                                            </el-option>
                                        </el-select>
                                    </div>
                                    
                                    <!-- 操作按钮 -->
                                    <div class="flex gap-1">
                                        <el-button v-if="editPathFieldMappings[sourceField.name]" size="small" type="danger" text @click="clearEditPathMapping(sourceField.name)">
                                            <el-icon><Delete /></el-icon>
                                        </el-button>
                                    </div>
                                </div>
                                
                                <div v-if="editPathSourceFields.length === 0" class="text-center py-8 text-gray-500">
                                    <el-icon class="text-4xl mb-2"><Link /></el-icon>
                                    <p>暂无Path参数</p>
                                    <p class="text-sm">请先加载源Path参数</p>
                                </div>
                            </div>
                        </div>
                    </el-tab-pane>
                </el-tabs>
            </div>
            
            <!-- 步骤3：运行模式配置 -->
            <div v-show="taskEditWizardStep === 2">
                <div class="space-y-6">
                    <div>
                        <h4 class="font-medium mb-4">运行模式</h4>
                        <el-radio-group v-model="taskDetailForm.runMode" class="mb-4">
                            <el-radio label="once">单次执行</el-radio>
                            <el-radio label="cycle">循环执行</el-radio>
                        </el-radio-group>
                    </div>
                    
                    <!-- 循环配置 -->
                    <div v-if="taskDetailForm.runMode === 'cycle'" class="space-y-4">
                        <div>
                            <h5 class="font-medium mb-2">循环类型</h5>
                            <el-radio-group v-model="taskDetailForm.cycleType">
                                <el-radio label="monthly">每月</el-radio>
                                <el-radio label="weekly">每周</el-radio>
                                <el-radio label="daily">每日</el-radio>
                            </el-radio-group>
                        </div>
                        
                        <!-- 每月配置 -->
                        <div v-if="taskDetailForm.cycleType === 'monthly'" class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">执行日期</label>
                                <el-select v-model="taskDetailForm.monthlyDay" placeholder="选择日期">
                                    <el-option v-for="day in 31" :key="day" :label="`${day}日`" :value="day"></el-option>
                                </el-select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">执行时间</label>
                                <el-time-picker v-model="taskDetailForm.executeTime" format="HH:mm" placeholder="选择时间"></el-time-picker>
                            </div>
                        </div>
                        
                        <!-- 每周配置 -->
                        <div v-if="taskDetailForm.cycleType === 'weekly'" class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">执行星期</label>
                                <el-select v-model="taskDetailForm.weeklyDay" placeholder="选择星期">
                                    <el-option label="星期一" value="1"></el-option>
                                    <el-option label="星期二" value="2"></el-option>
                                    <el-option label="星期三" value="3"></el-option>
                                    <el-option label="星期四" value="4"></el-option>
                                    <el-option label="星期五" value="5"></el-option>
                                    <el-option label="星期六" value="6"></el-option>
                                    <el-option label="星期日" value="0"></el-option>
                                </el-select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">执行时间</label>
                                <el-time-picker v-model="taskDetailForm.executeTime" format="HH:mm" placeholder="选择时间"></el-time-picker>
                            </div>
                        </div>
                        
                        <!-- 每日配置 -->
                        <div v-if="taskDetailForm.cycleType === 'daily'">
                            <label class="block text-sm font-medium mb-1">执行时间</label>
                            <el-time-picker v-model="taskDetailForm.executeTime" format="HH:mm" placeholder="选择时间"></el-time-picker>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 步骤4：配置确认 -->
            <div v-show="taskEditWizardStep === 3">
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium mb-2">基本信息</h4>
                        <div class="bg-gray-50 p-4 rounded">
                            <p><strong>任务名称：</strong>{{taskDetailForm.name}}</p>
                            <p><strong>任务描述：</strong>{{taskDetailForm.description}}</p>

                            <p><strong>源平台/接口：</strong>{{getSelectedPlatformName(taskDetailForm.sourcePlatformId)}} / {{getSelectedInterfaceName(taskDetailForm.sourceInterfaceId)}}</p>
                            <p><strong>目标平台/接口：</strong>{{getSelectedPlatformName(taskDetailForm.targetPlatformId)}} / {{getSelectedInterfaceName(taskDetailForm.targetInterfaceId)}}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">字段映射概览</h4>
                        <div class="bg-gray-50 p-4 rounded">
                            <p><strong>映射数量：</strong>{{ validEditMappingCount }} 个</p>
                            <div v-for="(sourceField, targetField) in editFieldMappings" :key="targetField" class="text-sm">
                                <p v-if="sourceField">{{ sourceField }} → {{ targetField }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="taskEditDialogVisible = false">取消</el-button>
                    <el-button v-if="taskEditWizardStep > 0" @click="taskEditWizardStep--">上一步</el-button>
                    <el-button v-if="taskEditWizardStep < 3" type="primary" @click="taskEditWizardStep++">下一步</el-button>
                    <el-button v-if="taskEditWizardStep === 3" type="success" @click="saveTaskEdit">保存修改</el-button>
                </span>
            </template>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;
        
        createApp({
            data() {
                return {
                    activeMenu: 'platform',
                    activeTab: 'platform',
                    userInfo: {
                        realName: '系统管理员',
                        avatarUrl: ''
                    },
                    
                    // 业务平台管理
                    platforms: [
                        {
                            id: 1,
                            name: '贵州移动',
                            type: 'http',
                            baseUrl: 'http://api.gz.mobile.com',
                            description: '贵州移动业务平台',
                            status: 'connected',
                            createTime: '2024-01-15 10:30:00'
                        },
                        {
                            id: 2,
                            name: '浙江创新院',
                            type: 'http',
                            baseUrl: 'http://api.zj.innovation.com',
                            description: '浙江创新院接口平台',
                            status: 'connected',
                            createTime: '2024-01-16 14:20:00'
                        }
                    ],
                    platformSearch: '',
                    platformTypeFilter: '',
                    platformCurrentPage: 1,
                    platformDialogVisible: false,
                    platformDialogTitle: '',
                    platformForm: {
                        name: '',
                        description: '',
                        type: '',
                        baseUrl: '',
                        authType: 'none'
                    },
                    platformDetailVisible: false,
                    platformDetail: {},
                    
                    // 接口管理
                    interfaces: [
                        {
                            id: 1,
                            name: '订购接口',
                            platformId: 1,
                            platformName: '贵州移动',
                            path: '/api/order/create',
                            method: 'POST',
                            fieldCount: 8,
                            description: '业务订购接口',
                            createTime: '2024-01-18 11:00:00',
                            fields: [
                                { id: 1, name: 'mainOrderNo', type: 'string', required: true, description: '主订单号', level: 0 },
                                { id: 2, name: 'customerInfo', type: 'object', required: true, description: '客户信息', level: 0 },
                                { id: 3, name: 'customName', type: 'string', required: true, description: '客户姓名', level: 1 },
                                { id: 4, name: 'phoneNumber', type: 'string', required: true, description: '手机号码', level: 1 },
                                { id: 5, name: 'productCode', type: 'string', required: true, description: '产品编码', level: 0 },
                                { id: 6, name: 'orderTime', type: 'string', required: true, description: '订购时间', level: 0 }
                            ]
                        },
                        {
                            id: 2,
                            name: '退订接口',
                            platformId: 1,
                            platformName: '贵州移动',
                            path: '/api/order/cancel',
                            method: 'POST',
                            fieldCount: 5,
                            description: '业务退订接口',
                            createTime: '2024-01-18 11:30:00',
                            fields: [
                                { id: 1, name: 'orderNo', type: 'string', required: true, description: '订单号', level: 0 },
                                { id: 2, name: 'phoneNumber', type: 'string', required: true, description: '手机号码', level: 0 },
                                { id: 3, name: 'cancelReason', type: 'string', required: false, description: '退订原因', level: 0 }
                            ]
                        },
                        {
                            id: 3,
                            name: '订单同步',
                            platformId: 2,
                            platformName: '浙江创新院',
                            path: '/api/sync/order',
                            method: 'POST',
                            fieldCount: 10,
                            description: '订单数据同步接口',
                            createTime: '2024-01-19 15:45:00',
                            fields: [
                                { id: 1, name: 'syncId', type: 'string', required: true, description: '同步ID', level: 0 },
                                { id: 2, name: 'orderData', type: 'array', required: true, description: '订单数据', level: 0 },
                                { id: 3, name: 'orderId', type: 'string', required: true, description: '订单ID', level: 1 },
                                { id: 4, name: 'status', type: 'string', required: true, description: '订单状态', level: 1 },
                                { id: 5, name: 'timestamp', type: 'string', required: true, description: '时间戳', level: 0 }
                            ]
                        }
                    ],
                    interfaceSearch: '',
                    interfacePlatformFilter: '',
                    interfaceCurrentPage: 1,
                    interfaceDialogVisible: false,
                    interfaceDialogTitle: '',
                    interfaceForm: {
                        platformId: '',
                        name: '',
                        path: '',
                        method: '',
                        description: '',
                        fields: []
                    },
                    interfaceDetailVisible: false,
                    interfaceDetail: {},
                    
                    // 任务管理
                    tasks: [
                        {
                            id: 1,
                            name: '移动订购数据同步',
                            sourceInfo: {
                                platformId: 1,
                                platformName: '贵州移动',
                                interfaceName: '订购接口'
                            },
                            targetInfo: {
                                platformId: 2,
                                platformName: '浙江创新院',
                                interfaceName: '订单同步'
                            },
                            runMode: 'cycle',
                            cycleType: 'daily',
                            executeTime: '09:00',
                            status: 'enabled',
                            lastRunTime: '2024-01-20 09:00:00',
                            nextRunTime: '2024-01-21 09:00:00',
                            createTime: '2024-01-18 16:00:00'
                        }
                    ],
                    taskSearch: '',
                    taskStatusFilter: '',
                    taskCurrentPage: 1,
                    taskWizardVisible: false,
                    taskWizardStep: 0,
                    activeFieldMappingTab: 'body', // 字段映射tab切换状态
                    taskForm: {
                        name: '',
                        description: '',
                        sourcePlatformId: '',
                        sourceInterfaceId: '',
                        targetPlatformId: '',
                        targetInterfaceId: ''
                    },
                    sourceInterfaces: [],
                    targetInterfaces: [],
                    sourceFields: [
                        { name: 'mainOrderNo', type: 'string', required: true },
                        { name: 'orderNo', type: 'string', required: true },
                        { name: 'department', type: 'number', required: true },
                        { name: 'customerInfo', type: 'object', required: true },
                        { name: 'accessAddress', type: 'string', required: false }
                    ],
                    targetFields: [
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'orderNumber', type: 'string', required: true },
                        { name: 'deptCode', type: 'number', required: true },
                        { name: 'customer', type: 'object', required: true },
                        { name: 'address', type: 'string', required: false }
                    ],
                    sourceFields: [],
                    targetFields: [],
                    fieldMappings: {},
                    
                    // Query参数映射
                    querySourceFields: [],
                    queryTargetFields: [],
                    queryFieldMappings: {},
                    
                    // Headers映射
                    headersSourceFields: [],
                    headersTargetFields: [],
                    headersFieldMappings: {},
                    
                    // Path参数映射
                    pathSourceFields: [],
                    pathTargetFields: [],
                    pathFieldMappings: {},
                    taskDetailDialogVisible: false,
                    taskEditDialogVisible: false,
                    taskEditWizardStep: 0,
                    activeEditFieldMappingTab: 'body', // 编辑任务字段映射tab切换状态
                    taskDetailForm: {},
                    editSourceInterfaces: [],
                    editTargetInterfaces: [],
                    editSourceFields: [],
                    editTargetFields: [],
                    editFieldMappings: [],
                    
                    // 编辑任务 - Query参数映射
                    editQuerySourceFields: [],
                    editQueryTargetFields: [],
                    editQueryFieldMappings: {},
                    
                    // 编辑任务 - Headers映射
                    editHeadersSourceFields: [],
                    editHeadersTargetFields: [],
                    editHeadersFieldMappings: {},
                    
                    // 编辑任务 - Path参数映射
                    editPathSourceFields: [],
                    editPathTargetFields: [],
                    editPathFieldMappings: {},
                    
                    // 同步记录
                    logs: [
                        {
                            id: 1,
                            callTime: '2024-01-20 14:30:15',
                            taskName: '移动订购数据同步',
                            sourcePlatform: '贵州移动',
                            targetPlatform: '浙江创新院',
                            sourceInterface: '订购接口',
                            targetInterface: '订单同步',
                            status: 'success',
                            duration: 245,
                            dataCount: 156,
                            successCount: 156,
                            failureCount: 0,
                            errorMessage: ''
                        },
                        {
                            id: 2,
                            callTime: '2024-01-20 14:25:32',
                            taskName: '移动订购数据同步',
                            sourcePlatform: '贵州移动',
                            targetPlatform: '浙江创新院',
                            sourceInterface: '订购接口',
                            targetInterface: '订单同步',
                            status: 'failure',
                            duration: 1200,
                            dataCount: 0,
                            successCount: 0,
                            failureCount: 0,
                            errorMessage: '目标平台连接超时'
                        },
                        {
                            id: 4,
                            callTime: '2024-01-20 12:00:12',
                            taskName: '移动订购数据同步',
                            sourcePlatform: '贵州移动',
                            targetPlatform: '浙江创新院',
                            sourceInterface: '订购接口',
                            targetInterface: '订单同步',
                            status: 'success',
                            duration: 320,
                            dataCount: 203,
                            successCount: 203,
                            failureCount: 0,
                            errorMessage: ''
                        }
                    ],
                    logTaskFilter: '',
                    logDateRange: [],
                    logStatusFilter: '',
                    logSourcePlatformFilter: '',
                    logTargetPlatformFilter: '',
                    logKeywordSearch: '',
                    logCurrentPage: 1,
                    logDetailVisible: false,
                    logDetail: {
                        status: '', // success, failure
                        errorMessage: '',
                        data: [],
                        basicInfo: {}
                    }
                };
            },
            computed: {
                currentPageTitle() {
                    const titles = {
                        platform: '业务平台管理',
                        interface: '接口管理',
                        task: '任务管理',
                        log: '同步记录'
                    };
                    return titles[this.activeTab] || '业务采集';
                },
                filteredPlatforms() {
                    return this.platforms.filter(platform => {
                        const matchSearch = !this.platformSearch || 
                            platform.name.toLowerCase().includes(this.platformSearch.toLowerCase()) ||
                            platform.baseUrl.toLowerCase().includes(this.platformSearch.toLowerCase());
                        const matchType = !this.platformTypeFilter || platform.type === this.platformTypeFilter;
                        return matchSearch && matchType;
                    });
                },
                filteredInterfaces() {
                    return this.interfaces.filter(interface => {
                        const matchSearch = !this.interfaceSearch || 
                            interface.name.toLowerCase().includes(this.interfaceSearch.toLowerCase()) ||
                            interface.path.toLowerCase().includes(this.interfaceSearch.toLowerCase());
                        const matchPlatform = !this.interfacePlatformFilter || interface.platformId == this.interfacePlatformFilter;
                        return matchSearch && matchPlatform;
                    });
                },
                filteredTasks() {
                    return this.tasks.filter(task => {
                        const matchSearch = !this.taskSearch || 
                            task.name.toLowerCase().includes(this.taskSearch.toLowerCase());
                        const matchStatus = !this.taskStatusFilter || task.status === this.taskStatusFilter;
                        return matchSearch && matchStatus;
                    });
                },
                filteredLogs() {
                    return this.logs.filter(log => {
                        // 任务筛选
                        const matchTask = !this.logTaskFilter || log.taskName.includes(this.logTaskFilter);
                        
                        // 状态筛选
                        const matchStatus = !this.logStatusFilter || log.status === this.logStatusFilter;
                        
                        // 源平台筛选
                        const matchSourcePlatform = !this.logSourcePlatformFilter || log.sourcePlatform === this.logSourcePlatformFilter;
                        
                        // 目标平台筛选
                        const matchTargetPlatform = !this.logTargetPlatformFilter || log.targetPlatform === this.logTargetPlatformFilter;
                        
                        // 时间范围筛选
                        let matchDateRange = true;
                        if (this.logDateRange && this.logDateRange.length === 2) {
                            const logTime = new Date(log.callTime);
                            const startTime = new Date(this.logDateRange[0]);
                            const endTime = new Date(this.logDateRange[1]);
                            matchDateRange = logTime >= startTime && logTime <= endTime;
                        }
                        
                        // 关键词搜索
                        const matchKeyword = !this.logKeywordSearch || 
                            log.taskName.toLowerCase().includes(this.logKeywordSearch.toLowerCase()) ||
                            log.sourceInterface.toLowerCase().includes(this.logKeywordSearch.toLowerCase()) ||
                            log.targetInterface.toLowerCase().includes(this.logKeywordSearch.toLowerCase()) ||
                            log.errorMessage.toLowerCase().includes(this.logKeywordSearch.toLowerCase());
                        
                        return matchTask && matchStatus && matchSourcePlatform && matchTargetPlatform && matchDateRange && matchKeyword;
                    });
                },
                validMappingsCount() {
                    return Object.values(this.fieldMappings).filter(val => val).length;
                },
                validEditMappingsCount() {
                    return Object.values(this.editFieldMappings).filter(val => val).length;
                }
            },
            methods: {
                handleMenuSelect(key) {
                    this.activeMenu = key;
                    if (['platform', 'interface', 'task', 'log'].includes(key)) {
                        this.activeTab = key;
                    }
                },
                
                // 业务平台管理方法
                showAddPlatformDialog() {
                    this.platformDialogTitle = '新增平台';
                    this.platformForm = {
                        name: '',
                        description: '',
                        type: '',
                        baseUrl: '',
                        authType: 'none'
                    };
                    this.platformDialogVisible = true;
                },
                editPlatform(platform) {
                    this.platformDialogTitle = '编辑平台';
                    this.platformForm = { ...platform };
                    this.platformDialogVisible = true;
                },
                // 检查平台下是否有接口
                hasInterfacesInPlatform(platformId) {
                    return this.interfaces.some(interface => interface.platformId === platformId);
                },
                // 检查接口下是否有任务
                hasTasksInInterface(interfaceId) {
                    // 根据interfaceId找到接口名称
                    const interface = this.interfaces.find(i => i.id === interfaceId);
                    if (!interface) return false;
                    
                    return this.tasks.some(task => 
                        task.sourceInfo.interfaceName === interface.name || 
                        task.targetInfo.interfaceName === interface.name
                    );
                },
                // 检查任务是否正在运行
                isTaskRunning(taskId) {
                    const task = this.tasks.find(t => t.id === taskId);
                    return task && task.status === 'enabled';
                },
                deletePlatform(platform) {
                    // 检查该平台下是否存在接口
                    if (this.hasInterfacesInPlatform(platform.id)) {
                        ElMessage.error('该平台存在接口，无法删除');
                        return;
                    }
                    
                    ElMessageBox.confirm(
                        `确定要删除平台"${platform.name}"吗？`,
                        '删除确认',
                        {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        }
                    ).then(() => {
                        // 实际删除逻辑
                        const index = this.platforms.findIndex(p => p.id === platform.id);
                        if (index > -1) {
                            this.platforms.splice(index, 1);
                            ElMessage.success('平台删除成功');
                        }
                    });
                },
                testPlatformConnection() {
                    ElMessage.success('连接测试成功');
                },
                savePlatform() {
                    ElMessage.success('保存成功');
                    this.platformDialogVisible = false;
                },
                onConnectionTypeChange() {
                    // 重置相关字段
                },
                getPlatformTypeTagType(type) {
                    const types = {
                        http: 'primary'
                    };
                    return types[type] || 'info';
                },
                getPlatformTypeName(type) {
                    const names = {
                        http: 'HTTP'
                    };
                    return names[type] || type;
                },
                getConnectionStatusClass(status) {
                    const classes = {
                        connected: 'status-success',
                        error: 'status-error',
                        connecting: 'status-warning'
                    };
                    return classes[status] || 'status-info';
                },
                getConnectionStatusText(status) {
                    const texts = {
                        connected: '已连接',
                        error: '连接异常',
                        connecting: '连接中'
                    };
                    return texts[status] || '未知';
                },
                getAuthTypeName(authType) {
                    const names = {
                        none: '无认证',
                        apikey: 'API Key',
                        bearer: 'Bearer Token'
                    };
                    return names[authType] || authType;
                },
                viewPlatform(platform) {
                    this.platformDetail = { ...platform };
                    this.platformDetailVisible = true;
                },
                testConnection(platform) {
                    ElMessage.success('连接测试成功');
                },
                
                // 接口管理方法
                showAddInterfaceDialog() {
                    this.interfaceDialogTitle = '新增接口';
                    this.interfaceForm = {
                        platformId: '',
                        name: '',
                        path: '',
                        method: '',
                        description: '',
                        fields: []
                    };
                    this.interfaceDialogVisible = true;
                },
                editInterface(interface) {
                    this.interfaceDialogTitle = '编辑接口';
                    this.interfaceForm = { 
                        ...interface,
                        fields: interface.fields || []
                    };
                    this.interfaceDialogVisible = true;
                },
                deleteInterface(interface) {
                    // 检查该接口下是否存在任务
                    if (this.hasTasksInInterface(interface.id)) {
                        ElMessage.error('该接口存在任务，无法删除');
                        return;
                    }
                    
                    ElMessageBox.confirm(
                        `确定要删除接口"${interface.name}"吗？`,
                        '删除确认',
                        {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        }
                    ).then(() => {
                        // 实际删除逻辑
                        const index = this.interfaces.findIndex(i => i.id === interface.id);
                        if (index > -1) {
                            this.interfaces.splice(index, 1);
                            ElMessage.success('接口删除成功');
                        }
                    });
                },
                saveInterface() {
                    ElMessage.success('保存成功');
                    this.interfaceDialogVisible = false;
                },
                addRootField() {
                    this.interfaceForm.fields.push({
                        id: Date.now(),
                        name: '',
                        type: 'string',
                        required: false,
                        description: '',
                        level: 0
                    });
                },
                addChildField(parentIndex) {
                    const parentField = this.interfaceForm.fields[parentIndex];
                    const newField = {
                        id: Date.now(),
                        name: '',
                        type: 'string',
                        required: false,
                        description: '',
                        level: parentField.level + 1
                    };
                    this.interfaceForm.fields.splice(parentIndex + 1, 0, newField);
                },
                removeField(index) {
                    const field = this.interfaceForm.fields[index];
                    // 删除该字段及其所有子字段
                    const fieldsToRemove = [index];
                    for (let i = index + 1; i < this.interfaceForm.fields.length; i++) {
                        if (this.interfaceForm.fields[i].level > field.level) {
                            fieldsToRemove.push(i);
                        } else {
                            break;
                        }
                    }
                    // 从后往前删除，避免索引变化
                    fieldsToRemove.reverse().forEach(idx => {
                        this.interfaceForm.fields.splice(idx, 1);
                    });
                },
                onFieldTypeChange(field, index) {
                    // 当字段类型改变时，如果不是object或array，删除其子字段
                    if (field.type !== 'object' && field.type !== 'array') {
                        const childIndices = [];
                        for (let i = index + 1; i < this.interfaceForm.fields.length; i++) {
                            if (this.interfaceForm.fields[i].level > field.level) {
                                childIndices.push(i);
                            } else {
                                break;
                            }
                        }
                        childIndices.reverse().forEach(idx => {
                            this.interfaceForm.fields.splice(idx, 1);
                        });
                    }
                },
                getMethodTagType(method) {
                    const types = {
                        GET: 'success',
                        POST: 'primary',
                        PUT: 'warning',
                        DELETE: 'danger'
                    };
                    return types[method] || 'info';
                },
                viewInterfaceDetail(interface) {
                    // 模拟接口详情数据，包含嵌套字段结构
                    this.interfaceDetail = {
                        ...interface,
                        fields: [
                            { id: 1, name: 'orderId', type: 'string', required: true, description: '订单ID', level: 0 },
                            { id: 2, name: 'customerInfo', type: 'object', required: true, description: '客户信息', level: 0 },
                            { id: 3, name: 'name', type: 'string', required: true, description: '客户姓名', level: 1 },
                            { id: 4, name: 'phone', type: 'string', required: true, description: '联系电话', level: 1 },
                            { id: 5, name: 'address', type: 'object', required: false, description: '地址信息', level: 1 },
                            { id: 6, name: 'province', type: 'string', required: true, description: '省份', level: 2 },
                            { id: 7, name: 'city', type: 'string', required: true, description: '城市', level: 2 },
                            { id: 8, name: 'products', type: 'array', required: true, description: '产品列表', level: 0 },
                            { id: 9, name: 'productId', type: 'string', required: true, description: '产品ID', level: 1 },
                            { id: 10, name: 'quantity', type: 'number', required: true, description: '数量', level: 1 }
                        ]
                    };
                    this.interfaceDetailVisible = true;
                },
                getFieldTypeColor(type) {
                    const colors = {
                        string: 'primary',
                        number: 'success',
                        boolean: 'warning',
                        object: 'info',
                        array: 'danger'
                    };
                    return colors[type] || 'info';
                },
                
                // 任务管理方法
                showTaskWizard() {
                    this.taskWizardStep = 0;
                    this.taskForm = {
                        name: '',
                        description: '',
                        sourcePlatformId: '',
                        sourceInterfaceId: '',
                        targetPlatformId: '',
                        targetInterfaceId: '',
                        runMode: 'once',
                        cycleType: 'daily',
                        monthlyDay: 1,
                        weeklyDay: '1',
                        executeTime: null
                    };
                    this.fieldMappings = {};
                    this.taskWizardVisible = true;
                },
                editTaskDetail(task) {
                    // 初始化编辑表单数据
                    this.taskDetailForm = {
                        ...task,
                        sourcePlatformName: this.getSelectedPlatformName(task.sourceInfo.platformId),
                        sourceInterfaceName: task.sourceInfo.interfaceName,
                        targetPlatformName: this.getSelectedPlatformName(task.targetInfo.platformId),
                        targetInterfaceName: task.targetInfo.interfaceName
                    };
                    
                    // 初始化编辑向导数据
                    this.taskEditWizardStep = 0;
                    
                    // 设置源平台和接口
                    this.editSourceInterfaces = this.interfaces.filter(i => i.platformId == task.sourceInfo.platformId);
                    this.editTargetInterfaces = this.interfaces.filter(i => i.platformId == task.targetInfo.platformId);
                    
                    // 模拟加载字段数据
                    this.editSourceFields = [
                        { name: 'mainOrderNo', type: 'string', required: true },
                        { name: 'orderNo', type: 'string', required: true },
                        { name: 'department', type: 'number', required: true },
                        { name: 'customerInfo', type: 'object', required: true },
                        { name: 'accessAddress', type: 'string', required: false }
                    ];
                    this.editTargetFields = [
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'orderNumber', type: 'string', required: true },
                        { name: 'deptCode', type: 'number', required: true },
                        { name: 'customer', type: 'object', required: true },
                        { name: 'address', type: 'string', required: false }
                    ];
                    
                    // 模拟现有的字段映射
                    this.editFieldMappings = {
                        'orderId': 'mainOrderNo',
                        'orderNumber': 'orderNo',
                        'deptCode': 'department'
                    };
                    
                    this.taskEditDialogVisible = true;
                },
                deleteTask(task) {
                    let confirmMessage = `确定要删除任务"${task.name}"吗？`;
                    
                    // 如果任务正在运行，给出特殊提示
                    if (this.isTaskRunning(task.id)) {
                        confirmMessage = `任务"${task.name}"正在运行中，删除后将停止执行，确定要删除吗？`;
                    }
                    
                    ElMessageBox.confirm(
                        confirmMessage,
                        '删除确认',
                        {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        }
                    ).then(() => {
                        // 实际删除逻辑
                        const index = this.tasks.findIndex(t => t.id === task.id);
                        if (index > -1) {
                            this.tasks.splice(index, 1);
                            ElMessage.success('任务删除成功');
                        }
                    });
                },
                toggleTaskStatus(task) {
                    const action = task.status === 'enabled' ? '停用' : '启用';
                    task.status = task.status === 'enabled' ? 'disabled' : 'enabled';
                    ElMessage.success(`任务${action}成功`);
                },
                viewTaskDetail(task) {
                    this.taskDetailForm = {
                        ...task,
                        sourcePlatformName: this.getSelectedPlatformName(task.sourceInfo.platformId),
                        sourceInterfaceName: task.sourceInfo.interfaceName,
                        targetPlatformName: this.getSelectedPlatformName(task.targetInfo.platformId),
                        targetInterfaceName: task.targetInfo.interfaceName
                    };
                    this.taskDetailDialogVisible = true;
                },
                saveTaskEdit() {
                    // 这里可以添加表单验证逻辑
                    ElMessage.success('任务编辑保存成功');
                    this.taskEditDialogVisible = false;
                },
                nextEditStep() {
                    if (this.taskEditWizardStep < 2) {
                        this.taskEditWizardStep++;
                    }
                },
                prevEditStep() {
                    if (this.taskEditWizardStep > 0) {
                        this.taskEditWizardStep--;
                    }
                },
                onEditSourcePlatformChange() {
                    this.editSourceInterfaces = this.interfaces.filter(i => i.platformId == this.taskDetailForm.sourceInfo.platformId);
                    this.taskDetailForm.sourceInfo.interfaceId = '';
                    this.editSourceFields = [];
                    this.editFieldMappings = {};
                },
                onEditTargetPlatformChange() {
                    this.editTargetInterfaces = this.interfaces.filter(i => i.platformId == this.taskDetailForm.targetInfo.platformId);
                    this.taskDetailForm.targetInfo.interfaceId = '';
                    this.editTargetFields = [];
                    this.editFieldMappings = {};
                },
                onEditSourceInterfaceChange() {
                    // 模拟获取源接口字段
                    this.editSourceFields = [
                        { name: 'mainOrderNo', type: 'string', required: true },
                        { name: 'orderNo', type: 'string', required: true },
                        { name: 'department', type: 'number', required: true },
                        { name: 'customerInfo', type: 'object', required: true },
                        { name: 'accessAddress', type: 'string', required: false }
                    ];
                    this.editFieldMappings = {};
                },
                onEditTargetInterfaceChange() {
                    // 模拟获取目标接口字段
                    this.editTargetFields = [
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'orderNumber', type: 'string', required: true },
                        { name: 'deptCode', type: 'number', required: true },
                        { name: 'customer', type: 'object', required: true },
                        { name: 'address', type: 'string', required: false }
                    ];
                    this.editFieldMappings = {};
                },
                clearAllEditMappings() {
                    ElMessageBox.confirm('确认清空所有映射关系吗？', '确认清空', {
                        type: 'warning'
                    }).then(() => {
                        this.editFieldMappings = {};
                        ElMessage.success('已清空所有映射');
                    });
                },
                availableEditSourceFields(currentTargetFieldName) {
                    const usedSourceFields = Object.values(this.editFieldMappings).filter(Boolean);
                    const currentSourceField = this.editFieldMappings[currentTargetFieldName];
                    return this.editSourceFields.filter(sf => !usedSourceFields.includes(sf.name) || sf.name === currentSourceField);
                },
                isEditSourceFieldUsed(sourceFieldName, currentTargetFieldName) {
                    const currentSourceField = this.editFieldMappings[currentTargetFieldName];
                    if (sourceFieldName === currentSourceField) {
                        return false;
                    }
                    return Object.values(this.editFieldMappings).includes(sourceFieldName);
                },
                availableEditTargetFields(currentSourceFieldName) {
                    const usedTargetFields = Object.values(this.editFieldMappings).filter(Boolean);
                    const currentTargetField = this.editFieldMappings[currentSourceFieldName];
                    return this.editTargetFields.filter(tf => !usedTargetFields.includes(tf.name) || tf.name === currentTargetField);
                },
                isEditTargetFieldUsed(targetFieldName, currentSourceFieldName) {
                    const currentTargetField = this.editFieldMappings[currentSourceFieldName];
                    if (targetFieldName === currentTargetField) {
                        return false;
                    }
                    return Object.values(this.editFieldMappings).includes(targetFieldName);
                },
                clearEditMapping(sourceFieldName) {
                    this.editFieldMappings[sourceFieldName] = '';
                    ElMessage.success('映射已清除');
                },
                onSourcePlatformChange() {
                    this.sourceInterfaces = this.interfaces.filter(i => i.platformId == this.taskForm.sourcePlatformId);
                    this.taskForm.sourceInterfaceId = '';
                    this.sourceFields = [];
                    this.fieldMappings = [];
                },
                onTargetPlatformChange() {
                    this.targetInterfaces = this.interfaces.filter(i => i.platformId == this.taskForm.targetPlatformId);
                    this.taskForm.targetInterfaceId = '';
                    this.targetFields = [];
                    this.fieldMappings = [];
                },
                onSourceInterfaceChange() {
                    // 模拟获取源接口字段
                    this.sourceFields = [
                        { name: 'mainOrderNo', type: 'string', required: true },
                        { name: 'orderNo', type: 'string', required: true },
                        { name: 'department', type: 'number', required: true },
                        { name: 'customerInfo', type: 'object', required: true },
                        { name: 'accessAddress', type: 'string', required: false }
                    ];
                    this.fieldMappings = [];
                },
                onTargetInterfaceChange() {
                    // 模拟获取目标接口字段
                    this.targetFields = [
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'orderNumber', type: 'string', required: true },
                        { name: 'deptCode', type: 'number', required: true },
                        { name: 'customer', type: 'object', required: true },
                        { name: 'address', type: 'string', required: false }
                    ];
                    this.fieldMappings = [];
                },
                addMappingRow() {
                    this.fieldMappings.push({
                        sourceField: '',
                        targetField: '',
                        transform: '直接映射'
                    });
                },
                removeMappingRow(index) {
                    this.fieldMappings.splice(index, 1);
                },
                onMappingChange(index) {
                    // 当映射发生变化时的处理逻辑
                    const mapping = this.fieldMappings[index];
                    if (mapping.sourceField && mapping.targetField) {
                        // 检查字段类型兼容性
                        const sourceField = this.sourceFields.find(f => f.name === mapping.sourceField);
                        const targetField = this.targetFields.find(f => f.name === mapping.targetField);
                        if (sourceField && targetField && sourceField.type !== targetField.type) {
                            ElMessage.warning(`字段类型不匹配：${sourceField.type} → ${targetField.type}`);
                        }
                    }
                },
                autoMatchFields() {
                    this.fieldMappings = [];
                    const matched = new Set();
                    
                    // 完全匹配
                    this.sourceFields.forEach(sourceField => {
                        const exactMatch = this.targetFields.find(targetField => 
                            targetField.name === sourceField.name && !matched.has(targetField.name)
                        );
                        if (exactMatch) {
                            this.fieldMappings.push({
                                sourceField: sourceField.name,
                                targetField: exactMatch.name,
                                transform: '直接映射'
                            });
                            matched.add(exactMatch.name);
                        }
                    });
                    
                    // 相似匹配
                    this.sourceFields.forEach(sourceField => {
                        if (!this.fieldMappings.find(m => m.sourceField === sourceField.name)) {
                            const similarMatch = this.targetFields.find(targetField => {
                                if (matched.has(targetField.name)) return false;
                                const sourceName = sourceField.name.toLowerCase();
                                const targetName = targetField.name.toLowerCase();
                                return sourceName.includes(targetName) || targetName.includes(sourceName) ||
                                       this.calculateSimilarity(sourceName, targetName) > 0.6;
                            });
                            if (similarMatch) {
                                this.fieldMappings.push({
                                    sourceField: sourceField.name,
                                    targetField: similarMatch.name,
                                    transform: '直接映射'
                                });
                                matched.add(similarMatch.name);
                            }
                        }
                    });
                    
                    ElMessage.success(`智能匹配完成，共匹配 ${this.fieldMappings.length} 个字段`);
                },
                calculateSimilarity(str1, str2) {
                    const longer = str1.length > str2.length ? str1 : str2;
                    const shorter = str1.length > str2.length ? str2 : str1;
                    const editDistance = this.getEditDistance(longer, shorter);
                    return (longer.length - editDistance) / longer.length;
                },
                getEditDistance(str1, str2) {
                    const matrix = [];
                    for (let i = 0; i <= str2.length; i++) {
                        matrix[i] = [i];
                    }
                    for (let j = 0; j <= str1.length; j++) {
                        matrix[0][j] = j;
                    }
                    for (let i = 1; i <= str2.length; i++) {
                        for (let j = 1; j <= str1.length; j++) {
                            if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                                matrix[i][j] = matrix[i - 1][j - 1];
                            } else {
                                matrix[i][j] = Math.min(
                                    matrix[i - 1][j - 1] + 1,
                                    matrix[i][j - 1] + 1,
                                    matrix[i - 1][j] + 1
                                );
                            }
                        }
                    }
                    return matrix[str2.length][str1.length];
                },
                clearAllMappings() {
                    ElMessageBox.confirm('确认清空所有映射关系吗？', '确认清空', {
                        type: 'warning'
                    }).then(() => {
                        this.fieldMappings = {};
                        ElMessage.success('已清空所有映射');
                    });
                },
                availableSourceFields(currentTargetFieldName) {
                    const usedSourceFields = Object.values(this.fieldMappings).filter(Boolean);
                    const currentSourceField = this.fieldMappings[currentTargetFieldName];
                    return this.sourceFields.filter(sf => !usedSourceFields.includes(sf.name) || sf.name === currentSourceField);
                },
                isSourceFieldUsed(sourceFieldName, currentTargetFieldName) {
                    const currentSourceField = this.fieldMappings[currentTargetFieldName];
                    if (sourceFieldName === currentSourceField) {
                        return false; // Don't disable the currently selected item for this dropdown
                    }
                    return Object.values(this.fieldMappings).includes(sourceFieldName);
                },
                availableTargetFields(currentSourceFieldName) {
                    const usedTargetFields = Object.values(this.fieldMappings).filter(Boolean);
                    const currentTargetField = this.fieldMappings[currentSourceFieldName];
                    return this.targetFields.filter(tf => !usedTargetFields.includes(tf.name) || tf.name === currentTargetField);
                },
                isTargetFieldUsed(targetFieldName, currentSourceFieldName) {
                    const currentTargetField = this.fieldMappings[currentSourceFieldName];
                    if (targetFieldName === currentTargetField) {
                        return false; // Don't disable the currently selected item for this dropdown
                    }
                    return Object.values(this.fieldMappings).includes(targetFieldName);
                },
                clearMapping(sourceFieldName) {
                    this.fieldMappings[sourceFieldName] = '';
                    ElMessage.success('映射已清除');
                },
                
                // Query参数映射相关方法
                loadQuerySourceFields() {
                    this.querySourceFields = [
                        { name: 'page', type: 'number', required: false },
                        { name: 'size', type: 'number', required: false },
                        { name: 'keyword', type: 'string', required: false },
                        { name: 'status', type: 'string', required: false },
                        { name: 'startDate', type: 'string', required: false }
                    ];
                    this.queryFieldMappings = {};
                    ElMessage.success('Query参数加载完成');
                },
                loadQueryTargetFields() {
                    this.queryTargetFields = [
                        { name: 'pageNum', type: 'number', required: false },
                        { name: 'pageSize', type: 'number', required: false },
                        { name: 'searchKey', type: 'string', required: false },
                        { name: 'state', type: 'string', required: false },
                        { name: 'beginDate', type: 'string', required: false }
                    ];
                    ElMessage.success('目标Query参数加载完成');
                },
                availableQueryTargetFields(currentSourceFieldName) {
                    const usedTargetFields = Object.values(this.queryFieldMappings).filter(Boolean);
                    const currentTargetField = this.queryFieldMappings[currentSourceFieldName];
                    return this.queryTargetFields.filter(tf => !usedTargetFields.includes(tf.name) || tf.name === currentTargetField);
                },
                isQueryTargetFieldUsed(targetFieldName, currentSourceFieldName) {
                    const currentTargetField = this.queryFieldMappings[currentSourceFieldName];
                    if (currentTargetField === targetFieldName) return false;
                    return Object.values(this.queryFieldMappings).includes(targetFieldName);
                },
                clearQueryMapping(sourceFieldName) {
                    this.queryFieldMappings[sourceFieldName] = '';
                    ElMessage.success('Query映射已清除');
                },
                clearAllQueryMappings() {
                    this.queryFieldMappings = {};
                    ElMessage.success('所有Query映射已清除');
                },
                autoMatchQueryFields() {
                    let matchCount = 0;
                    this.querySourceFields.forEach(sourceField => {
                        const exactMatch = this.queryTargetFields.find(targetField =>
                            targetField.name.toLowerCase() === sourceField.name.toLowerCase()
                        );
                        if (exactMatch && !Object.values(this.queryFieldMappings).includes(exactMatch.name)) {
                            this.queryFieldMappings[sourceField.name] = exactMatch.name;
                            matchCount++;
                        }
                    });
                    ElMessage.success(`Query智能匹配完成，共匹配 ${matchCount} 个参数`);
                },
                
                // Headers映射相关方法
                loadHeadersSourceFields() {
                    this.headersSourceFields = [
                        { name: 'Content-Type', type: 'string', required: true },
                        { name: 'Authorization', type: 'string', required: true },
                        { name: 'User-Agent', type: 'string', required: false },
                        { name: 'Accept', type: 'string', required: false },
                        { name: 'X-Request-ID', type: 'string', required: false }
                    ];
                    this.headersFieldMappings = {};
                    ElMessage.success('Headers加载完成');
                },
                loadHeadersTargetFields() {
                    this.headersTargetFields = [
                        { name: 'content-type', type: 'string', required: true },
                        { name: 'auth-token', type: 'string', required: true },
                        { name: 'user-agent', type: 'string', required: false },
                        { name: 'accept-type', type: 'string', required: false },
                        { name: 'request-id', type: 'string', required: false }
                    ];
                    ElMessage.success('目标Headers加载完成');
                },
                availableHeadersTargetFields(currentSourceFieldName) {
                    const usedTargetFields = Object.values(this.headersFieldMappings).filter(Boolean);
                    const currentTargetField = this.headersFieldMappings[currentSourceFieldName];
                    return this.headersTargetFields.filter(tf => !usedTargetFields.includes(tf.name) || tf.name === currentTargetField);
                },
                isHeadersTargetFieldUsed(targetFieldName, currentSourceFieldName) {
                    const currentTargetField = this.headersFieldMappings[currentSourceFieldName];
                    if (currentTargetField === targetFieldName) return false;
                    return Object.values(this.headersFieldMappings).includes(targetFieldName);
                },
                clearHeadersMapping(sourceFieldName) {
                    this.headersFieldMappings[sourceFieldName] = '';
                    ElMessage.success('Headers映射已清除');
                },
                clearAllHeadersMappings() {
                    this.headersFieldMappings = {};
                    ElMessage.success('所有Headers映射已清除');
                },
                autoMatchHeadersFields() {
                    let matchCount = 0;
                    this.headersSourceFields.forEach(sourceField => {
                        const exactMatch = this.headersTargetFields.find(targetField =>
                            targetField.name.toLowerCase().replace('-', '') === sourceField.name.toLowerCase().replace('-', '')
                        );
                        if (exactMatch && !Object.values(this.headersFieldMappings).includes(exactMatch.name)) {
                            this.headersFieldMappings[sourceField.name] = exactMatch.name;
                            matchCount++;
                        }
                    });
                    ElMessage.success(`Headers智能匹配完成，共匹配 ${matchCount} 个字段`);
                },
                
                // Path参数映射相关方法
                loadPathSourceFields() {
                    this.pathSourceFields = [
                        { name: 'userId', type: 'string', required: true },
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'version', type: 'string', required: false },
                        { name: 'category', type: 'string', required: false }
                    ];
                    this.pathFieldMappings = {};
                    ElMessage.success('Path参数加载完成');
                },
                loadPathTargetFields() {
                    this.pathTargetFields = [
                        { name: 'uid', type: 'string', required: true },
                        { name: 'id', type: 'string', required: true },
                        { name: 'ver', type: 'string', required: false },
                        { name: 'type', type: 'string', required: false }
                    ];
                    ElMessage.success('目标Path参数加载完成');
                },
                availablePathTargetFields(currentSourceFieldName) {
                    const usedTargetFields = Object.values(this.pathFieldMappings).filter(Boolean);
                    const currentTargetField = this.pathFieldMappings[currentSourceFieldName];
                    return this.pathTargetFields.filter(tf => !usedTargetFields.includes(tf.name) || tf.name === currentTargetField);
                },
                isPathTargetFieldUsed(targetFieldName, currentSourceFieldName) {
                    const currentTargetField = this.pathFieldMappings[currentSourceFieldName];
                    if (currentTargetField === targetFieldName) return false;
                    return Object.values(this.pathFieldMappings).includes(targetFieldName);
                },
                clearPathMapping(sourceFieldName) {
                    this.pathFieldMappings[sourceFieldName] = '';
                    ElMessage.success('Path映射已清除');
                },
                clearAllPathMappings() {
                    this.pathFieldMappings = {};
                    ElMessage.success('所有Path映射已清除');
                },
                autoMatchPathFields() {
                    let matchCount = 0;
                    this.pathSourceFields.forEach(sourceField => {
                        const exactMatch = this.pathTargetFields.find(targetField =>
                            targetField.name.toLowerCase() === sourceField.name.toLowerCase() ||
                            (sourceField.name.toLowerCase().includes('id') && targetField.name.toLowerCase().includes('id'))
                        );
                        if (exactMatch && !Object.values(this.pathFieldMappings).includes(exactMatch.name)) {
                            this.pathFieldMappings[sourceField.name] = exactMatch.name;
                            matchCount++;
                        }
                    });
                    ElMessage.success(`Path智能匹配完成，共匹配 ${matchCount} 个参数`);
                },
                
                // 编辑任务 - Query参数映射相关方法
                loadEditQuerySourceFields() {
                    this.editQuerySourceFields = [
                        { name: 'page', type: 'number', required: false },
                        { name: 'size', type: 'number', required: false },
                        { name: 'keyword', type: 'string', required: false },
                        { name: 'status', type: 'string', required: false },
                        { name: 'startDate', type: 'string', required: false }
                    ];
                    this.editQueryFieldMappings = {};
                    ElMessage.success('编辑任务Query参数加载完成');
                },
                loadEditQueryTargetFields() {
                    this.editQueryTargetFields = [
                        { name: 'pageNum', type: 'number', required: false },
                        { name: 'pageSize', type: 'number', required: false },
                        { name: 'searchKey', type: 'string', required: false },
                        { name: 'state', type: 'string', required: false },
                        { name: 'beginDate', type: 'string', required: false }
                    ];
                    ElMessage.success('编辑任务目标Query参数加载完成');
                },
                availableEditQueryTargetFields(currentSourceFieldName) {
                    const usedTargetFields = Object.values(this.editQueryFieldMappings).filter(Boolean);
                    const currentTargetField = this.editQueryFieldMappings[currentSourceFieldName];
                    return this.editQueryTargetFields.filter(tf => !usedTargetFields.includes(tf.name) || tf.name === currentTargetField);
                },
                isEditQueryTargetFieldUsed(targetFieldName, currentSourceFieldName) {
                    const currentTargetField = this.editQueryFieldMappings[currentSourceFieldName];
                    if (currentTargetField === targetFieldName) return false;
                    return Object.values(this.editQueryFieldMappings).includes(targetFieldName);
                },
                clearEditQueryMapping(sourceFieldName) {
                    this.editQueryFieldMappings[sourceFieldName] = '';
                    ElMessage.success('编辑任务Query映射已清除');
                },
                clearAllEditQueryMappings() {
                    this.editQueryFieldMappings = {};
                    ElMessage.success('编辑任务所有Query映射已清除');
                },
                autoMatchEditQueryFields() {
                    let matchCount = 0;
                    this.editQuerySourceFields.forEach(sourceField => {
                        const exactMatch = this.editQueryTargetFields.find(targetField =>
                            targetField.name.toLowerCase() === sourceField.name.toLowerCase() ||
                            (sourceField.name.toLowerCase().includes('page') && targetField.name.toLowerCase().includes('page')) ||
                            (sourceField.name.toLowerCase().includes('size') && targetField.name.toLowerCase().includes('size'))
                        );
                        if (exactMatch && !Object.values(this.editQueryFieldMappings).includes(exactMatch.name)) {
                            this.editQueryFieldMappings[sourceField.name] = exactMatch.name;
                            matchCount++;
                        }
                    });
                    ElMessage.success(`编辑任务Query智能匹配完成，共匹配 ${matchCount} 个参数`);
                },
                
                // 编辑任务 - Headers映射相关方法
                loadEditHeadersSourceFields() {
                    this.editHeadersSourceFields = [
                        { name: 'Authorization', type: 'string', required: true },
                        { name: 'Content-Type', type: 'string', required: true },
                        { name: 'User-Agent', type: 'string', required: false },
                        { name: 'Accept', type: 'string', required: false },
                        { name: 'X-Request-ID', type: 'string', required: false }
                    ];
                    this.editHeadersFieldMappings = {};
                    ElMessage.success('编辑任务Headers加载完成');
                },
                loadEditHeadersTargetFields() {
                    this.editHeadersTargetFields = [
                        { name: 'Auth-Token', type: 'string', required: true },
                        { name: 'Content-Type', type: 'string', required: true },
                        { name: 'Client-Info', type: 'string', required: false },
                        { name: 'Accept-Type', type: 'string', required: false },
                        { name: 'Trace-ID', type: 'string', required: false }
                    ];
                    ElMessage.success('编辑任务目标Headers加载完成');
                },
                availableEditHeadersTargetFields(currentSourceFieldName) {
                    const usedTargetFields = Object.values(this.editHeadersFieldMappings).filter(Boolean);
                    const currentTargetField = this.editHeadersFieldMappings[currentSourceFieldName];
                    return this.editHeadersTargetFields.filter(tf => !usedTargetFields.includes(tf.name) || tf.name === currentTargetField);
                },
                isEditHeadersTargetFieldUsed(targetFieldName, currentSourceFieldName) {
                    const currentTargetField = this.editHeadersFieldMappings[currentSourceFieldName];
                    if (currentTargetField === targetFieldName) return false;
                    return Object.values(this.editHeadersFieldMappings).includes(targetFieldName);
                },
                clearEditHeadersMapping(sourceFieldName) {
                    this.editHeadersFieldMappings[sourceFieldName] = '';
                    ElMessage.success('编辑任务Headers映射已清除');
                },
                clearAllEditHeadersMappings() {
                    this.editHeadersFieldMappings = {};
                    ElMessage.success('编辑任务所有Headers映射已清除');
                },
                autoMatchEditHeadersFields() {
                    let matchCount = 0;
                    this.editHeadersSourceFields.forEach(sourceField => {
                        const exactMatch = this.editHeadersTargetFields.find(targetField =>
                            targetField.name.toLowerCase() === sourceField.name.toLowerCase() ||
                            (sourceField.name.toLowerCase().includes('content-type') && targetField.name.toLowerCase().includes('content-type')) ||
                            (sourceField.name.toLowerCase().includes('auth') && targetField.name.toLowerCase().includes('auth'))
                        );
                        if (exactMatch && !Object.values(this.editHeadersFieldMappings).includes(exactMatch.name)) {
                            this.editHeadersFieldMappings[sourceField.name] = exactMatch.name;
                            matchCount++;
                        }
                    });
                    ElMessage.success(`编辑任务Headers智能匹配完成，共匹配 ${matchCount} 个参数`);
                },
                
                // 编辑任务 - Path参数映射相关方法
                loadEditPathSourceFields() {
                    this.editPathSourceFields = [
                        { name: 'userId', type: 'string', required: true },
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'version', type: 'string', required: false },
                        { name: 'format', type: 'string', required: false }
                    ];
                    this.editPathFieldMappings = {};
                    ElMessage.success('编辑任务Path参数加载完成');
                },
                loadEditPathTargetFields() {
                    this.editPathTargetFields = [
                        { name: 'user_id', type: 'string', required: true },
                        { name: 'order_id', type: 'string', required: true },
                        { name: 'api_version', type: 'string', required: false },
                        { name: 'response_format', type: 'string', required: false }
                    ];
                    ElMessage.success('编辑任务目标Path参数加载完成');
                },
                availableEditPathTargetFields(currentSourceFieldName) {
                    const usedTargetFields = Object.values(this.editPathFieldMappings).filter(Boolean);
                    const currentTargetField = this.editPathFieldMappings[currentSourceFieldName];
                    return this.editPathTargetFields.filter(tf => !usedTargetFields.includes(tf.name) || tf.name === currentTargetField);
                },
                isEditPathTargetFieldUsed(targetFieldName, currentSourceFieldName) {
                    const currentTargetField = this.editPathFieldMappings[currentSourceFieldName];
                    if (currentTargetField === targetFieldName) return false;
                    return Object.values(this.editPathFieldMappings).includes(targetFieldName);
                },
                clearEditPathMapping(sourceFieldName) {
                    this.editPathFieldMappings[sourceFieldName] = '';
                    ElMessage.success('编辑任务Path映射已清除');
                },
                clearAllEditPathMappings() {
                    this.editPathFieldMappings = {};
                    ElMessage.success('编辑任务所有Path映射已清除');
                },
                autoMatchEditPathFields() {
                    let matchCount = 0;
                    this.editPathSourceFields.forEach(sourceField => {
                        const exactMatch = this.editPathTargetFields.find(targetField =>
                            targetField.name.toLowerCase() === sourceField.name.toLowerCase() ||
                            (sourceField.name.toLowerCase().includes('id') && targetField.name.toLowerCase().includes('id')) ||
                            (sourceField.name.toLowerCase().includes('version') && targetField.name.toLowerCase().includes('version'))
                        );
                        if (exactMatch && !Object.values(this.editPathFieldMappings).includes(exactMatch.name)) {
                            this.editPathFieldMappings[sourceField.name] = exactMatch.name;
                            matchCount++;
                        }
                    });
                    ElMessage.success(`编辑任务Path智能匹配完成，共匹配 ${matchCount} 个参数`);
                },
                saveTask() {
                    ElMessage.success('任务保存并激活成功');
                    this.taskWizardVisible = false;
                },
                saveDraftTask() {
                    ElMessage.success('任务保存为草稿成功');
                    this.taskWizardVisible = false;
                },
                getTaskStatusTagType(status) {
                    const types = {
                        enabled: 'success',
                        disabled: 'warning'
                    };
                    return types[status] || 'info';
                },
                getTaskStatusText(status) {
                    const texts = {
                        enabled: '启用',
                        disabled: '停用'
                    };
                    return texts[status] || status;
                },
                getSelectedPlatformName(platformId) {
                    const platform = this.platforms.find(p => p.id == platformId);
                    return platform ? platform.name : '';
                },
                getSelectedInterfaceName(interfaceId) {
                    const interface = this.interfaces.find(i => i.id == interfaceId);
                    return interface ? interface.name : '';
                },
                getCycleTypeText(cycleType) {
                    const texts = {
                        monthly: '每月',
                        weekly: '每周',
                        daily: '每日'
                    };
                    return texts[cycleType] || cycleType;
                },
                getWeekDayText(weekDay) {
                    const texts = {
                        '0': '星期日',
                        '1': '星期一',
                        '2': '星期二',
                        '3': '星期三',
                        '4': '星期四',
                        '5': '星期五',
                        '6': '星期六'
                    };
                    return texts[weekDay] || weekDay;
                },
                formatTime(time) {
                    if (!time) return '-';
                    if (typeof time === 'string') return time;
                    const hours = time.getHours().toString().padStart(2, '0');
                    const minutes = time.getMinutes().toString().padStart(2, '0');
                    return `${hours}:${minutes}`;
                },
                
                // 日志管理方法
                searchLogs() {
                    // 查询逻辑已在filteredLogs计算属性中实现
                    const count = this.filteredLogs.length;
                    ElMessage.success(`查询完成，共找到 ${count} 条记录`);
                },
                resetLogFilters() {
                    this.logTaskFilter = '';
                    this.logDateRange = [];
                    this.logStatusFilter = '';
                    this.logSourcePlatformFilter = '';
                    this.logTargetPlatformFilter = '';
                    this.logKeywordSearch = '';
                    ElMessage.success('筛选条件已重置');
                },
                viewLogDetail(log) {
                    this.logDetail.status = log.status;
                    this.logDetail.basicInfo = {
                        '调用时间': log.callTime,
                        '任务名称': log.taskName,
                        '执行耗时': `${log.duration} ms`,
                        '调用状态': this.getLogStatusText(log.status)
                    };

                    if (log.status === 'success' || log.status === 'partial') {
                        this.logDetail.errorMessage = '';
                        // 模拟成功的同步成果数据
                        this.logDetail.data = Array.from({ length: log.successCount || 5 }).map((_, i) => ({
                            orderNo: `ON2024012000${i + 1}`,
                            customerName: `客户${i + 1}`,
                            phone: `1380013800${i}`,
                            businessType: '宽带新装',
                            bandwidth: '200M',
                            installAddress: `XX市XX区XX路${i+1}号`,
                            orderTime: `2024-01-20 14:3${i}:00`,
                            syncStatus: '成功'
                        }));
                    } else { // failure
                        this.logDetail.data = [];
                        this.logDetail.errorMessage = log.errorMessage || '未知的错误原因，请联系技术支持。';
                    }
                    this.logDetailVisible = true;
                },
                copyToClipboard(text) {
                    navigator.clipboard.writeText(text).then(() => {
                        ElMessage.success('已复制到剪贴板');
                    });
                },
                
                // 日志状态处理方法
                getLogStatusText(status) {
                    const texts = {
                        success: '成功',
                        failure: '失败'
                    };
                    return texts[status] || '未知';
                },
                getLogStatusType(status) {
                    const types = {
                        success: 'success',
                        failure: 'danger'
                    };
                    return types[status] || 'info';
                },
                
                // 通用方法
                navigateToProfile() {
                    ElMessage.info('跳转到个人中心');
                },
                navigateToPassword() {
                    ElMessage.info('跳转到修改密码');
                },
                logout() {
                    ElMessageBox.confirm('确认退出登录吗？', '确认退出', {
                        type: 'warning'
                    }).then(() => {
                        ElMessage.success('退出成功');
                    });
                }
            },
            mounted() {
                // 初始化
                this.activeTab = 'platform';
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>