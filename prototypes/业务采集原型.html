<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视联网适配中心 - 业务采集模块</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sidebar {
            width: 250px;
            background: #001529;
            color: white;
            height: 100vh;
            overflow-y: auto;
        }
        .main-content {
            flex: 1;
            background: #f5f5f5;
            overflow-y: auto;
        }
        .el-menu {
            border-right: none;
        }
        .el-menu--dark {
            background-color: #001529;
        }
        .el-menu-item.is-active {
            background-color: #1890ff !important;
        }
        .el-submenu__title:hover {
            background-color: #1890ff !important;
        }
        .el-menu-item:hover {
            background-color: #1890ff !important;
        }
        .content-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status-success {
            color: #52c41a;
        }
        .status-error {
            color: #ff4d4f;
        }
        .status-warning {
            color: #faad14;
        }
        .status-info {
            color: #1890ff;
        }
        .field-tree {
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            padding: 16px;
            background: #fafafa;
            min-height: 300px;
        }
        .mapping-line {
            position: absolute;
            border-top: 2px solid #1890ff;
            z-index: 10;
        }
        .field-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: white;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .field-item:hover {
            border-color: #1890ff;
            box-shadow: 0 2px 4px rgba(24, 144, 255, 0.2);
        }
        .field-item.selected {
            border-color: #1890ff;
            background: #e6f7ff;
        }
        .wizard-steps {
            margin-bottom: 24px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="flex h-screen">
            <!-- 左侧导航 -->
            <div class="sidebar">
                <div class="p-4 border-b border-gray-600">
                    <h2 class="text-lg font-bold text-white">视联网适配中心</h2>
                </div>
                <el-menu
                    :default-active="activeMenu"
                    class="el-menu-vertical-demo"
                    background-color="#001529"
                    text-color="#fff"
                    active-text-color="#fff"
                    :collapse="false"
                    @select="handleMenuSelect">
                    
                    <el-sub-menu index="1">
                        <template #title>
                            <el-icon><Monitor /></el-icon>
                            <span>运营门户</span>
                        </template>
                        <el-menu-item index="1-1">驾驶舱</el-menu-item>
                        <el-sub-menu index="1-2">
                            <template #title>客户管理</template>
                        </el-sub-menu>
                        <el-sub-menu index="1-3">
                            <template #title>运营分析</template>
                            <el-menu-item index="1-3-1">客户分析</el-menu-item>
                            <el-menu-item index="1-3-2">设备分析</el-menu-item>
                            <el-menu-item index="1-3-3">业务分析</el-menu-item>
                        </el-sub-menu>
                        <el-sub-menu index="1-5">
                            <template #title>系统配置</template>
                            <el-menu-item index="1-5-1">用户管理</el-menu-item>
                            <el-menu-item index="1-5-2">角色管理</el-menu-item>
                        </el-sub-menu>
                        <el-sub-menu index="1-6">
                            <template #title>日志管理</template>
                            <el-menu-item index="1-6-1">登录日志</el-menu-item>
                            <el-menu-item index="1-6-2">操作日志</el-menu-item>
                        </el-sub-menu>
                    </el-sub-menu>
                    
                    <el-sub-menu index="2">
                        <template #title>
                            <el-icon><Connection /></el-icon>
                            <span>接口适配</span>
                        </template>
                        <el-menu-item index="2-1">业务平台管理</el-menu-item>
                        <el-menu-item index="2-2">设备管理</el-menu-item>
                        <el-menu-item index="2-3">通道管理</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="3">
                        <template #title>
                            <el-icon><DataAnalysis /></el-icon>
                            <span>业务数据采集</span>
                        </template>
                        <el-menu-item index="platform">业务平台管理</el-menu-item>
                        <el-menu-item index="interface">接口管理</el-menu-item>
                        <el-menu-item index="task">任务管理</el-menu-item>
                        <el-menu-item index="log">同步日志</el-menu-item>
                    </el-sub-menu>
                </el-menu>
            </div>

            <!-- 主内容区域 -->
            <div class="main-content">
                <!-- 顶部导航栏 -->
                <div class="bg-white border-b border-gray-200 px-6 py-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-xl font-semibold text-gray-800">{{ currentPageTitle }}</h1>
                            <p class="text-sm text-gray-500 mt-1">{{ currentPageDesc }}</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <!-- 用户信息 -->
                            <el-dropdown trigger="click">
                                <div class="flex items-center cursor-pointer px-3 py-2 rounded-lg hover:bg-gray-100">
                                    <el-avatar size="small" class="mr-2" :src="userInfo.avatarUrl">
                                        <i class="el-icon-user"></i>
                                    </el-avatar>
                                    <span class="text-gray-700 font-medium">{{ userInfo.realName }}</span>
                                    <i class="el-icon-arrow-down ml-1 text-gray-500"></i>
                                </div>
                                <template #dropdown>
                                    <el-dropdown-menu>
                                        <el-dropdown-item @click="navigateToProfile">
                                            <i class="el-icon-user mr-2"></i>个人中心
                                        </el-dropdown-item>
                                        <el-dropdown-item @click="navigateToPassword">
                                            <i class="el-icon-key mr-2"></i>修改密码
                                        </el-dropdown-item>
                                        <el-dropdown-item divided @click="logout">
                                            <i class="el-icon-switch-button mr-2"></i>退出登录
                                        </el-dropdown-item>
                                    </el-dropdown-menu>
                                </template>
                            </el-dropdown>
                        </div>
                    </div>
                </div>

                <!-- 内容区域 -->
                <div class="p-6">
                    <!-- 业务平台管理 -->
                    <div v-show="activeTab === 'platform'">
                        <div class="content-card p-6">
                            <!-- 操作栏 -->
                            <div class="flex justify-between items-center mb-6">
                                <div class="flex items-center space-x-4">
                                    <el-input
                                        v-model="platformSearch"
                                        placeholder="搜索平台名称、连接地址"
                                        style="width: 300px"
                                        clearable>
                                        <template #prefix>
                                            <el-icon><Search /></el-icon>
                                        </template>
                                    </el-input>
                                    <el-select v-model="platformTypeFilter" placeholder="连接类型" clearable style="width: 150px">
                                        <el-option label="全部" value=""></el-option>
                                        <el-option label="HTTP" value="http"></el-option>
                                        <el-option label="数据库" value="database"></el-option>
                                        <el-option label="消息队列" value="mq"></el-option>
                                    </el-select>
                                </div>
                                <el-button type="primary" @click="showAddPlatformDialog">
                                    <el-icon><Plus /></el-icon>
                                    新增平台
                                </el-button>
                            </div>

                            <!-- 平台列表 -->
                            <el-table :data="filteredPlatforms" stripe>
                                <el-table-column type="selection" width="55"></el-table-column>
                                <el-table-column prop="name" label="平台名称" width="150"></el-table-column>
                                <el-table-column prop="type" label="连接类型" width="120">
                                    <template #default="scope">
                                        <el-tag :type="getPlatformTypeTagType(scope.row.type)">{{getPlatformTypeName(scope.row.type)}}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="baseUrl" label="连接地址" width="200"></el-table-column>
                                <el-table-column prop="description" label="描述" width="200"></el-table-column>
                                <el-table-column prop="status" label="连接状态" width="120">
                                    <template #default="scope">
                                        <span :class="getConnectionStatusClass(scope.row.status)">
                                            <el-icon><CircleFilled /></el-icon>
                                            {{getConnectionStatusText(scope.row.status)}}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="createTime" label="创建时间" width="180"></el-table-column>
                                <el-table-column label="操作" width="280">
                                    <template #default="scope">
                                        <div class="flex items-center gap-1">
                                            <el-button size="small" @click="viewPlatform(scope.row)">详情</el-button>
                                            <el-button size="small" type="primary" @click="editPlatform(scope.row)">编辑</el-button>
                                            <el-button size="small" type="warning" @click="testConnection(scope.row)">测试连接</el-button>
                                            <el-button size="small" type="danger" @click="deletePlatform(scope.row)">删除</el-button>
                                        </div>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="platformCurrentPage"
                                    :page-size="10"
                                    :total="platforms.length"
                                    layout="total, prev, pager, next">
                                </el-pagination>
                            </div>
                        </div>
                    </div>

                    <!-- 接口管理 -->
                    <div v-show="activeTab === 'interface'">
                        <div class="content-card p-6">
                            <!-- 操作栏 -->
                            <div class="flex justify-between items-center mb-6">
                                <div class="flex items-center space-x-4">
                                    <el-input
                                        v-model="interfaceSearch"
                                        placeholder="搜索接口名称、路径"
                                        style="width: 300px"
                                        clearable>
                                        <template #prefix>
                                            <el-icon><Search /></el-icon>
                                        </template>
                                    </el-input>
                                    <el-select v-model="interfacePlatformFilter" placeholder="所属平台" clearable style="width: 150px">
                                        <el-option label="全部" value=""></el-option>
                                        <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                                    </el-select>
                                </div>
                                <el-button type="primary" @click="showAddInterfaceDialog">
                                    <el-icon><Plus /></el-icon>
                                    新增接口
                                </el-button>
                            </div>

                            <!-- 接口列表 -->
                            <el-table :data="filteredInterfaces" stripe>
                                <el-table-column prop="name" label="接口名称" width="150"></el-table-column>
                                <el-table-column prop="platformName" label="所属平台" width="120"></el-table-column>
                                <el-table-column prop="path" label="接口路径" width="200"></el-table-column>
                                <el-table-column prop="method" label="请求方法" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getMethodTagType(scope.row.method)">{{scope.row.method}}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="fieldCount" label="字段数量" width="100"></el-table-column>
                                <el-table-column prop="description" label="描述" width="200"></el-table-column>
                                <el-table-column prop="createTime" label="创建时间" width="180"></el-table-column>
                                <el-table-column label="操作" width="200">
                                    <template #default="scope">
                                        <div class="flex gap-1">
                                            <el-button size="small" @click="viewInterfaceDetail(scope.row)">详情</el-button>
                                            <el-button size="small" type="primary" @click="editInterface(scope.row)">编辑</el-button>
                                            <el-button size="small" type="danger" @click="deleteInterface(scope.row)">删除</el-button>
                                        </div>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="interfaceCurrentPage"
                                    :page-size="10"
                                    :total="interfaces.length"
                                    layout="total, prev, pager, next">
                                </el-pagination>
                            </div>
                        </div>
                    </div>

                    <!-- 任务管理 -->
                    <div v-show="activeTab === 'task'">
                        <div class="content-card p-6">
                            <!-- 操作栏 -->
                            <div class="flex justify-between items-center mb-6">
                                <div class="flex items-center space-x-4">
                                    <el-input
                                        v-model="taskSearch"
                                        placeholder="搜索任务名称"
                                        style="width: 300px"
                                        clearable>
                                        <template #prefix>
                                            <el-icon><Search /></el-icon>
                                        </template>
                                    </el-input>
                                    <el-select v-model="taskStatusFilter" placeholder="任务状态" clearable style="width: 150px">
                                        <el-option label="全部" value=""></el-option>
                                        <el-option label="启用" value="enabled"></el-option>
                                        <el-option label="停用" value="disabled"></el-option>
                                    </el-select>
                                </div>
                                <el-button type="primary" @click="showTaskWizard">
                                    <el-icon><Plus /></el-icon>
                                    新建任务
                                </el-button>
                            </div>

                            <!-- 任务列表 -->
                            <el-table :data="filteredTasks" stripe>
                                <el-table-column type="selection" width="55"></el-table-column>
                                <el-table-column prop="name" label="任务名称" width="150"></el-table-column>
                                <el-table-column prop="sourceInfo" label="源平台/接口" width="200">
                                    <template #default="scope">
                                        <div>
                                            <div class="font-medium">{{scope.row.sourceInfo.platformName}}</div>
                                            <div class="text-sm text-gray-500">{{scope.row.sourceInfo.interfaceName}}</div>
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="targetInfo" label="目标平台/接口" width="200">
                                    <template #default="scope">
                                        <div>
                                            <div class="font-medium">{{scope.row.targetInfo.platformName}}</div>
                                            <div class="text-sm text-gray-500">{{scope.row.targetInfo.interfaceName}}</div>
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="status" label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getTaskStatusTagType(scope.row.status)">{{getTaskStatusText(scope.row.status)}}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="lastRunTime" label="最近运行" width="180"></el-table-column>
                                <el-table-column prop="createTime" label="创建时间" width="180"></el-table-column>
                                <el-table-column label="操作" width="280">
                                    <template #default="scope">
                                        <div class="flex flex-wrap gap-1">
                                            <el-button size="small" @click="viewTaskDetail(scope.row)">详情</el-button>
                                            <el-button size="small" type="primary" @click="editTaskDetail(scope.row)">编辑</el-button>
                                            <el-button size="small" :type="scope.row.status === 'enabled' ? 'warning' : 'success'" @click="toggleTaskStatus(scope.row)">
                                                {{scope.row.status === 'enabled' ? '停用' : '启用'}}
                                            </el-button>
                                            <el-button size="small" type="danger" @click="deleteTask(scope.row)">删除</el-button>
                                        </div>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="taskCurrentPage"
                                    :page-size="10"
                                    :total="tasks.length"
                                    layout="total, prev, pager, next">
                                </el-pagination>
                            </div>
                        </div>
                    </div>

                    <!-- 同步日志 -->
                    <div v-show="activeTab === 'log'">
                        <div class="content-card p-6">
                            <!-- 筛选区域 -->
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                                <el-select v-model="logTaskFilter" placeholder="选择任务" clearable>
                                    <el-option label="全部任务" value=""></el-option>
                                    <el-option v-for="task in tasks" :key="task.id" :label="task.name" :value="task.id"></el-option>
                                </el-select>
                                <el-date-picker
                                    v-model="logDateRange"
                                    type="datetimerange"
                                    range-separator="至"
                                    start-placeholder="开始时间"
                                    end-placeholder="结束时间"
                                    format="YYYY-MM-DD HH:mm:ss"
                                    value-format="YYYY-MM-DD HH:mm:ss">
                                </el-date-picker>
                                <el-select v-model="logStatusFilter" placeholder="调用状态" clearable>
                                    <el-option label="全部" value=""></el-option>
                                    <el-option label="成功" value="success"></el-option>
                                    <el-option label="失败" value="failure"></el-option>
                                </el-select>
                                <el-input v-model="logKeywordSearch" placeholder="关键词搜索" clearable></el-input>
                                <el-button type="primary" @click="searchLogs">
                                    <el-icon><Search /></el-icon>
                                    查询
                                </el-button>
                            </div>

                            <!-- 日志列表 -->
                            <el-table :data="filteredLogs" stripe>
                                <el-table-column prop="callTime" label="调用时间" width="180"></el-table-column>
                                <el-table-column prop="taskName" label="任务名称" width="150"></el-table-column>
                                <el-table-column prop="sourcePlatform" label="源平台" width="120"></el-table-column>
                                <el-table-column prop="targetPlatform" label="目标平台" width="120"></el-table-column>
                                <el-table-column prop="status" label="调用状态" width="100">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 'success' ? 'success' : 'danger'">
                                            {{scope.row.status === 'success' ? '成功' : '失败'}}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="duration" label="耗时(ms)" width="100"></el-table-column>
                                <el-table-column prop="errorMessage" label="错误信息" width="200" show-overflow-tooltip></el-table-column>
                                <el-table-column label="操作" width="120">
                                    <template #default="scope">
                                        <el-button size="small" type="primary" @click="viewLogDetail(scope.row)">查看详情</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="logCurrentPage"
                                    :page-size="10"
                                    :total="logs.length"
                                    layout="total, prev, pager, next">
                                </el-pagination>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 业务平台管理对话框 -->
        <el-dialog v-model="platformDialogVisible" :title="platformDialogTitle" width="600px">
            <el-form :model="platformForm" label-width="100px">
                <el-form-item label="平台名称" required>
                    <el-input v-model="platformForm.name" placeholder="请输入平台名称"></el-input>
                </el-form-item>
                <el-form-item label="平台描述">
                    <el-input v-model="platformForm.description" type="textarea" placeholder="请输入平台描述"></el-input>
                </el-form-item>
                <el-form-item label="连接类型" required>
                    <el-select v-model="platformForm.type" placeholder="请选择连接类型" @change="onConnectionTypeChange">
                        <el-option label="HTTP" value="http"></el-option>
                        <el-option label="数据库" value="database"></el-option>
                        <el-option label="消息队列" value="mq"></el-option>
                    </el-select>
                </el-form-item>
                <div v-if="platformForm.type === 'http'">
                    <el-form-item label="Base URL" required>
                        <el-input v-model="platformForm.baseUrl" placeholder="http://api.example.com"></el-input>
                    </el-form-item>
                    <el-form-item label="认证方式">
                        <el-select v-model="platformForm.authType" placeholder="请选择认证方式">
                            <el-option label="无认证" value="none"></el-option>
                            <el-option label="API Key" value="apikey"></el-option>
                            <el-option label="Bearer Token" value="bearer"></el-option>
                        </el-select>
                    </el-form-item>
                </div>
                <div v-if="platformForm.type === 'database'">
                    <el-form-item label="数据库类型" required>
                        <el-select v-model="platformForm.dbType" placeholder="请选择数据库类型">
                            <el-option label="MySQL" value="mysql"></el-option>
                            <el-option label="PostgreSQL" value="postgresql"></el-option>
                            <el-option label="Oracle" value="oracle"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="连接地址" required>
                        <el-input v-model="platformForm.host" placeholder="localhost:3306"></el-input>
                    </el-form-item>
                    <el-form-item label="数据库名" required>
                        <el-input v-model="platformForm.database" placeholder="database_name"></el-input>
                    </el-form-item>
                    <el-form-item label="用户名" required>
                        <el-input v-model="platformForm.dbUsername" placeholder="请输入数据库用户名"></el-input>
                    </el-form-item>
                    <el-form-item label="密码" required>
                        <el-input v-model="platformForm.dbPassword" type="password" placeholder="请输入数据库密码" show-password></el-input>
                    </el-form-item>
                </div>
                <div v-if="platformForm.type === 'mq'">
                    <el-form-item label="消息队列类型" required>
                        <el-select v-model="platformForm.mqType" placeholder="请选择消息队列类型">
                            <el-option label="RabbitMQ" value="rabbitmq"></el-option>
                            <el-option label="Apache Kafka" value="kafka"></el-option>
                            <el-option label="Apache RocketMQ" value="rocketmq"></el-option>
                            <el-option label="Redis" value="redis"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="连接地址" required>
                        <el-input v-model="platformForm.mqHost" placeholder="localhost:5672"></el-input>
                    </el-form-item>
                    <el-form-item label="虚拟主机/命名空间">
                        <el-input v-model="platformForm.virtualHost" placeholder="/"></el-input>
                    </el-form-item>
                    <el-form-item label="用户名">
                        <el-input v-model="platformForm.mqUsername" placeholder="guest"></el-input>
                    </el-form-item>
                    <el-form-item label="密码">
                        <el-input v-model="platformForm.mqPassword" type="password" placeholder="请输入密码" show-password></el-input>
                    </el-form-item>
                </div>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="platformDialogVisible = false">取消</el-button>
                    <el-button type="warning" @click="testPlatformConnection">测试连接</el-button>
                    <el-button type="primary" @click="savePlatform">保存</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 平台详情查看对话框 -->
        <el-dialog v-model="platformDetailVisible" title="平台详情" width="600px">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">平台名称</label>
                        <div class="text-gray-900">{{platformDetail.name}}</div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">连接类型</label>
                        <el-tag :type="getPlatformTypeTagType(platformDetail.type)">{{getPlatformTypeName(platformDetail.type)}}</el-tag>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">平台描述</label>
                    <div class="text-gray-900">{{platformDetail.description || '暂无描述'}}</div>
                </div>
                <div v-if="platformDetail.type === 'http'">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">连接地址</label>
                            <div class="text-gray-900">{{platformDetail.baseUrl}}</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">认证方式</label>
                            <div class="text-gray-900">{{getAuthTypeName(platformDetail.authType)}}</div>
                        </div>
                    </div>
                </div>
                <div v-if="platformDetail.type === 'database'">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">数据库类型</label>
                            <div class="text-gray-900">{{platformDetail.dbType}}</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">连接地址</label>
                            <div class="text-gray-900">{{platformDetail.host}}</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">数据库名</label>
                            <div class="text-gray-900">{{platformDetail.database}}</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                            <div class="text-gray-900">{{platformDetail.dbUsername}}</div>
                        </div>
                    </div>
                </div>
                <div v-if="platformDetail.type === 'mq'">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">消息队列类型</label>
                            <div class="text-gray-900">{{platformDetail.mqType}}</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">连接地址</label>
                            <div class="text-gray-900">{{platformDetail.mqHost}}</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">虚拟主机/命名空间</label>
                            <div class="text-gray-900">{{platformDetail.virtualHost || '/'}}</div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                            <div class="text-gray-900">{{platformDetail.mqUsername || 'guest'}}</div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">连接状态</label>
                        <span :class="getConnectionStatusClass(platformDetail.status)">
                            <el-icon><CircleFilled /></el-icon>
                            {{getConnectionStatusText(platformDetail.status)}}
                        </span>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">创建时间</label>
                        <div class="text-gray-900">{{platformDetail.createTime}}</div>
                    </div>
                </div>
            </div>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="platformDetailVisible = false">关闭</el-button>
                    <el-button type="primary" @click="editPlatform(platformDetail)">编辑</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 接口管理对话框 -->
        <el-dialog v-model="interfaceDialogVisible" :title="interfaceDialogTitle" width="800px">
            <el-form :model="interfaceForm" label-width="100px">
                <el-form-item label="所属平台" required>
                    <el-select v-model="interfaceForm.platformId" placeholder="请选择平台">
                        <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="接口名称" required>
                    <el-input v-model="interfaceForm.name" placeholder="请输入接口名称"></el-input>
                </el-form-item>
                <el-form-item label="接口路径" required>
                    <el-input v-model="interfaceForm.path" placeholder="/api/order/create"></el-input>
                </el-form-item>
                <el-form-item label="请求方法" required>
                    <el-select v-model="interfaceForm.method" placeholder="请选择请求方法">
                        <el-option label="GET" value="GET"></el-option>
                        <el-option label="POST" value="POST"></el-option>
                        <el-option label="PUT" value="PUT"></el-option>
                        <el-option label="DELETE" value="DELETE"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="接口描述">
                    <el-input v-model="interfaceForm.description" type="textarea" placeholder="请输入接口描述"></el-input>
                </el-form-item>
                <el-form-item label="字段定义">
                    <div class="field-tree">
                        <div class="flex justify-between items-center mb-4">
                            <span class="font-medium">字段结构编辑器</span>
                            <el-button size="small" type="primary" @click="addRootField">添加根字段</el-button>
                        </div>
                        <div class="field-tree-container">
                            <div v-for="(field, index) in interfaceForm.fields" :key="index" class="field-node">
                                <div class="field-item" :style="{paddingLeft: field.level * 20 + 'px'}">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span v-if="field.level > 0" class="text-gray-400">└─</span>
                                            <el-input v-model="field.name" placeholder="字段名" size="small" style="width: 120px"></el-input>
                                            <el-select v-model="field.type" placeholder="类型" size="small" style="width: 100px" @change="onFieldTypeChange(field, index)">
                                                <el-option label="String" value="string"></el-option>
                                                <el-option label="Number" value="number"></el-option>
                                                <el-option label="Boolean" value="boolean"></el-option>
                                                <el-option label="Object" value="object"></el-option>
                                                <el-option label="Array" value="array"></el-option>
                                            </el-select>
                                            <el-checkbox v-model="field.required">必填</el-checkbox>
                                            <el-input v-model="field.description" placeholder="描述" size="small" style="width: 150px"></el-input>
                                        </div>
                                        <div class="flex items-center space-x-1">
                                            <el-button v-if="field.type === 'object' || field.type === 'array'" size="small" type="success" @click="addChildField(index)">添加子字段</el-button>
                                            <el-button size="small" type="danger" @click="removeField(index)">删除</el-button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="interfaceDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveInterface">保存</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 任务向导对话框 -->
        <el-dialog v-model="taskWizardVisible" title="创建同步任务" width="1000px">
            <div class="wizard-steps">
                <el-steps :active="taskWizardStep" finish-status="success">
                    <el-step title="基本信息"></el-step>
                    <el-step title="字段映射"></el-step>
                    <el-step title="配置确认"></el-step>
                </el-steps>
            </div>
            
            <!-- 步骤1：基本信息 -->
            <div v-show="taskWizardStep === 0">
                <el-form :model="taskForm" label-width="120px">
                    <el-form-item label="任务名称" required>
                        <el-input v-model="taskForm.name" placeholder="请输入任务名称"></el-input>
                    </el-form-item>
                    <el-form-item label="任务描述">
                        <el-input v-model="taskForm.description" type="textarea" placeholder="请输入任务描述"></el-input>
                    </el-form-item>
                    <el-form-item label="源平台" required>
                        <el-select v-model="taskForm.sourcePlatformId" placeholder="请选择源平台" @change="onSourcePlatformChange">
                            <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="源接口" required>
                        <el-select v-model="taskForm.sourceInterfaceId" placeholder="请选择源接口" @change="onSourceInterfaceChange">
                            <el-option v-for="interface in sourceInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="目标平台" required>
                        <el-select v-model="taskForm.targetPlatformId" placeholder="请选择目标平台" @change="onTargetPlatformChange">
                            <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="目标接口" required>
                        <el-select v-model="taskForm.targetInterfaceId" placeholder="请选择目标接口" @change="onTargetInterfaceChange">
                            <el-option v-for="interface in targetInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                        </el-select>
                    </el-form-item>
                </el-form>
            </div>
            
            <!-- 步骤2：字段映射 -->
            <div v-show="taskWizardStep === 1">
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-medium">字段映射配置</h4>
                        <div class="space-x-2">
                            <el-button size="small" @click="addMappingRow">添加映射</el-button>
                            <el-button size="small" @click="autoMatchFields">智能匹配</el-button>
                            <el-button size="small" type="warning" @click="clearAllMappings">清空映射</el-button>
                        </div>
                    </div>
                    
                    <!-- 表头 -->
                    <div class="grid grid-cols-12 gap-2 mb-2 p-3 bg-gray-50 rounded font-medium text-sm">
                        <div class="col-span-5">源接口字段</div>
                        <div class="col-span-1 text-center">→</div>
                        <div class="col-span-5">目标接口字段</div>
                        <div class="col-span-1 text-center">操作</div>
                    </div>
                    
                    <!-- 映射行 -->
                    <div class="space-y-2 max-h-96 overflow-y-auto">
                        <div v-for="(mapping, index) in fieldMappings" :key="index" class="grid grid-cols-12 gap-2 p-3 bg-white border rounded hover:bg-gray-50">
                            <!-- 源字段选择 -->
                            <div class="col-span-5">
                                <el-select v-model="mapping.sourceField" placeholder="选择源字段" size="small" class="w-full" @change="onMappingChange(index)">
                                    <el-option v-for="field in sourceFields" :key="field.name" :label="`${field.name} (${field.type})`" :value="field.name">
                                        <div class="flex justify-between items-center">
                                            <span>{{field.name}}</span>
                                            <el-tag size="small" :type="getFieldTypeColor(field.type)">{{field.type}}</el-tag>
                                        </div>
                                    </el-option>
                                </el-select>
                            </div>
                            
                            <!-- 箭头 -->
                            <div class="col-span-1 flex items-center justify-center">
                                <el-icon class="text-blue-500"><Right /></el-icon>
                            </div>
                            
                            <!-- 目标字段选择 -->
                            <div class="col-span-5">
                                <el-select v-model="mapping.targetField" placeholder="选择目标字段" size="small" class="w-full" @change="onMappingChange(index)">
                                    <el-option v-for="field in targetFields" :key="field.name" :label="`${field.name} (${field.type})`" :value="field.name">
                                        <div class="flex justify-between items-center">
                                            <span>{{field.name}}</span>
                                            <el-tag size="small" :type="getFieldTypeColor(field.type)">{{field.type}}</el-tag>
                                        </div>
                                    </el-option>
                                </el-select>
                            </div>
                            
                            <!-- 删除按钮 -->
                            <div class="col-span-1 flex items-center justify-center">
                                <el-button size="small" type="danger" :icon="Delete" circle @click="removeMappingRow(index)"></el-button>
                            </div>
                        </div>
                        
                        <!-- 空状态 -->
                        <div v-if="fieldMappings.length === 0" class="text-center py-8 text-gray-500">
                            <el-icon class="text-4xl mb-2"><Connection /></el-icon>
                            <p>暂无字段映射，点击"添加映射"开始配置</p>
                        </div>
                    </div>
                    
                    <!-- 映射统计 -->
                    <div class="mt-4 p-3 bg-blue-50 rounded">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-blue-700">映射统计：已配置 {{validMappingsCount}} 个有效映射</span>
                            <span class="text-gray-600">源字段：{{sourceFields.length}} 个 | 目标字段：{{targetFields.length}} 个</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 步骤3：配置确认 -->
            <div v-show="taskWizardStep === 2">
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium mb-2">基本信息</h4>
                        <div class="bg-gray-50 p-4 rounded">
                            <p><strong>任务名称：</strong>{{taskForm.name}}</p>
                            <p><strong>任务描述：</strong>{{taskForm.description}}</p>
                            <p><strong>源平台/接口：</strong>{{getSelectedPlatformName(taskForm.sourcePlatformId)}} / {{getSelectedInterfaceName(taskForm.sourceInterfaceId)}}</p>
                            <p><strong>目标平台/接口：</strong>{{getSelectedPlatformName(taskForm.targetPlatformId)}} / {{getSelectedInterfaceName(taskForm.targetInterfaceId)}}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">字段映射概览</h4>
                        <div class="bg-gray-50 p-4 rounded">
                            <p><strong>映射数量：</strong>{{fieldMappings.length}} 个</p>
                            <div v-for="mapping in fieldMappings" :key="mapping.sourceField" class="text-sm">
                                {{mapping.sourceField}} → {{mapping.targetField}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="taskWizardVisible = false">取消</el-button>
                    <el-button v-if="taskWizardStep > 0" @click="taskWizardStep--">上一步</el-button>
                    <el-button v-if="taskWizardStep < 2" type="primary" @click="taskWizardStep++">下一步</el-button>
                    <el-button v-if="taskWizardStep === 2" type="success" @click="saveTask">保存并激活</el-button>
                    <el-button v-if="taskWizardStep === 2" @click="saveDraftTask">存为草稿</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 接口详情弹窗 -->
        <el-dialog v-model="interfaceDetailVisible" title="接口详情" width="70%">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">接口名称</label>
                        <p class="text-gray-900">{{ interfaceDetail.name }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">所属平台</label>
                        <p class="text-gray-900">{{ interfaceDetail.platformName }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">接口路径</label>
                        <p class="text-gray-900">{{ interfaceDetail.path }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">请求方法</label>
                        <el-tag :type="interfaceDetail.method === 'POST' ? 'primary' : 'success'">{{ interfaceDetail.method }}</el-tag>
                    </div>
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">接口描述</label>
                        <p class="text-gray-900">{{ interfaceDetail.description }}</p>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">字段结构</label>
                    <div class="border rounded-lg p-4 bg-gray-50">
                        <div v-for="field in interfaceDetail.fields" :key="field.id" class="field-display" :style="{paddingLeft: field.level * 20 + 'px', marginBottom: '8px'}">
                            <div class="flex items-center space-x-2">
                                <span v-if="field.level > 0" class="text-gray-400">└─</span>
                                <span class="font-medium">{{ field.name }}</span>
                                <el-tag size="small" :type="getFieldTypeColor(field.type)">{{ field.type }}</el-tag>
                                <el-tag v-if="field.required" size="small" type="danger">必填</el-tag>
                                <span class="text-gray-600">{{ field.description }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </el-dialog>

        <!-- 日志详情对话框 -->
        <el-dialog v-model="logDetailVisible" title="调用详情" width="1400px" class="log-detail-dialog">
            <!-- 基本信息卡片 -->
            <div class="mb-6">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-100">
                    <div class="grid grid-cols-4 gap-4 text-sm">
                        <div class="flex items-center space-x-2">
                            <el-icon class="text-blue-500"><Clock /></el-icon>
                            <div>
                                <div class="text-gray-500">调用时间</div>
                                <div class="font-medium">2024-01-20 14:30:15</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <el-icon class="text-green-500"><Connection /></el-icon>
                            <div>
                                <div class="text-gray-500">任务名称</div>
                                <div class="font-medium">移动订购数据同步</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <el-icon class="text-purple-500"><Timer /></el-icon>
                            <div>
                                <div class="text-gray-500">执行耗时</div>
                                <div class="font-medium">245ms</div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <el-icon class="text-orange-500"><CircleCheck /></el-icon>
                            <div>
                                <div class="text-gray-500">调用状态</div>
                                <el-tag type="success" size="small">成功</el-tag>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 报文内容区域 -->
            <div class="grid grid-cols-3 gap-6">
                <!-- 原始请求 -->
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center space-x-2 text-white">
                            <el-icon><Upload /></el-icon>
                            <h4 class="font-medium">原始请求</h4>
                        </div>
                        <el-button size="small" type="primary" plain @click="copyToClipboard(logDetail.originalRequest)">
                            <el-icon><CopyDocument /></el-icon>
                            复制
                        </el-button>
                    </div>
                    <div class="p-4">
                        <div class="bg-gray-50 rounded-lg border" style="height: 420px; overflow-y: auto;">
                            <pre class="text-sm p-4 leading-relaxed font-mono">{{logDetail.originalRequest}}</pre>
                        </div>
                    </div>
                </div>
                
                <!-- 转换后请求 -->
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                    <div class="bg-gradient-to-r from-green-500 to-green-600 px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center space-x-2 text-white">
                            <el-icon><Refresh /></el-icon>
                            <h4 class="font-medium">转换后请求</h4>
                        </div>
                        <el-button size="small" type="success" plain @click="copyToClipboard(logDetail.transformedRequest)">
                            <el-icon><CopyDocument /></el-icon>
                            复制
                        </el-button>
                    </div>
                    <div class="p-4">
                        <div class="bg-gray-50 rounded-lg border" style="height: 420px; overflow-y: auto;">
                            <pre class="text-sm p-4 leading-relaxed font-mono">{{logDetail.transformedRequest}}</pre>
                        </div>
                    </div>
                </div>
                
                <!-- 目标响应 -->
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center space-x-2 text-white">
                            <el-icon><Download /></el-icon>
                            <h4 class="font-medium">目标响应</h4>
                        </div>
                        <el-button size="small" type="warning" plain @click="copyToClipboard(logDetail.targetResponse)">
                            <el-icon><CopyDocument /></el-icon>
                            复制
                        </el-button>
                    </div>
                    <div class="p-4">
                        <div class="bg-gray-50 rounded-lg border" style="height: 420px; overflow-y: auto;">
                            <pre class="text-sm p-4 leading-relaxed font-mono">{{logDetail.targetResponse}}</pre>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 错误信息区域 -->
            <div v-if="logDetail.errorMessage" class="mt-6">
                <div class="bg-red-50 border border-red-200 rounded-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-red-500 to-red-600 px-4 py-3">
                        <div class="flex items-center space-x-2 text-white">
                            <el-icon><Warning /></el-icon>
                            <h4 class="font-medium">错误信息</h4>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="bg-red-25 p-4 rounded border border-red-100">
                            <p class="text-red-800 font-mono text-sm leading-relaxed">{{logDetail.errorMessage}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </el-dialog>

        <!-- 任务详情弹窗 -->
        <el-dialog v-model="taskDetailDialogVisible" title="任务详情" width="800px">
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">任务名称</label>
                        <p class="text-gray-900">{{ taskDetailForm.name }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">任务状态</label>
                        <el-tag :type="getTaskStatusTagType(taskDetailForm.status)">{{ getTaskStatusText(taskDetailForm.status) }}</el-tag>
                    </div>
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">任务描述</label>
                        <p class="text-gray-900">{{ taskDetailForm.description || '暂无描述' }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">源平台</label>
                        <p class="text-gray-900">{{ taskDetailForm.sourcePlatformName }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">源接口</label>
                        <p class="text-gray-900">{{ taskDetailForm.sourceInterfaceName }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">目标平台</label>
                        <p class="text-gray-900">{{ taskDetailForm.targetPlatformName }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">目标接口</label>
                        <p class="text-gray-900">{{ taskDetailForm.targetInterfaceName }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">最近运行时间</label>
                        <p class="text-gray-900">{{ taskDetailForm.lastRunTime || '暂未运行' }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">创建时间</label>
                        <p class="text-gray-900">{{ taskDetailForm.createTime }}</p>
                    </div>
                </div>
            </div>
        </el-dialog>

        <!-- 任务编辑向导弹窗 -->
        <el-dialog v-model="taskEditDialogVisible" title="编辑任务" width="1000px">
            <div class="wizard-steps">
                <el-steps :active="taskEditWizardStep" finish-status="success">
                    <el-step title="基本信息"></el-step>
                    <el-step title="字段映射"></el-step>
                    <el-step title="配置确认"></el-step>
                </el-steps>
            </div>
            
            <!-- 步骤1：基本信息 -->
            <div v-show="taskEditWizardStep === 0">
                <el-form :model="taskDetailForm" label-width="120px">
                    <el-form-item label="任务名称" required>
                        <el-input v-model="taskDetailForm.name" placeholder="请输入任务名称"></el-input>
                    </el-form-item>
                    <el-form-item label="任务描述">
                        <el-input v-model="taskDetailForm.description" type="textarea" placeholder="请输入任务描述"></el-input>
                    </el-form-item>
                    <el-form-item label="任务状态">
                        <el-select v-model="taskDetailForm.status" placeholder="请选择状态">
                            <el-option label="启用" value="enabled"></el-option>
                            <el-option label="停用" value="disabled"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="源平台" required>
                        <el-select v-model="taskDetailForm.sourcePlatformId" placeholder="请选择源平台" @change="onEditSourcePlatformChange">
                            <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="源接口" required>
                        <el-select v-model="taskDetailForm.sourceInterfaceId" placeholder="请选择源接口" @change="onEditSourceInterfaceChange">
                            <el-option v-for="interface in editSourceInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="目标平台" required>
                        <el-select v-model="taskDetailForm.targetPlatformId" placeholder="请选择目标平台" @change="onEditTargetPlatformChange">
                            <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="目标接口" required>
                        <el-select v-model="taskDetailForm.targetInterfaceId" placeholder="请选择目标接口" @change="onEditTargetInterfaceChange">
                            <el-option v-for="interface in editTargetInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                        </el-select>
                    </el-form-item>
                </el-form>
            </div>
            
            <!-- 步骤2：字段映射 -->
            <div v-show="taskEditWizardStep === 1">
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-medium">字段映射配置</h4>
                        <div class="space-x-2">
                            <el-button size="small" @click="addEditMappingRow">添加映射</el-button>
                            <el-button size="small" @click="autoMatchEditFields">智能匹配</el-button>
                            <el-button size="small" type="warning" @click="clearAllEditMappings">清空映射</el-button>
                        </div>
                    </div>
                    
                    <!-- 表头 -->
                    <div class="grid grid-cols-12 gap-2 mb-2 p-3 bg-gray-50 rounded font-medium text-sm">
                        <div class="col-span-5">源接口字段</div>
                        <div class="col-span-1 text-center">→</div>
                        <div class="col-span-5">目标接口字段</div>
                        <div class="col-span-1 text-center">操作</div>
                    </div>
                    
                    <!-- 映射行 -->
                    <div class="space-y-2 max-h-96 overflow-y-auto">
                        <div v-for="(mapping, index) in editFieldMappings" :key="index" class="grid grid-cols-12 gap-2 p-3 bg-white border rounded hover:bg-gray-50">
                            <!-- 源字段选择 -->
                            <div class="col-span-5">
                                <el-select v-model="mapping.sourceField" placeholder="选择源字段" size="small" class="w-full" @change="onEditMappingChange(index)">
                                    <el-option v-for="field in editSourceFields" :key="field.name" :label="`${field.name} (${field.type})`" :value="field.name">
                                        <div class="flex justify-between items-center">
                                            <span>{{field.name}}</span>
                                            <el-tag size="small" :type="getFieldTypeColor(field.type)">{{field.type}}</el-tag>
                                        </div>
                                    </el-option>
                                </el-select>
                            </div>
                            
                            <!-- 箭头 -->
                            <div class="col-span-1 flex items-center justify-center">
                                <el-icon class="text-blue-500"><Right /></el-icon>
                            </div>
                            
                            <!-- 目标字段选择 -->
                            <div class="col-span-5">
                                <el-select v-model="mapping.targetField" placeholder="选择目标字段" size="small" class="w-full" @change="onEditMappingChange(index)">
                                    <el-option v-for="field in editTargetFields" :key="field.name" :label="`${field.name} (${field.type})`" :value="field.name">
                                        <div class="flex justify-between items-center">
                                            <span>{{field.name}}</span>
                                            <el-tag size="small" :type="getFieldTypeColor(field.type)">{{field.type}}</el-tag>
                                        </div>
                                    </el-option>
                                </el-select>
                            </div>
                            
                            <!-- 删除按钮 -->
                            <div class="col-span-1 flex items-center justify-center">
                                <el-button size="small" type="danger" :icon="Delete" circle @click="removeEditMappingRow(index)"></el-button>
                            </div>
                        </div>
                        
                        <!-- 空状态 -->
                        <div v-if="editFieldMappings.length === 0" class="text-center py-8 text-gray-500">
                            <el-icon class="text-4xl mb-2"><Connection /></el-icon>
                            <p>暂无字段映射，点击"添加映射"开始配置</p>
                        </div>
                    </div>
                    
                    <!-- 映射统计 -->
                    <div class="mt-4 p-3 bg-blue-50 rounded">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-blue-700">映射统计：已配置 {{validEditMappingsCount}} 个有效映射</span>
                            <span class="text-gray-600">源字段：{{editSourceFields.length}} 个 | 目标字段：{{editTargetFields.length}} 个</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 步骤3：配置确认 -->
            <div v-show="taskEditWizardStep === 2">
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium mb-2">基本信息</h4>
                        <div class="bg-gray-50 p-4 rounded">
                            <p><strong>任务名称：</strong>{{taskDetailForm.name}}</p>
                            <p><strong>任务描述：</strong>{{taskDetailForm.description}}</p>
                            <p><strong>任务状态：</strong>{{getTaskStatusText(taskDetailForm.status)}}</p>
                            <p><strong>源平台/接口：</strong>{{getSelectedPlatformName(taskDetailForm.sourcePlatformId)}} / {{getSelectedInterfaceName(taskDetailForm.sourceInterfaceId)}}</p>
                            <p><strong>目标平台/接口：</strong>{{getSelectedPlatformName(taskDetailForm.targetPlatformId)}} / {{getSelectedInterfaceName(taskDetailForm.targetInterfaceId)}}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">字段映射概览</h4>
                        <div class="bg-gray-50 p-4 rounded">
                            <p><strong>映射数量：</strong>{{editFieldMappings.length}} 个</p>
                            <div v-for="mapping in editFieldMappings" :key="mapping.sourceField" class="text-sm">
                                {{mapping.sourceField}} → {{mapping.targetField}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="taskEditDialogVisible = false">取消</el-button>
                    <el-button v-if="taskEditWizardStep > 0" @click="taskEditWizardStep--">上一步</el-button>
                    <el-button v-if="taskEditWizardStep < 2" type="primary" @click="taskEditWizardStep++">下一步</el-button>
                    <el-button v-if="taskEditWizardStep === 2" type="success" @click="saveTaskEdit">保存修改</el-button>
                </span>
            </template>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;
        
        createApp({
            data() {
                return {
                    activeMenu: 'platform',
                    activeTab: 'platform',
                    userInfo: {
                        realName: '系统管理员',
                        avatarUrl: ''
                    },
                    
                    // 业务平台管理
                    platforms: [
                        {
                            id: 1,
                            name: '贵州移动',
                            type: 'http',
                            baseUrl: 'http://api.gz.mobile.com',
                            description: '贵州移动业务平台',
                            status: 'connected',
                            createTime: '2024-01-15 10:30:00'
                        },
                        {
                            id: 2,
                            name: '浙江创新院',
                            type: 'http',
                            baseUrl: 'http://api.zj.innovation.com',
                            description: '浙江创新院接口平台',
                            status: 'connected',
                            createTime: '2024-01-16 14:20:00'
                        },
                        {
                            id: 3,
                            name: '数据中心',
                            type: 'database',
                            baseUrl: 'mysql://db.datacenter.com:3306',
                            description: '核心数据库',
                            status: 'error',
                            createTime: '2024-01-17 09:15:00'
                        }
                    ],
                    platformSearch: '',
                    platformTypeFilter: '',
                    platformCurrentPage: 1,
                    platformDialogVisible: false,
                    platformDialogTitle: '',
                    platformForm: {
                        name: '',
                        description: '',
                        type: '',
                        baseUrl: '',
                        authType: 'none',
                        dbType: '',
                        host: '',
                        database: '',
                        dbUsername: '',
                        dbPassword: '',
                        mqType: '',
                        mqHost: '',
                        virtualHost: '',
                        mqUsername: '',
                        mqPassword: ''
                    },
                    platformDetailVisible: false,
                    platformDetail: {},
                    
                    // 接口管理
                    interfaces: [
                        {
                            id: 1,
                            name: '订购接口',
                            platformId: 1,
                            platformName: '贵州移动',
                            path: '/api/order/create',
                            method: 'POST',
                            fieldCount: 8,
                            description: '业务订购接口',
                            createTime: '2024-01-18 11:00:00'
                        },
                        {
                            id: 2,
                            name: '退订接口',
                            platformId: 1,
                            platformName: '贵州移动',
                            path: '/api/order/cancel',
                            method: 'POST',
                            fieldCount: 5,
                            description: '业务退订接口',
                            createTime: '2024-01-18 11:30:00'
                        },
                        {
                            id: 3,
                            name: '订单同步',
                            platformId: 2,
                            platformName: '浙江创新院',
                            path: '/api/sync/order',
                            method: 'POST',
                            fieldCount: 10,
                            description: '订单数据同步接口',
                            createTime: '2024-01-19 15:45:00'
                        }
                    ],
                    interfaceSearch: '',
                    interfacePlatformFilter: '',
                    interfaceCurrentPage: 1,
                    interfaceDialogVisible: false,
                    interfaceDialogTitle: '',
                    interfaceForm: {
                        platformId: '',
                        name: '',
                        path: '',
                        method: '',
                        description: '',
                        fields: []
                    },
                    interfaceDetailVisible: false,
                    interfaceDetail: {},
                    
                    // 任务管理
                    tasks: [
                        {
                            id: 1,
                            name: '移动订购数据同步',
                            sourceInfo: {
                                platformId: 1,
                                platformName: '贵州移动',
                                interfaceName: '订购接口'
                            },
                            targetInfo: {
                                platformId: 2,
                                platformName: '浙江创新院',
                                interfaceName: '订单同步'
                            },
                            status: 'enabled',
                            lastRunTime: '2024-01-20 14:30:00',
                            createTime: '2024-01-18 16:00:00'
                        },
                        {
                            id: 2,
                            name: '退订数据同步',
                            sourceInfo: {
                                platformId: 1,
                                platformName: '贵州移动',
                                interfaceName: '退订接口'
                            },
                            targetInfo: {
                                platformId: 2,
                                platformName: '浙江创新院',
                                interfaceName: '订单同步'
                            },
                            status: 'disabled',
                            lastRunTime: '',
                            createTime: '2024-01-19 10:15:00'
                        }
                    ],
                    taskSearch: '',
                    taskStatusFilter: '',
                    taskCurrentPage: 1,
                    taskWizardVisible: false,
                    taskWizardStep: 0,
                    taskForm: {
                        name: '',
                        description: '',
                        sourcePlatformId: '',
                        sourceInterfaceId: '',
                        targetPlatformId: '',
                        targetInterfaceId: ''
                    },
                    sourceInterfaces: [],
                    targetInterfaces: [],
                    sourceFields: [
                        { name: 'mainOrderNo', type: 'string', required: true },
                        { name: 'orderNo', type: 'string', required: true },
                        { name: 'department', type: 'number', required: true },
                        { name: 'customerInfo', type: 'object', required: true },
                        { name: 'accessAddress', type: 'string', required: false }
                    ],
                    targetFields: [
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'orderNumber', type: 'string', required: true },
                        { name: 'deptCode', type: 'number', required: true },
                        { name: 'customer', type: 'object', required: true },
                        { name: 'address', type: 'string', required: false }
                    ],
                    sourceFields: [],
                    targetFields: [],
                    fieldMappings: [],
                    taskDetailDialogVisible: false,
                    taskEditDialogVisible: false,
                    taskEditWizardStep: 0,
                    taskDetailForm: {},
                    editSourceInterfaces: [],
                    editTargetInterfaces: [],
                    editSourceFields: [],
                    editTargetFields: [],
                    editFieldMappings: [],
                    
                    // 同步日志
                    logs: [
                        {
                            id: 1,
                            callTime: '2024-01-20 14:30:15',
                            taskName: '移动订购数据同步',
                            sourcePlatform: '贵州移动',
                            targetPlatform: '浙江创新院',
                            status: 'success',
                            duration: 245,
                            errorMessage: ''
                        },
                        {
                            id: 2,
                            callTime: '2024-01-20 14:25:32',
                            taskName: '移动订购数据同步',
                            sourcePlatform: '贵州移动',
                            targetPlatform: '浙江创新院',
                            status: 'failure',
                            duration: 1200,
                            errorMessage: '目标平台连接超时'
                        }
                    ],
                    logTaskFilter: '',
                    logDateRange: [],
                    logStatusFilter: '',
                    logKeywordSearch: '',
                    logCurrentPage: 1,
                    logDetailVisible: false,
                    logDetail: {
                        originalRequest: '',
                        transformedRequest: '',
                        targetResponse: '',
                        errorMessage: ''
                    }
                };
            },
            computed: {
                currentPageTitle() {
                    const titles = {
                        platform: '业务平台管理',
                        interface: '接口管理',
                        task: '任务管理',
                        log: '同步日志'
                    };
                    return titles[this.activeTab] || '业务采集';
                },
                currentPageDesc() {
                    const descs = {
                        platform: '统一管理外部平台连接信息，支持HTTP、数据库、消息队列等多种连接类型',
                        interface: '定义和管理各平台的接口结构，为数据同步任务提供基础',
                        task: '创建和管理数据同步任务，支持可视化字段映射配置',
                        log: '查看同步任务执行日志，支持全链路调用详情追踪'
                    };
                    return descs[this.activeTab] || '可视化的接口对接功能模块';
                },
                filteredPlatforms() {
                    return this.platforms.filter(platform => {
                        const matchSearch = !this.platformSearch || 
                            platform.name.toLowerCase().includes(this.platformSearch.toLowerCase()) ||
                            platform.baseUrl.toLowerCase().includes(this.platformSearch.toLowerCase());
                        const matchType = !this.platformTypeFilter || platform.type === this.platformTypeFilter;
                        return matchSearch && matchType;
                    });
                },
                filteredInterfaces() {
                    return this.interfaces.filter(interface => {
                        const matchSearch = !this.interfaceSearch || 
                            interface.name.toLowerCase().includes(this.interfaceSearch.toLowerCase()) ||
                            interface.path.toLowerCase().includes(this.interfaceSearch.toLowerCase());
                        const matchPlatform = !this.interfacePlatformFilter || interface.platformId == this.interfacePlatformFilter;
                        return matchSearch && matchPlatform;
                    });
                },
                filteredTasks() {
                    return this.tasks.filter(task => {
                        const matchSearch = !this.taskSearch || 
                            task.name.toLowerCase().includes(this.taskSearch.toLowerCase());
                        const matchStatus = !this.taskStatusFilter || task.status === this.taskStatusFilter;
                        return matchSearch && matchStatus;
                    });
                },
                filteredLogs() {
                    return this.logs.filter(log => {
                        const matchTask = !this.logTaskFilter || log.taskName.includes(this.logTaskFilter);
                        const matchStatus = !this.logStatusFilter || log.status === this.logStatusFilter;
                        const matchKeyword = !this.logKeywordSearch || 
                            log.taskName.toLowerCase().includes(this.logKeywordSearch.toLowerCase()) ||
                            log.errorMessage.toLowerCase().includes(this.logKeywordSearch.toLowerCase());
                        return matchTask && matchStatus && matchKeyword;
                    });
                },
                validMappingsCount() {
                    return this.fieldMappings.filter(mapping => mapping.sourceField && mapping.targetField).length;
                },
                validEditMappingsCount() {
                    return this.editFieldMappings.filter(mapping => mapping.sourceField && mapping.targetField).length;
                }
            },
            methods: {
                handleMenuSelect(key) {
                    this.activeMenu = key;
                    if (['platform', 'interface', 'task', 'log'].includes(key)) {
                        this.activeTab = key;
                    }
                },
                
                // 业务平台管理方法
                showAddPlatformDialog() {
                    this.platformDialogTitle = '新增平台';
                    this.platformForm = {
                        name: '',
                        description: '',
                        type: '',
                        baseUrl: '',
                        authType: 'none',
                        dbType: '',
                        host: '',
                        database: '',
                        dbUsername: '',
                        dbPassword: '',
                        mqType: '',
                        mqHost: '',
                        virtualHost: '',
                        mqUsername: '',
                        mqPassword: ''
                    };
                    this.platformDialogVisible = true;
                },
                editPlatform(platform) {
                    this.platformDialogTitle = '编辑平台';
                    this.platformForm = { ...platform };
                    this.platformDialogVisible = true;
                },
                deletePlatform(platform) {
                    ElMessageBox.confirm('确认删除该平台吗？平台下的所有接口定义也将被删除。', '确认删除', {
                        type: 'warning'
                    }).then(() => {
                        ElMessage.success('删除成功');
                    });
                },
                testPlatformConnection() {
                    ElMessage.success('连接测试成功');
                },
                savePlatform() {
                    ElMessage.success('保存成功');
                    this.platformDialogVisible = false;
                },
                onConnectionTypeChange() {
                    // 重置相关字段
                },
                getPlatformTypeTagType(type) {
                    const types = {
                        http: 'primary',
                        database: 'success',
                        mq: 'warning'
                    };
                    return types[type] || 'info';
                },
                getPlatformTypeName(type) {
                    const names = {
                        http: 'HTTP',
                        database: '数据库',
                        mq: '消息队列'
                    };
                    return names[type] || type;
                },
                getConnectionStatusClass(status) {
                    const classes = {
                        connected: 'status-success',
                        error: 'status-error',
                        connecting: 'status-warning'
                    };
                    return classes[status] || 'status-info';
                },
                getConnectionStatusText(status) {
                    const texts = {
                        connected: '已连接',
                        error: '连接异常',
                        connecting: '连接中'
                    };
                    return texts[status] || '未知';
                },
                getAuthTypeName(authType) {
                    const names = {
                        none: '无认证',
                        apikey: 'API Key',
                        bearer: 'Bearer Token'
                    };
                    return names[authType] || authType;
                },
                viewPlatform(platform) {
                    this.platformDetail = { ...platform };
                    this.platformDetailVisible = true;
                },
                testConnection(platform) {
                    ElMessage.success('连接测试成功');
                },
                
                // 接口管理方法
                showAddInterfaceDialog() {
                    this.interfaceDialogTitle = '新增接口';
                    this.interfaceForm = {
                        platformId: '',
                        name: '',
                        path: '',
                        method: '',
                        description: '',
                        fields: []
                    };
                    this.interfaceDialogVisible = true;
                },
                editInterface(interface) {
                    this.interfaceDialogTitle = '编辑接口';
                    this.interfaceForm = { ...interface };
                    this.interfaceDialogVisible = true;
                },
                deleteInterface(interface) {
                    ElMessageBox.confirm('确认删除该接口吗？', '确认删除', {
                        type: 'warning'
                    }).then(() => {
                        ElMessage.success('删除成功');
                    });
                },
                saveInterface() {
                    ElMessage.success('保存成功');
                    this.interfaceDialogVisible = false;
                },
                addRootField() {
                    this.interfaceForm.fields.push({
                        id: Date.now(),
                        name: '',
                        type: 'string',
                        required: false,
                        description: '',
                        level: 0
                    });
                },
                addChildField(parentIndex) {
                    const parentField = this.interfaceForm.fields[parentIndex];
                    const newField = {
                        id: Date.now(),
                        name: '',
                        type: 'string',
                        required: false,
                        description: '',
                        level: parentField.level + 1
                    };
                    this.interfaceForm.fields.splice(parentIndex + 1, 0, newField);
                },
                removeField(index) {
                    const field = this.interfaceForm.fields[index];
                    // 删除该字段及其所有子字段
                    const fieldsToRemove = [index];
                    for (let i = index + 1; i < this.interfaceForm.fields.length; i++) {
                        if (this.interfaceForm.fields[i].level > field.level) {
                            fieldsToRemove.push(i);
                        } else {
                            break;
                        }
                    }
                    // 从后往前删除，避免索引变化
                    fieldsToRemove.reverse().forEach(idx => {
                        this.interfaceForm.fields.splice(idx, 1);
                    });
                },
                onFieldTypeChange(field, index) {
                    // 当字段类型改变时，如果不是object或array，删除其子字段
                    if (field.type !== 'object' && field.type !== 'array') {
                        const childIndices = [];
                        for (let i = index + 1; i < this.interfaceForm.fields.length; i++) {
                            if (this.interfaceForm.fields[i].level > field.level) {
                                childIndices.push(i);
                            } else {
                                break;
                            }
                        }
                        childIndices.reverse().forEach(idx => {
                            this.interfaceForm.fields.splice(idx, 1);
                        });
                    }
                },
                getMethodTagType(method) {
                    const types = {
                        GET: 'success',
                        POST: 'primary',
                        PUT: 'warning',
                        DELETE: 'danger'
                    };
                    return types[method] || 'info';
                },
                viewInterfaceDetail(interface) {
                    // 模拟接口详情数据，包含嵌套字段结构
                    this.interfaceDetail = {
                        ...interface,
                        fields: [
                            { id: 1, name: 'orderId', type: 'string', required: true, description: '订单ID', level: 0 },
                            { id: 2, name: 'customerInfo', type: 'object', required: true, description: '客户信息', level: 0 },
                            { id: 3, name: 'name', type: 'string', required: true, description: '客户姓名', level: 1 },
                            { id: 4, name: 'phone', type: 'string', required: true, description: '联系电话', level: 1 },
                            { id: 5, name: 'address', type: 'object', required: false, description: '地址信息', level: 1 },
                            { id: 6, name: 'province', type: 'string', required: true, description: '省份', level: 2 },
                            { id: 7, name: 'city', type: 'string', required: true, description: '城市', level: 2 },
                            { id: 8, name: 'products', type: 'array', required: true, description: '产品列表', level: 0 },
                            { id: 9, name: 'productId', type: 'string', required: true, description: '产品ID', level: 1 },
                            { id: 10, name: 'quantity', type: 'number', required: true, description: '数量', level: 1 }
                        ]
                    };
                    this.interfaceDetailVisible = true;
                },
                getFieldTypeColor(type) {
                    const colors = {
                        string: 'primary',
                        number: 'success',
                        boolean: 'warning',
                        object: 'info',
                        array: 'danger'
                    };
                    return colors[type] || 'info';
                },
                
                // 任务管理方法
                showTaskWizard() {
                    this.taskWizardStep = 0;
                    this.taskForm = {
                        name: '',
                        description: '',
                        sourcePlatformId: '',
                        sourceInterfaceId: '',
                        targetPlatformId: '',
                        targetInterfaceId: ''
                    };
                    this.fieldMappings = [];
                    this.taskWizardVisible = true;
                },
                editTaskDetail(task) {
                    // 初始化编辑表单数据
                    this.taskDetailForm = {
                        ...task,
                        sourcePlatformName: this.getSelectedPlatformName(task.sourceInfo.platformId),
                        sourceInterfaceName: task.sourceInfo.interfaceName,
                        targetPlatformName: this.getSelectedPlatformName(task.targetInfo.platformId),
                        targetInterfaceName: task.targetInfo.interfaceName
                    };
                    
                    // 初始化编辑向导数据
                    this.taskEditWizardStep = 0;
                    
                    // 设置源平台和接口
                    this.editSourceInterfaces = this.interfaces.filter(i => i.platformId == task.sourceInfo.platformId);
                    this.editTargetInterfaces = this.interfaces.filter(i => i.platformId == task.targetInfo.platformId);
                    
                    // 模拟加载字段数据
                    this.editSourceFields = [
                        { name: 'mainOrderNo', type: 'string', required: true },
                        { name: 'orderNo', type: 'string', required: true },
                        { name: 'department', type: 'number', required: true },
                        { name: 'customerInfo', type: 'object', required: true },
                        { name: 'accessAddress', type: 'string', required: false }
                    ];
                    this.editTargetFields = [
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'orderNumber', type: 'string', required: true },
                        { name: 'deptCode', type: 'number', required: true },
                        { name: 'customer', type: 'object', required: true },
                        { name: 'address', type: 'string', required: false }
                    ];
                    
                    // 模拟现有的字段映射
                    this.editFieldMappings = [
                        { sourceField: 'mainOrderNo', targetField: 'orderId', transform: '直接映射' },
                        { sourceField: 'orderNo', targetField: 'orderNumber', transform: '直接映射' },
                        { sourceField: 'department', targetField: 'deptCode', transform: '直接映射' }
                    ];
                    
                    this.taskEditDialogVisible = true;
                },
                deleteTask(task) {
                    ElMessageBox.confirm('确认删除该任务吗？', '确认删除', {
                        type: 'warning'
                    }).then(() => {
                        ElMessage.success('删除成功');
                    });
                },
                toggleTaskStatus(task) {
                    const action = task.status === 'enabled' ? '停用' : '启用';
                    task.status = task.status === 'enabled' ? 'disabled' : 'enabled';
                    ElMessage.success(`任务${action}成功`);
                },
                viewTaskDetail(task) {
                    this.taskDetailForm = {
                        ...task,
                        sourcePlatformName: this.getSelectedPlatformName(task.sourceInfo.platformId),
                        sourceInterfaceName: task.sourceInfo.interfaceName,
                        targetPlatformName: this.getSelectedPlatformName(task.targetInfo.platformId),
                        targetInterfaceName: task.targetInfo.interfaceName
                    };
                    this.taskDetailDialogVisible = true;
                },
                saveTaskEdit() {
                    // 这里可以添加表单验证逻辑
                    ElMessage.success('任务编辑保存成功');
                    this.taskEditDialogVisible = false;
                },
                nextEditStep() {
                    if (this.taskEditWizardStep < 2) {
                        this.taskEditWizardStep++;
                    }
                },
                prevEditStep() {
                    if (this.taskEditWizardStep > 0) {
                        this.taskEditWizardStep--;
                    }
                },
                onEditSourcePlatformChange() {
                    this.editSourceInterfaces = this.interfaces.filter(i => i.platformId == this.taskDetailForm.sourceInfo.platformId);
                    this.taskDetailForm.sourceInfo.interfaceId = '';
                    this.editSourceFields = [];
                    this.editFieldMappings = [];
                },
                onEditTargetPlatformChange() {
                    this.editTargetInterfaces = this.interfaces.filter(i => i.platformId == this.taskDetailForm.targetInfo.platformId);
                    this.taskDetailForm.targetInfo.interfaceId = '';
                    this.editTargetFields = [];
                    this.editFieldMappings = [];
                },
                onEditSourceInterfaceChange() {
                    // 模拟获取源接口字段
                    this.editSourceFields = [
                        { name: 'mainOrderNo', type: 'string', required: true },
                        { name: 'orderNo', type: 'string', required: true },
                        { name: 'department', type: 'number', required: true },
                        { name: 'customerInfo', type: 'object', required: true },
                        { name: 'accessAddress', type: 'string', required: false }
                    ];
                    this.editFieldMappings = [];
                },
                onEditTargetInterfaceChange() {
                    // 模拟获取目标接口字段
                    this.editTargetFields = [
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'orderNumber', type: 'string', required: true },
                        { name: 'deptCode', type: 'number', required: true },
                        { name: 'customer', type: 'object', required: true },
                        { name: 'address', type: 'string', required: false }
                    ];
                    this.editFieldMappings = [];
                },
                addEditMappingRow() {
                    this.editFieldMappings.push({
                        sourceField: '',
                        targetField: '',
                        transform: '直接映射'
                    });
                },
                removeEditMappingRow(index) {
                    this.editFieldMappings.splice(index, 1);
                },
                onEditMappingChange(index) {
                    // 当映射发生变化时的处理逻辑
                    const mapping = this.editFieldMappings[index];
                    if (mapping.sourceField && mapping.targetField) {
                        // 检查字段类型兼容性
                        const sourceField = this.editSourceFields.find(f => f.name === mapping.sourceField);
                        const targetField = this.editTargetFields.find(f => f.name === mapping.targetField);
                        if (sourceField && targetField && sourceField.type !== targetField.type) {
                            ElMessage.warning(`字段类型不匹配：${sourceField.type} → ${targetField.type}`);
                        }
                    }
                },
                autoMatchEditFields() {
                    this.editFieldMappings = [];
                    const matched = new Set();
                    
                    // 完全匹配
                    this.editSourceFields.forEach(sourceField => {
                        const exactMatch = this.editTargetFields.find(targetField => 
                            targetField.name === sourceField.name && !matched.has(targetField.name)
                        );
                        if (exactMatch) {
                            this.editFieldMappings.push({
                                sourceField: sourceField.name,
                                targetField: exactMatch.name,
                                transform: '直接映射'
                            });
                            matched.add(exactMatch.name);
                        }
                    });
                    
                    // 相似匹配
                    this.editSourceFields.forEach(sourceField => {
                        if (!this.editFieldMappings.find(m => m.sourceField === sourceField.name)) {
                            const similarMatch = this.editTargetFields.find(targetField => {
                                if (matched.has(targetField.name)) return false;
                                const sourceName = sourceField.name.toLowerCase();
                                const targetName = targetField.name.toLowerCase();
                                return sourceName.includes(targetName) || targetName.includes(sourceName) ||
                                       this.calculateSimilarity(sourceName, targetName) > 0.6;
                            });
                            if (similarMatch) {
                                this.editFieldMappings.push({
                                    sourceField: sourceField.name,
                                    targetField: similarMatch.name,
                                    transform: '直接映射'
                                });
                                matched.add(similarMatch.name);
                            }
                        }
                    });
                    
                    ElMessage.success(`智能匹配完成，共匹配 ${this.editFieldMappings.length} 个字段`);
                },
                clearAllEditMappings() {
                    ElMessageBox.confirm('确认清空所有映射关系吗？', '确认清空', {
                        type: 'warning'
                    }).then(() => {
                        this.editFieldMappings = [];
                        ElMessage.success('已清空所有映射');
                    });
                },
                onSourcePlatformChange() {
                    this.sourceInterfaces = this.interfaces.filter(i => i.platformId == this.taskForm.sourcePlatformId);
                    this.taskForm.sourceInterfaceId = '';
                    this.sourceFields = [];
                    this.fieldMappings = [];
                },
                onTargetPlatformChange() {
                    this.targetInterfaces = this.interfaces.filter(i => i.platformId == this.taskForm.targetPlatformId);
                    this.taskForm.targetInterfaceId = '';
                    this.targetFields = [];
                    this.fieldMappings = [];
                },
                onSourceInterfaceChange() {
                    // 模拟获取源接口字段
                    this.sourceFields = [
                        { name: 'mainOrderNo', type: 'string', required: true },
                        { name: 'orderNo', type: 'string', required: true },
                        { name: 'department', type: 'number', required: true },
                        { name: 'customerInfo', type: 'object', required: true },
                        { name: 'accessAddress', type: 'string', required: false }
                    ];
                    this.fieldMappings = [];
                },
                onTargetInterfaceChange() {
                    // 模拟获取目标接口字段
                    this.targetFields = [
                        { name: 'orderId', type: 'string', required: true },
                        { name: 'orderNumber', type: 'string', required: true },
                        { name: 'deptCode', type: 'number', required: true },
                        { name: 'customer', type: 'object', required: true },
                        { name: 'address', type: 'string', required: false }
                    ];
                    this.fieldMappings = [];
                },
                addMappingRow() {
                    this.fieldMappings.push({
                        sourceField: '',
                        targetField: '',
                        transform: '直接映射'
                    });
                },
                removeMappingRow(index) {
                    this.fieldMappings.splice(index, 1);
                },
                onMappingChange(index) {
                    // 当映射发生变化时的处理逻辑
                    const mapping = this.fieldMappings[index];
                    if (mapping.sourceField && mapping.targetField) {
                        // 检查字段类型兼容性
                        const sourceField = this.sourceFields.find(f => f.name === mapping.sourceField);
                        const targetField = this.targetFields.find(f => f.name === mapping.targetField);
                        if (sourceField && targetField && sourceField.type !== targetField.type) {
                            ElMessage.warning(`字段类型不匹配：${sourceField.type} → ${targetField.type}`);
                        }
                    }
                },
                autoMatchFields() {
                    this.fieldMappings = [];
                    const matched = new Set();
                    
                    // 完全匹配
                    this.sourceFields.forEach(sourceField => {
                        const exactMatch = this.targetFields.find(targetField => 
                            targetField.name === sourceField.name && !matched.has(targetField.name)
                        );
                        if (exactMatch) {
                            this.fieldMappings.push({
                                sourceField: sourceField.name,
                                targetField: exactMatch.name,
                                transform: '直接映射'
                            });
                            matched.add(exactMatch.name);
                        }
                    });
                    
                    // 相似匹配
                    this.sourceFields.forEach(sourceField => {
                        if (!this.fieldMappings.find(m => m.sourceField === sourceField.name)) {
                            const similarMatch = this.targetFields.find(targetField => {
                                if (matched.has(targetField.name)) return false;
                                const sourceName = sourceField.name.toLowerCase();
                                const targetName = targetField.name.toLowerCase();
                                return sourceName.includes(targetName) || targetName.includes(sourceName) ||
                                       this.calculateSimilarity(sourceName, targetName) > 0.6;
                            });
                            if (similarMatch) {
                                this.fieldMappings.push({
                                    sourceField: sourceField.name,
                                    targetField: similarMatch.name,
                                    transform: '直接映射'
                                });
                                matched.add(similarMatch.name);
                            }
                        }
                    });
                    
                    ElMessage.success(`智能匹配完成，共匹配 ${this.fieldMappings.length} 个字段`);
                },
                calculateSimilarity(str1, str2) {
                    const longer = str1.length > str2.length ? str1 : str2;
                    const shorter = str1.length > str2.length ? str2 : str1;
                    const editDistance = this.getEditDistance(longer, shorter);
                    return (longer.length - editDistance) / longer.length;
                },
                getEditDistance(str1, str2) {
                    const matrix = [];
                    for (let i = 0; i <= str2.length; i++) {
                        matrix[i] = [i];
                    }
                    for (let j = 0; j <= str1.length; j++) {
                        matrix[0][j] = j;
                    }
                    for (let i = 1; i <= str2.length; i++) {
                        for (let j = 1; j <= str1.length; j++) {
                            if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                                matrix[i][j] = matrix[i - 1][j - 1];
                            } else {
                                matrix[i][j] = Math.min(
                                    matrix[i - 1][j - 1] + 1,
                                    matrix[i][j - 1] + 1,
                                    matrix[i - 1][j] + 1
                                );
                            }
                        }
                    }
                    return matrix[str2.length][str1.length];
                },
                clearAllMappings() {
                    ElMessageBox.confirm('确认清空所有映射关系吗？', '确认清空', {
                        type: 'warning'
                    }).then(() => {
                        this.fieldMappings = [];
                        ElMessage.success('已清空所有映射');
                    });
                },
                saveTask() {
                    ElMessage.success('任务保存并激活成功');
                    this.taskWizardVisible = false;
                },
                saveDraftTask() {
                    ElMessage.success('任务保存为草稿成功');
                    this.taskWizardVisible = false;
                },
                getTaskStatusTagType(status) {
                    const types = {
                        enabled: 'success',
                        disabled: 'warning'
                    };
                    return types[status] || 'info';
                },
                getTaskStatusText(status) {
                    const texts = {
                        enabled: '启用',
                        disabled: '停用'
                    };
                    return texts[status] || status;
                },
                getSelectedPlatformName(platformId) {
                    const platform = this.platforms.find(p => p.id == platformId);
                    return platform ? platform.name : '';
                },
                getSelectedInterfaceName(interfaceId) {
                    const interface = this.interfaces.find(i => i.id == interfaceId);
                    return interface ? interface.name : '';
                },
                
                // 日志管理方法
                searchLogs() {
                    ElMessage.success('查询完成');
                },
                viewLogDetail(log) {
                    this.logDetail = {
                        originalRequest: JSON.stringify({
                            "mainOrderNo": "MO202401200001",
                            "orderNo": "O202401200001",
                            "department": 1001,
                            "customerInfo": {
                                "name": "张三",
                                "phone": "13800138000"
                            },
                            "accessAddress": "贵州省贵阳市云岩区"
                        }, null, 2),
                        transformedRequest: JSON.stringify({
                            "orderId": "O202401200001",
                            "orderNumber": "MO202401200001",
                            "deptCode": 1001,
                            "customer": {
                                "name": "张三",
                                "phone": "13800138000"
                            },
                            "address": "贵州省贵阳市云岩区"
                        }, null, 2),
                        targetResponse: JSON.stringify({
                            "code": 200,
                            "message": "success",
                            "data": {
                                "syncId": "SYNC202401200001",
                                "status": "completed"
                            }
                        }, null, 2),
                        errorMessage: log.errorMessage
                    };
                    this.logDetailVisible = true;
                },
                copyToClipboard(text) {
                    navigator.clipboard.writeText(text).then(() => {
                        ElMessage.success('已复制到剪贴板');
                    });
                },
                
                // 通用方法
                navigateToProfile() {
                    ElMessage.info('跳转到个人中心');
                },
                navigateToPassword() {
                    ElMessage.info('跳转到修改密码');
                },
                logout() {
                    ElMessageBox.confirm('确认退出登录吗？', '确认退出', {
                        type: 'warning'
                    }).then(() => {
                        ElMessage.success('退出成功');
                    });
                }
            },
            mounted() {
                // 初始化
                this.activeTab = 'platform';
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>