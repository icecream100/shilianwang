<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视联网适配中心 - 业务采集模块</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sidebar {
            width: 250px;
            background: #001529;
            color: white;
            height: 100vh;
            overflow-y: auto;
        }
        .main-content {
            flex: 1;
            background: #f5f5f5;
            overflow-y: auto;
        }
        .el-menu {
            border-right: none;
        }
        .el-menu--dark {
            background-color: #001529;
        }
        .el-menu-item.is-active {
            background-color: #1890ff !important;
        }
        .el-submenu__title:hover {
            background-color: #1890ff !important;
        }
        .el-menu-item:hover {
            background-color: #1890ff !important;
        }
        .content-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status-online {
            color: #52c41a;
        }
        .status-offline {
            color: #ff4d4f;
        }
        .status-connecting {
            color: #faad14;
        }
        .status-unknown {
            color: #8c8c8c;
        }
        
        /* 状态标签样式 */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-badge-connected {
            background-color: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .status-badge-disconnected {
            background-color: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .status-badge-connecting {
            background-color: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .status-badge-enabled {
            background-color: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .status-badge-disabled {
            background-color: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        /* 方法标签样式 */
        .method-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .method-get {
            background-color: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .method-post {
            background-color: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .method-put {
            background-color: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .method-delete {
            background-color: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .method-patch {
            background-color: rgba(147, 51, 234, 0.1);
            color: #7c3aed;
            border: 1px solid rgba(147, 51, 234, 0.2);
        }
        
        /* 平台类型标签 */
        .platform-badge {
            background-color: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        /* 表格美化 */
        .el-table .el-table__header-wrapper th {
            background: #f5f7fa !important;
            color: #333 !important;
            font-size: 12px !important;
            font-weight: bold !important;
        }
        .el-table .el-table__body-wrapper td {
            color: #333 !important;
            font-size: 12px !important;
        }
        
        /* 参数配置器样式 */
        .param-config-container {
            border: 1px solid #e4e7ed;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .param-config-header {
            background: #f5f7fa;
            padding: 12px 16px;
            border-bottom: 1px solid #e4e7ed;
            font-weight: 600;
            color: #303133;
        }
        
        .param-config-content {
            padding: 16px;
        }
        
        .param-tree-item {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .param-tree-item:last-child {
            border-bottom: none;
        }
        
        .param-tree-indent {
            margin-left: 20px;
        }
        
        .param-tree-indent-2 {
            margin-left: 40px;
        }
        
        .param-tree-indent-3 {
            margin-left: 60px;
        }
        
        .param-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        /* 字段映射样式 */
        .mapping-container {
            border: 1px solid #e4e7ed;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .mapping-header {
            background: #f5f7fa;
            padding: 12px 16px;
            border-bottom: 1px solid #e4e7ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mapping-stats {
            font-size: 12px;
            color: #909399;
        }
        
        .mapping-stats-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .mapping-progress {
            display: flex;
            align-items: center;
        }
        
        .mapping-content {
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* 表格样式的字段映射 */
        .mapping-table-container {
            background: white;
        }
        
        .mapping-table-header {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1fr 1fr;
            gap: 16px;
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }
        
        .mapping-table-body {
            background: white;
        }
        
        .mapping-table-row {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1fr 1fr;
            gap: 16px;
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
        }
        
        .mapping-table-row:last-child {
            border-bottom: none;
        }
        
        .mapping-table-row:hover {
            background: #f8f9fa;
        }
        
        .mapping-col-source {
            display: flex;
            align-items: center;
        }
        
        .mapping-col-target {
            display: flex;
            align-items: center;
        }
        
        .mapping-col-type {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mapping-col-required {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mapping-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .mapping-item:last-child {
            border-bottom: none;
        }
        
        .mapping-target-field {
            min-width: 200px;
            font-weight: 500;
        }
        
        .mapping-required {
            color: #f56c6c;
        }
        
        .mapping-source-select {
            flex: 1;
            max-width: 300px;
        }
        
        /* 步骤条样式 */
        .wizard-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .wizard-header {
            background: #f5f7fa;
            padding: 20px;
            border-bottom: 1px solid #e4e7ed;
        }
        
        .wizard-content {
            padding: 24px;
            min-height: 500px;
        }
        
        .wizard-footer {
            padding: 16px 24px;
            border-top: 1px solid #e4e7ed;
            background: #fafafa;
            display: flex;
            justify-content: space-between;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            .mapping-item {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            .mapping-target-field {
                min-width: auto;
            }
            .mapping-source-select {
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="flex h-screen">
            <!-- 左侧导航 -->
            <div class="sidebar">
                <div class="p-4 border-b border-gray-600">
                    <h2 class="text-lg font-bold text-white">视联网适配中心</h2>
                </div>
                <el-menu
                    :default-active="activeMenu"
                    class="el-menu-vertical-demo"
                    background-color="#001529"
                    text-color="#fff"
                    active-text-color="#fff"
                    :collapse="false"
                    @select="handleMenuSelect">
                    
                    <el-sub-menu index="1">
                        <template #title>
                            <el-icon><Monitor /></el-icon>
                            <span>运营门户</span>
                        </template>
                        <el-menu-item index="1-1">运营门户</el-menu-item>
                        <el-menu-item index="1-2">客户管理</el-menu-item>
                        <el-menu-item index="1-3">运营分析</el-menu-item>
                        <el-menu-item index="1-4">系统设置</el-menu-item>
                        <el-menu-item index="1-5">日志管理</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="2">
                        <template #title>
                            <el-icon><Connection /></el-icon>
                            <span>接口适配</span>
                        </template>
                        <el-menu-item index="2-1">视联网平台管理</el-menu-item>
                        <el-menu-item index="2-2">设备管理</el-menu-item>
                        <el-menu-item index="2-3">通道管理</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="3">
                        <template #title>
                            <el-icon><DataAnalysis /></el-icon>
                            <span>业务采集</span>
                        </template>
                        <el-menu-item index="platform-mgmt">业务平台管理</el-menu-item>
                        <el-menu-item index="interface-mgmt">接口管理</el-menu-item>
                        <el-menu-item index="task-mgmt">任务管理</el-menu-item>
                        <el-menu-item index="log-mgmt">同步记录</el-menu-item>
                    </el-sub-menu>
                </el-menu>
            </div>

            <!-- 主内容区域 -->
            <div class="main-content">
                <!-- 顶部导航栏 -->
                <div class="bg-white border-b border-gray-200 px-6 py-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-xl font-semibold text-gray-800">业务采集模块</h1>
                            <p class="text-sm text-gray-600 mt-1">{{ getPageDescription() }}</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <!-- 用户信息 -->
                            <el-dropdown trigger="click">
                                <div class="flex items-center cursor-pointer px-3 py-2 rounded-lg hover:bg-gray-100">
                                    <el-avatar size="small" class="mr-2">
                                        <i class="el-icon-user"></i>
                                    </el-avatar>
                                    <span class="text-gray-700 font-medium">管理员</span>
                                    <i class="el-icon-arrow-down ml-1 text-gray-500"></i>
                                </div>
                                <template #dropdown>
                                    <el-dropdown-menu>
                                        <el-dropdown-item>
                                            <i class="el-icon-user mr-2"></i>个人中心
                                        </el-dropdown-item>
                                        <el-dropdown-item>
                                            <i class="el-icon-key mr-2"></i>修改密码
                                        </el-dropdown-item>
                                        <el-dropdown-item divided>
                                            <i class="el-icon-switch-button mr-2"></i>退出登录
                                        </el-dropdown-item>
                                    </el-dropdown-menu>
                                </template>
                            </el-dropdown>
                        </div>
                    </div>
                </div>

                <!-- 内容区域 -->
                <div class="p-6">
                    <!-- 业务平台管理 -->
                    <div v-show="activeTab === 'platform-mgmt'">
                        <div class="content-card p-6">
                            <!-- 筛选查询区域 -->
                            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                                <div class="flex justify-between items-center">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1">
                                        <div class="flex items-center space-x-3">
                                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">平台名称/连接地址:</label>
                                            <el-input
                                                v-model="platformSearch"
                                                placeholder="请输入平台名称或连接地址"
                                                clearable
                                                style="flex: 1">
                                                <template #prefix>
                                                    <el-icon><Search /></el-icon>
                                                </template>
                                            </el-input>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">连接类型:</label>
                                            <el-select v-model="platformTypeFilter" placeholder="全部类型" clearable style="flex: 1">
                                                <el-option label="全部类型" value=""></el-option>
                                                <el-option label="HTTP" value="HTTP"></el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3 ml-4">
                                        <el-button type="primary" @click="searchPlatforms">
                                            <el-icon><Search /></el-icon>
                                            查询
                                        </el-button>
                                        <el-button @click="resetPlatformFilters">
                                            <el-icon><RefreshLeft /></el-icon>
                                            重置
                                        </el-button>
                                        <el-button type="success" @click="showAddPlatformDialog">
                                            <el-icon><Plus /></el-icon>
                                            新增平台
                                        </el-button>
                                    </div>
                                </div>
                            </div>

                            <!-- 平台列表 -->
                            <el-table :data="filteredPlatforms" style="width: 100%" stripe>
                                <el-table-column prop="name" label="平台名称" width="150">
                                    <template #default="scope">
                                        <span class="font-medium">{{ scope.row.name }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="type" label="平台类型" width="100">
                                    <template #default="scope">
                                        <span class="status-badge platform-badge">{{ scope.row.type }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="baseUrl" label="连接地址" width="200">
                                    <template #default="scope">
                                        <span class="text-blue-600">{{ scope.row.baseUrl }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="description" label="平台描述" width="200">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.description || '-' }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="status" label="连接状态" width="100">
                                    <template #default="scope">
                                        <span :class="getStatusBadgeClass(scope.row.status)">
                                            {{ getStatusText(scope.row.status) }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="createTime" label="新增时间" width="150">
                                    <template #default="scope">
                                        <span class="text-gray-500">{{ scope.row.createTime }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="200" fixed="right">
                                    <template #default="scope">
                                        <el-button size="small" @click="viewPlatformDetail(scope.row)">详情</el-button>
                                        <el-button size="small" type="primary" @click="editPlatform(scope.row)">编辑</el-button>
                                        <el-button size="small" type="warning" @click="testConnection(scope.row)">测试连接</el-button>
                                        <el-button size="small" type="danger" @click="deletePlatform(scope.row)">删除</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="platformCurrentPage"
                                    v-model:page-size="platformPageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="platforms.length"
                                    layout="total, sizes, prev, pager, next, jumper">
                                </el-pagination>
                            </div>
                        </div>
                    </div>

                    <!-- 接口管理 -->
                    <div v-show="activeTab === 'interface-mgmt'">
                        <div class="content-card p-6">
                            <!-- 筛选查询区域 -->
                            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                                <div class="flex justify-between items-center">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1">
                                        <div class="flex items-center space-x-3">
                                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">接口名称/路径:</label>
                                            <el-input
                                                v-model="interfaceSearch"
                                                placeholder="请输入接口名称或路径"
                                                clearable
                                                style="flex: 1">
                                                <template #prefix>
                                                    <el-icon><Search /></el-icon>
                                                </template>
                                            </el-input>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">所属平台:</label>
                                            <el-select v-model="interfacePlatformFilter" placeholder="全部平台" clearable style="flex: 1">
                                                <el-option label="全部平台" value=""></el-option>
                                                <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3 ml-4">
                                        <el-button type="primary" @click="searchInterfaces">
                                            <el-icon><Search /></el-icon>
                                            查询
                                        </el-button>
                                        <el-button @click="resetInterfaceFilters">
                                            <el-icon><RefreshLeft /></el-icon>
                                            重置
                                        </el-button>
                                        <el-button type="success" @click="showAddInterfaceDialog">
                                            <el-icon><Plus /></el-icon>
                                            新增接口
                                        </el-button>
                                    </div>
                                </div>
                            </div>

                            <!-- 接口列表 -->
                            <el-table :data="filteredInterfaces" style="width: 100%" stripe>
                                <el-table-column prop="name" label="接口名称" width="150">
                                    <template #default="scope">
                                        <span class="font-medium">{{ scope.row.name }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="platformName" label="所属平台" width="120">
                                    <template #default="scope">
                                        <span class="text-blue-600">{{ scope.row.platformName }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="path" label="接口路径" width="180">
                                    <template #default="scope">
                                        <span class="font-mono text-sm">{{ scope.row.path }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="method" label="请求方法" width="100">
                                    <template #default="scope">
                                        <span :class="getMethodBadgeClass(scope.row.method)">{{ scope.row.method }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="fieldCount" label="字段数量" width="100">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.fieldCount }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="description" label="接口描述" width="200">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.description || '-' }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="createTime" label="新增时间" width="150">
                                    <template #default="scope">
                                        <span class="text-gray-500">{{ scope.row.createTime }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="180" fixed="right">
                                    <template #default="scope">
                                        <el-button size="small" @click="viewInterfaceDetail(scope.row)">详情</el-button>
                                        <el-button size="small" type="primary" @click="editInterface(scope.row)">编辑</el-button>
                                        <el-button size="small" type="danger" @click="deleteInterface(scope.row)">删除</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="interfaceCurrentPage"
                                    v-model:page-size="interfacePageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="interfaces.length"
                                    layout="total, sizes, prev, pager, next, jumper">
                                </el-pagination>
                            </div>
                        </div>
                    </div>

                    <!-- 任务管理 -->
                    <div v-show="activeTab === 'task-mgmt'">
                        <div class="content-card p-6">
                            <!-- 筛选查询区域 -->
                            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                                <div class="flex justify-between items-center">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-1">
                                        <div class="flex items-center space-x-3">
                                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">任务名称:</label>
                                            <el-input
                                                v-model="taskSearch"
                                                placeholder="请输入任务名称"
                                                clearable
                                                style="flex: 1">
                                                <template #prefix>
                                                    <el-icon><Search /></el-icon>
                                                </template>
                                            </el-input>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">任务状态:</label>
                                            <el-select v-model="taskStatusFilter" placeholder="全部状态" clearable style="flex: 1">
                                                <el-option label="全部状态" value=""></el-option>
                                                <el-option label="启用" value="enabled"></el-option>
                                                <el-option label="停用" value="disabled"></el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3 ml-4">
                                        <el-button type="primary" @click="searchTasks">
                                            <el-icon><Search /></el-icon>
                                            查询
                                        </el-button>
                                        <el-button @click="resetTaskFilters">
                                            <el-icon><RefreshLeft /></el-icon>
                                            重置
                                        </el-button>
                                        <el-button type="success" @click="showAddTaskWizard">
                                            <el-icon><Plus /></el-icon>
                                            新增任务
                                        </el-button>
                                    </div>
                                </div>
                            </div>

                            <!-- 任务列表 -->
                            <el-table :data="filteredTasks" style="width: 100%" stripe>
                                <el-table-column prop="name" label="任务名称" width="150">
                                    <template #default="scope">
                                        <span class="font-medium">{{ scope.row.name }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="sourcePlatform" label="源平台/接口" width="180">
                                    <template #default="scope">
                                        <span class="text-blue-600">{{ scope.row.sourcePlatform }}/{{ scope.row.sourceInterface }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="targetPlatform" label="目标平台/接口" width="180">
                                    <template #default="scope">
                                        <span class="text-green-600">{{ scope.row.targetPlatform }}/{{ scope.row.targetInterface }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="status" label="状态" width="80">
                                    <template #default="scope">
                                        <span :class="scope.row.status === 'enabled' ? 'status-badge status-badge-enabled' : 'status-badge status-badge-disabled'">
                                            {{ scope.row.status === 'enabled' ? '启用' : '停用' }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="runMode" label="运行模式" width="100">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.runMode }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="schedule" label=运行计划" width="150">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.schedule || '--' }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="lastRun" label="最近运行" width="150">
                                    <template #default="scope">
                                        <span class="text-gray-500">{{ scope.row.lastRun || '--' }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="createTime" label="新增时间" width="150">
                                    <template #default="scope">
                                        <span class="text-gray-500">{{ scope.row.createTime }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="200" fixed="right">
                                    <template #default="scope">
                                        <el-button size="small" @click="viewTaskDetail(scope.row)">详情</el-button>
                                        <el-button size="small" type="primary" @click="editTask(scope.row)">编辑</el-button>
                                        <el-button size="small" :type="scope.row.status === 'enabled' ? 'warning' : 'success'" 
                                                   @click="toggleTaskStatus(scope.row)">
                                            {{ scope.row.status === 'enabled' ? '停用' : '启用' }}
                                        </el-button>
                                        <el-button size="small" type="danger" @click="deleteTask(scope.row)">删除</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="taskCurrentPage"
                                    v-model:page-size="taskPageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="tasks.length"
                                    layout="total, sizes, prev, pager, next, jumper">
                                </el-pagination>
                            </div>
                        </div>
                    </div>

                    <!-- 同步日志 -->
                    <div v-show="activeTab === 'log-mgmt'">
                        <div class="content-card p-6">
                            <!-- 筛选查询区域 -->
                            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                                <div class="flex justify-between items-center">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 flex-1">
                                        <div class="flex items-center space-x-3">
                                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">任务名称:</label>
                                            <el-select v-model="logTaskFilter" placeholder="全部任务" clearable style="flex: 1">
                                                <el-option label="全部任务" value=""></el-option>
                                                <el-option v-for="task in tasks" :key="task.id" :label="task.name" :value="task.id"></el-option>
                                            </el-select>
                                        </div>
                                        <div class="flex items-center space-x-3">
                                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">同步状态:</label>
                                            <el-select v-model="logStatusFilter" placeholder="全部状态" clearable style="flex: 1">
                                                <el-option label="全部状态" value=""></el-option>
                                                <el-option label="成功" value="success"></el-option>
                                                <el-option label="失败" value="failed"></el-option>
                                                <el-option label="运行中" value="running"></el-option>
                                            </el-select>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3 ml-4">
                                        <el-button type="primary" @click="searchLogs">
                                            <el-icon><Search /></el-icon>
                                            查询
                                        </el-button>
                                        <el-button @click="resetLogFilters">
                                            <el-icon><RefreshLeft /></el-icon>
                                            重置
                                        </el-button>
                                    </div>
                                </div>
                            </div>

                            <!-- 日志列表 -->
                            <el-table :data="filteredLogs" style="width: 100%" stripe>
                                <el-table-column prop="executeTime" label="同步时间" width="170">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.executeTime }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="taskName" label="任务名称" width="150">
                                    <template #default="scope">
                                        <span class="font-medium">{{ scope.row.taskName }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="sourcePlatform" label="源平台" width="140">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.sourcePlatform || '-' }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="sourceInterface" label="源接口" width="140">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.sourceInterface || '-' }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="targetPlatform" label="目标平台" width="140">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.targetPlatform || '-' }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="targetInterface" label="目标接口" width="140">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.targetInterface || '-' }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="status" label="同步状态" width="100">
                                    <template #default="scope">
                                        <span :class="getLogStatusBadgeClass(scope.row.status)">
                                            {{ getLogStatusText(scope.row.status) }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="duration" label="耗时" width="100">
                                    <template #default="scope">
                                        <span class="text-gray-600">{{ scope.row.duration }}ms</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="120" fixed="right">
                                    <template #default="scope">
                                        <el-button size="small" @click="viewLogDetail(scope.row)">查看</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="flex justify-center mt-6">
                                <el-pagination
                                    v-model:current-page="logCurrentPage"
                                    v-model:page-size="logPageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="logs.length"
                                    layout="total, sizes, prev, pager, next, jumper">
                                </el-pagination>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新增/编辑平台对话框 -->
        <el-dialog
            v-model="platformDialogVisible"
            :title="platformDialogMode === 'add' ? '新增平台' : '编辑平台'"
            width="600px"
            :close-on-click-modal="false">
            <el-form :model="platformForm" :rules="platformRules" ref="platformFormRef" label-width="120px">
                <el-form-item label="平台名称" prop="name">
                    <el-input v-model="platformForm.name" placeholder="请输入平台名称"></el-input>
                </el-form-item>
                <el-form-item label="平台描述" prop="description">
                    <el-input v-model="platformForm.description" type="textarea" :rows="3" placeholder="请输入平台描述"></el-input>
                </el-form-item>
                <el-form-item label="连接类型" prop="type">
                    <el-select v-model="platformForm.type" placeholder="请选择连接类型" @change="onConnectionTypeChange" :disabled="platformDialogMode === 'edit'">
                        <el-option label="HTTP" value="HTTP"></el-option>
                    </el-select>
                </el-form-item>
                <div v-if="platformForm.type === 'HTTP'">
                    <el-form-item label="基础URL" prop="baseUrl">
                        <el-input v-model="platformForm.baseUrl" placeholder="https://api.example.com"></el-input>
                    </el-form-item>
                    <el-form-item label="认证方式" prop="authType">
                        <el-select v-model="platformForm.authType" placeholder="请选择认证方式" @change="onAuthTypeChange">
                            <el-option label="无认证" value="none"></el-option>
                            <el-option label="API Key" value="apikey"></el-option>
                            <el-option label="Bearer Token" value="bearer"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item v-if="platformForm.authType === 'apikey'" label="API Key" prop="apiKey">
                        <el-input v-model="platformForm.apiKey" placeholder="请输入API Key"></el-input>
                    </el-form-item>
                    <el-form-item v-if="platformForm.authType === 'bearer'" label="Token" prop="token">
                        <el-input v-model="platformForm.token" placeholder="请输入Bearer Token"></el-input>
                    </el-form-item>
                </div>
            </el-form>
            <template #footer>
                <div class="flex justify-between">
                    <el-button @click="testPlatformConnection" :loading="testingConnection">测试连接</el-button>
                    <div>
                        <el-button @click="platformDialogVisible = false">取消</el-button>
                        <el-button type="primary" @click="savePlatform" :loading="savingPlatform">保存</el-button>
                    </div>
                </div>
            </template>
        </el-dialog>

        <!-- 新增/编辑接口对话框 -->
        <el-dialog
            v-model="interfaceDialogVisible"
            :title="interfaceDialogMode === 'add' ? '新增接口' : '编辑接口'"
            width="900px"
            :close-on-click-modal="false">
            <el-form :model="interfaceForm" :rules="interfaceRules" ref="interfaceFormRef" label-width="120px">
                <el-form-item label="所属平台" prop="platformId">
                    <el-select v-model="interfaceForm.platformId" placeholder="请选择所属平台">
                        <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="接口名称" prop="name">
                    <el-input v-model="interfaceForm.name" placeholder="请输入接口名称"></el-input>
                </el-form-item>
                <el-form-item label="接口路径" prop="path">
                    <el-input v-model="interfaceForm.path" placeholder="/api/users"></el-input>
                </el-form-item>
                <el-form-item label="请求方法" prop="method">
                    <el-select v-model="interfaceForm.method" placeholder="请选择请求方法">
                        <el-option label="GET" value="GET"></el-option>
                        <el-option label="POST" value="POST"></el-option>
                        <el-option label="PUT" value="PUT"></el-option>
                        <el-option label="DELETE" value="DELETE"></el-option>
                        <el-option label="PATCH" value="PATCH"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="接口描述" prop="description">
                    <el-input v-model="interfaceForm.description" type="textarea" :rows="3" placeholder="请输入接口描述"></el-input>
                </el-form-item>
                
                <!-- 请求参数配置 -->
                <el-form-item label="请求参数配置">
                    <div class="param-config-container w-full">
                        <el-tabs v-model="activeParamTab" type="border-card">
                            <el-tab-pane label="Body" name="body">
                                <div class="param-config-content">
                                    <div class="flex justify-between items-center mb-4">
                                        <span class="text-sm text-gray-600">配置请求体参数，支持层级结构</span>
                                        <el-button size="small" type="primary" @click="addBodyParam()">
                                            <el-icon><Plus /></el-icon>
                                            添加一级参数
                                        </el-button>
                                    </div>
                                    <div v-if="interfaceForm.bodyParams.length === 0" class="text-center text-gray-400 py-8">
                                        暂无参数，点击上方按钮添加参数
                                    </div>
                                    <div v-else>
                                        <div v-for="(param, index) in interfaceForm.bodyParams" :key="param.id" class="param-tree-item">
                                            <div class="flex items-center gap-3">
                                                <el-input v-model="param.name" placeholder="参数名称" style="width: 150px"></el-input>
                                                <el-checkbox v-model="param.required">必填</el-checkbox>
                                                <el-select v-model="param.type" placeholder="数据类型" style="width: 120px" @change="onParamTypeChange(param)">
                                                    <el-option label="string" value="string"></el-option>
                                                    <el-option label="number" value="number"></el-option>
                                                    <el-option label="boolean" value="boolean"></el-option>
                                                    <el-option label="object" value="object"></el-option>
                                                    <el-option label="array" value="array"></el-option>
                                                </el-select>
                                                <el-input v-model="param.description" placeholder="备注" style="flex: 1"></el-input>
                                                <div class="param-actions">
                                                    <el-button v-if="param.type === 'object' || param.type === 'array'" size="small" @click="addChildParam(param)">
                                                        <el-icon><Plus /></el-icon>
                                                        添加子集
                                                    </el-button>
                                                    <el-button size="small" type="danger" @click="removeBodyParam(index)">
                                                        <el-icon><Delete /></el-icon>
                                                        删除
                                                    </el-button>
                                                </div>
                                            </div>
                                            <!-- 子参数 -->
                                            <div v-if="param.children && param.children.length > 0" class="param-tree-indent">
                                                <div v-for="(child, childIndex) in param.children" :key="child.id" class="param-tree-item">
                                                    <div class="flex items-center gap-3">
                                                        <el-input v-model="child.name" placeholder="参数名称" style="width: 150px"></el-input>
                                                        <el-checkbox v-model="child.required">必填</el-checkbox>
                                                        <el-select v-model="child.type" placeholder="数据类型" style="width: 120px">
                                                            <el-option label="string" value="string"></el-option>
                                                            <el-option label="number" value="number"></el-option>
                                                            <el-option label="boolean" value="boolean"></el-option>
                                                            <el-option label="object" value="object"></el-option>
                                                            <el-option label="array" value="array"></el-option>
                                                        </el-select>
                                                        <el-input v-model="child.description" placeholder="备注" style="flex: 1"></el-input>
                                                        <el-button size="small" type="danger" @click="removeChildParam(param, childIndex)">
                                                            <el-icon><Delete /></el-icon>
                                                            删除
                                                        </el-button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="Query" name="query">
                                <div class="param-config-content">
                                    <div class="flex justify-between items-center mb-4">
                                        <span class="text-sm text-gray-600">配置URL查询参数</span>
                                        <el-button size="small" type="primary" @click="addQueryParam()">
                                            <el-icon><Plus /></el-icon>
                                            添加参数
                                        </el-button>
                                    </div>
                                    <div v-if="interfaceForm.queryParams.length === 0" class="text-center text-gray-400 py-8">
                                        暂无参数，点击上方按钮添加参数
                                    </div>
                                    <div v-else>
                                        <div v-for="(param, index) in interfaceForm.queryParams" :key="param.id" class="param-tree-item">
                                            <div class="flex items-center gap-3">
                                                <el-input v-model="param.name" placeholder="参数名称" style="width: 150px"></el-input>
                                                <el-select v-model="param.required" placeholder="是否必填" style="width: 100px">
                                                    <el-option label="必填" :value="true"></el-option>
                                                    <el-option label="非必填" :value="false"></el-option>
                                                </el-select>
                                                <el-input v-model="param.example" placeholder="参数示例(必填)" style="width: 200px"></el-input>
                                                <el-input v-model="param.description" placeholder="备注" style="flex: 1"></el-input>
                                                <el-button size="small" type="danger" @click="removeQueryParam(index)">
                                                    <el-icon><Delete /></el-icon>
                                                    删除
                                                </el-button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="Headers" name="headers">
                                <div class="param-config-content">
                                    <div class="flex justify-between items-center mb-4">
                                        <span class="text-sm text-gray-600">配置请求头参数</span>
                                        <el-button size="small" type="primary" @click="addHeaderParam()">
                                            <el-icon><Plus /></el-icon>
                                            添加参数
                                        </el-button>
                                    </div>
                                    <div v-if="interfaceForm.headerParams.length === 0" class="text-center text-gray-400 py-8">
                                        暂无参数，点击上方按钮添加参数
                                    </div>
                                    <div v-else>
                                        <div v-for="(param, index) in interfaceForm.headerParams" :key="param.id" class="param-tree-item">
                                            <div class="flex items-center gap-3">
                                                <el-input v-model="param.name" placeholder="参数名称" style="width: 150px"></el-input>
                                                <el-select v-model="param.required" placeholder="是否必填" style="width: 100px">
                                                    <el-option label="必填" :value="true"></el-option>
                                                    <el-option label="非必填" :value="false"></el-option>
                                                </el-select>
                                                <el-input v-model="param.example" placeholder="参数示例(必填)" style="width: 200px"></el-input>
                                                <el-input v-model="param.description" placeholder="备注" style="flex: 1"></el-input>
                                                <el-button size="small" type="danger" @click="removeHeaderParam(index)">
                                                    <el-icon><Delete /></el-icon>
                                                    删除
                                                </el-button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="Path" name="path">
                                <div class="param-config-content">
                                    <div class="flex justify-between items-center mb-4">
                                        <span class="text-sm text-gray-600">配置路径参数</span>
                                        <el-button size="small" type="primary" @click="addPathParam()">
                                            <el-icon><Plus /></el-icon>
                                            添加参数
                                        </el-button>
                                    </div>
                                    <div v-if="interfaceForm.pathParams.length === 0" class="text-center text-gray-400 py-8">
                                        暂无参数，点击上方按钮添加参数
                                    </div>
                                    <div v-else>
                                        <div v-for="(param, index) in interfaceForm.pathParams" :key="param.id" class="param-tree-item">
                                            <div class="flex items-center gap-3">
                                                <el-input v-model="param.name" placeholder="参数名称" style="width: 150px"></el-input>
                                                <el-select v-model="param.required" placeholder="是否必填" style="width: 100px">
                                                    <el-option label="必填" :value="true"></el-option>
                                                    <el-option label="非必填" :value="false"></el-option>
                                                </el-select>
                                                <el-input v-model="param.example" placeholder="参数示例(必填)" style="width: 200px"></el-input>
                                                <el-input v-model="param.description" placeholder="备注" style="flex: 1"></el-input>
                                                <el-button size="small" type="danger" @click="removePathParam(index)">
                                                    <el-icon><Delete /></el-icon>
                                                    删除
                                                </el-button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </el-tab-pane>
                        </el-tabs>
                    </div>
                </el-form-item>
            </el-form>
            <template #footer>
                <div>
                    <el-button @click="interfaceDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveInterface" :loading="savingInterface">保存</el-button>
                </div>
            </template>
        </el-dialog>

        <!-- 新增任务向导对话框 -->
        <el-dialog
            v-model="taskWizardVisible"
            :title="taskWizardMode === 'edit' ? '编辑任务' : '新增任务'"
            width="1000px"
            :close-on-click-modal="false">
            <div class="wizard-container">
                <div class="wizard-header">
                    <el-steps :active="taskWizardStep" finish-status="success">
                        <el-step title="基本信息" description="配置任务基本信息"></el-step>
                        <el-step title="字段映射" description="配置字段映射关系"></el-step>
                        <el-step title="运行周期" description="配置任务运行计划"></el-step>
                    </el-steps>
                </div>
                <div class="wizard-content">
                    <!-- 步骤1：基本信息 -->
                    <div v-show="taskWizardStep === 0">
                        <el-form :model="taskForm" :rules="taskRules" ref="taskFormRef" label-width="120px">
                            <el-form-item label="任务名称" prop="name">
                                <el-input v-model="taskForm.name" placeholder="请输入任务名称"></el-input>
                            </el-form-item>
                            <el-form-item label="任务描述" prop="description">
                                <el-input v-model="taskForm.description" type="textarea" :rows="3" placeholder="请输入任务描述"></el-input>
                            </el-form-item>
                            <el-form-item label="源平台" prop="sourcePlatformId">
                                <el-select v-model="taskForm.sourcePlatformId" placeholder="请选择源平台" @change="onSourcePlatformChange">
                                    <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="源接口" prop="sourceInterfaceId">
                                <el-select v-model="taskForm.sourceInterfaceId" placeholder="请选择源接口" @change="onSourceInterfaceChange">
                                    <el-option v-for="interface in sourceInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="目标平台" prop="targetPlatformId">
                                <el-select v-model="taskForm.targetPlatformId" placeholder="请选择目标平台" @change="onTargetPlatformChange">
                                    <el-option v-for="platform in platforms" :key="platform.id" :label="platform.name" :value="platform.id"></el-option>
                                </el-select>
                            </el-form-item>
                            <el-form-item label="目标接口" prop="targetInterfaceId">
                                <el-select v-model="taskForm.targetInterfaceId" placeholder="请选择目标接口" @change="onTargetInterfaceChange">
                                    <el-option v-for="interface in targetInterfaces" :key="interface.id" :label="interface.name" :value="interface.id"></el-option>
                                </el-select>
                            </el-form-item>
                        </el-form>
                    </div>

                    <!-- 步骤2：字段映射 -->
                    <div v-show="taskWizardStep === 1">
                        <div class="mapping-container">
                            <div class="mapping-header">
                                <div>
                                    <h4 class="font-medium">字段映射配置</h4>
                                    <p class="text-sm text-gray-600 mt-1">为目标接口的参数选择对应的源字段</p>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="mapping-stats-container">
                                        <span class="mapping-stats">已映射: {{ mappedFieldsCount }}/{{ totalRequiredFields }}</span>
                                        <div class="mapping-progress">
                                            <el-progress 
                                                :percentage="totalRequiredFields > 0 ? Math.round((mappedFieldsCount / totalRequiredFields) * 100) : 0"
                                                :color="mappedFieldsCount === totalRequiredFields ? '#67C23A' : '#409EFF'"
                                                :stroke-width="6"
                                                :show-text="false"
                                                style="width: 120px;">
                                            </el-progress>
                                        </div>
                                    </div>
                                    <el-button size="small" @click="clearAllMappings">清空映射</el-button>
                                </div>
                            </div>
                            <el-tabs v-model="activeMappingTab" type="border-card">
                                <el-tab-pane label="Body参数映射" name="body">
                                    <div class="mapping-content">
                                        <div v-if="targetBodyFields.length === 0" class="text-center text-gray-400 py-8">
                                            请先选择目标接口
                                        </div>
                                        <div v-else class="mapping-table-container">
                                            <div class="mapping-table-header">
                                                <div class="mapping-col-source">源字段</div>
                                                <div class="mapping-col-target">目标字段</div>
                                                <div class="mapping-col-type">类型</div>
                                                <div class="mapping-col-required">必填</div>
                                            </div>
                                            <div class="mapping-table-body">
                                                <div v-for="field in targetBodyFields" :key="field.id" class="mapping-table-row">
                                                    <div class="mapping-col-source">
                                                        <el-select v-model="field.mappedSource" placeholder="选择源平台输出字段" class="w-full" clearable>
                                                            <el-option 
                                                                v-for="sourceField in sourceFields" 
                                                                :key="sourceField.id" 
                                                                :label="sourceField.name" 
                                                                :value="sourceField.id"
                                                                :disabled="selectedSourceFieldIds.includes(sourceField.id) && field.mappedSource !== sourceField.id">
                                                                <span>{{ sourceField.name }}</span>
                                                                <span v-if="selectedSourceFieldIds.includes(sourceField.id) && field.mappedSource !== sourceField.id" class="text-gray-400 ml-2">(已映射)</span>
                                                            </el-option>
                                                        </el-select>
                                                    </div>
                                                    <div class="mapping-col-target">
                                                        <span class="font-medium text-gray-900">{{ field.name }}</span>
                                                    </div>
                                                    <div class="mapping-col-type">
                                                        <span class="text-blue-600">{{ field.type }}</span>
                                                    </div>
                                                    <div class="mapping-col-required">
                                                        <span :class="field.required ? 'text-red-500 font-medium' : 'text-gray-500'">
                                                            {{ field.required ? '必填' : '选填' }}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </el-tab-pane>
                                <el-tab-pane label="Query参数映射" name="query">
                                    <div class="mapping-content">
                                        <div v-if="targetQueryFields.length === 0" class="text-center text-gray-400 py-8">
                                            目标接口无Query参数
                                        </div>
                                        <div v-else class="mapping-table-container">
                                            <div class="mapping-table-header">
                                                <div class="mapping-col-source">源字段</div>
                                                <div class="mapping-col-target">目标字段</div>
                                                <div class="mapping-col-type">类型</div>
                                                <div class="mapping-col-required">必填</div>
                                            </div>
                                            <div class="mapping-table-body">
                                                <div v-for="field in targetQueryFields" :key="field.id" class="mapping-table-row">
                                                    <div class="mapping-col-source">
                                                        <el-select v-model="field.mappedSource" placeholder="选择源平台输出字段" class="w-full" clearable>
                                                            <el-option 
                                                                v-for="sourceField in sourceFields" 
                                                                :key="sourceField.id" 
                                                                :label="sourceField.name" 
                                                                :value="sourceField.id"
                                                                :disabled="selectedSourceFieldIds.includes(sourceField.id) && field.mappedSource !== sourceField.id">
                                                                <span>{{ sourceField.name }}</span>
                                                                <span v-if="selectedSourceFieldIds.includes(sourceField.id) && field.mappedSource !== sourceField.id" class="text-gray-400 ml-2">(已映射)</span>
                                                            </el-option>
                                                        </el-select>
                                                    </div>
                                                    <div class="mapping-col-target">
                                                        <span class="font-medium text-gray-900">{{ field.name }}</span>
                                                    </div>
                                                    <div class="mapping-col-type">
                                                        <span class="text-blue-600">{{ field.type }}</span>
                                                    </div>
                                                    <div class="mapping-col-required">
                                                        <span :class="field.required ? 'text-red-500 font-medium' : 'text-gray-500'">
                                                            {{ field.required ? '必填' : '选填' }}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </el-tab-pane>
                                <el-tab-pane label="Headers参数映射" name="headers">
                                    <div class="mapping-content">
                                        <div v-if="targetHeaderFields.length === 0" class="text-center text-gray-400 py-8">
                                            目标接口无Headers参数
                                        </div>
                                        <div v-else class="mapping-table-container">
                                            <div class="mapping-table-header">
                                                <div class="mapping-col-source">源字段</div>
                                                <div class="mapping-col-target">目标字段</div>
                                                <div class="mapping-col-type">类型</div>
                                                <div class="mapping-col-required">必填</div>
                                            </div>
                                            <div class="mapping-table-body">
                                                <div v-for="field in targetHeaderFields" :key="field.id" class="mapping-table-row">
                                                    <div class="mapping-col-source">
                                                        <el-select v-model="field.mappedSource" placeholder="选择源平台输出字段" class="w-full" clearable>
                                                            <el-option 
                                                                v-for="sourceField in sourceFields" 
                                                                :key="sourceField.id" 
                                                                :label="sourceField.name" 
                                                                :value="sourceField.id"
                                                                :disabled="selectedSourceFieldIds.includes(sourceField.id) && field.mappedSource !== sourceField.id">
                                                                <span>{{ sourceField.name }}</span>
                                                                <span v-if="selectedSourceFieldIds.includes(sourceField.id) && field.mappedSource !== sourceField.id" class="text-gray-400 ml-2">(已映射)</span>
                                                            </el-option>
                                                        </el-select>
                                                    </div>
                                                    <div class="mapping-col-target">
                                                        <span class="font-medium text-gray-900">{{ field.name }}</span>
                                                    </div>
                                                    <div class="mapping-col-type">
                                                        <span class="text-blue-600">{{ field.type }}</span>
                                                    </div>
                                                    <div class="mapping-col-required">
                                                        <span :class="field.required ? 'text-red-500 font-medium' : 'text-gray-500'">
                                                            {{ field.required ? '必填' : '选填' }}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </el-tab-pane>
                                <el-tab-pane label="Path参数映射" name="path">
                                    <div class="mapping-content">
                                        <div v-if="targetPathFields.length === 0" class="text-center text-gray-400 py-8">
                                            目标接口无Path参数
                                        </div>
                                        <div v-else class="mapping-table-container">
                                            <div class="mapping-table-header">
                                                <div class="mapping-col-source">源字段</div>
                                                <div class="mapping-col-target">目标字段</div>
                                                <div class="mapping-col-type">类型</div>
                                                <div class="mapping-col-required">必填</div>
                                            </div>
                                            <div class="mapping-table-body">
                                                <div v-for="field in targetPathFields" :key="field.id" class="mapping-table-row">
                                                    <div class="mapping-col-source">
                                                        <el-select v-model="field.mappedSource" placeholder="选择源平台输出字段" class="w-full" clearable>
                                                            <el-option 
                                                                v-for="sourceField in sourceFields" 
                                                                :key="sourceField.id" 
                                                                :label="sourceField.name" 
                                                                :value="sourceField.id"
                                                                :disabled="selectedSourceFieldIds.includes(sourceField.id) && field.mappedSource !== sourceField.id">
                                                                <span>{{ sourceField.name }}</span>
                                                                <span v-if="selectedSourceFieldIds.includes(sourceField.id) && field.mappedSource !== sourceField.id" class="text-gray-400 ml-2">(已映射)</span>
                                                            </el-option>
                                                        </el-select>
                                                    </div>
                                                    <div class="mapping-col-target">
                                                        <span class="font-medium text-gray-900">{{ field.name }}</span>
                                                    </div>
                                                    <div class="mapping-col-type">
                                                        <span class="text-blue-600">{{ field.type }}</span>
                                                    </div>
                                                    <div class="mapping-col-required">
                                                        <span :class="field.required ? 'text-red-500 font-medium' : 'text-gray-500'">
                                                            {{ field.required ? '必填' : '选填' }}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </el-tab-pane>
                            </el-tabs>
                        </div>
                    </div>

                    <!-- 步骤3：运行周期 -->
                    <div v-show="taskWizardStep === 2">
                        <el-form :model="taskForm" label-width="120px">
                            <el-form-item label="运行模式" prop="runMode">
                                <el-radio-group v-model="taskForm.runMode" @change="onRunModeChange">
                                    <el-radio label="single">单次运行</el-radio>
                                    <el-radio label="loop">循环运行</el-radio>
                                </el-radio-group>
                            </el-form-item>
                            <div v-if="taskForm.runMode === 'loop'">
                                <el-form-item label="循环类型" prop="loopType">
                                    <el-select v-model="taskForm.loopType" placeholder="请选择循环类型" @change="onLoopTypeChange">
                                        <el-option label="每月" value="monthly"></el-option>
                                        <el-option label="每周" value="weekly"></el-option>
                                        <el-option label="每日" value="daily"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item v-if="taskForm.loopType === 'monthly'" label="运行日期" prop="monthDay">
                                    <el-select v-model="taskForm.monthDay" placeholder="请选择运行日期">
                                        <el-option v-for="day in 31" :key="day" :label="`${day}日`" :value="day"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item v-if="taskForm.loopType === 'weekly'" label="运行星期" prop="weekDay">
                                    <el-select v-model="taskForm.weekDay" placeholder="请选择运行星期">
                                        <el-option label="星期一" value="1"></el-option>
                                        <el-option label="星期二" value="2"></el-option>
                                        <el-option label="星期三" value="3"></el-option>
                                        <el-option label="星期四" value="4"></el-option>
                                        <el-option label="星期五" value="5"></el-option>
                                        <el-option label="星期六" value="6"></el-option>
                                        <el-option label="星期日" value="0"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item v-if="taskForm.loopType" label="运行时间" prop="executeTime">
                                    <el-time-picker 
                                        v-model="taskForm.executeTime" 
                                        placeholder="选择时间" 
                                        format="HH:mm" 
                                        value-format="HH:mm">
                                    </el-time-picker>
                                </el-form-item>
                                <div v-if="taskForm.loopType" class="mt-4 p-3 bg-gray-50 rounded">
                                    <h5 class="text-sm font-medium mb-2">运行计划预览</h5>
                                    <p class="text-sm text-gray-600">{{ getSchedulePreview() }}</p>
                                </div>
                            </div>
                        </el-form>
                    </div>
                </div>
                <div class="wizard-footer">
                    <div>
                        <el-button v-if="taskWizardStep > 0" @click="taskWizardStep--">上一步</el-button>
                    </div>
                    <div>
                        <el-button @click="taskWizardVisible = false">取消</el-button>
                        <el-button v-if="taskWizardStep < 2" type="primary" @click="nextWizardStep">下一步</el-button>
                        <el-button v-else type="primary" @click="saveTask" :loading="savingTask">保存任务</el-button>
                    </div>
                </div>
            </div>
        </el-dialog>

        <!-- 日志详情对话框 -->
        <el-dialog
            v-model="logDetailVisible"
            title="运行日志详情"
            width="800px">
            <div v-if="selectedLog">
                <el-descriptions :column="2" border>
                    <el-descriptions-item label="任务名称">{{ selectedLog.taskName }}</el-descriptions-item>
                    <el-descriptions-item label="运行时间">{{ selectedLog.executeTime }}</el-descriptions-item>
                    <el-descriptions-item label="运行状态">
                        <span :class="getLogStatusBadgeClass(selectedLog.status)">
                            {{ getLogStatusText(selectedLog.status) }}
                        </span>
                    </el-descriptions-item>
                    <el-descriptions-item label="运行耗时">{{ selectedLog.duration }}ms</el-descriptions-item>
                    <el-descriptions-item label="处理记录数">{{ selectedLog.recordCount }}</el-descriptions-item>
                </el-descriptions>
                <div v-if="selectedLog.details" class="mt-4">
                    <h4 class="font-medium mb-2">运行详情</h4>
                    <el-input v-model="selectedLog.details" type="textarea" :rows="6" readonly></el-input>
                </div>
            </div>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        const app = createApp({
            data() {
                return {
                    activeMenu: 'platform-mgmt',
                    activeTab: 'platform-mgmt',
                    
                    // 平台管理相关数据
                    platforms: [
                        {
                            id: 1,
                            name: '客户管理系统',
                            type: 'HTTP',
                            baseUrl: 'https://crm.example.com/api',
                            description: '客户关系管理系统API',
                            status: 'connected',
                            createTime: '2024-01-15 10:30:00'
                        },
                        {
                            id: 2,
                            name: '订单管理系统',
                            type: 'HTTP',
                            baseUrl: 'https://order.example.com/api',
                            description: '订单处理系统API',
                            status: 'disconnected',
                            createTime: '2024-01-16 14:20:00'
                        },
                        {
                            id: 3,
                            name: '库存管理系统',
                            type: 'HTTP',
                            baseUrl: 'https://inventory.example.com/api',
                            description: '库存管理系统API',
                            status: 'connecting',
                            createTime: '2024-01-17 09:15:00'
                        }
                    ],
                    platformSearch: '',
                    platformTypeFilter: '',
                    platformCurrentPage: 1,
                    platformPageSize: 10,
                    
                    // 平台对话框相关
                    platformDialogVisible: false,
                    platformDialogMode: 'add',
                    platformForm: {
                        name: '',
                        description: '',
                        type: '',
                        baseUrl: '',
                        authType: 'none',
                        apiKey: '',
                        token: ''
                    },
                    platformRules: {
                        name: [{ required: true, message: '请输入平台名称', trigger: 'blur' }],
                        type: [{ required: true, message: '请选择连接类型', trigger: 'change' }],
                        baseUrl: [{ required: true, message: '请输入基础URL', trigger: 'blur' }]
                    },
                    testingConnection: false,
                    savingPlatform: false,
                    
                    // 接口管理相关数据
                    interfaces: [
                        {
                            id: 1,
                            name: '获取客户列表',
                            platformId: 1,
                            platformName: '客户管理系统',
                            path: '/customers',
                            method: 'GET',
                            fieldCount: 8,
                            description: '获取客户基本信息列表',
                            createTime: '2024-01-15 11:00:00'
                        },
                        {
                            id: 2,
                            name: '创建订单',
                            platformId: 2,
                            platformName: '订单管理系统',
                            path: '/orders',
                            method: 'POST',
                            fieldCount: 12,
                            description: '创建新订单',
                            createTime: '2024-01-16 15:30:00'
                        },
                        {
                            id: 3,
                            name: '更新库存',
                            platformId: 3,
                            platformName: '库存管理系统',
                            path: '/inventory/{id}',
                            method: 'PUT',
                            fieldCount: 6,
                            description: '更新商品库存信息',
                            createTime: '2024-01-17 10:45:00'
                        }
                    ],
                    interfaceSearch: '',
                    interfacePlatformFilter: '',
                    interfaceCurrentPage: 1,
                    interfacePageSize: 10,
                    
                    // 接口对话框相关
                    interfaceDialogVisible: false,
                    interfaceDialogMode: 'add',
                    interfaceForm: {
                        platformId: '',
                        name: '',
                        path: '',
                        method: '',
                        description: '',
                        bodyParams: [],
                        queryParams: [],
                        headerParams: [],
                        pathParams: []
                    },
                    interfaceRules: {
                        platformId: [{ required: true, message: '请选择所属平台', trigger: 'change' }],
                        name: [{ required: true, message: '请输入接口名称', trigger: 'blur' }],
                        path: [{ required: true, message: '请输入接口路径', trigger: 'blur' }],
                        method: [{ required: true, message: '请选择请求方法', trigger: 'change' }]
                    },
                    activeParamTab: 'body',
                    savingInterface: false,
                    
                    // 任务管理相关数据
                    tasks: [
                        {
                            id: 1,
                            name: '客户数据同步',
                            sourcePlatform: '客户管理系统',
                            sourceInterface: '获取客户列表',
                            targetPlatform: '订单管理系统',
                            targetInterface: '同步客户信息',
                            status: 'enabled',
                            runMode: '定时运行',
                            schedule: '每天 02:00',
                            lastRun: '2024-01-20 02:00:00',
                            createTime: '2024-01-18 16:20:00'
                        },
                        {
                            id: 2,
                            name: '订单状态更新',
                            sourcePlatform: '订单管理系统',
                            sourceInterface: '获取订单状态',
                            targetPlatform: '库存管理系统',
                            targetInterface: '更新库存状态',
                            status: 'disabled',
                            runMode: '实时同步',
                            schedule: '每30秒',
                            lastRun: '2024-01-19 18:30:00',
                            createTime: '2024-01-19 09:15:00'
                        }
                    ],
                    taskSearch: '',
                    taskStatusFilter: '',
                    taskCurrentPage: 1,
                    taskPageSize: 10,
                    
                    // 任务向导相关
                    taskWizardVisible: false,
                    taskWizardStep: 0,
                    taskWizardMode: 'add', // 'add' 或 'edit'
                    editingTaskId: null,
                    taskForm: {
                        name: '',
                        description: '',
                        sourcePlatformId: '',
                        sourceInterfaceId: '',
                        targetPlatformId: '',
                        targetInterfaceId: '',
                        runMode: 'manual',
                        scheduleType: '',
                        minuteInterval: 1,
                        hourInterval: 1,
                        dailyTime: '',
                        weekDay: '',
                        weeklyTime: '',
                        monthDay: 1,
                        monthlyTime: '',
                        cronExpression: '',
                        realtimeInterval: 30
                    },
                    taskRules: {
                        name: [{ required: true, message: '请输入任务名称', trigger: 'blur' }],
                        sourcePlatformId: [{ required: true, message: '请选择源平台', trigger: 'change' }],
                        sourceInterfaceId: [{ required: true, message: '请选择源接口', trigger: 'change' }],
                        targetPlatformId: [{ required: true, message: '请选择目标平台', trigger: 'change' }],
                        targetInterfaceId: [{ required: true, message: '请选择目标接口', trigger: 'change' }]
                    },
                    sourceInterfaces: [],
                    targetInterfaces: [],
                    activeMappingTab: 'body',
                    sourceFields: [],
                    targetBodyFields: [],
                    targetQueryFields: [],
                    targetHeaderFields: [],
                    targetPathFields: [],
                    savingTask: false,
                    
                    // 日志管理相关数据
                    logs: [
                        {
                            id: 1,
                            taskName: '客户数据同步',
                            executeTime: '2024-01-20 02:00:00',
                            sourcePlatform: '运营平台A',
                            sourceInterface: '客户查询接口V1',
                            targetPlatform: '数据中心B',
                            targetInterface: '客户写入接口V2',
                            status: 'success',
                            duration: 1250,
                            recordCount: 156,
                            successCount: 156,
                            failedCount: 0,
                            skippedCount: 0,
                            errorMessage: '',
                            details: '成功同步156条客户记录到目标系统'
                        },
                        {
                            id: 2,
                            taskName: '订单状态更新',
                            executeTime: '2024-01-19 18:30:00',
                            sourcePlatform: '订单平台C',
                            sourceInterface: '订单状态查询API',
                            targetPlatform: '仓储系统D',
                            targetInterface: '订单状态回写API',
                            status: 'failed',
                            duration: 850,
                            recordCount: 0,
                            successCount: 0,
                            failedCount: 0,
                            skippedCount: 0,
                            errorMessage: '连接目标系统超时',
                            details: '尝试连接库存管理系统时发生超时错误，请检查网络连接'
                        },
                        {
                            id: 3,
                            taskName: '客户数据同步',
                            executeTime: '2024-01-19 02:00:00',
                            sourcePlatform: '运营平台A',
                            sourceInterface: '客户查询接口V1',
                            targetPlatform: '数据中心B',
                            targetInterface: '客户写入接口V2',
                            status: 'running',
                            duration: 0,
                            recordCount: 0,
                            successCount: 0,
                            failedCount: 0,
                            skippedCount: 0,
                            errorMessage: '',
                            details: '任务正在运行中...'
                        }
                    ],
                    logTaskFilter: '',
                    logStatusFilter: '',
                    logDateRange: [],
                    logCurrentPage: 1,
                    logPageSize: 10,
                    
                    // 日志详情对话框
                    logDetailVisible: false,
                    selectedLog: null
                };
            },
            computed: {
                filteredPlatforms() {
                    let filtered = this.platforms;
                    if (this.platformSearch) {
                        filtered = filtered.filter(platform => 
                            platform.name.toLowerCase().includes(this.platformSearch.toLowerCase()) ||
                            platform.baseUrl.toLowerCase().includes(this.platformSearch.toLowerCase())
                        );
                    }
                    if (this.platformTypeFilter) {
                        filtered = filtered.filter(platform => platform.type === this.platformTypeFilter);
                    }
                    return filtered;
                },
                filteredInterfaces() {
                    let filtered = this.interfaces;
                    if (this.interfaceSearch) {
                        filtered = filtered.filter(interface => 
                            interface.name.toLowerCase().includes(this.interfaceSearch.toLowerCase()) ||
                            interface.path.toLowerCase().includes(this.interfaceSearch.toLowerCase())
                        );
                    }
                    if (this.interfacePlatformFilter) {
                        filtered = filtered.filter(interface => interface.platformId == this.interfacePlatformFilter);
                    }
                    return filtered;
                },
                filteredTasks() {
                    let filtered = this.tasks;
                    if (this.taskSearch) {
                        filtered = filtered.filter(task => 
                            task.name.toLowerCase().includes(this.taskSearch.toLowerCase())
                        );
                    }
                    if (this.taskStatusFilter) {
                        filtered = filtered.filter(task => task.status === this.taskStatusFilter);
                    }
                    return filtered;
                },
                filteredLogs() {
                    let filtered = this.logs;
                    if (this.logTaskFilter) {
                        const task = this.tasks.find(t => t.id == this.logTaskFilter);
                        if (task) {
                            filtered = filtered.filter(log => log.taskName === task.name);
                        }
                    }
                    if (this.logStatusFilter) {
                        filtered = filtered.filter(log => log.status === this.logStatusFilter);
                    }
                    if (this.logDateRange && this.logDateRange.length === 2) {
                        const startDate = new Date(this.logDateRange[0]);
                        const endDate = new Date(this.logDateRange[1]);
                        filtered = filtered.filter(log => {
                            const logDate = new Date(log.executeTime);
                            return logDate >= startDate && logDate <= endDate;
                        });
                    }
                    // 默认按同步时间倒序
                    return filtered.slice().sort((a, b) => new Date(b.executeTime) - new Date(a.executeTime));
                },
                mappedFieldsCount() {
                    let count = 0;
                    this.targetBodyFields.forEach(field => {
                        if (field.mappedSource) count++;
                    });
                    this.targetQueryFields.forEach(field => {
                        if (field.mappedSource) count++;
                    });
                    this.targetHeaderFields.forEach(field => {
                        if (field.mappedSource) count++;
                    });
                    this.targetPathFields.forEach(field => {
                        if (field.mappedSource) count++;
                    });
                    return count;
                },
                totalRequiredFields() {
                    let count = 0;
                    this.targetBodyFields.forEach(field => {
                        if (field.required) count++;
                    });
                    this.targetQueryFields.forEach(field => {
                        if (field.required) count++;
                    });
                    this.targetHeaderFields.forEach(field => {
                        if (field.required) count++;
                    });
                    this.targetPathFields.forEach(field => {
                        if (field.required) count++;
                    });
                    return count;
                },
                // 获取已选择的源字段ID列表
                selectedSourceFieldIds() {
                    const selectedIds = new Set();
                    
                    // 收集所有已映射的源字段ID
                    this.targetBodyFields.forEach(field => {
                        if (field.mappedSource) selectedIds.add(field.mappedSource);
                    });
                    this.targetQueryFields.forEach(field => {
                        if (field.mappedSource) selectedIds.add(field.mappedSource);
                    });
                    this.targetHeaderFields.forEach(field => {
                        if (field.mappedSource) selectedIds.add(field.mappedSource);
                    });
                    this.targetPathFields.forEach(field => {
                        if (field.mappedSource) selectedIds.add(field.mappedSource);
                    });
                    
                    return Array.from(selectedIds);
                }
            },
            methods: {
                handleMenuSelect(key) {
                    this.activeMenu = key;
                    if (key.startsWith('platform-mgmt') || key.startsWith('interface-mgmt') || 
                        key.startsWith('task-mgmt') || key.startsWith('log-mgmt')) {
                        this.activeTab = key;
                    }
                },
                getPageDescription() {
                    const descriptions = {
                        'platform-mgmt': '管理业务平台连接配置，支持HTTP等多种连接方式',
                        'interface-mgmt': '管理各平台的API接口定义和参数配置',
                        'task-mgmt': '配置数据采集任务，设置字段映射和运行计划',
                        'log-mgmt': '查看任务运行历史和详细日志信息'
                    };
                    return descriptions[this.activeTab] || '';
                },
                
                // 平台管理方法
                searchPlatforms() {
                    // 搜索逻辑已在computed中实现
                },
                resetPlatformFilters() {
                    this.platformSearch = '';
                    this.platformTypeFilter = '';
                },
                showAddPlatformDialog() {
                    this.platformDialogMode = 'add';
                    this.resetPlatformForm();
                    this.platformDialogVisible = true;
                },
                editPlatform(platform) {
                    this.platformDialogMode = 'edit';
                    this.platformForm = { ...platform };
                    this.platformDialogVisible = true;
                },
                deletePlatform(platform) {
                    ElMessageBox.confirm('确定要删除该平台吗？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        const index = this.platforms.findIndex(p => p.id === platform.id);
                        if (index > -1) {
                            this.platforms.splice(index, 1);
                            ElMessage.success('删除成功');
                        }
                    });
                },
                testConnection(platform) {
                    ElMessage.info('正在测试连接...');
                    // 模拟测试连接
                    setTimeout(() => {
                        ElMessage.success('连接测试成功');
                    }, 1500);
                },
                viewPlatformDetail(platform) {
                    ElMessage.info('查看平台详情功能开发中...');
                },
                resetPlatformForm() {
                    this.platformForm = {
                        name: '',
                        description: '',
                        type: '',
                        baseUrl: '',
                        authType: 'none',
                        apiKey: '',
                        token: ''
                    };
                },
                onConnectionTypeChange() {
                    // 连接类型变化时的处理
                },
                onAuthTypeChange() {
                    // 认证方式变化时的处理
                },
                testPlatformConnection() {
                    this.testingConnection = true;
                    setTimeout(() => {
                        this.testingConnection = false;
                        ElMessage.success('连接测试成功');
                    }, 2000);
                },
                savePlatform() {
                    this.$refs.platformFormRef.validate((valid) => {
                        if (valid) {
                            this.savingPlatform = true;
                            setTimeout(() => {
                                if (this.platformDialogMode === 'add') {
                                    const newPlatform = {
                                        ...this.platformForm,
                                        id: Date.now(),
                                        status: 'disconnected',
                                        createTime: new Date().toLocaleString()
                                    };
                                    this.platforms.push(newPlatform);
                                    ElMessage.success('平台添加成功');
                                } else {
                                    const index = this.platforms.findIndex(p => p.id === this.platformForm.id);
                                    if (index > -1) {
                                        this.platforms[index] = { ...this.platformForm };
                                        ElMessage.success('平台更新成功');
                                    }
                                }
                                this.savingPlatform = false;
                                this.platformDialogVisible = false;
                            }, 1000);
                        }
                    });
                },
                
                // 接口管理方法
                searchInterfaces() {
                    // 搜索逻辑已在computed中实现
                },
                resetInterfaceFilters() {
                    this.interfaceSearch = '';
                    this.interfacePlatformFilter = '';
                },
                showAddInterfaceDialog() {
                    this.interfaceDialogMode = 'add';
                    this.resetInterfaceForm();
                    this.interfaceDialogVisible = true;
                },
                editInterface(interface) {
                    this.interfaceDialogMode = 'edit';
                    this.interfaceForm = { ...interface };
                    this.interfaceDialogVisible = true;
                },
                deleteInterface(interface) {
                    ElMessageBox.confirm('确定要删除该接口吗？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        const index = this.interfaces.findIndex(i => i.id === interface.id);
                        if (index > -1) {
                            this.interfaces.splice(index, 1);
                            ElMessage.success('删除成功');
                        }
                    });
                },
                viewInterfaceDetail(interface) {
                    ElMessage.info('查看接口详情功能开发中...');
                },
                resetInterfaceForm() {
                    this.interfaceForm = {
                        platformId: '',
                        name: '',
                        path: '',
                        method: '',
                        description: '',
                        bodyParams: [],
                        queryParams: [],
                        headerParams: [],
                        pathParams: []
                    };
                },
                
                // 参数配置方法
                addBodyParam() {
                    this.interfaceForm.bodyParams.push({
                        id: Date.now(),
                        name: '',
                        type: 'string',
                        required: false,
                        description: '',
                        children: []
                    });
                },
                removeBodyParam(index) {
                    this.interfaceForm.bodyParams.splice(index, 1);
                },
                addChildParam(parent) {
                    if (!parent.children) {
                        parent.children = [];
                    }
                    parent.children.push({
                        id: Date.now(),
                        name: '',
                        type: 'string',
                        required: false,
                        description: ''
                    });
                },
                removeChildParam(parent, index) {
                    parent.children.splice(index, 1);
                },
                onParamTypeChange(param) {
                    if (param.type !== 'object' && param.type !== 'array') {
                        param.children = [];
                    }
                },
                addQueryParam() {
                    this.interfaceForm.queryParams.push({
                        id: Date.now(),
                        name: '',
                        required: false,
                        example: '',
                        description: ''
                    });
                },
                removeQueryParam(index) {
                    this.interfaceForm.queryParams.splice(index, 1);
                },
                addHeaderParam() {
                    this.interfaceForm.headerParams.push({
                        id: Date.now(),
                        name: '',
                        required: false,
                        example: '',
                        description: ''
                    });
                },
                removeHeaderParam(index) {
                    this.interfaceForm.headerParams.splice(index, 1);
                },
                addPathParam() {
                    this.interfaceForm.pathParams.push({
                        id: Date.now(),
                        name: '',
                        required: true,
                        example: '',
                        description: ''
                    });
                },
                removePathParam(index) {
                    this.interfaceForm.pathParams.splice(index, 1);
                },
                saveInterface() {
                    this.$refs.interfaceFormRef.validate((valid) => {
                        if (valid) {
                            this.savingInterface = true;
                            setTimeout(() => {
                                if (this.interfaceDialogMode === 'add') {
                                    const platform = this.platforms.find(p => p.id == this.interfaceForm.platformId);
                                    const newInterface = {
                                        ...this.interfaceForm,
                                        id: Date.now(),
                                        platformName: platform ? platform.name : '',
                                        fieldCount: this.interfaceForm.bodyParams.length + this.interfaceForm.queryParams.length,
                                        createTime: new Date().toLocaleString()
                                    };
                                    this.interfaces.push(newInterface);
                                    ElMessage.success('接口添加成功');
                                } else {
                                    const index = this.interfaces.findIndex(i => i.id === this.interfaceForm.id);
                                    if (index > -1) {
                                        this.interfaces[index] = { ...this.interfaceForm };
                                        ElMessage.success('接口更新成功');
                                    }
                                }
                                this.savingInterface = false;
                                this.interfaceDialogVisible = false;
                            }, 1000);
                        }
                    });
                },
                
                // 任务管理方法
                searchTasks() {
                    // 搜索逻辑已在computed中实现
                },
                resetTaskFilters() {
                    this.taskSearch = '';
                    this.taskStatusFilter = '';
                },
                showAddTaskWizard() {
                    this.taskWizardMode = 'add';
                    this.editingTaskId = null;
                    this.taskWizardStep = 0;
                    this.resetTaskForm();
                    this.taskWizardVisible = true;
                },
                editTask(task) {
                    // 设置编辑模式
                    this.taskWizardMode = 'edit';
                    this.editingTaskId = task.id;
                    this.taskWizardStep = 0;
                    
                    // 回填任务基本信息
                    this.taskForm.name = task.name;
                    this.taskForm.description = task.description || '';
                    
                    // 根据任务信息找到对应的平台和接口ID
                    const sourcePlatform = this.platforms.find(p => p.name === task.sourcePlatform);
                    const targetPlatform = this.platforms.find(p => p.name === task.targetPlatform);
                    
                    if (sourcePlatform) {
                        this.taskForm.sourcePlatformId = sourcePlatform.id;
                        this.onSourcePlatformChange(); // 加载源接口列表
                        
                        // 设置源接口
                        setTimeout(() => {
                            const sourceInterface = this.sourceInterfaces.find(i => i.name === task.sourceInterface);
                            if (sourceInterface) {
                                this.taskForm.sourceInterfaceId = sourceInterface.id;
                                this.onSourceInterfaceChange(); // 加载源字段
                            }
                        }, 100);
                    }
                    
                    if (targetPlatform) {
                        this.taskForm.targetPlatformId = targetPlatform.id;
                        this.onTargetPlatformChange(); // 加载目标接口列表
                        
                        // 设置目标接口
                        setTimeout(() => {
                            const targetInterface = this.targetInterfaces.find(i => i.name === task.targetInterface);
                            if (targetInterface) {
                                this.taskForm.targetInterfaceId = targetInterface.id;
                                this.onTargetInterfaceChange(); // 加载目标字段
                            }
                        }, 100);
                    }
                    
                    // 回填运行配置
                    this.taskForm.runMode = task.runMode === '定时运行' ? 'scheduled' : 
                                           task.runMode === '实时同步' ? 'realtime' : 'manual';
                    
                    // 根据schedule解析具体的调度配置
                    if (task.schedule) {
                        if (task.schedule.includes('每天')) {
                            this.taskForm.scheduleType = 'daily';
                            const timeMatch = task.schedule.match(/(\d{2}:\d{2})/);
                            if (timeMatch) {
                                this.taskForm.dailyTime = timeMatch[1];
                            }
                        } else if (task.schedule.includes('每') && task.schedule.includes('秒')) {
                            this.taskForm.scheduleType = 'interval';
                            const intervalMatch = task.schedule.match(/每(\d+)秒/);
                            if (intervalMatch) {
                                this.taskForm.realtimeInterval = parseInt(intervalMatch[1]);
                            }
                        }
                    }
                    
                    // 显示向导对话框
                    this.taskWizardVisible = true;
                },
                deleteTask(task) {
                    ElMessageBox.confirm('确定要删除该任务吗？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        const index = this.tasks.findIndex(t => t.id === task.id);
                        if (index > -1) {
                            this.tasks.splice(index, 1);
                            ElMessage.success('删除成功');
                        }
                    });
                },
                toggleTaskStatus(task) {
                    task.status = task.status === 'enabled' ? 'disabled' : 'enabled';
                    ElMessage.success(`任务已${task.status === 'enabled' ? '启用' : '停用'}`);
                },
                viewTaskDetail(task) {
                    ElMessage.info('查看任务详情功能开发中...');
                },
                resetTaskForm() {
                    this.taskForm = {
                        name: '',
                        description: '',
                        sourcePlatformId: '',
                        sourceInterfaceId: '',
                        targetPlatformId: '',
                        targetInterfaceId: '',
                        runMode: 'single',
                        loopType: '',
                        monthDay: 1,
                        weekDay: '',
                        executeTime: ''
                    };
                    this.sourceInterfaces = [];
                    this.targetInterfaces = [];
                    this.sourceFields = [];
                    this.targetBodyFields = [];
                    this.targetQueryFields = [];
                },
                
                // 任务向导方法
                nextWizardStep() {
                    if (this.taskWizardStep === 0) {
                        // 验证基本信息
                        this.$refs.taskFormRef.validate((valid) => {
                            if (valid) {
                                this.taskWizardStep++;
                                this.loadFieldMappingData();
                            }
                        });
                    } else {
                        this.taskWizardStep++;
                    }
                },
                onSourcePlatformChange() {
                    this.taskForm.sourceInterfaceId = '';
                    this.sourceInterfaces = this.interfaces.filter(i => i.platformId == this.taskForm.sourcePlatformId);
                },
                onSourceInterfaceChange() {
                    this.loadSourceFields();
                },
                onTargetPlatformChange() {
                    this.taskForm.targetInterfaceId = '';
                    this.targetInterfaces = this.interfaces.filter(i => i.platformId == this.taskForm.targetPlatformId);
                },
                onTargetInterfaceChange() {
                    this.loadTargetFields();
                },
                loadFieldMappingData() {
                    this.loadSourceFields();
                    this.loadTargetFields();
                },
                loadSourceFields() {
                    // 模拟加载源字段
                    this.sourceFields = [
                        { id: 1, name: 'id', type: 'number' },
                        { id: 2, name: 'name', type: 'string' },
                        { id: 3, name: 'email', type: 'string' },
                        { id: 4, name: 'phone', type: 'string' },
                        { id: 5, name: 'address', type: 'string' },
                        { id: 6, name: 'createTime', type: 'string' }
                    ];
                },
                loadTargetFields() {
                    // 模拟加载目标字段
                    this.targetBodyFields = [
                        { id: 1, name: 'customerId', type: 'number', required: true, description: '客户ID' },
                        { id: 2, name: 'customerName', type: 'string', required: true, description: '客户姓名' },
                        { id: 3, name: 'contactEmail', type: 'string', required: false, description: '联系邮箱' },
                        { id: 4, name: 'contactPhone', type: 'string', required: true, description: '联系电话' }
                    ];
                    this.targetQueryFields = [
                        { id: 1, name: 'source', type: 'string', required: false, description: '数据来源' }
                    ];
                    this.targetHeaderFields = [
                        { id: 1, name: 'Authorization', type: 'string', required: true, description: '认证令牌' },
                        { id: 2, name: 'Content-Type', type: 'string', required: false, description: '内容类型' }
                    ];
                    this.targetPathFields = [
                        { id: 1, name: 'userId', type: 'string', required: true, description: '用户ID' }
                    ];
                },
                clearAllMappings() {
                    this.targetBodyFields.forEach(field => {
                        field.mappedSource = '';
                    });
                    this.targetQueryFields.forEach(field => {
                        field.mappedSource = '';
                    });
                    this.targetHeaderFields.forEach(field => {
                        field.mappedSource = '';
                    });
                    this.targetPathFields.forEach(field => {
                        field.mappedSource = '';
                    });
                },
                onRunModeChange() {
                    // 运行模式变化时重置相关字段
                    this.taskForm.loopType = '';
                    this.taskForm.monthDay = 1;
                    this.taskForm.weekDay = '';
                    this.taskForm.executeTime = '';
                },
                onLoopTypeChange() {
                    // 循环类型变化时重置相关字段
                    this.taskForm.monthDay = 1;
                    this.taskForm.weekDay = '';
                    this.taskForm.executeTime = '';
                },
                getSchedulePreview() {
                    if (this.taskForm.runMode === 'single') {
                        return '单次运行，手动触发运行';
                    } else if (this.taskForm.runMode === 'loop' && this.taskForm.loopType) {
                        let preview = '';
                        switch (this.taskForm.loopType) {
                            case 'daily':
                                preview = '每日';
                                break;
                            case 'weekly':
                                if (this.taskForm.weekDay) {
                                    const weekDays = ['日', '一', '二', '三', '四', '五', '六'];
                                    preview = `每周${weekDays[this.taskForm.weekDay]}`;
                                } else {
                                    preview = '每周';
                                }
                                break;
                            case 'monthly':
                                if (this.taskForm.monthDay) {
                                    preview = `每月${this.taskForm.monthDay}日`;
                                } else {
                                    preview = '每月';
                                }
                                break;
                        }
                        if (this.taskForm.executeTime) {
                            preview += ` ${this.taskForm.executeTime}`;
                        }
                        return preview + ' 自动运行';
                    }
                    return '请完善配置信息';
                },
                saveTask() {
                    this.savingTask = true;
                    setTimeout(() => {
                        const sourcePlatform = this.platforms.find(p => p.id == this.taskForm.sourcePlatformId);
                        const sourceInterface = this.interfaces.find(i => i.id == this.taskForm.sourceInterfaceId);
                        const targetPlatform = this.platforms.find(p => p.id == this.taskForm.targetPlatformId);
                        const targetInterface = this.interfaces.find(i => i.id == this.taskForm.targetInterfaceId);
                        
                        if (this.taskWizardMode === 'edit') {
                            // 编辑模式：更新现有任务
                            const taskIndex = this.tasks.findIndex(t => t.id === this.editingTaskId);
                            if (taskIndex !== -1) {
                                const updatedTask = {
                                    ...this.tasks[taskIndex],
                                    name: this.taskForm.name,
                                    description: this.taskForm.description,
                                    sourcePlatform: sourcePlatform ? sourcePlatform.name : '',
                                    sourceInterface: sourceInterface ? sourceInterface.name : '',
                                    targetPlatform: targetPlatform ? targetPlatform.name : '',
                                    targetInterface: targetInterface ? targetInterface.name : '',
                                    runMode: this.taskForm.runMode === 'manual' ? '手动运行' : 
                                            this.taskForm.runMode === 'scheduled' ? '定时运行' : '实时同步',
                                    schedule: this.generateScheduleText(),
                                    updateTime: new Date().toLocaleString()
                                };
                                this.$set(this.tasks, taskIndex, updatedTask);
                                ElMessage.success('任务更新成功');
                            }
                        } else {
                            // 新增模式：创建新任务
                            const newTask = {
                                id: Date.now(),
                                name: this.taskForm.name,
                                description: this.taskForm.description,
                                sourcePlatform: sourcePlatform ? sourcePlatform.name : '',
                                sourceInterface: sourceInterface ? sourceInterface.name : '',
                                targetPlatform: targetPlatform ? targetPlatform.name : '',
                                targetInterface: targetInterface ? targetInterface.name : '',
                                status: 'disabled',
                                runMode: this.taskForm.runMode === 'manual' ? '手动运行' : 
                                        this.taskForm.runMode === 'scheduled' ? '定时运行' : '实时同步',
                                schedule: this.generateScheduleText(),
                                lastRun: '',
                                createTime: new Date().toLocaleString()
                            };
                            
                            this.tasks.push(newTask);
                            ElMessage.success('任务创建成功');
                        }
                        
                        this.savingTask = false;
                        this.taskWizardVisible = false;
                    }, 1500);
                },
                generateScheduleText() {
                    if (this.taskForm.runMode === 'manual') {
                        return '手动触发';
                    } else if (this.taskForm.runMode === 'scheduled') {
                        if (this.taskForm.scheduleType === 'daily' && this.taskForm.dailyTime) {
                            return `每天 ${this.taskForm.dailyTime}`;
                        } else if (this.taskForm.scheduleType === 'weekly' && this.taskForm.weeklyDay && this.taskForm.weeklyTime) {
                            const weekDays = ['日', '一', '二', '三', '四', '五', '六'];
                            return `每周${weekDays[this.taskForm.weeklyDay]} ${this.taskForm.weeklyTime}`;
                        } else if (this.taskForm.scheduleType === 'monthly' && this.taskForm.monthlyDay && this.taskForm.monthlyTime) {
                            return `每月${this.taskForm.monthlyDay}日 ${this.taskForm.monthlyTime}`;
                        }
                        return '定时运行';
                    } else if (this.taskForm.runMode === 'realtime') {
                        if (this.taskForm.realtimeInterval) {
                            return `每${this.taskForm.realtimeInterval}秒`;
                        }
                        return '实时同步';
                    }
                    return '--';
                },
                
                // 日志管理方法
                searchLogs() {
                    // 搜索逻辑已在computed中实现
                },
                resetLogFilters() {
                    this.logTaskFilter = '';
                    this.logStatusFilter = '';
                    this.logDateRange = [];
                },
                viewLogDetail(log) {
                    this.selectedLog = log;
                    this.logDetailVisible = true;
                },
                
                // 工具方法
                getStatusBadgeClass(status) {
                    const classes = {
                        'connected': 'status-badge status-badge-connected',
                        'disconnected': 'status-badge status-badge-disconnected',
                        'connecting': 'status-badge status-badge-connecting'
                    };
                    return classes[status] || 'status-badge';
                },
                getStatusText(status) {
                    const texts = {
                        'connected': '已连接',
                        'disconnected': '未连接',
                        'connecting': '连接中'
                    };
                    return texts[status] || '未知';
                },
                getMethodBadgeClass(method) {
                    const classes = {
                        'GET': 'method-badge method-get',
                        'POST': 'method-badge method-post',
                        'PUT': 'method-badge method-put',
                        'DELETE': 'method-badge method-delete',
                        'PATCH': 'method-badge method-patch'
                    };
                    return classes[method] || 'method-badge';
                },
                getLogStatusBadgeClass(status) {
                    const classes = {
                        'success': 'status-badge status-badge-connected',
                        'failed': 'status-badge status-badge-disconnected',
                        'running': 'status-badge status-badge-connecting'
                    };
                    return classes[status] || 'status-badge';
                },
                getLogStatusText(status) {
                    const texts = {
                        'success': '成功',
                        'failed': '失败',
                        'running': '运行中'
                    };
                    return texts[status] || '未知';
                }
            }
        });
        
        // 注册图标组件
        for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
            app.component(key, component);
        }
        
        app.use(ElementPlus).mount('#app');
    </script>
</body>
</html>