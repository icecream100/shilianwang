<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视联网适配中心 - 系统设置</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sidebar {
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
        }
        .nav-item {
            padding: 12px 20px;
            color: #bdc3c7;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }
        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        .nav-item.active {
            background-color: rgba(64, 158, 255, 0.2);
            color: #409eff;
            border-left-color: #409eff;
        }
        .nav-group {
            margin-bottom: 10px;
        }
        .nav-group-title {
            padding: 8px 20px;
            color: #95a5a6;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .nav-submenu {
            padding-left: 40px;
            font-size: 14px;
        }
        .content-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }
        .status-tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-enabled {
            background-color: #f0f9ff;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        .status-disabled {
            background-color: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        .tab-content {
            min-height: 600px;
        }
        .permission-tree {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="flex h-screen bg-gray-50">
            <!-- 左侧导航 -->
            <div class="w-64 sidebar">
                <div class="p-6 border-b border-gray-600">
                    <h1 class="text-xl font-bold text-white">视联网适配中心</h1>
                </div>
                <nav class="mt-6">
                    <div class="nav-group">
                        <div class="nav-group-title">运营门户</div>
                        <div class="nav-item">
                            <i class="el-icon-monitor"></i> 驾驶舱
                        </div>
                        <div class="nav-item">
                            <i class="el-icon-user"></i> 客户管理
                        </div>
                        <div class="nav-item">
                            <i class="el-icon-data-analysis"></i> 运营分析
                            <div class="nav-submenu">
                                <div class="nav-item">客户分析</div>
                                <div class="nav-item">设备分析</div>
                                <div class="nav-item">业务分析</div>
                            </div>
                        </div>
                        <div class="nav-item">
                            <i class="el-icon-monitor"></i> 运行监控
                            <div class="nav-submenu">
                                <div class="nav-item">告警规则管理</div>
                                <div class="nav-item">告警事件管理</div>
                            </div>
                        </div>
                        <div class="nav-item active">
                            <i class="el-icon-setting"></i> 系统配置
                            <div class="nav-submenu">
                                <div class="nav-item" :class="{active: activeTab === 'users'}" @click="activeTab = 'users'">用户管理</div>
                                <div class="nav-item" :class="{active: activeTab === 'roles'}" @click="activeTab = 'roles'">角色管理</div>
                            </div>
                        </div>
                        <div class="nav-item">
                            <i class="el-icon-document"></i> 日志管理
                            <div class="nav-submenu">
                                <div class="nav-item">登录日志</div>
                                <div class="nav-item">操作日志</div>
                            </div>
                        </div>
                    </div>
                    <div class="nav-group">
                        <div class="nav-group-title">接口适配</div>
                        <div class="nav-item">
                            <i class="el-icon-connection"></i> 接入平台管理
                        </div>
                        <div class="nav-item">
                            <i class="el-icon-cpu"></i> 设备管理
                        </div>
                        <div class="nav-item">
                            <i class="el-icon-link"></i> 通道管理
                        </div>
                    </div>
                    <div class="nav-group">
                        <div class="nav-group-title">业务数据采集</div>
                        <div class="nav-item">
                            <i class="el-icon-data-board"></i> 业务采集设置
                        </div>
                        <div class="nav-item">
                            <i class="el-icon-refresh"></i> 客户同步设置
                        </div>
                        <div class="nav-item">
                            <i class="el-icon-view"></i> 任务状态
                        </div>
                    </div>
                </nav>
            </div>

            <!-- 主内容区域 -->
            <div class="flex-1 overflow-auto">
                <!-- 顶部标题栏 -->
                <div class="bg-white shadow-sm border-b px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800">系统设置</h2>
                            <p class="text-gray-600 mt-1">管理系统用户账户和角色权限配置</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <!-- 用户信息 -->
                            <div class="flex items-center space-x-3 ml-6 pl-6 border-l border-gray-200">
                                <el-dropdown trigger="click" @command="handleUserCommand">
                                    <div class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 px-3 py-2 rounded-lg transition-colors">
                                        <el-avatar :size="32" :src="userInfo.avatarUrl" class="border border-gray-200">
                                            <el-icon><User /></el-icon>
                                        </el-avatar>
                                        <div class="text-left">
                                            <div class="text-sm font-medium text-gray-800">{{userInfo.realName}}</div>
                                            <div class="text-xs text-gray-500">{{userInfo.department}}</div>
                                        </div>
                                        <el-icon class="text-gray-400"><ArrowDown /></el-icon>
                                    </div>
                                    <template #dropdown>
                                        <el-dropdown-menu>
                                            <el-dropdown-item command="profile">
                                                <el-icon><User /></el-icon>
                                                个人中心
                                            </el-dropdown-item>
                                            <el-dropdown-item command="password">
                                                <el-icon><Lock /></el-icon>
                                                修改密码
                                            </el-dropdown-item>
                                            <el-dropdown-item command="logout" divided>
                                                <el-icon><SwitchButton /></el-icon>
                                                退出登录
                                            </el-dropdown-item>
                                        </el-dropdown-menu>
                                    </template>
                                </el-dropdown>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 系统设置内容 -->
                <div class="p-6">
                    <!-- 用户管理 -->
                    <div v-if="activeTab === 'users'" class="content-card">
                        <div class="tab-content p-6">
                            <div class="mb-4">
                                <h3 class="text-xl font-bold text-gray-800">用户管理</h3>
                                <p class="text-gray-600 mt-1">管理系统用户账户信息</p>
                            </div>
                                <!-- 筛选区域 -->
                                <div class="mb-6">
                                    <el-form :inline="true" :model="userFilters" class="demo-form-inline">
                                        <el-form-item label="用户名">
                                            <el-input v-model="userFilters.username" placeholder="请输入用户名" clearable style="width: 200px"></el-input>
                                        </el-form-item>
                                        <el-form-item label="姓名">
                                            <el-input v-model="userFilters.realName" placeholder="请输入姓名" clearable style="width: 200px"></el-input>
                                        </el-form-item>
                                        <el-form-item label="手机号">
                                            <el-input v-model="userFilters.phoneNumber" placeholder="请输入手机号" clearable style="width: 200px"></el-input>
                                        </el-form-item>
                                        <el-form-item label="状态">
                                            <el-select v-model="userFilters.status" placeholder="请选择状态" clearable style="width: 120px">
                                                <el-option label="全部" value=""></el-option>
                                                <el-option label="启用" value="1"></el-option>
                                                <el-option label="禁用" value="0"></el-option>
                                            </el-select>
                                        </el-form-item>
                                        <el-form-item>
                                            <el-button type="primary" @click="searchUsers">查询</el-button>
                                            <el-button @click="resetUserFilters">重置</el-button>
                                        </el-form-item>
                                    </el-form>
                                    
                                    <!-- 分隔线和操作按钮区 -->
                                    <div class="border-t border-gray-200 pt-4 mt-4">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <el-button type="primary" @click="showAddUserDialog">新增用户</el-button>
                                            </div>
                                            <div class="text-sm text-gray-500">
                                                共 {{ userPagination.total }} 条记录
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 用户列表 -->
                                <el-table :data="filteredUsers" style="width: 100%" v-loading="userLoading">
                                    <el-table-column type="index" label="序号" width="60"></el-table-column>
                                    <el-table-column prop="username" label="用户名" width="120"></el-table-column>
                                    <el-table-column prop="realName" label="姓名" width="100"></el-table-column>
                                    <el-table-column prop="phoneNumber" label="手机号" width="130"></el-table-column>
                                    <el-table-column prop="email" label="邮箱" width="180"></el-table-column>
                                    <el-table-column prop="department" label="所属部门" width="120"></el-table-column>
                                    <el-table-column label="角色" width="150">
                                        <template #default="scope">
                                            <el-tag v-for="role in scope.row.roles" :key="role" size="small" class="mr-1">{{ role }}</el-tag>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="状态" width="80">
                                        <template #default="scope">
                                            <span :class="scope.row.status === 1 ? 'status-tag status-enabled' : 'status-tag status-disabled'">
                                                {{ scope.row.status === 1 ? '启用' : '禁用' }}
                                            </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="createTime" label="创建时间" width="160"></el-table-column>
                                    <el-table-column label="操作" width="280">
                                        <template #default="scope">
                                            <el-button size="small" @click="editUser(scope.row)">编辑</el-button>
                                            <el-button size="small" @click="assignRoles(scope.row)">分配角色</el-button>
                                            <el-button size="small" :type="scope.row.status === 1 ? 'warning' : 'success'" @click="toggleUserStatus(scope.row)">
                                                {{ scope.row.status === 1 ? '禁用' : '启用' }}
                                            </el-button>
                                            <el-button size="small" type="danger" @click="deleteUser(scope.row)">删除</el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>

                                <!-- 分页 -->
                                <div class="mt-4 flex justify-end">
                                    <el-pagination
                                        v-model:current-page="userPagination.currentPage"
                                        v-model:page-size="userPagination.pageSize"
                                        :page-sizes="[10, 20, 50, 100]"
                                        :total="userPagination.total"
                                        layout="total, sizes, prev, pager, next, jumper">
                                    </el-pagination>
                                </div>
                        </div>
                    </div>

                    <!-- 角色管理 -->
                    <div v-if="activeTab === 'roles'" class="content-card">
                        <div class="tab-content p-6">
                            <div class="mb-4">
                                <h3 class="text-xl font-bold text-gray-800">角色管理</h3>
                                <p class="text-gray-600 mt-1">管理系统角色和权限配置</p>
                            </div>
                                <!-- 筛选区域 -->
                                <div class="mb-6">
                                    <el-form :inline="true" :model="roleFilters" class="demo-form-inline">
                                        <el-form-item label="角色名称">
                                            <el-input v-model="roleFilters.roleName" placeholder="请输入角色名称" clearable style="width: 200px"></el-input>
                                        </el-form-item>
                                        <el-form-item>
                                            <el-button type="primary" @click="searchRoles">查询</el-button>
                                            <el-button @click="resetRoleFilters">重置</el-button>
                                        </el-form-item>
                                    </el-form>
                                    
                                    <!-- 分隔线和操作按钮区 -->
                                    <div class="border-t border-gray-200 pt-4 mt-4">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <el-button type="primary" @click="showAddRoleDialog">新增角色</el-button>
                                            </div>
                                            <div class="text-sm text-gray-500">
                                                共 {{ rolePagination.total }} 条记录
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 角色列表 -->
                                <el-table :data="filteredRoles" style="width: 100%" v-loading="roleLoading">
                                    <el-table-column type="index" label="序号" width="60"></el-table-column>
                                    <el-table-column prop="roleName" label="角色名称" width="150"></el-table-column>
                                    <el-table-column prop="roleKey" label="角色标识" width="150"></el-table-column>
                                    <el-table-column prop="description" label="角色描述" min-width="200"></el-table-column>
                                    <el-table-column label="状态" width="80">
                                        <template #default="scope">
                                            <span :class="scope.row.status === 1 ? 'status-tag status-enabled' : 'status-tag status-disabled'">
                                                {{ scope.row.status === 1 ? '启用' : '禁用' }}
                                            </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column prop="createTime" label="创建时间" width="160"></el-table-column>
                                    <el-table-column label="操作" width="280">
                                        <template #default="scope">
                                            <el-button size="small" @click="editRole(scope.row)">编辑</el-button>
                                            <el-button size="small" type="primary" @click="assignPermissions(scope.row)">授权</el-button>
                                            <el-button size="small" :type="scope.row.status === 1 ? 'warning' : 'success'" @click="toggleRoleStatus(scope.row)">
                                                {{ scope.row.status === 1 ? '禁用' : '启用' }}
                                            </el-button>
                                            <el-button size="small" type="danger" @click="deleteRole(scope.row)" :disabled="scope.row.roleKey === 'admin'">删除</el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>

                                <!-- 分页 -->
                                <div class="mt-4 flex justify-end">
                                    <el-pagination
                                        v-model:current-page="rolePagination.currentPage"
                                        v-model:page-size="rolePagination.pageSize"
                                        :page-sizes="[10, 20, 50, 100]"
                                        :total="rolePagination.total"
                                        layout="total, sizes, prev, pager, next, jumper">
                                    </el-pagination>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新增/编辑用户对话框 -->
        <el-dialog v-model="userDialogVisible" :title="userDialogTitle" width="600px">
            <el-form :model="userForm" :rules="userRules" ref="userFormRef" label-width="100px">
                <el-form-item label="用户名" prop="username">
                    <el-input v-model="userForm.username" :disabled="userForm.id" placeholder="请输入用户名"></el-input>
                </el-form-item>
                <el-form-item label="姓名" prop="realName">
                    <el-input v-model="userForm.realName" placeholder="请输入姓名"></el-input>
                </el-form-item>
                <el-form-item label="手机号" prop="phoneNumber">
                    <el-input v-model="userForm.phoneNumber" placeholder="请输入手机号"></el-input>
                </el-form-item>
                <el-form-item label="邮箱" prop="email">
                    <el-input v-model="userForm.email" placeholder="请输入邮箱"></el-input>
                </el-form-item>
                <el-form-item label="所属部门">
                    <el-select v-model="userForm.deptId" placeholder="请选择部门" style="width: 100%">
                        <el-option v-for="dept in departments" :key="dept.id" :label="dept.name" :value="dept.id"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="初始密码" prop="password" v-if="!userForm.id">
                    <el-input v-model="userForm.password" type="password" placeholder="请输入初始密码" show-password></el-input>
                </el-form-item>
                <el-form-item label="状态">
                    <el-radio-group v-model="userForm.status">
                        <el-radio :label="1">启用</el-radio>
                        <el-radio :label="0">禁用</el-radio>
                    </el-radio-group>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="userDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveUser">确定</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 新增/编辑角色对话框 -->
        <el-dialog v-model="roleDialogVisible" :title="roleDialogTitle" width="600px">
            <el-form :model="roleForm" :rules="roleRules" ref="roleFormRef" label-width="100px">
                <el-form-item label="角色名称" prop="roleName">
                    <el-input v-model="roleForm.roleName" placeholder="请输入角色名称"></el-input>
                </el-form-item>
                <el-form-item label="角色标识" prop="roleKey">
                    <el-input v-model="roleForm.roleKey" :disabled="roleForm.id" placeholder="请输入角色标识（英文）"></el-input>
                </el-form-item>
                <el-form-item label="角色描述">
                    <el-input v-model="roleForm.description" type="textarea" :rows="3" placeholder="请输入角色描述"></el-input>
                </el-form-item>
                <el-form-item label="状态">
                    <el-radio-group v-model="roleForm.status">
                        <el-radio :label="1">启用</el-radio>
                        <el-radio :label="0">禁用</el-radio>
                    </el-radio-group>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="roleDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveRole">确定</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 分配角色对话框 -->
        <el-dialog v-model="assignRoleDialogVisible" title="分配角色" width="500px">
            <div class="mb-4">
                <strong>用户：</strong>{{ selectedUser.realName }} ({{ selectedUser.username }})
            </div>
            <el-transfer
                v-model="selectedUserRoles"
                :data="allRoles"
                :titles="['可选角色', '已分配角色']"
                :button-texts="['移除', '分配']"
                :format="{
                    noChecked: '${total}',
                    hasChecked: '${checked}/${total}'
                }"
                style="text-align: left; display: inline-block">
            </el-transfer>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="assignRoleDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveUserRoles">确定</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 角色授权对话框 -->
        <el-dialog v-model="permissionDialogVisible" title="角色授权" width="600px">
            <div class="mb-4">
                <strong>角色：</strong>{{ selectedRole.roleName }} ({{ selectedRole.roleKey }})
            </div>
            <div class="permission-tree">
                <el-tree
                    ref="permissionTreeRef"
                    :data="permissionTree"
                    :props="{ children: 'children', label: 'label' }"
                    show-checkbox
                    node-key="id"
                    :default-checked-keys="selectedPermissions"
                    :check-strictly="false">
                </el-tree>
            </div>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="permissionDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveRolePermissions">确定</el-button>
                </span>
            </template>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    activeTab: 'users',
                    currentUser: {
                        name: '系统管理员'
                    },
                    // 用户信息
                    userInfo: {
                        username: 'admin',
                        realName: '张三',
                        department: '系统管理员',
                        avatarUrl: 'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png'
                    },
                    
                    // 用户管理相关数据
                    userLoading: false,
                    userFilters: {
                        username: '',
                        realName: '',
                        phoneNumber: '',
                        status: ''
                    },
                    userPagination: {
                        currentPage: 1,
                        pageSize: 10,
                        total: 0
                    },
                    users: [
                        {
                            id: 1,
                            username: 'admin',
                            realName: '系统管理员',
                            phoneNumber: '13800138000',
                            email: 'admin@example.com',
                            department: '技术部',
                            roles: ['系统管理员'],
                            status: 1,
                            createTime: '2024-01-01 10:00:00'
                        },
                        {
                            id: 2,
                            username: 'operator',
                            realName: '运营人员',
                            phoneNumber: '13800138001',
                            email: 'operator@example.com',
                            department: '运营部',
                            roles: ['运营人员'],
                            status: 1,
                            createTime: '2024-01-02 10:00:00'
                        },
                        {
                            id: 3,
                            username: 'viewer',
                            realName: '查看员',
                            phoneNumber: '13800138002',
                            email: 'viewer@example.com',
                            department: '业务部',
                            roles: ['查看员'],
                            status: 0,
                            createTime: '2024-01-03 10:00:00'
                        }
                    ],
                    userDialogVisible: false,
                    userDialogTitle: '',
                    userForm: {
                        id: null,
                        username: '',
                        realName: '',
                        phoneNumber: '',
                        email: '',
                        deptId: null,
                        password: '',
                        status: 1
                    },
                    userRules: {
                        username: [{ required: true, message: '请输入用户名', trigger: 'blur' }],
                        realName: [{ required: true, message: '请输入姓名', trigger: 'blur' }],
                        password: [{ required: true, message: '请输入初始密码', trigger: 'blur' }],
                        phoneNumber: [{ pattern: /^1[3-9]\d{9}$/, message: '请输入正确的手机号', trigger: 'blur' }],
                        email: [{ type: 'email', message: '请输入正确的邮箱地址', trigger: 'blur' }]
                    },
                    departments: [
                        { id: 1, name: '技术部' },
                        { id: 2, name: '运营部' },
                        { id: 3, name: '业务部' },
                        { id: 4, name: '市场部' }
                    ],
                    
                    // 角色管理相关数据
                    roleLoading: false,
                    roleFilters: {
                        roleName: ''
                    },
                    rolePagination: {
                        currentPage: 1,
                        pageSize: 10,
                        total: 0
                    },
                    roles: [
                        {
                            id: 1,
                            roleName: '系统管理员',
                            roleKey: 'admin',
                            description: '系统超级管理员，拥有所有权限',
                            status: 1,
                            createTime: '2024-01-01 10:00:00'
                        },
                        {
                            id: 2,
                            roleName: '运营人员',
                            roleKey: 'operator',
                            description: '运营管理人员，负责日常运营工作',
                            status: 1,
                            createTime: '2024-01-01 10:00:00'
                        },
                        {
                            id: 3,
                            roleName: '查看员',
                            roleKey: 'viewer',
                            description: '只读权限，可查看相关数据',
                            status: 1,
                            createTime: '2024-01-01 10:00:00'
                        }
                    ],
                    roleDialogVisible: false,
                    roleDialogTitle: '',
                    roleForm: {
                        id: null,
                        roleName: '',
                        roleKey: '',
                        description: '',
                        status: 1
                    },
                    roleRules: {
                        roleName: [{ required: true, message: '请输入角色名称', trigger: 'blur' }],
                        roleKey: [{ required: true, message: '请输入角色标识', trigger: 'blur' }]
                    },
                    
                    // 分配角色相关数据
                    assignRoleDialogVisible: false,
                    selectedUser: {},
                    selectedUserRoles: [],
                    allRoles: [],
                    
                    // 角色授权相关数据
                    permissionDialogVisible: false,
                    selectedRole: {},
                    selectedPermissions: [],
                    permissionTree: [
                        {
                            id: 1,
                            label: '运营门户',
                            children: [
                                { id: 11, label: '驾驶舱' },
                                { id: 12, label: '客户管理' },
                                {
                                    id: 13,
                                    label: '运营分析',
                                    children: [
                                        { id: 131, label: '客户分析' },
                                        { id: 132, label: '设备分析' },
                                        { id: 133, label: '业务分析' }
                                    ]
                                },
                                {
                                    id: 14,
                                    label: '运行监控',
                                    children: [
                                        { id: 141, label: '告警规则管理' },
                                        { id: 142, label: '告警事件管理' }
                                    ]
                                },
                                {
                                    id: 15,
                                    label: '系统配置',
                                    children: [
                                        { id: 151, label: '用户管理' },
                                        { id: 152, label: '角色管理' }
                                    ]
                                },
                                {
                                    id: 16,
                                    label: '日志管理',
                                    children: [
                                        { id: 161, label: '登录日志' },
                                        { id: 162, label: '操作日志' }
                                    ]
                                }
                            ]
                        },
                        {
                            id: 2,
                            label: '接口适配',
                            children: [
                                { id: 21, label: '接入平台管理' },
                                { id: 22, label: '设备管理' },
                                { id: 23, label: '通道管理' }
                            ]
                        },
                        {
                            id: 3,
                            label: '业务数据采集',
                            children: [
                                { id: 31, label: '业务采集设置' },
                                { id: 32, label: '客户同步设置' },
                                { id: 33, label: '任务状态' }
                            ]
                        }
                    ]
                };
            },
            computed: {
                filteredUsers() {
                    let filtered = this.users;
                    if (this.userFilters.username) {
                        filtered = filtered.filter(user => user.username.includes(this.userFilters.username));
                    }
                    if (this.userFilters.realName) {
                        filtered = filtered.filter(user => user.realName.includes(this.userFilters.realName));
                    }
                    if (this.userFilters.phoneNumber) {
                        filtered = filtered.filter(user => user.phoneNumber.includes(this.userFilters.phoneNumber));
                    }
                    if (this.userFilters.status !== '') {
                        filtered = filtered.filter(user => user.status == this.userFilters.status);
                    }
                    this.userPagination.total = filtered.length;
                    return filtered;
                },
                filteredRoles() {
                    let filtered = this.roles;
                    if (this.roleFilters.roleName) {
                        filtered = filtered.filter(role => role.roleName.includes(this.roleFilters.roleName));
                    }
                    this.rolePagination.total = filtered.length;
                    return filtered;
                }
            },
            methods: {
                // 用户相关方法
                handleUserCommand(command) {
                    switch(command) {
                        case 'profile':
                            this.goToProfile();
                            break;
                        case 'password':
                            this.showChangePassword();
                            break;
                        case 'logout':
                            this.logout();
                            break;
                    }
                },
                goToProfile() {
                    this.$message.info('跳转到个人中心');
                    // 这里可以添加路由跳转逻辑
                },
                showChangePassword() {
                    this.$message.info('打开修改密码对话框');
                    // 这里可以添加修改密码的逻辑
                },
                logout() {
                    this.$confirm('确定要退出登录吗？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        this.$message.success('退出登录成功');
                        // 这里可以添加退出登录的逻辑
                    }).catch(() => {
                        this.$message.info('已取消退出');
                    });
                },
                
                // 用户管理方法
                searchUsers() {
                    this.userLoading = true;
                    setTimeout(() => {
                        this.userLoading = false;
                    }, 500);
                },
                resetUserFilters() {
                    this.userFilters = {
                        username: '',
                        realName: '',
                        phoneNumber: '',
                        status: ''
                    };
                },
                showAddUserDialog() {
                    this.userDialogTitle = '新增用户';
                    this.userForm = {
                        id: null,
                        username: '',
                        realName: '',
                        phoneNumber: '',
                        email: '',
                        deptId: null,
                        password: '',
                        status: 1
                    };
                    this.userDialogVisible = true;
                },
                editUser(user) {
                    this.userDialogTitle = '编辑用户';
                    this.userForm = { ...user };
                    this.userDialogVisible = true;
                },
                saveUser() {
                    this.$refs.userFormRef.validate((valid) => {
                        if (valid) {
                            if (this.userForm.id) {
                                // 编辑用户
                                const index = this.users.findIndex(u => u.id === this.userForm.id);
                                if (index !== -1) {
                                    this.users[index] = { ...this.userForm };
                                }
                                ElMessage.success('用户信息修改成功');
                            } else {
                                // 新增用户
                                this.userForm.id = Date.now();
                                this.userForm.createTime = new Date().toLocaleString();
                                this.users.push({ ...this.userForm });
                                ElMessage.success('新增用户成功');
                            }
                            this.userDialogVisible = false;
                        }
                    });
                },
                toggleUserStatus(user) {
                    const action = user.status === 1 ? '禁用' : '启用';
                    ElMessageBox.confirm(`确定要${action}用户 ${user.username} 吗？`, '确认操作', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        user.status = user.status === 1 ? 0 : 1;
                        ElMessage.success(`用户状态修改成功`);
                    });
                },
                deleteUser(user) {
                    if (user.username === 'admin') {
                        ElMessage.warning('超级管理员账户不允许删除');
                        return;
                    }
                    ElMessageBox.confirm(`确定要删除用户 ${user.username} 吗？此操作不可恢复。`, '确认删除', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        const index = this.users.findIndex(u => u.id === user.id);
                        if (index !== -1) {
                            this.users.splice(index, 1);
                        }
                        ElMessage.success('用户删除成功');
                    });
                },
                assignRoles(user) {
                    this.selectedUser = user;
                    this.allRoles = this.roles.map(role => ({
                        key: role.id,
                        label: role.roleName
                    }));
                    // 模拟用户已有角色
                    this.selectedUserRoles = [1]; // 假设用户已有第一个角色
                    this.assignRoleDialogVisible = true;
                },
                saveUserRoles() {
                    // 更新用户角色
                    const roleNames = this.selectedUserRoles.map(roleId => {
                        const role = this.roles.find(r => r.id === roleId);
                        return role ? role.roleName : '';
                    }).filter(name => name);
                    
                    const userIndex = this.users.findIndex(u => u.id === this.selectedUser.id);
                    if (userIndex !== -1) {
                        this.users[userIndex].roles = roleNames;
                    }
                    
                    this.assignRoleDialogVisible = false;
                    ElMessage.success('角色分配成功');
                },
                
                // 角色管理方法
                searchRoles() {
                    this.roleLoading = true;
                    setTimeout(() => {
                        this.roleLoading = false;
                    }, 500);
                },
                resetRoleFilters() {
                    this.roleFilters = {
                        roleName: ''
                    };
                },
                showAddRoleDialog() {
                    this.roleDialogTitle = '新增角色';
                    this.roleForm = {
                        id: null,
                        roleName: '',
                        roleKey: '',
                        description: '',
                        status: 1
                    };
                    this.roleDialogVisible = true;
                },
                editRole(role) {
                    this.roleDialogTitle = '编辑角色';
                    this.roleForm = { ...role };
                    this.roleDialogVisible = true;
                },
                saveRole() {
                    this.$refs.roleFormRef.validate((valid) => {
                        if (valid) {
                            if (this.roleForm.id) {
                                // 编辑角色
                                const index = this.roles.findIndex(r => r.id === this.roleForm.id);
                                if (index !== -1) {
                                    this.roles[index] = { ...this.roleForm };
                                }
                                ElMessage.success('角色信息修改成功');
                            } else {
                                // 新增角色
                                this.roleForm.id = Date.now();
                                this.roleForm.createTime = new Date().toLocaleString();
                                this.roles.push({ ...this.roleForm });
                                ElMessage.success('新增角色成功');
                            }
                            this.roleDialogVisible = false;
                        }
                    });
                },
                toggleRoleStatus(role) {
                    const action = role.status === 1 ? '禁用' : '启用';
                    ElMessageBox.confirm(`确定要${action}角色 ${role.roleName} 吗？${action === '禁用' ? '禁用后，拥有此角色的用户将临时失去相应权限。' : ''}`, '确认操作', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        role.status = role.status === 1 ? 0 : 1;
                        ElMessage.success(`角色状态修改成功`);
                    });
                },
                deleteRole(role) {
                    if (role.roleKey === 'admin') {
                        ElMessage.warning('内置保护角色，不允许删除');
                        return;
                    }
                    ElMessageBox.confirm(`确定要删除角色 ${role.roleName} 吗？删除后，拥有此角色的用户将失去相应权限。`, '确认删除', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        const index = this.roles.findIndex(r => r.id === role.id);
                        if (index !== -1) {
                            this.roles.splice(index, 1);
                        }
                        ElMessage.success('角色删除成功');
                    });
                },
                assignPermissions(role) {
                    this.selectedRole = role;
                    // 模拟角色已有权限
                    if (role.roleKey === 'admin') {
                        this.selectedPermissions = [1, 11, 12, 13, 131, 132, 133, 14, 141, 142, 15, 151, 152, 16, 161, 162, 2, 21, 22, 23, 3, 31, 32, 33];
                    } else if (role.roleKey === 'operator') {
                        this.selectedPermissions = [1, 11, 12, 13, 131, 132, 133, 14, 141, 142];
                    } else {
                        this.selectedPermissions = [1, 11, 12];
                    }
                    this.permissionDialogVisible = true;
                },
                saveRolePermissions() {
                    const checkedKeys = this.$refs.permissionTreeRef.getCheckedKeys();
                    const halfCheckedKeys = this.$refs.permissionTreeRef.getHalfCheckedKeys();
                    const allCheckedKeys = [...checkedKeys, ...halfCheckedKeys];
                    
                    // 这里可以保存权限到后端
                    console.log('保存角色权限:', this.selectedRole.roleName, allCheckedKeys);
                    
                    this.permissionDialogVisible = false;
                    ElMessage.success('角色授权成功');
                }
            },
            mounted() {
                // 初始化分页总数
                this.userPagination.total = this.users.length;
                this.rolePagination.total = this.roles.length;
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>