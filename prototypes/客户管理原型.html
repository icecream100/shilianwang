<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视联网适配中心 - 客户管理</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sidebar {
            width: 250px;
            background: #001529;
            color: white;
            height: 100vh;
            overflow-y: auto;
        }
        .main-content {
            flex: 1;
            background: #f5f5f5;
            overflow-y: auto;
        }
        .el-menu {
            border-right: none;
        }
        .el-menu--dark {
            background-color: #001529;
        }
        .el-menu-item.is-active {
            background-color: #1890ff !important;
        }
        .el-submenu__title:hover {
            background-color: #1890ff !important;
        }
        .el-menu-item:hover {
            background-color: #1890ff !important;
        }
        .content-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status-tag {
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
        }
        .status-active {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }
        .status-inactive {
            background: #fff2e8;
            color: #fa8c16;
            border: 1px solid #ffd591;
        }
        .status-disabled {
            background: #fff1f0;
            color: #ff4d4f;
            border: 1px solid #ffccc7;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="flex h-screen">
            <!-- 左侧导航 -->
            <div class="sidebar">
                <div class="p-4 border-b border-gray-600">
                    <h2 class="text-lg font-bold text-white">视联网适配中心</h2>
                </div>
                <el-menu
                    :default-active="activeMenu"
                    class="el-menu-vertical-demo"
                    background-color="#001529"
                    text-color="#fff"
                    active-text-color="#fff"
                    :collapse="false"
                    @select="handleMenuSelect">
                    
                    <el-sub-menu index="1">
                        <template #title>
                            <el-icon><Monitor /></el-icon>
                            <span>运营门户</span>
                        </template>
                        <el-menu-item index="1-1">驾驶舱</el-menu-item>
                        <el-sub-menu index="1-2">
                            <template #title>客户管理</template>
                        </el-sub-menu>
                        <el-sub-menu index="1-3">
                            <template #title>运营分析</template>
                            <el-menu-item index="1-3-1">客户分析</el-menu-item>
                            <el-menu-item index="1-3-2">设备分析</el-menu-item>
                            <el-menu-item index="1-3-3">业务分析</el-menu-item>
                        </el-sub-menu>

                        <el-sub-menu index="1-5">
                            <template #title>系统配置</template>
                            <el-menu-item index="1-5-1">用户管理</el-menu-item>
                            <el-menu-item index="1-5-2">角色管理</el-menu-item>
                        </el-sub-menu>
                        <el-sub-menu index="1-6">
                            <template #title>日志管理</template>
                            <el-menu-item index="1-6-1">登录日志</el-menu-item>
                            <el-menu-item index="1-6-2">操作日志</el-menu-item>
                        </el-sub-menu>
                    </el-sub-menu>
                    
                    <el-sub-menu index="2">
                        <template #title>
                            <el-icon><Connection /></el-icon>
                            <span>接口适配</span>
                        </template>
                        <el-menu-item index="2-1">接入平台管理</el-menu-item>
                        <el-menu-item index="2-2">设备管理</el-menu-item>
                        <el-menu-item index="2-3">通道管理</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="3">
                        <template #title>
                            <el-icon><DataAnalysis /></el-icon>
                            <span>业务数据采集</span>
                        </template>
                        <el-menu-item index="3-1">业务采集设置</el-menu-item>
                        <el-menu-item index="3-2">客户同步设置</el-menu-item>
                        <el-menu-item index="3-3">任务状态</el-menu-item>
                    </el-sub-menu>
                </el-menu>
            </div>

            <!-- 主内容区域 -->
            <div class="main-content">
                <!-- 顶部导航栏 -->
                <div class="bg-white border-b border-gray-200 px-6 py-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-xl font-semibold text-gray-800">客户管理</h1>
                            <p class="text-sm text-gray-500 mt-1">管理客户信息、CRM同步配置和授权资源</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <!-- 用户信息 -->
                            <div class="flex items-center space-x-3 ml-6 pl-6 border-l border-gray-200">
                                <el-dropdown trigger="click" @command="handleUserCommand">
                                    <div class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 px-3 py-2 rounded-lg transition-colors">
                                        <el-avatar :size="32" :src="userInfo.avatarUrl" class="border border-gray-200">
                                            <el-icon><User /></el-icon>
                                        </el-avatar>
                                        <div class="text-left">
                                            <div class="text-sm font-medium text-gray-800">{{userInfo.realName}}</div>
                                            <div class="text-xs text-gray-500">{{userInfo.department}}</div>
                                        </div>
                                        <el-icon class="text-gray-400"><ArrowDown /></el-icon>
                                    </div>
                                    <template #dropdown>
                                        <el-dropdown-menu>
                                            <el-dropdown-item command="profile">
                                                <el-icon><User /></el-icon>
                                                个人中心
                                            </el-dropdown-item>
                                            <el-dropdown-item command="password">
                                                <el-icon><Lock /></el-icon>
                                                修改密码
                                            </el-dropdown-item>
                                            <el-dropdown-item command="logout" divided>
                                                <el-icon><SwitchButton /></el-icon>
                                                退出登录
                                            </el-dropdown-item>
                                        </el-dropdown-menu>
                                    </template>
                                </el-dropdown>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 内容区域 -->
                <div class="p-6">
                    <!-- 搜索和筛选区域 -->
                    <div class="content-card p-6 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <el-input
                                v-model="searchForm.keyword"
                                placeholder="搜索客户ID、名称、联系人、电话"
                                clearable
                                @input="handleSearch">
                                <template #prefix>
                                    <el-icon><Search /></el-icon>
                                </template>
                            </el-input>
                            <el-select v-model="searchForm.status" placeholder="客户状态" clearable>
                                <el-option label="全部" value=""></el-option>
                                <el-option label="正常" value="active"></el-option>
                                <el-option label="暂停" value="inactive"></el-option>
                                <el-option label="停用" value="disabled"></el-option>
                            </el-select>
                            <el-select v-model="searchForm.industry" placeholder="所属行业" clearable>
                                <el-option label="全部" value=""></el-option>
                                <el-option label="金融业" value="finance"></el-option>
                                <el-option label="制造业" value="manufacturing"></el-option>
                                <el-option label="教育" value="education"></el-option>
                                <el-option label="医疗" value="healthcare"></el-option>
                                <el-option label="政府" value="government"></el-option>
                                <el-option label="其他" value="other"></el-option>
                            </el-select>
                            <div class="flex space-x-2">
                                <el-button type="primary" @click="handleSearch">
                                    <el-icon><Search /></el-icon>
                                    搜索
                                </el-button>
                                <el-button @click="resetSearch">
                                    <el-icon><Refresh /></el-icon>
                                    重置
                                </el-button>
                            </div>
                        </div>
                        <!-- 操作按钮区域 -->
                        <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                            <div class="flex space-x-3">
                                <el-button type="primary" @click="showAddCustomer = true">
                                    <el-icon><Plus /></el-icon>
                                    新增客户
                                </el-button>
                                <el-button @click="showCrmConfig = true">
                                    <el-icon><Setting /></el-icon>
                                    CRM同步配置
                                </el-button>
                                <el-button @click="triggerCrmSync">
                                    <el-icon><Refresh /></el-icon>
                                    手动同步CRM
                                 </el-button>

                            </div>
                        </div>
                    </div>

                    <!-- 客户列表 -->
                    <div class="content-card">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-medium">客户列表</h3>

                            </div>
                            
                            <el-table :data="filteredCustomers" style="width: 100%" v-loading="loading">
                                <el-table-column prop="customerId" label="客户ID" width="120"></el-table-column>
                                <el-table-column prop="customerName" label="客户名称" width="180"></el-table-column>
                                <el-table-column prop="contactPerson" label="联系人" width="100"></el-table-column>
                                <el-table-column prop="contactPhone" label="联系电话" width="130"></el-table-column>
                                <el-table-column prop="industry" label="所属行业" width="100"></el-table-column>
                                <el-table-column prop="customerLevel" label="客户级别" width="100"></el-table-column>
                                <el-table-column prop="dataSource" label="信息来源" width="100">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.dataSource === 'MANUAL' ? 'primary' : 'success'" size="small">
                                            {{scope.row.dataSource === 'MANUAL' ? '手动创建' : 'CRM同步'}}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="status" label="状态" width="80">
                                    <template #default="scope">
                                        <span :class="getStatusClass(scope.row.status)">{{getStatusText(scope.row.status)}}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="createTime" label="创建时间" width="150"></el-table-column>
                                <el-table-column label="操作" width="300" fixed="right">
                                    <template #default="scope">
                                        <el-button size="small" @click="viewCustomer(scope.row)">查看</el-button>
                                        <el-button size="small" type="primary" @click="editCustomer(scope.row)">编辑</el-button>
                                        <el-button size="small" type="success" @click="manageResources(scope.row)">授权管理</el-button>
                                        <el-button size="small" type="danger" @click="deleteCustomer(scope.row)">删除</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                            
                            <div class="flex justify-end mt-4">
                                <el-pagination
                                    v-model:current-page="currentPage"
                                    v-model:page-size="pageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="customers.length"
                                    layout="total, sizes, prev, pager, next, jumper">
                                </el-pagination>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新增/编辑客户对话框 -->
        <el-dialog
            v-model="showAddCustomer"
            :title="editingCustomer ? '编辑客户' : '新增客户'"
            width="600px"
            @close="resetCustomerForm">
            <el-form :model="customerForm" :rules="customerRules" ref="customerFormRef" label-width="100px">
                <el-row :gutter="20">
                    <el-col :span="12">
                        <el-form-item label="客户ID" prop="customerId">
                            <el-input v-model="customerForm.customerId" placeholder="请输入客户ID" :disabled="editingCustomer && editingCustomer.dataSource === 'CRM_SYNC'"></el-input>
                            <div v-if="editingCustomer && editingCustomer.dataSource === 'CRM_SYNC'" class="text-xs text-orange-500 mt-1">
                                此字段由CRM系统同步，手动修改可能在下次同步时被覆盖
                            </div>
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="客户名称" prop="customerName">
                            <el-input v-model="customerForm.customerName" placeholder="请输入客户名称"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row :gutter="20">
                    <el-col :span="12">
                        <el-form-item label="联系人" prop="contactPerson">
                            <el-input v-model="customerForm.contactPerson" placeholder="请输入联系人"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="联系电话" prop="contactPhone">
                            <el-input v-model="customerForm.contactPhone" placeholder="请输入联系电话"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row :gutter="20">
                    <el-col :span="12">
                        <el-form-item label="所属行业" prop="industry">
                            <el-select v-model="customerForm.industry" placeholder="请选择行业" style="width: 100%">
                                <el-option label="金融业" value="finance"></el-option>
                                <el-option label="制造业" value="manufacturing"></el-option>
                                <el-option label="教育" value="education"></el-option>
                                <el-option label="医疗" value="healthcare"></el-option>
                                <el-option label="政府" value="government"></el-option>
                                <el-option label="其他" value="other"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="客户级别" prop="customerLevel">
                            <el-select v-model="customerForm.customerLevel" placeholder="请选择级别" style="width: 100%">
                                <el-option label="重要客户" value="important"></el-option>
                                <el-option label="普通客户" value="normal"></el-option>
                                <el-option label="潜在客户" value="potential"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-form-item label="详细地址" prop="address">
                    <el-input v-model="customerForm.address" placeholder="请输入详细地址"></el-input>
                </el-form-item>
                <el-form-item label="客户状态" prop="status">
                    <el-select v-model="customerForm.status" placeholder="请选择状态" style="width: 200px">
                        <el-option label="正常" value="active"></el-option>
                        <el-option label="暂停" value="inactive"></el-option>
                        <el-option label="停用" value="disabled"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="备注">
                    <el-input v-model="customerForm.remarks" type="textarea" :rows="3" placeholder="请输入备注"></el-input>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="showAddCustomer = false">取消</el-button>
                    <el-button type="primary" @click="saveCustomer">保存</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- CRM同步配置对话框 -->
        <el-dialog v-model="showCrmConfig" title="CRM同步配置" width="800px">
            <el-tabs v-model="activeTab">
                <el-tab-pane label="同步配置" name="config">
                    <el-form :model="crmConfig" label-width="120px">
                        <el-form-item label="CRM系统地址">
                            <el-input v-model="crmConfig.apiUrl" placeholder="请输入CRM系统API地址"></el-input>
                        </el-form-item>
                        <el-form-item label="认证方式">
                            <el-select v-model="crmConfig.authType" style="width: 100%">
                                <el-option label="API Key" value="apikey"></el-option>
                                <el-option label="OAuth 2.0" value="oauth"></el-option>
                                <el-option label="Basic Auth" value="basic"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="API密钥">
                            <el-input v-model="crmConfig.apiKey" type="password" placeholder="请输入API密钥"></el-input>
                        </el-form-item>
                        <el-form-item label="同步频率">
                            <el-select v-model="crmConfig.syncFrequency" style="width: 100%">
                                <el-option label="每小时" value="hourly"></el-option>
                                <el-option label="每天" value="daily"></el-option>
                                <el-option label="每周" value="weekly"></el-option>
                                <el-option label="手动" value="manual"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="启用同步">
                            <el-switch v-model="crmConfig.enabled"></el-switch>
                        </el-form-item>
                    </el-form>
                </el-tab-pane>
                <el-tab-pane label="字段映射" name="mapping">
                    <div class="mb-4">
                        <el-button type="primary" size="small" @click="addFieldMapping">
                            <el-icon><Plus /></el-icon>
                            添加映射
                        </el-button>
                    </div>
                    <el-table :data="fieldMappings" style="width: 100%">
                        <el-table-column label="本地字段" width="200">
                            <template #default="scope">
                                <el-select v-model="scope.row.localField" placeholder="选择本地字段">
                                    <el-option label="客户编号" value="customerCode"></el-option>
                                    <el-option label="客户名称" value="customerName"></el-option>
                                    <el-option label="联系人" value="contactPerson"></el-option>
                                    <el-option label="联系电话" value="contactPhone"></el-option>
                                    <el-option label="邮箱" value="email"></el-option>
                                </el-select>
                            </template>
                        </el-table-column>
                        <el-table-column label="CRM字段" width="200">
                            <template #default="scope">
                                <el-input v-model="scope.row.crmField" placeholder="输入CRM字段名"></el-input>
                            </template>
                        </el-table-column>
                        <el-table-column label="转换规则">
                            <template #default="scope">
                                <el-input v-model="scope.row.transformRule" placeholder="输入转换规则"></el-input>
                            </template>
                        </el-table-column>
                        <el-table-column label="操作" width="100">
                            <template #default="scope">
                                <el-button size="small" type="danger" @click="removeFieldMapping(scope.$index)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </el-tab-pane>
                <el-tab-pane label="同步日志" name="logs">
                    <div class="mb-4">
                        <el-button @click="refreshSyncLogs">
                            <el-icon><Refresh /></el-icon>
                            刷新日志
                        </el-button>
                    </div>
                    <el-table :data="syncLogs" style="width: 100%">
                        <el-table-column prop="syncTime" label="同步时间" width="160"></el-table-column>
                        <el-table-column prop="status" label="状态" width="100">
                            <template #default="scope">
                                <el-tag :type="scope.row.status === 'success' ? 'success' : 'danger'">
                                    {{scope.row.status === 'success' ? '成功' : '失败'}}
                                </el-tag>
                            </template>
                        </el-table-column>
                        <el-table-column prop="recordCount" label="处理记录数" width="120"></el-table-column>
                        <el-table-column prop="message" label="详细信息"></el-table-column>
                    </el-table>
                </el-tab-pane>
            </el-tabs>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="showCrmConfig = false">关闭</el-button>
                    <el-button type="primary" @click="saveCrmConfig">保存配置</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 客户详情对话框 -->
        <el-dialog v-model="showCustomerDetail" title="客户详情" width="600px">
            <div v-if="selectedCustomer">
                <el-descriptions :column="2" border>
                    <el-descriptions-item label="客户编号">{{selectedCustomer.customerCode}}</el-descriptions-item>
                    <el-descriptions-item label="客户名称">{{selectedCustomer.customerName}}</el-descriptions-item>
                    <el-descriptions-item label="联系人">{{selectedCustomer.contactPerson}}</el-descriptions-item>
                    <el-descriptions-item label="联系电话">{{selectedCustomer.contactPhone}}</el-descriptions-item>
                    <el-descriptions-item label="邮箱">{{selectedCustomer.email}}</el-descriptions-item>
                    <el-descriptions-item label="所属省份">{{selectedCustomer.province}}</el-descriptions-item>
                    <el-descriptions-item label="状态">
                        <span :class="getStatusClass(selectedCustomer.status)">{{getStatusText(selectedCustomer.status)}}</span>
                    </el-descriptions-item>
                    <el-descriptions-item label="创建时间">{{selectedCustomer.createTime}}</el-descriptions-item>
                    <el-descriptions-item label="最后同步时间" :span="2">{{selectedCustomer.lastSyncTime}}</el-descriptions-item>
                    <el-descriptions-item label="备注" :span="2">{{selectedCustomer.remark || '无'}}</el-descriptions-item>
                </el-descriptions>
            </div>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="showCustomerDetail = false">关闭</el-button>
                    <el-button type="primary" @click="editCustomer(selectedCustomer)">编辑</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 授权资源管理对话框 -->
        <el-dialog v-model="showResourceManagement" title="资源授权管理" width="900px">
            <div class="mb-4">
                <h4 class="text-lg font-medium mb-2">客户信息</h4>
                <div v-if="selectedCustomer" class="bg-gray-50 p-4 rounded">
                    <span class="font-medium">{{selectedCustomer.customerName}}</span>
                    <span class="text-gray-500 ml-2">({{selectedCustomer.customerCode}})</span>
                </div>
            </div>
            
            <el-tabs v-model="resourceActiveTab">
                <el-tab-pane label="资源列表" name="resources">
                    <div class="mb-4">
                        <el-input
                            v-model="resourceSearchKeyword"
                            placeholder="搜索资源"
                            style="width: 250px"
                            clearable>
                            <template #prefix>
                                <el-icon><Search /></el-icon>
                            </template>
                        </el-input>
                        <el-button type="primary" class="ml-4" @click="showAddResourceDialog = true">
                            <el-icon><Plus /></el-icon>
                            添加授权
                        </el-button>
                    </div>
                    
                    <el-table :data="authorizedResources" style="width: 100%">
                        <el-table-column type="selection" width="55"></el-table-column>
                        <el-table-column prop="resourceName" label="资源名称" width="130"></el-table-column>
                        <el-table-column prop="resourceType" label="资源类型" width="80"></el-table-column>
                        <el-table-column prop="businessType" label="业务类型" width="90">
                            <template #default="scope">
                                <el-tag :type="scope.row.businessType === 'CORE' ? 'danger' : scope.row.businessType === 'EXTENDED' ? 'warning' : 'info'" size="small">
                                    {{scope.row.businessType === 'CORE' ? '核心业务' : scope.row.businessType === 'EXTENDED' ? '扩展业务' : '基础业务'}}
                                </el-tag>
                            </template>
                        </el-table-column>
                        <el-table-column prop="description" label="描述" width="150"></el-table-column>
                        <el-table-column prop="authorizeTime" label="授权时间" width="130"></el-table-column>
                        <el-table-column label="操作" width="120">
                            <template #default="scope">
                                <el-button size="small" type="danger" @click="removeAuthorization(scope.row)">取消授权</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </el-tab-pane>
              
            </el-tabs>
            
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="showResourceManagement = false">取消</el-button>
                    <el-button type="primary" @click="saveResourceAuthorization">保存</el-button>
                </span>
            </template>
        </el-dialog>

        <!-- 新增资源授权对话框 -->
        <el-dialog v-model="showAddResourceDialog" title="新增资源授权" width="600px">
            <div class="mb-4">
                <el-input
                    v-model="resourceSearchKeyword"
                    placeholder="搜索资源"
                    clearable>
                    <template #prefix>
                        <el-icon><Search /></el-icon>
                    </template>
                </el-input>
            </div>
            
            <el-table :data="filteredAvailableResources" style="width: 100%" @selection-change="handleResourceSelection">
                <el-table-column type="selection" width="55"></el-table-column>
                <el-table-column prop="resourceName" label="资源名称" width="130"></el-table-column>
                <el-table-column prop="resourceType" label="资源类型" width="80"></el-table-column>
                <el-table-column prop="businessType" label="业务类型" width="90">
                    <template #default="scope">
                        <el-tag :type="scope.row.businessType === 'CORE' ? 'danger' : scope.row.businessType === 'EXTENDED' ? 'warning' : 'info'" size="small">
                            {{scope.row.businessType === 'CORE' ? '核心业务' : scope.row.businessType === 'EXTENDED' ? '扩展业务' : '基础业务'}}
                        </el-tag>
                    </template>
                </el-table-column>
                <el-table-column prop="description" label="描述" width="150"></el-table-column>
                <el-table-column prop="maxUsers" label="最大用户数" width="90"></el-table-column>
            </el-table>
            
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="showAddResourceDialog = false">取消</el-button>
                    <el-button type="primary" @click="confirmResourceAuthorization">确认</el-button>
                </span>
            </template>
        </el-dialog>
    </div>

    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;
        
        createApp({
            data() {
                return {
                    loading: false,
                    currentPage: 1,
                    pageSize: 10,
                    showAddCustomer: false,
                    showCrmConfig: false,
                    showCustomerDetail: false,
                    editingCustomer: null,
                    selectedCustomer: null,
                    activeTab: 'config',
                    activeMenu: 'customer',
                    showResourceManagement: false,
                    showAddResourceDialog: false,
                    resourceActiveTab: 'resources',
                    resourceSearchKeyword: '',
                    selectedResources: [],
                    
                    // 用户信息
                    userInfo: {
                        username: 'admin',
                        realName: '张三',
                        department: '运营管理部',
                        avatarUrl: 'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png'
                    },
                    
                    searchForm: {
                        keyword: '',
                        status: '',
                        industry: ''
                    },
                    
                    customerForm: {
                        customerId: '',
                        customerName: '',
                        contactPerson: '',
                        contactPhone: '',
                        industry: '',
                        customerLevel: '',
                        address: '',
                        status: 'active',
                        remarks: ''
                    },
                    
                    customerRules: {
                        customerId: [{ required: true, message: '请输入客户ID', trigger: 'blur' }],
                        customerName: [{ required: true, message: '请输入客户名称', trigger: 'blur' }],
                        contactPerson: [{ required: true, message: '请输入联系人', trigger: 'blur' }],
                        contactPhone: [
                            { required: true, message: '请输入联系电话', trigger: 'blur' },
                            { pattern: /^1[3-9]\d{9}$/, message: '请输入正确的手机号码', trigger: 'blur' }
                        ],
                        status: [{ required: true, message: '请选择状态', trigger: 'change' }]
                    },
                    
                    customers: [
                        {
                            id: 1,
                            customerId: 'CUS001',
                            customerName: '北京科技有限公司',
                            contactPerson: '张三',
                            contactPhone: '13800138001',
                            industry: 'finance',
                            customerLevel: 'important',
                            address: '北京市朝阳区建国门外大街1号',
                            status: 'active',
                            dataSource: 'CRM_SYNC',
                            crmOriginalId: 'CRM_001',
                            createTime: '2024-01-15 10:30:00',
                            lastUpdateTime: '2024-01-20 14:20:00',
                            remarks: '重要客户，金融行业'
                        },
                        {
                            id: 2,
                            customerId: 'CUS002',
                            customerName: '上海信息技术公司',
                            contactPerson: '李四',
                            contactPhone: '13800138002',
                            industry: 'manufacturing',
                            customerLevel: 'normal',
                            address: '上海市浦东新区陆家嘴环路1000号',
                            status: 'active',
                            dataSource: 'MANUAL',
                            crmOriginalId: '',
                            createTime: '2024-01-16 09:15:00',
                            lastUpdateTime: '2024-01-20 14:25:00',
                            remarks: '手动创建的客户'
                        },
                        {
                            id: 3,
                            customerId: 'CUS003',
                            customerName: '广东网络服务公司',
                            contactPerson: '王五',
                            contactPhone: '13800138003',
                            industry: 'education',
                            customerLevel: 'potential',
                            address: '广东省广州市天河区珠江新城花城大道85号',
                            status: 'inactive',
                            dataSource: 'CRM_SYNC',
                            crmOriginalId: 'CRM_003',
                            createTime: '2024-01-17 16:45:00',
                            lastUpdateTime: '2024-01-19 11:10:00',
                            remarks: '暂停服务，待重新激活'
                        },
                        {
                            id: 4,
                            customerId: 'CUS004',
                            customerName: '江苏智能制造有限公司',
                            contactPerson: '赵六',
                            contactPhone: '13800138004',
                            industry: 'manufacturing',
                            customerLevel: 'important',
                            address: '江苏省南京市建邺区江东中路369号',
                            status: 'active',
                            dataSource: 'MANUAL',
                            crmOriginalId: '',
                            createTime: '2024-01-18 11:20:00',
                            lastUpdateTime: '2024-01-21 09:30:00',
                            remarks: '新签约的重要客户'
                        }
                    ],
                    
                    crmConfig: {
                        apiUrl: 'https://api.crm.example.com',
                        authType: 'apikey',
                        apiKey: '',
                        syncFrequency: 'daily',
                        enabled: true
                    },
                    
                    fieldMappings: [
                        { localField: 'customerCode', crmField: 'customer_id', transformRule: '' },
                        { localField: 'customerName', crmField: 'company_name', transformRule: '' },
                        { localField: 'contactPerson', crmField: 'contact_name', transformRule: '' },
                        { localField: 'contactPhone', crmField: 'phone', transformRule: '' },
                        { localField: 'email', crmField: 'email', transformRule: '' }
                    ],
                    
                    syncLogs: [
                        {
                            syncTime: '2024-01-20 14:30:00',
                            status: 'success',
                            recordCount: 15,
                            message: '同步成功，处理15条记录'
                        },
                        {
                            syncTime: '2024-01-19 14:30:00',
                            status: 'success',
                            recordCount: 12,
                            message: '同步成功，处理12条记录'
                        },
                        {
                            syncTime: '2024-01-18 14:30:00',
                            status: 'failed',
                            recordCount: 0,
                            message: 'API连接超时，同步失败'
                        }
                    ],
                    
                    // 授权资源相关数据
                    authorizedResources: [
                        {
                            id: 1,
                            resourceName: '大厅摄像头',
                            resourceType: '摄像头',
                            businessType: 'CORE',
                            description: '海康威视 DS-2CD3',
                            authorizeTime: '2024-01-15 10:30:00',
                            maxUsers: 100,
                            currentUsers: 45
                        },
                        {
                            id: 2,
                            resourceName: '监控服务器',
                            resourceType: '服务器',
                            businessType: 'EXTENDED',
                            description: 'Dell PowerEdge R740',
                            authorizeTime: '2024-01-16 14:20:00',
                            maxUsers: 50,
                            currentUsers: 20
                        },
                        {
                            id: 3,
                            resourceName: '视频会议系统',
                            resourceType: '软件',
                            businessType: 'BASIC',
                            description: '企业级视频会议解决方案',
                            authorizeTime: '2024-01-17 09:15:00',
                            maxUsers: 200,
                            currentUsers: 80
                        }
                    ],
                    
                    availableResources: [
                        {
                            id: 4,
                            resourceName: '会议室NVR',
                            resourceType: 'NVR',
                            businessType: 'EXTENDED',
                            description: '大华 NVR5216',
                            maxUsers: 30,
                            isAvailable: true
                        },
                        {
                            id: 5,
                            resourceName: '门禁系统',
                            resourceType: '门禁',
                            businessType: 'BASIC',
                            description: '宇视科技 DS-K1T341',
                            maxUsers: 100,
                            isAvailable: true
                        },
                        {
                            id: 6,
                            resourceName: '停车场摄像头',
                            resourceType: '摄像头',
                            businessType: 'CORE',
                            description: '海康威视 DS-2CD3',
                            maxUsers: 50,
                            isAvailable: true
                        },
                        {
                            id: 7,
                            resourceName: '智能分析服务器',
                            resourceType: '服务器',
                            businessType: 'CORE',
                            description: 'AI视频分析专用服务器',
                            maxUsers: 20,
                            isAvailable: true
                        },
                        {
                            id: 8,
                            resourceName: '云存储服务',
                            resourceType: '存储',
                            businessType: 'EXTENDED',
                            description: '企业级云存储解决方案',
                            maxUsers: 500,
                            isAvailable: false
                        }
                    ],
                    
                    resourcePermissions: [
                        {
                            resourceName: '大厅摄像头',
                            permission: '查看',
                            grantTime: '2024-01-15 10:30:00',
                            expireTime: '2025-01-15 10:30:00',
                            status: 'active'
                        },
                        {
                            resourceName: '监控服务器',
                            permission: '管理',
                            grantTime: '2024-01-15 10:30:00',
                            expireTime: '2025-01-15 10:30:00',
                            status: 'active'
                        }
                    ]
                }
            },
            
            computed: {
                filteredCustomers() {
                    let filtered = this.customers;
                    
                    // 关键词搜索
                    if (this.searchForm.keyword) {
                        filtered = filtered.filter(customer => 
                            customer.customerName.includes(this.searchForm.keyword) ||
                            customer.contactPerson.includes(this.searchForm.keyword) ||
                            customer.contactPhone.includes(this.searchForm.keyword) ||
                            customer.customerId.includes(this.searchForm.keyword)
                        );
                    }
                    
                    // 状态筛选
                    if (this.searchForm.status) {
                        filtered = filtered.filter(customer => customer.status === this.searchForm.status);
                    }
                    
                    // 行业筛选
                    if (this.searchForm.industry) {
                        filtered = filtered.filter(customer => customer.industry === this.searchForm.industry);
                    }
                    
                    return filtered;
                },
                
                filteredAvailableResources() {
                    let filtered = this.availableResources.filter(resource => resource.isAvailable);
                    
                    if (this.resourceSearchKeyword) {
                        filtered = filtered.filter(resource => 
                            resource.resourceName.includes(this.resourceSearchKeyword) ||
                            resource.description.includes(this.resourceSearchKeyword)
                        );
                    }
                    
                    return filtered;
                }
            },
            
            methods: {
                // 用户相关方法
                handleUserCommand(command) {
                    switch(command) {
                        case 'profile':
                            this.navigateToProfile();
                            break;
                        case 'password':
                            this.navigateToPassword();
                            break;
                        case 'logout':
                            this.logout();
                            break;
                    }
                },
                
                navigateToProfile() {
                    // 跳转到个人中心
                    console.log('跳转到个人中心');
                    // 这里可以添加路由跳转逻辑
                },
                
                navigateToPassword() {
                    // 跳转到修改密码页面
                    console.log('跳转到修改密码页面');
                    // 这里可以添加路由跳转逻辑
                },
                
                logout() {
                    // 退出登录确认
                    this.$confirm('确定要退出登录吗？', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'warning'
                    }).then(() => {
                        // 执行退出登录逻辑
                        console.log('用户已退出登录');
                        this.$message.success('已退出登录');
                        // 这里可以添加清除token、跳转到登录页等逻辑
                    }).catch(() => {
                        // 取消退出
                    });
                },
                
                handleSearch() {
                    // 搜索逻辑
                    console.log('搜索条件:', this.searchForm);
                },
                
                resetSearch() {
                    this.searchForm = {
                        keyword: '',
                        status: '',
                        industry: ''
                    };
                },
                
                viewCustomer(customer) {
                    this.selectedCustomer = customer;
                    this.showCustomerDetail = true;
                },
                
                editCustomer(customer) {
                    this.editingCustomer = customer;
                    this.customerForm = { ...customer };
                    this.showAddCustomer = true;
                    this.showCustomerDetail = false;
                },
                
                deleteCustomer(customer) {
                    ElMessageBox.confirm(
                        `确定要删除客户 "${customer.customerName}" 吗？`,
                        '确认删除',
                        {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning',
                        }
                    ).then(() => {
                        const index = this.customers.findIndex(c => c.id === customer.id);
                        if (index > -1) {
                            this.customers.splice(index, 1);
                            ElMessage.success('删除成功');
                        }
                    }).catch(() => {
                        ElMessage.info('已取消删除');
                    });
                },
                
                saveCustomer() {
                    this.$refs.customerFormRef.validate((valid) => {
                        if (valid) {
                            if (this.editingCustomer) {
                                // 编辑模式
                                const index = this.customers.findIndex(c => c.id === this.editingCustomer.id);
                                if (index > -1) {
                                    this.customers[index] = { ...this.customerForm, id: this.editingCustomer.id };
                                }
                                ElMessage.success('客户信息更新成功');
                            } else {
                                // 新增模式
                                const newCustomer = {
                                    ...this.customerForm,
                                    id: Date.now(),
                                    createTime: new Date().toLocaleString(),
                                    lastSyncTime: '-'
                                };
                                this.customers.unshift(newCustomer);
                                ElMessage.success('客户添加成功');
                            }
                            this.showAddCustomer = false;
                            this.resetCustomerForm();
                        }
                    });
                },
                
                resetCustomerForm() {
                    this.editingCustomer = null;
                    this.customerForm = {
                        customerId: '',
                        customerName: '',
                        contactPerson: '',
                        contactPhone: '',
                        industry: '',
                        customerLevel: '',
                        address: '',
                        status: 'active',
                        remarks: ''
                    };
                    if (this.$refs.customerFormRef) {
                        this.$refs.customerFormRef.resetFields();
                    }
                },
                
                triggerCrmSync() {
                    this.loading = true;
                    ElMessage.info('正在同步CRM数据...');
                    
                    setTimeout(() => {
                        this.loading = false;
                        ElMessage.success('CRM数据同步完成');
                        // 更新同步日志
                        this.syncLogs.unshift({
                            syncTime: new Date().toLocaleString(),
                            status: 'success',
                            recordCount: Math.floor(Math.random() * 20) + 1,
                            message: '手动同步成功'
                        });
                    }, 2000);
                },
                
                saveCrmConfig() {
                    ElMessage.success('CRM配置保存成功');
                    this.showCrmConfig = false;
                },
                
                addFieldMapping() {
                    this.fieldMappings.push({
                        localField: '',
                        crmField: '',
                        transformRule: ''
                    });
                },
                
                removeFieldMapping(index) {
                    this.fieldMappings.splice(index, 1);
                },
                
                refreshSyncLogs() {
                    ElMessage.success('同步日志已刷新');
                },
                
                getStatusClass(status) {
                    const classes = {
                        'active': 'status-tag status-active',
                        'inactive': 'status-tag status-inactive',
                        'disabled': 'status-tag status-disabled'
                    };
                    return classes[status] || 'status-tag';
                },
                
                getStatusText(status) {
                    const texts = {
                        'active': '正常',
                        'inactive': '暂停',
                        'disabled': '停用'
                    };
                    return texts[status] || status;
                },
                
                // 授权资源管理相关方法
                manageResources(customer) {
                    this.selectedCustomer = customer;
                    this.showResourceManagement = true;
                    this.resourceActiveTab = 'resources';
                },
                
                removeAuthorization(resource) {
                    ElMessageBox.confirm(
                        `确定要取消对 "${resource.resourceName}" 的授权吗？`,
                        '确认取消授权',
                        {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning',
                        }
                    ).then(() => {
                        const index = this.authorizedResources.findIndex(r => r.id === resource.id);
                        if (index > -1) {
                            this.authorizedResources.splice(index, 1);
                            ElMessage.success('授权已取消');
                        }
                    }).catch(() => {
                        ElMessage.info('已取消操作');
                    });
                },
                
                handleResourceSelection(selection) {
                    this.selectedResources = selection;
                },
                
                confirmResourceAuthorization() {
                    if (this.selectedResources.length === 0) {
                        ElMessage.warning('请选择要授权的资源');
                        return;
                    }
                    
                    // 将选中的资源添加到已授权列表
                    this.selectedResources.forEach(resource => {
                        const exists = this.authorizedResources.find(r => r.id === resource.id);
                        if (!exists) {
                            this.authorizedResources.push({
                                ...resource
                            });
                            
                            // 添加权限记录
                            this.resourcePermissions.push({
                                resourceName: resource.resourceName,
                                permission: '查看',
                                grantTime: new Date().toLocaleString(),
                                expireTime: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toLocaleString(),
                                status: 'active'
                            });
                        }
                    });
                    
                    // 从可用资源中移除已授权的资源
                    this.selectedResources.forEach(resource => {
                        const index = this.availableResources.findIndex(r => r.id === resource.id);
                        if (index > -1) {
                            this.availableResources.splice(index, 1);
                        }
                    });
                    
                    ElMessage.success(`成功授权 ${this.selectedResources.length} 个资源`);
                    this.showAddResourceDialog = false;
                    this.selectedResources = [];
                },
                
                saveResourceAuthorization() {
                    ElMessage.success('资源授权保存成功');
                    this.showResourceManagement = false;
                },
                
                handleMenuSelect(key) {
                    this.activeMenu = key;
                    // 这里可以添加不同菜单项的处理逻辑
                    if (key === 'customer') {
                        // 客户管理相关逻辑
                    } else if (key === 'resource') {
                        // 授权资源管理相关逻辑
                        ElMessage.info('授权资源管理功能开发中...');
                    }
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>